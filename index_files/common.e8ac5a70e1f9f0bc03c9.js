/*! For license information please see common.e8ac5a70e1f9f0bc03c9.js.LICENSE.txt */
(self.webpackChunkvk=self.webpackChunkvk||[]).push([[8592],{66347:function(e,t,n){"use strict";var i=n(27813);window.FeedNotifications={webActionsAcceptHandlers:{reveal_bdya:function(e,t,n,i,o){var a=gpeByClass("_block",e);return ajax.post("profileEdit.php",{act:"reveal_birthday",from:"feed_assistance",hash:o},{onDone:function(e){var t=window.Snackbar;t&&t.init&&t.init({text:e.msg}),remove(a)}}),!0}},webActionsDeclineHandlers:{},withoutNavActions:["enable_browser_notifications","reveal_bdya"],hide:function(e){function t(t,n,i,o,a,r,s,l){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}((function(e,t,n,o,a,r,s,l){var c={_ajax:1,act:"hide_internal_notification",reason:o,id:t,hash:n},u={},d=gpeByClass("_block",e),_=!0;if("decline"==o){var f=this.webActionsDeclineHandlers[r];_=this.runActionHandler(f,e,c,u,s,n),hide(d)}else{var p=this.webActionsAcceptHandlers[r];_=this.runActionHandler(p,e,c,u,s,n),lockButton(e),"add_custom_newsfeed"==r&&((0,i.setCookie)("remixcustom_feed_added",s),c.action=r,c.action_section=s.section,c.action_hash=s.hash)}return u.onDone=function(){"compact"===l&&"accept"===o||cur.destroy.push((function(){return remove(d)})),~this.withoutNavActions.indexOf(r)||nav.go(e,a)}.bind(this),u.onFail=function(){unlockButton(e)},Promise.resolve(_).then((function(e){(e||isUndefined(e))&&ajax.post("/index.php",c,u)})),!1})),runActionHandler:function(e,t,n,i,o,a){return!isFunction(e)||e(t,n,i,o,a)},addWebActionAcceptHandler:function(e,t){this.webActionsAcceptHandlers[e]=t},addWebActionDeclineHandler:function(e,t){this.webActionsDeclineHandlers[e]=t}}},25914:function(e,t,n){"use strict";var i=n(46769),o=n(11393),a=n(18613),r=n(17656),s=n(9046),l=n(49751),c=n(78466),u=n(54412),d=browser.meizu||browser.mi||browser.uc_mini||0!==browser.ios&&browser.ios<10||browser.chrome&&browser.version.split(".")[0]<53,_=!d&&!!a.default.getFlag(a.FLAG_MP4);onDOMReady((function(){p.onUpdate(),page.onChange((function(){p.onUpdate()}))}));var f={gifs:[],currentAutoplayElement:null,ignore:[]},p={isBadBrowser:d,isMp4Supports:function(){return _},openPopup:function(e,t,n){if(void 0===n&&(n={}),this.autoplayTest(),e&&cancelEvent(e),function(e){cur.loadedGifs||(cur.loadedGifs={});return!cur.loadedGifs[e.raw]}(n)&&n.needConfirm){var i=function(e){return(0,s.ceFromString)(o.default.html((0,r.default)({scrollable:!0,header:{title:getLang("mobile_wall_gif_size_warning_popup_title")},content:[getLang("mobile_wall_gif_size_warning").replace("{size}",e.size),{class:"Popup__buttons",inner:[(0,l.default)({onClick:'Gif.confirm(this, "'+e.raw+'")',use_native_onclick:!0,class:"Popup__button",theme:"regular",inner:o.default.wrap(getLang("mobile_continue"))}),(0,l.default)({onClick:"Popup.close(this)",use_native_onclick:!0,class:"Popup__button",theme:"secondary",inner:o.default.wrap(getLang("mobile_cancel"))})]}]})))}(n,t.getAttribute("data-media"));return domInsertBefore(i,t),void r.default.open(i,!0)}p.openMediaView(n.raw,n.hash,{hasVideo:n.hasVideo,no_push:n.no_push})},openMediaView:function(e,t,n){void 0===n&&(n={});var o=makeUrl("/doc"+e+(n.hasVideo?"?mp4":""),{hash:t});(0,c.fetchMediaView)().then((function(a){var r=a.open,l=a.actionBridge,c=a.setItems;(0,s.statlogsValueEvent)(u.STATLOG_MEDIAVIEW_EVENT,"init","gif");var d=l.handle("visibilityChanged",(function(o){if(o.state){var a=nav.getQuery(),r=(0,i.default)({},a,{z:"doc"+e+"/"+(t||"")}),l=!!a.z,c=nav.path+(0,s.obj2qs)(r)+nav.hash;nav.go(c,null,{no_push:n.no_push,push_only:!0,replace:l})}else{d();var u=qs2obj(nav.params);if(!!u.z&&history.length>1)return history.back(),clog("History back done"),!1;var _=nav.path+(0,s.obj2qs)(u)+nav.hash;nav.backToTabHistory(null,{href:_,replace:!0,restore:!0})}}));c([{type:2,id:e,gifType:n.hasVideo?"video":"image",src:o}]),r()})).catch((function(){window.open(o,"_blank")}))},close:function(){var e=(0,i.default)({},nav.getQuery());delete e.z;var t=nav.path+(0,s.obj2qs)(e)+nav.hash;nav.go(t,null,{push_only:!1,nav_incr:!0})},confirm:function(e,t){cur.loadedGifs[t]=!0,r.default.close(e),(0,s.geBySel1)('[data-media="'+t+'"]').click()},autoplayTest:function(){a.default.detectAutoplay().then((function(e){_=a.default.getFeatures().mp4&&e&&a.default.getFlag(a.FLAG_MP4)&&!d}))},activateGIF:function(){if("/mail"!==nav.path){var e=scrollTop(),t=e+window.innerHeight,n=e+window.innerHeight/2,i={};Array.from(f.gifs||[]).forEach((function(o){var a=getXY(o)[1],r=a>=e&&a<=t,s=Math.abs(n-a);r&&(i[s]=o)}));var o=i[Math.min.apply(Math,Object.keys(i))];o?o.classList.contains("current_gif")||-1===f.ignore.indexOf(o)&&(post.toggleGif(o,!1,!1,!0),f.currentAutoplayElement=o):post.hidePlayingGifs(!1,!0)}},onUpdate:function(){a.default.getFlag(a.FLAG_GIF_AUTOPLAY)&&(f.gifs=[].concat(Array.from($$(".doc_preview_rows_1 .doc_preview_gif")||[])),onBodyScroll((0,s.throttle)(p.activateGIF,200)))},getState:function(){return f},setState:function(e,t){f[e]=t}};window.Gif=p},66948:function(){window.Informer={close:function(e){hide(e)}}},64537:function(e,t,n){"use strict";var i=n(61124);window.Podcast={toggleFave:function(e,t,n){var i="snippet__favorite_active",o=hasClass(e,i);ajax.post("fave.php",{act:"fave_podcast",add:!o,hash:n,audio_id:t,ref:cur.module}),attr(e,"aria-label",o?lang.mobile_bookmarks_actions_add:lang.mobile_bookmarks_actions_remove),o?removeClass(e,i):addClass(e,i)},onOpenClick:function(e,t){var n=$(".snippet__popup",e.closest(".snippet")),o="";cur&&cur.module?o=cur.module:nav&&"/feed"===nav.cur?o="feed":!nav||"/feed?section=podcasts"!==nav.cur&&"/feed/podcasts"!==nav.cur||(o="feed_podcasts"),statlogsValueEvent("mvk_podcasts_actions","mvk_open_popup",t,o),i.default.open(n,!0)}}},3873:function(e,t,n){"use strict";var i=n(47847),o=n(1730),a={getHash:function(){var e=(0,o.$)("#feed_add_form"),t=qs2obj(e.action.split("?")[1]);return e.getAttribute("data-hash")||t.hash},openCopyright:function(e,t,n,a){cancelEvent(e);var r=!1;if("BUTTON"===e.target.tagName)r=e.target.disabled;else if("LABEL"===e.target.tagName){r=(0,o.$)("button",e.target).disabled}r||i.default.open(t,n,a)},saveSource:function(e,t){if(t.target){if(13!==t.keyCode)return;t=t.target}var n=(0,o.$)(".AddCopyrightPopup__input",t.closest(".AddCopyrightPopup")),a=n.querySelector("input");i.default.submit(a.value,e,n)},deleteSource:function(e,t,n){var a=(0,o.$)(".AddCopyrightPopup__input",t.closest(".AddCopyrightPopup"));event&&cancelEvent(e),i.default.remove(n,a)},deleteObject:function(e){e&&cancelEvent(e);var t=nav.params,n=qs2obj(t);delete n.object,delete n.list,n.delete_object=1,post.saveDraft(null,a.getHash(),""+nav.path+obj2qs(n))}};window.posting=a},65572:function(e,t,n){"use strict";var i=n(46769),o=n(80444),a=n(9046),r=n(5606),s=n(86205),l=n(1730),c=n(3226),u=n(43116),d=n(83652),_=n(86353),f=n(24961),p={};function m(e){var t,n,h,v;m.getQueryREs=_e;var g,A,y,w,S,b,k,C,E,I,T,M,P,L=!1,N=[],R={},x={},B={},D={},O=!1,U=null,H=null,F=null,V=0,j=[],$=null,q=null,W=null,G=!1,Y=!1,K=10,Q=[],z=!0,X=!1,J=!1,Z=!1,ee={},te=[],ne=!1,ie="",oe=!1,ae=null,re=0,se=0,le=!1,ce={},ue=e&&"AudioSectionSearch_field"===e.field,de=Wd.elem({class:["show_next_wrap","show_next_wrap_transparent"],inner:{class:"show_more_loading",inner:{tag:"i",class:"i_loading",inner:""}}});function _e(e){var t,n,i;e=e.replace(/https?:\/\/(m\.)?vk\.com\/([^#]+#\/)?/,"");for(var o=Y,r=[e,n=(0,a.parseRusKeys)(e,o)||e,i=(0,a.parseLatKeys)(e,o)||e,(0,a.parseLat)(n),(0,a.parseCyr)(i)],s={},l=[],c=0,u=r.length;c<u;c++)r[c]&&!s[r[c]]&&(s[r[c]]=!0,t=(t=(0,a.escapeRE)(r[c])).replace(/[её]/gi,"[её]").replace(/(e|yo)/gi,"(?:e|yo)"),l.push(new RegExp("(^|\\s|\\(|>)("+t+")","gi")));return l}function fe(e){return void 0===e&&(e=""),"_"+e+(ee&&(0,a.len)(ee)?JSON.stringify(ee):"")}function pe(e,t,n,r){if(clearTimeout(H),!n)return H=setTimeout((function(){pe(e,t,!0)}),10),!1;var s=(0,a.val)(e)||"";if(U===s&&!r)return!1;var l,c=fe(s),u=x[c],d=_e(s);if(!ue&&!u&&s.length>2&&x["_"+s.slice(0,-2)]){var _="_"+s.slice(0,-2);x[_]&&D[_]&&!x[_].length&&(!Z||Z&&!B[_])&&(D[c]=!0,u=x[c]=[],Z&&(B[c]=""))}r&&(delete D[c],delete x[c],delete B[c]);var f=0;if(!u){u=[];if(qsearch.isCachedPage)f=((0,a.geByClass1)("_si_container",g)||g).childNodes.length;if(!s&&N.length)for(var p=V,m=V+Math.min(Math.max(K,f),N.length);p<m;p++)u.push([N[p]]);else{var h={},v=0;for(p=0,m=N.length;p<m;p++){var A=N[p];if(R[A]){if(h[A]=!0,(l=Ae(d,R[A][0]))&&(u.push([A,l]),++v>=30))break;0}}if(v<30)for(var A in R)if(!h[A]&&(l=Ae(d,R[A][0]))){if(u.push([A,l]),++v>=30)break;0}}D[c]=D[c]||!s&&N.length||u.length>2*K,D[c]=D[c]||Z&&u.length>K}var y=!C||!!s;(!D[c]&&(z||Z)||r)&&!k&&y&&me(e,s),x[c]=u;var w=U!==s;if(U=s,ye(u,B[c]),"string"==typeof I?Wd.handle2([I],null,s,g):I&&I(s,g),(J||!U||w)&&(re=Math.max(K,f)),ne&&O){var S=(0,o.parseURL)(nav.cur),b=(0,a.qs2obj)(S.search.replace("?","")),E=Object.keys(b).reduce((function(e,t){return te.includes(t)?e[t]=ee[t]:te.includes(t)||(e[t]=(0,a.isUndefined)(e[t])?b[t]:e[t]),e}),(0,a.extend)((0,a.copy)(ee),{q:s})),T=o.default.make(nav.path,(0,i.default)({act:E.act},E)),M=(0,a.extend)(nav.page_get(nav.cur)||{},{page:(0,a.ge)("m"),state:page.stash(),cur:window.cur,options:{replacePrevPage:!0}});nav.set({replace:!0,nav:(0,a.extend)({},nav,{cur:nav.path,path:nav.path||"",push:T||"",params:(0,a.obj2qs)(E).replace("?","")||""})}),page.save(T,M)}return(0,a.onBodyScrollForce)(),!1}function me(e,n,i){if(!h){var o=ue?800:200;if(clearTimeout(F),!i)return F=setTimeout((function(){me(e,n,!0)}),o),!1;(0,_.partConfigEnabled)("mvk_quick_search_canceled_requests")&&null!==ae&&(ve("aborted",n),ae.abort()),ae=window.ajax.post(t,(0,a.extend)({_ajax:1,q:n},ee),{onDone:function(t,i,o){var r;"string"==typeof E?(r=Wd).handle2.apply(r,[[E],null].concat(Array.prototype.slice.call(arguments),[n,g])):E&&E.apply(void 0,Array.prototype.slice.call(arguments).concat([n,g]));for(var s,l=fe(n),c=x[l]||[],d={},_=_e(n),f=0;f<c.length;f++)d[c[f][0]]=!0;for(var p=0;p<i.length;p++){var m=i[p];d[m]||((s=Ae(_,t[m][0]))||G||!n)&&c.push([m,s])}D[l]=!0,x[l]=c,Z&&(B[l]=o||""),R=(0,a.extend)(t,R),ce._cache=R,z=!X||(0,a.len)(R)<X,U===n?(ye(c,B[l]),(0,a.onBodyScrollForce)(),(0,u.updateCounters)()):delete x[l],z||(0,a.removeClass)("input_loading",e),b&&(z=!1,X=Object.keys(R).length),ve("successful",n),ae=null},onFail:function(){var t=fe(n);delete x[t],(0,a.removeClass)("input_loading",e),ve("failed",n)}}),ve("sent",n),(0,a.geByClass1)("al_loading",g)||(0,a.addClass)("input_loading",e)}}function he(e){void 0===e&&(e="");var t=e.length;if(t<10)return t.toString();var n=t.toString().length,i=Math.pow(10,n-1),o=Math.floor(t/i)*i;return o+" - "+(o+i)}function ve(e,t){void 0===t&&(t=""),(0,_.partConfigEnabled)("mvk_quick_search_canceled_requests_stats")&&(0,f.saveStatlogEvents)({name:"mvk_quick_search_requests",value:window.vk.id,keys:[e,he(t),ie,window.cur.module]})}function ge(){var e=g&&g.querySelector(".show_next_wrap");e&&e.remove()}function Ae(e,t){if(!t)return!1;"string"!=typeof t&&(t=t.toString());var n=[t],i=/([№])/gi;-1!==t.search(i)&&n.push(t.replace(i,""));for(var o=0;o<n.length;o++)for(var a=0,r=e.length;a<r;a++)if(-1!==n[o].search(e[a]))return e[a];return!1}function ye(e,t,n){var i="";if(q&&g){var o=Object.keys(Q).filter((function(e){return!!Q[e]})).map((function(e){return e+""}));o.length&&""===U&&(e=e.filter((function(e){return!o.includes(String(e[0]))})),o.forEach((function(t){e.unshift([t,!1])})));for(var c=function(t){var n=e[t],o=n[0],a=n[1];if(!R[o])return"continue";var r=R[o].slice(1);if(a)for(var s in j){var l=j[s];r[l]&&(r[l]=r[l].replace(a,'$1<em class="found">$2</em>'))}i+=q.apply({id:o,q:U,highlight:function(e){if("string"!=typeof e)throw new Error("Highlighting expected string but got "+typeof e);return e.replace(a,'$1<em class="found">$2</em>')},template:function(e,t){var n=this;return e.replace(/%(\d+)%|#(\d+)#/g,(function(e,i,o){return o&&t[o-1]?n.highlight(t[o-1]):i&&t[i-1]?t[i-1]:""}))}},r)},u=0;u<e.length;u++)c(u);if(!i&&!D[fe(U)]&&(z||Z)&&!k){ge(),(0,a.removeClass)("_si_container_loading",g);var _=Wd.html({class:"al_loading qs_loading",inner:(0,s.default)((0,d.getLoading40Icon)())});i=U?_:'<div id="al_loading"></div>'}if(!i&&W&&(i=W(U)),(0,a.removeClass)("input_loading",A),n&&(i+=n),t||i!==P||oe){var f=$?$(i,U,J,t):i+(t||"");(0,a.val)(g,f)}if(P=i,w){var p=(0,l.$)('[data-prefix="'+ie+'"]');p&&p.classList.toggle("qs_with_clear",!!U)}S&&(0,a.toggle)(S,!!U),!U&&(0,r.alLoadingFix)(),(0,l.$)(".al_loading",g)&&(le=!0),T&&T(U)}}(0,a.extend)(this,{go:function(e){return!A||(pe(A,e,!0,!0),A.blur(),(0,a.cancelEvent)(e),!1)},redraw:function(){var e=fe(U);ye(x[e],B[e]),(0,a.onBodyScrollForce)()},clear:function(e,t){return(0,a.val)(A,""),t?(0,a.elfocus)(A):(0,a.elblur)(A),this.setSearchParams({}),this.go(e),(0,a.cancelEvent)(e),!1},blur:function(){(0,a.elblur)(A)},toggleAttach:function(e,t){Q[e]=t},setSearchParams:function(e){var t=(0,a.copy)(ee);if(isArray(e)){var n=nav.getQuery()||{};ee=(0,a.extend)(ee,e.reduce((function(e,t){var i=n[t];return i&&(e[t]=i),e}),{}))}else ee=e;var i=JSON.stringify(t)!==JSON.stringify(ee);this.onSearchParamsChange(ee,t,i);var o=(0,l.$)('[data-prefix="'+ie+'"]');if(o){var r=(0,l.$)(".filter_btn",o);r&&((0,a.toggle)(r,!!U),O&&i&&(R={}))}},getSearchParams:function(){return ee},onSearchParamsChange:(0,c.default)(),removeFromCache:function(e,t){for(var n=0,i=Object.keys(p);n<i.length;n++){var o=i[n];if(new RegExp(e).test(o)){var a=p[o];(null==a?void 0:a._cache[t])&&(null==a||delete a._cache[t]);break}}},init:function(e){var i=this;if(e=e||{},g=(0,a.ge)(e.container)||null,A=(0,a.ge)(e.field)||null,y=(0,a.ge)(e.btn)||null,w=(0,a.ge)(e.clear_btn)||null,S=(0,a.ge)(e.filter_btn)||null,U=null,!e.init_once||!(0,a.attr)(g,"data-qsearch-inited")){if(!O||t!=e.action||!e.init_once){x={},B={},D={},t=e.action||"",L=null!==e.next_from,v=e.next_from,n=e.al_action||t,h=e.local_only||!1,N=e.top_items||[],R=e._cache||{},oe=e.forceRerender||!1,j=e.hl_fields||[],$=e.tpl||null,q=e.item_tpl||null,W=e.null_tpl||null,G=e.soft_filter||!1,Y=e.need_invalid_keys||!1,K=e.top_len||10,X=e.load_limit||!1,E=e.onLoaded||!1,I=e.onFiltered||!1,T=e.onRendered||!1,M=e.onFocusChanged||!1,J=e.al_need||!1,V=!J&&e.init_offset||0,Z=e.global_search||!1,k=e.no_search_query||!1,C=e.search_non_empty_query||!1,b=e.load_once||!1,ne=e.updateQuery||!1,te=e.availableSearchParams||[],ie=e.prefix||"";var o=e.action+e.container;p[o]?ce=p[o]:(ce._cache=R,ce.top_items=N,p[o]=ce),qsearch.isCachedPage&&(N=ce.top_items,R=ce._cache,v=ce.next_from),te.length&&(this.setSearchParams(te),window.onDOMReady((function(){i.setSearchParams(te),(0,a.onBodyResize)((function(){i.setSearchParams(te)}))})))}var r=null;t&&g&&A&&q&&(z=!0!==t&&(!X||(0,a.len)(R)<X),(0,a.addEvent)(A,"focus",(function(e){e&&e.preventDefault();clearTimeout(r),M&&M.call({q:U},!0),function t(n){!n&&pe(A,e,!0),r=setTimeout(t,100)}(!0)})),(0,a.addEvent)(A,"keydown keypress change blur",(function(e){"blur"==e.type&&(clearTimeout(r),M&&M.call({q:U},!1)),pe(A,e,"keydown"!=e.type&&"keypress"!=e.type)})),e._new||y&&!(0,a.attr)(y,"onclick")&&(0,a.attr)(y,"onclick","return qsearch.go(event);"),!J||O&&e.init_once||(re=K,se=(0,a.len)(R),(0,a.initAutoScroll)((function(){var e=((0,a.geByClass1)("_si_container",g)||g).childNodes;return e[re]||e[e.length-1]}),(function(){var e=(0,a.geByClass1)("_si_container",g)||g;if(!le&&!U)if(L?!!v:re+K>se&&z)le=!0,g&&g.append(de),(0,a.addClass)(e,"_si_container_loading"),window.ajax.post(n,{_ajax:1,offset:se,next_from:v,q:U},{onDone:function(n,i,o,r){v=o;var s,l=r?r.needLoad:void 0,c=r&&r.html||"";"string"==typeof E?(s=Wd).handle2.apply(s,[[E],null].concat(Array.prototype.slice.call(arguments))):E&&E.apply(void 0,arguments);var u=(0,a.len)(n);if(le=!1,ge(),(0,a.removeClass)(e,"_si_container_loading"),X||(N=N.slice(0,se).concat(i),ce.top_items=N),se+=u,R=(0,a.extend)(n,R),ce._cache=R,ce.next_from=v,z=!0!==t&&(!X&&u||(0,a.len)(R)<X),!1===l&&(z=!1),!U){re+=K;for(var d=[],_=0,f=Math.min(re,N.length);_<f;_++)d.push([N[_]]);ye(d,B._,c),(0,a.onBodyScrollForce)()}},onFail:function(){le=!1,ge(),(0,a.removeClass)(e,"_si_container_loading")}});else if(re<N.length){re+=K;for(var i=[],o=0,r=Math.min(re,N.length);o<r;o++)i.push([N[o]]);ye(i,B._),(0,a.onBodyScrollForce)()}}))),e.common_cache&&(e.common_cache&&e.common_cache._gq_cache&&(B=e.common_cache._gq_cache),e.common_cache._q_loaded&&(D=e.common_cache._q_loaded)),!e.skip_init_filter&&pe(A,null,!0),e.init_once&&(0,a.attr)(g,"data-qsearch-inited",!0),O=!0)}}}),e&&this.init(e)}window.QuickSearch=m,window.QuickSearchCache=p,window.qsearch=new m},35979:function(e,t,n){"use strict";var i=n(62691);window.Scroller=function(e,t){var n,o,a,r,s,l=t&&t.ignoreMouseWheel,c=t&&t.noAutoScroll,u=!isUndefined(document.ontouchmove),d=!0,_=!1,f=!1,p=!1,m=!1,h=0,v=0,g=!1,A=0,y=!1,w=!1,S=!1,b=!1;function k(e){var t=e.touches,n=getX(o),i=getY(o);return{x:((t&&t[0]?t[0].pageX:e.pageX)||0)-n,y:((t&&t[0]?t[0].pageY:e.pageY)||0)-i}}function C(e){g||(g=[]),g.push([vkNow(),e]),g=g.slice(-20)}function E(){g=!1}function I(){if(!g||g.length<2)return[0,0,0];for(var e=vkNow(),t=!1,n=g.pop(),i=g.length-1;i>=0;i--){if((o=e-g[i][0])>150)break;t=g[i]}if(!t||!n)return[0,0,0];var o,a=n[1].x-t[1].x,r=n[1].y-t[1].y,s=Math.sqrt(a*a+r*r);return(o=n[0]-t[0])?[s/o,a/o,r/o]:[0,0,0]}function T(e){"touchstart"==e.type?d=!e.touches||1==e.touches.length:"touchmove"==e.type?d=!1:"click"==e.type&&(d||(cancelEvent(e),d=!0))}function M(e){if(!(window.isNewMail&&e.target.closest(".stickers_panel")&&e.target.closest(".messenger")||b&&e.touches&&e.touches.length>1)){if(E(),f){if(v<=1)return}else if(getW(o)-getW(a)>=0)return;p=k(e),C(m=p),S=!0,setStyle.animate(a)}}function P(e){if(p&&(b||S)){thover&&thover.cancel(e);var t=k(e);if(C(m=t),S){var n=p.x-t.x,i=p.y-t.y;if(Math.abs(n)>=Math.abs(i)&&(cancelEvent(e),b=!0),S=!1,b){var r=getY(o),s=getH(o),l=scrollTop(),u=getCh();!c&&(r-7<l?scrollTop(r-7):r+s+7>l+u&&scrollTop(r+s+7-u))}}if(b)if(cancelEvent(e),f){var d=getW(o);n=p.x-t.x;(h<=0&&n<0||h>=v-1&&n>0)&&(n/=3);var g=-h-n/d,y=_?100*g+"%":g*d;setStyle.transform(a,{translate:[y,0]})}else{var w=getW(o)-getW(a);n=p.x-t.x;if(w>0&&(w=0),(g=A-n)<w)y=w-(w-g)/3;else if(g>0)y=0+(g-0)/3;else y=A-n;x(y),setStyle.transform(a,{translate:[y,0]})}}}function L(e){if(p&&b){if(cancelEvent(e),f){var t=4.7*I()[1],n=p.x-m.x,i=getW(o),r=Math.abs(n)>=i/2;(h>0&&(r&&n<0||t>1)||h<v-1&&(r&&n>0||t<-1))&&(h+=n>0?1:-1);var s=-h,l=_?100*s+"%":s*i;p=!1,E(),B(),setStyle.animate(a,"transform",{duration:200,func:"ease"}),setStyle.transform(a,{translate:[l,0]})}else{var c=function(){if(!g)return!1;var e=I(),t=e[0],n=e[1];if(E(),!t)return!1;var i=t/4.7,o=n*i-4.7*i*i/2;return i*=530,o*=140,clog("dx",o,"t",i),!(t<.1||!o)&&{dx:o,t:i}}(),u=getW(o)-getW(a);n=p.x-m.x,s=A-n;c&&(s+=c.dx),u>0&&(u=0),A=s<u?u:s>0?0:s;var d={duration:200,func:"ease"};c&&(d={duration:c.t,func:"cubic-bezier(0, 1, 1, 1)"}),x(A),setStyle.animate(a,"transform",d),setStyle.transform(a,{translate:[A,0]})}b=!1}}function N(e){if(!(l||window.isNewMail&&e.target.closest(".stickers_panel")&&e.target.closest(".messenger"))){if(preventEvent(e),f){if(v<=1)return}else if((n=getW(o)-getW(a))>=0)return;var t=(e.detail?e.detail:e.wheelDelta)>0?3:-3;if(!1===y&&(y=0),y+=t,!f){var n=getW(o)-getW(a),i=A-y;if(n>0&&(n=0),i<n)var r=n-(n-i)/3;else if(i>0)r=0+(i-0)/3;else r=A-y;x(r),setStyle.transform(a,{translate:[r,0]})}clearTimeout(w),w=setTimeout((function(){if(f){(h>0&&y<0||h<v-1&&y>0)&&(h+=y>0?1:-1);var e=-h,t=getW(o),n=_?100*e+"%":e*t;B(),setStyle.animate(a,"transform",{duration:200,func:"ease"}),setStyle.transform(a,{translate:[n,0]})}else{var i=getW(o)-getW(a);i>0&&(i=0),(e=A-y)<i?A=i:e>0?A=0:A-=y,x(n),setStyle.animate(a,"transform",{duration:200,func:"ease"}),setStyle.transform(a,{translate:[A,0]})}y=!1}),200)}}function R(e){if(f){var t=h;if(e&&e.target){var n=hasClass("sp_ppt",e.target)?e.target:gpeByClass("sp_ppt",e.target),i=+attr(n,"data-i");h=i<0?0:i>v-1?v-1:i}p=!1,E(),b=!1;var r=getW(o),s=-h,l=_?100*s+"%":s*r;B(),t!=h&&setStyle.animate(a,"transform",{duration:200,func:"ease"}),setStyle.transform(a,{translate:[l,0]})}}function x(e){if(!f){e=e||A;var t=getW(o)-getW(a);toggleClass("sw_left",o,e<0),toggleClass("sw_right",o,e>t)}}function B(){if(f){var e=geByClass1("sp_ppt_sel",n);e&&e===s[h]||(removeClass("sp_ppt_sel",e),addClass("sp_ppt_sel",s[h]))}}extend(this,{init:function(){o=geByClass1("scroller_wrap",n),a=geByClass1("scroller_cont",o),f?(r=geByClass1("sp_pages_pts",n),s=geByClass("sp_ppt",r),v=(geByClass("scroller_page",a)||[]).length,h=0,B()):x(A=0),g=!1,setStyle.transform(a,{translate:[0,0]}),u?(addEvent(o,"touchstart touchmove click",T),addEvent(o,"touchstart",M),addEvent(o,"touchmove",P),addEvent(o,"touchend touchcancel",L)):(addEvent(o,"mousewheel",N),addEvent(r,"click",R)),_||onBodyResize(R)},destroy:function(){u?(removeEvent(o,"touchstart touchmove click",T),removeEvent(o,"touchstart",M),removeEvent(o,"touchmove",P),removeEvent(o,"touchend touchcancel",L)):(removeEvent(o,"mousewheel",N),removeEvent(r,"click",R)),_||onBodyResize("__clear",R)},onShow:function(){f?B():x(A)},canClick:function(){return d}}),n=e,(t=t||{}).byPage?(f=!0,_=!i.default.android):(f=!1,_=!1,this.showElem=function(e){if(!f){var t=getX(e)-getX(o),n=t+A,i=n+getW(e),r=getW(o),s=!1;n<0?s=0-t+20:i>r&&(s=r-getW(e)-t-20);var l=getW(o)-getW(a);l>0&&(l=0),s<l?s=l:s>0&&(s=0),clog(t,A,n,i,0,r,s),!1!==s&&(x(A=s),setStyle.animate(a,"transform",{duration:200,func:"ease"}),setStyle.transform(a,{translate:[A,0]}))}})}},26256:function(e,t,n){"use strict";var i=n(27813);!function(){function e(){if(geByClass1("tabs_block_hideable")){var e=geByClass1("tabs_block");geByClass1("tabs_list").offsetHeight>geByClass1("tabs_list_more").offsetHeight?removeClass("tabs_block_without_show_more",e):addClass("tabs_block_without_show_more",e)}}onDOMReady(e),onBodyResize(e),window.Tabs={actualizeShowMoreVisibility:e,toggle:function(e){var t=gpeByClass("tabs_block",e);hasClass("tabs_block_opened",t)?(0,i.setCookie)("remixm_tabs_expanded","",-1):(0,i.setCookie)("remixm_tabs_expanded",1),toggleClass("tabs_block_opened",t)}}}()},33965:function(e,t,n){"use strict";var i=n(1730),o=n(6103),a=n(9046),r=n(64723),s=n(92424),l=n(89359),c=n(39931),u=n(90968),d=n(65207),_=n(18431),f=n(96694),p=n(9869),m=n(40469),h=(n(86353),n(11393));function v(e){var t=!1,n={onStart:function(){(0,a.addClass)("wia_item--loading",this.link)},onDone:function(){var i=e.onDone&&e.onDone.apply(this,arguments);if(i){var o=i.wdHTML,r=i.data,s=i.onDoneEnd;if(o){var l=h.default.elem(o);(0,a.replace)(l,this.link.parentNode),r&&!t&&Snackbar.init({text:r.title,action:{url:r.href,text:r.undo_title,callback:function(e,i){var o=i.id;e.preventDefault(),t=!0,ajax.click(l.querySelector("a"),n),Snackbar.close(o)}}}),t=!1}s&&s()}}};return n}var g={onDone:function(e,t,n,i,o){var r=window,s=r.photo;if(p.Like.onDone.apply(this,arguments),this.photo_id){var l=s.get(this.photo_id);if(l){(0,a.ce)("div",{innerHTML:t});var c,u=(0,a.ce)("div",{innerHTML:i});l.likes=(0,a.val)(d),l.likes_cnt=(0,a.intval)(((null==u.querySelector||null==(c=u.querySelector("[data-like_count]"))?void 0:c.getAttribute("data-like_count"))||"").replace(/\D+/g,"")),l.likes_me=o,l.liked_people=t,l.like_buttons=i;var d=(0,a.ce)("div",{innerHTML:l.actions}),_=(0,a.geByClass1)("like_wrap",d);(0,a.val)(_,i),s.save(l)}}},onFail:p.Like.onFail},A={onDone:function(e){var t=window.photo;if(this.photo_id){if(!e.error){var n={};"confirm"===e.type?n={type:s.SNACKBAR_TYPE_SUCCESS,text:getLang("mobile_msg_photos_tag_confirmed")}:"delete"===e.type&&(n={type:s.SNACKBAR_TYPE_SUCCESS,text:getLang("mobile_msg_photos_tag_deleted")}),Snackbar.init(n)}var i=t.get(this.photo_id);i&&(i.tag_info="",t.save(i));var o=(0,a.geByClass1)("photo_view"),r=(0,a.geByClass1)("pv_tag_wrap",o);(0,a.val)(r,"")}}},y=v({onStart:function(e){console.log(this,e)},onDone:function(e,t,n,o){var r=photo.get(t);r&&(r.isDeleted=n,photo.save(r)),Popup.close((0,i.$)(".Popup_open"));var s=(0,i.$)(".PhotoviewPage");s&&s.classList.toggle("PhotoviewPage--deleted",n);return{wdHTML:e,data:o,onDoneEnd:function(){var e=(0,i.$)("#photo_actions"),t=$$(".ContextMenu__list li",e);Array.from(t).forEach((function(e){n&&"delete"!==domData(e,"name")&&(0,a.hide)(e),n||(0,a.show)(e)})),r&&(r.actions=e.innerHTML,photo.save(r))}}}}),w={onDone:function(e,t){var n=window.isNewMail&&(0,i.$)(".messenger")&&this.link.closest(".msg");if((0,a.val)(e,t),n){var o=Number(n.className.match(/msg_id_(\d+)/)[1]);store.mail.msgs[o].textFull=n.$(".msg__text").innerHTML}}},S={onDone:function(e){this.link&&((0,a.after)(cdf(e),(0,a.gpeByClass)("pic_body_wrap",this.link)),(0,a.hide)(this.link))}},b=v({onStart:function(){(0,a.addClass)("cm_item_loading",this.link)},onDone:function(e,t,n){if(!e)return{wdHTML:t,data:n};this.link&&(0,a.val)(this.link.parentNode,e)}}),k={onDone:function(e,t,n){if(void 0===n&&(n={}),e){var i=window.photo;(0,a.remove)(e+"_msg");var o=(0,a.ge)(e);if(o){if(n.remove)re(o),re(e+"_msg");else if(t){var r=(0,a.ce)("div",{id:e+"_msg",className:(o.className||"")+" post_message_item"}),s=n.no_wrap?t:'<div class="pi_cont">'+t+"</div>";(0,a.val)(r,s),(0,a.after)(r,o),(0,a.hide)(o),(0,a.geByClass1)("rtm_reply_wrap",o)&&window.reply&&window.reply.edithide()}else(0,a.show)(e);if(this.photo_id){var l=i.get(this.photo_id);if(l){var c=(0,a.geByClass1)("photoview"),u=(0,a.geByClass1)("comments_wrap",c);l.comments_html=(0,a.val)(u)}}}}}},C={onDone:function(e,t,n,i){if(e){(0,a.remove)(e+"_msg");var o=(0,a.ge)(e);if(o)if(t){var r=(/^([a-z]+)_item$/i.exec(n||"")||[])[1]||"inline",s=(0,a.ce)("div",{id:e+"_msg",className:r+"_item "+r+"_message_item"}),l=i||"message_item_cont";(0,a.val)(s,'<div class="'+l+'">'+t+"</div>"),(0,a.after)(s,o),(0,a.hide)(o)}else!1===t?(o.classList.add("_deleted"),(0,a.hide)(o)):(0,a.show)(o)}}},E={onDone:function(e,t,n){if(e){var o=(0,a.ge)(e),r=(0,a.getY)(o)||(0,a.getY)(e+"_msg"),s=(0,a.getH)(o)||(0,a.getH)(e+"_msg"),c=r+(_<320?s:0)-(0,a.scrollTop)();if((0,a.remove)(e+"_msg"),o){var u=(0,a.hasClass)("wall_item",o)||(0,a.hasClass)("post",o)?"wall":"post";if(n){var d=(0,a.ce)("div",{id:e+"_msg",className:u+"_item post_message_item"});(0,a.val)(d,'<div class="pi_cont">'+n+"</div>"),(0,a.after)(d,o)}if(t){(0,a.each)((0,a.geByClass)(u+"_item"),(function(){var e=!!this.id&&this.id.match(/^wall((-?\d+)_(-?\d+)(_\d+)?)$/),i=(0,a.attr)(this,"data-copy"),o=!!i&&i.match(/^(-?\d+)_(-?\d+)$/);if(!e)return!0;(!e[4]&&e[2]==t||e[4]&&e[3]==t||o&&o[1]==t)&&(0,a.toggleClass)("post_item_ignored",this,n)}));var _=(0,a.getCw)(),f=(r=(0,a.getY)(o)||(0,a.getY)(e+"_msg"),s=(0,a.getH)(o)||(0,a.getH)(e+"_msg"),r+(_<320?s:0)-c);(0,a.geByClass1)("wall_item")===o&&(f=0),(0,a.scrollTop)(f);var p=(0,i.$)(".ContextMenu",o);p&&l.default.close(p)}}}}},I={onDone:function(e,t){if(e){var n=(0,a.ge)(e);if((0,a.remove)(e+"_msg"),n&&t){var i=(0,a.hasClass)("wall_item",n)||(0,a.hasClass)("post",n)?"wall":"post",o=(0,a.ce)("div",{id:e+"_msg",className:i+"_item post_message_item"});(0,a.val)(o,'<div class="pi_cont">'+t+"</div>"),(0,a.after)(o,n)}(0,a.toggleClass)("post_item_ignored",n,t)}}},T={onDone:function(e,t,n){if(e){var i=(0,a.ge)(e);if((0,a.remove)(e+"_msg"),i){if(n){var o=(0,a.ce)("div",{id:e+"_msg",className:"wall_item post_message_item"});(0,a.val)(o,'<div class="pi_cont">'+n+"</div>"),(0,a.after)(o,i)}(0,a.toggleClass)("post_item_ignored",i)}}}},M={onStart:function(){var e=(0,a.gpeByClass)("show_more_wrap",this.link),t=(0,a.geByClass1)("show_more",e)||this.link,n=(0,a.ce)("div",{id:"show_more_loading",className:"show_more_loading show_more_loading--spinner",innerHTML:h.default.html((0,r.default)({spinner:!0}))}),i=(0,a.ce)("div",{id:"show_more_wrap",className:"show_next_wrap show_next_wrap_transparent"});(0,a.attr)(n,"data-href",(0,a.getHref)(t)),i.appendChild(n),(0,a.before)(i,e),(0,a.remove)(e)},onDone:function(e){var t=window.cur;ajax.tAlProcess=(new Date).getTime();var n=(0,a.ge)("show_more_wrap"),i=new Set;document.querySelectorAll(".wall_item").forEach((function(e){var t=e.id;t&&i.add(t)}));var r=cdf(e);Array.from($$(".wall_item",r)).forEach((function(e){e.id&&i.has(e.id)&&(clog("Remove existing post "+e.id),e.remove())})),(0,a.before)(r,n),(0,a.remove)(n),ajax.prepare_click("mcont"),(0,a.onBodyScrollForce)(100),ajax.tAlModule=t.module,ajax.tAlRender=(new Date).getTime(),ajax.onPostsLoad(),Gif.onUpdate(),window.UnauthorizedFeed&&UnauthorizedFeed.onUpdate(),(0,o.resizePosters)()}},P={onStart:M.onStart,onDone:function(e){M.onDone.apply(null,arguments),(0,_.cutTextToHighlight)(".SearchItemServicesInfo__textMatch")}},L={onStart:M.onStart,onDone:function(e,t){M.onDone.apply(null,arguments),Bookmarks.pushItemsToStore(t)}},N={onStart:M.onStart,onDone:function(e,t){var n=window.cur;ajax.tAlProcess=(new Date).getTime();var i=(0,a.geByClass1)("photos_page","mcont"),r=(0,a.ge)("show_more_wrap"),s=cdf(t);e=e.replace(/<img src="([^"]+)" class="/gi,'<img data-src="$1" class="_image ');var l=cdf(e);i&&i.appendChild(l),(0,a.before)(s,r),(0,a.remove)(r),ajax.prepare_click("mcont"),(0,a.onBodyScrollForce)(100),ajax.tAlModule=n.module,ajax.tAlRender=(new Date).getTime(),(0,o.resizePosters)()}},R={onStart:M.onStart,onDone:function(e,t){var n=window.cur;ajax.tAlProcess=(new Date).getTime();var i=(0,a.geByClass1)("audios_block",(0,a.geByClass1)("audios","mcont")),o=(0,a.ge)("show_more_wrap"),r=cdf(t),s=cdf(e);i&&i.appendChild(s),(0,a.before)(r,o),(0,a.remove)(o),ajax.prepare_click("mcont"),ajax.tAlModule=n.module,ajax.tAlRender=(new Date).getTime()}},x={onStart:M.onStart,onDone:function(e,t){var n=window.cur,i=e[0],o=e[1],r=(0,a.ge)("show_more_wrap");ajax.tAlProcess=Date.now(),f.Section.handlePagination(i,t),(0,a.remove)(r);var s=f.Section.getSection(t.name);s&&s.appendChild(cdf(o)),ajax.prepare_click("mcont"),(0,a.onBodyScrollForce)(100),ajax.tAlModule=n.module,ajax.tAlRender=Date.now()}},B=v({onDone:function(e,t,n){if(!e)return{wdHTML:t,data:n};var i=(0,a.ge)(e);i&&i.parentNode&&t&&(0,a.replace)(cdf(t),i.parentNode)}}),D=v({onDone:function(e,t,n){return void 0===n&&(n={}),n.snackbar&&Snackbar.init(n.snackbar),{wdHTML:e,data:t}}}),O={onStart:function(){var e=this.link,t=(0,a.gpeByClass)("notify_lite",e);if(t)return(0,a.remove)(t);for(;e=e.parentNode;)if((0,a.hasClass)("notify_item",e)){(0,a.hasClass)("notify_panel",e.parentNode)?(0,a.remove)(e.parentNode):(0,a.remove)(e);break}}},U={onStart:function(){var e=(0,a.geByClass)("pagination","mcont");(0,a.each)(e,(function(e,t){(0,a.before)((0,a.ce)("div",{className:"summary_loading",innerHTML:'<i class="i_loading"></i>'}),t.firstChild)}))},onDone:function(e,t,n){var i=window.mail,o=(0,a.ge)("messages"+t);o&&((0,a.val)(o,e),i.onMessagesRepainted(!0),!this.save&&(0,a.scrollToEl)()),this.save&&i.saveDialog({messages:e},t),this.clear&&((0,a.val)((0,a.geByTag1)("textarea","write_form"),""),(0,a.remove)((0,a.geByClass1)("pi_medias","write_form"))),(0,a.removeClass)("cp_attach_btn_sel",(0,a.geByClass1)("cp_attach_btn")),window.isNewMail&&MailScrap.clearSystemMessage2(),n&&n.play_animation_msg_id&&StickersSettings.getAutoplay()&&StickersAnimation.loadStickerInMvkIMAndPlay(n.play_animation_msg_id)},onFail:function(){var e=Array.prototype.slice.call(arguments),t=e.shift();switch(t){case 2:this.link.form&&this.link.form.submit()}}},H={onStart:function(){var e=(0,a.geByClass)("pagination","mcont");(0,a.each)(e,(function(e,t){(0,a.before)((0,a.ce)("div",{className:"summary_loading",innerHTML:'<i class="i_loading"></i>'}),t.firstChild)}))},onDone:function(e,t){var n=window.mail,i=(0,a.ge)("dialogs");i&&((0,a.val)(i,e),!this.no_scroll&&(0,a.scrollToEl)(),n.cacheDialogsPage()),n.save(t)}},F={onFail:function(e,t){if(e===ajax.RESPONSE_CAPTCHA){var n=this.link&&this.link.form;t+="&code="+(n&&n.code?n.code.value:""),nav.hard_go(t)}}},V={onStart:function(){var e=(0,a.gpeByClass)("friendsList__showMoreBtnWrap",this.link),t=(0,a.geByClass1)("friendsList__showMoreBtn",e)||this.link,n=(0,a.ce)("div",{id:"show_more_loading",className:"show_more_loading",innerHTML:'<i class="i_loading">&nbsp;</i>'}),i=(0,a.ce)("div",{id:"show_more_wrap",className:"show_next_wrap show_next_wrap_transparent friendsList__showMoreBtnWrap"});(0,a.attr)(n,"data-href",(0,a.getHref)(t)),i.appendChild(n),(0,a.before)(i,e),(0,a.remove)(e)},onFail:function(){var e=this,t=this.link.getAttribute("data-href")||this.link.getAttribute("href");setTimeout((function(){ajax.post(t,{_ajax:1},{onDone:V.onDone.bind(e),onFail:V.onFail.bind(e)})}),500)},onDone:M.onDone},j=v({onDone:function(e,t,n){if(!e)return{wdHTML:t,data:n};var i=(0,a.ge)(e);i&&i.parentNode&&t&&(0,a.replace)(cdf(t),i.parentNode)}}),$=v({onDone:function(e,t,n){if(!e)return{wdHTML:t,data:n};var i=(0,a.geByClass)(e);if(i.length&&t)for(var o=0,r=i.length;o<r;o++)i[o].parentNode&&(0,a.replace)(cdf(t),i[o].parentNode)}}),q={onStart:function(){var e=this.link;e.classList.contains("wia_item")&&e.classList.add("wia_item--loading")},onDone:function(e,t,n,i,o){if(e){var r=(0,a.geByClass)(e);if(r.length&&t)for(var s=0,l=r.length;s<l;s++)r[s].parentNode&&(0,a.replace)(cdf(t),r[s].parentNode);Share.setBookmarkState(i,o),n&&Bookmarks.showSuccessSnack(n);var _=(0,c.parseBookmarkedProductClass)(e);_&&(0,u.trackMarketEvent)({event:o?d.ECommGoodsEvent.ADD_ITEM_TO_BOOKMARKS:d.ECommGoodsEvent.REMOVE_ITEM_FROM_BOOKMARKS,ownerId:_.ownerId,itemId:_.itemId,instant:!0}),n&&31===n.item_type&&o&&(0,m.sendNarrativeAnalytic)(m.NarrativeAnalyticEventType.addToBookmarks,{ownerId:n.item_oid,id:n.item_id},m.NarrativeAnalyticNavScreen.other)}}},W=v({onDone:function(e,t,n,i,o,r){if(!e)return{wdHTML:o,data:r};var s=(0,a.ge)(e);if(!s)return{wdHTML:o,data:r};var l=(0,a.geByClass1)("wia_close",s);if(l&&((0,a.val)(l,n),l.href=t),!(0,a.hasClass)("single_wall_item",s))return{wdHTML:o,data:r};var c=(0,a.ge)("nc_form"),u=(0,a.geByClass1)("wall_replies");return c?(0,a.toggle)(c,!!i):i&&(u?domInsert(u,i):(domInsertAfter((0,a.ce)("div",{innerHTML:i}),s),u=(0,a.geByClass1)("wall_replies"))),(0,a.toggleClass)("closed_comments",u,!i),{wdHTML:o,data:r}}}),G={onStart:function(){var e=domPN(this.link),t=(0,a.geByClass1)("Loading",e);t||(t=h.default.html((0,r.default)()),append(t,e)),(0,a.addClass)("RepliesThreadNext_loading",e)},onDone:function(e,t,n,i){var r,s=domPN(this.link),l=(0,a.hasClass)("RepliesThreadNext_prev",s),c=0,u=cdf(e);if(domChildren(u).forEach((function(e){(0,a.ge)(e.id)&&re(e)})),l?(r=(0,a.gpeByClass)("wall_replies",s),c=(0,a.getH)(r),(0,a.after)(u,s)):(0,a.before)(u,s),i?(this.link.href=i,(0,a.removeClass)("RepliesThreadNext_loading",s)):re(s),Gif.onUpdate(),(0,o.resizePosters)(),n&&(cur.replyNames=(0,a.extend)(cur.replyNames||{},n)),t&&t.length&&Mention.addItems(t),l){var d=(0,a.getH)(r)-c;(0,a.scrollTop)((0,a.scrollTop)()+d)}(0,a.onBodyScrollForce)()},onFail:function(){var e=domPN(this.link),t=(0,a.geByClass1)("i_loading",e);(0,a.hide)(t),(0,a.show)(this.link),(0,a.removeClass)("RepliesThreadNext_loading",e)}},Y={onDone:function(e,t,n){var i=(0,a.geByClass1)("RepliesWrap");i.innerHTML=e,Gif.onUpdate(),(0,o.resizePosters)(),n&&(0,a.extend)(cur.replyNames,n),t&&t.length&&Mention.addItems(t),(0,a.scrollTop)((0,a.getH)(i)+(0,a.getY)(i))}},K={onDone:function(e,t,n,i){if(e){var o=(0,a.ge)(e);if(o){if(i)(0,a.geByClass)("ReplyItem__message_type_"+i,o).forEach((function(e){re(e)}));var r=(0,a.geByClass1)("ReplyItem__wrap",o),s=(0,a.geByClass)("ReplyItem__message",o),l=s.pop();if(t){var c=cdf(t);(0,a.hide)(l||r),(0,a.after)(c,l||r),(0,a.geByClass1)("rtm_reply_wrap",o)&&window.reply&&window.reply.edithide()}else i||(re(l),l=s.pop()),(0,a.show)(l||r);if(n){var u=(0,a.ge)("RepliesThread"+n);u&&(0,a.toggle)(u,!t)}}}}},Q={onStart:function(){Btn.setLoading(document.querySelector("#email_soft_bouncing a.Btn"),!0)},onDone:function(e){1===e&&document.getElementById("email_soft_bouncing").remove(),Btn.setLoading(document.querySelector("#email_soft_bouncing a.Btn"),!1)}};window.Like=p.Like,window.PhotoLike=g,window.PhotoTag=A,window.PhotoDelete=y,window.Poll=w,window.CopyHistory=S,window.ToggleMenu=b,window.Comment=k,window.ItemDelete=C,window.FeedIgnore=E,window.FeedIgnoreItem=I,window.FeedIgnoreComments=T,window.Wall=M,window.SearchServices=P,window.Bookmark=L,window.BookmarkToggle=q,window.Photos=N,window.Audios=R,window.AudioSection=x,window.FixPost=B,window.ContextMenuCommonAction=D,window.Notify=O,window.Dialog=U,window.Dialogs=H,window.LoginCheckAuthCodePage=F,window.WallSubscribe=j,window.FeedSubscribe=$,window.ImportedFriends=V,window.CloseComments=W,window.RepliesNext=G,window.RepliesLast=Y,window.ReplyAction=K,window.MiniAppsCatalogResetRecent=function(e){if(e.dataset.section){var t={act:"mini_apps_reset_recent",hash:e.dataset.hash||""};ajax.post("/apps.php",t,{onDone:function(){var t=(0,a.ge)("mini_apps_"+e.dataset.section);t&&t.remove()}})}},window.ResetEmailSoftBounce=Q},3644:function(e,t,n){"use strict";var i=n(3226),o=n(3045),a=n(33669),r=n(81020),s=n(74734),l=n(86353),c=n(16283),u=n(1481),d=n(42893),_=n(88241),f=n(27813),p=n(63150),m=n.n(p),h=n(51242),v=n(9961),g=n(74873),A=n(3793),y=n(9046),w=n(78869),S=n(42058),b=n(41650),k=n(12925),C=n(86900),E=window.audio||function(){var e=(0,y.ssGet)("audio_vol"),t="number"==typeof e?e:.8,n={onPause:function(){(0,C.statlogsValueEvent)("mvk_audio_player_listening",P[L].id,E.getCurrentProgress()),B&&(B=!1,ssSet("audio_play","0"),clearTimeout(U));r.emit(v.events.PAUSE,W())},onPlay:function(){B||(B=!0,ssSet("audio_play","1"),clearTimeout(U),U=setTimeout(Y,100));if(audioBackgroundRestriction&&audioBackgroundRestriction.isIdle)return void E.pause();r.emit(v.events.PLAY,W())},onBufferUpdate:function(e){r.emit(v.events.BUFFERED,W(),e,E.duration())},onEnd:function(){if(s>0)return;r.emit(v.events.ENDED,W()),O?(O=!1,E.next()):D=!0},onProgressUpdate:function(e,t,n){if(I.isPlaying())return;if(!e&&n)try{e=n/E.duration()}catch(e){}r.emit(v.events.PROGRESS,W(),e,E.duration(),t),e>.01&&(j=t);ssSet("audio_pos",e),!O&&o.getDuration()-o.getCurrentTime()<.5&&(O=!0);if(e>.8&&V){var i=function(){var e=L+1;if(e&&P&&e<P.length)return P[e];return null}();i&&o.isFullyLoaded()&&(V=!1,function(e){e&&e.url&&o.prefetch(e.url)}(i))}D&&(D=!1,E.next())},defaultVolume:t},o=new g.AudioPlayerHTML5(n),a=new A.AudioTaskManager(o),r=new h.EventBus,s=0,l=null,u={},p=new d.AudioQueue,T=!1,M=srand(),P=[],L=null,N={},R="",x=null,B=!1,D=!1,O=!1,U=null,H=!1,F=!1,V=!1,j=0;function $(e,t){if(void 0===t&&(t=!1),!E.support)return!1;var n;if(B&&E.pause(),r.emit(v.events.DESELECT,q()),(n=E.canRepeat!==k.audioRepeat.ONE||t?L+e:L)>=P.length||n<0){if(E.canRepeat!==k.audioRepeat.ALL&&E.canRepeat!==k.audioRepeat.ONE)return!1;n=n>=P.length?0:Math.max(0,P.length-1)}(0,C.statlogsValueEvent)("mvk_audio_player_listening",P[L].id,E.getCurrentProgress());var i=P[n];E.play(i.fullId).then((function(t){t||$(e>0?e+1:e-1)})).catch((function(){}))}function q(){return P[L]||!1}function W(){return q().fullId||!1}function G(e){return function(e){return new Promise((function(t,n){l&&l(),l=n;var i=[];if(u=u||{},e)if(e.url)t(e);else{var o=N[e.fullId];if(o>=0)for(var a=o;a<o+3;a++){var r=P[a];r&&!r.url&&!u[r.fullId]&&r.urlHash&&(i.push(r.fullId+"_"+r.actionHash+"_"+r.urlHash),u[r.fullId]=!0)}ajax.post("/audio",{act:"reload_audio",ids:i.join(",")},{onDone:function(i){i?(i.forEach((function(n){var i=(0,w.asObject)(n),o=P[N[i.fullId]];o&&(o.url=i.url),(0,S.getAudioElementsById)(i.fullId).forEach((function(e){try{var t=JSON.parse(e.dataset.audio);t[b.AUDIO_PLAYER_ENUMS.AUDIO_ITEM_INDEX_URL]=i.url,e.dataset.audio=JSON.stringify(t)}catch(e){}})),i.fullId===e.fullId&&(e.url=i.url,t(e)),delete u[i.fullId]})),n()):n()},onFail:n})}else n()})).catch((function(){return u={}}))}(e).then((function(e){a.clearTask(A.TaskName.URL);var t=e.url;if(!t)throw new Error;return a.setUrl(t).then((function(t){t?s=0:(a.clearAllTasks(),r.emit(v.events.FAILED),B&&s<2&&(e.pause(),e.next(),s++))}))}))}function Y(){if(B){var e=lsGet("audio_current_player");M!=e?E.pause():U=setTimeout(Y,100)}}function K(e){ssSet("audio_query",e),H&&(0,f.setCookie)(H+"q",encodeURIComponent(e),1)}return{support:!0,canRepeat:k.audioRepeat.ALL,shuffled:!1,onInit:(0,i.default)(),init:function(e){!F&&E.support&&(F=!0,e.cookie&&(H=e.cookie,e.cookie_path||"/"),onDOMReady((function(){!function(e){var t=(0,y.ssGet)("audio_id"),n=(0,y.ssGet)("audio_pos"),i=(0,f.getCookie)(H+"_playlist");e.playlist&&e.playlist.length&&(i&&E.setPlaylistId(i),E.playlist((e.playlist||[]).map(w.asObject),{q:e.playlist_q||""})),t&&E.select(t).then((function(){n<1&&E.setPosition(n,!0)})).catch((function(){}))}(e),E.onInit()})))},subscribe:function(e,t){return r.subscribe(e,t)},unsubscribe:function(e,t){return r.unsubscribe(e,t)},notify:function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];r.emit.apply(r,[e].concat(n))},getCurrent:q,getCurrentId:W,operate:function(e){if(!E.support)return!1;!e||P[L]&&e===W()?B?E.pause():E.play():((0,C.statlogsValueEvent)("mvk_audio_player_listening",q().id,E.getCurrentProgress()),E.play(e))},setPlaylistId:function(e){e!==x&&(x=e,r.emit(v.events.PLAYLIST_CHANGED))},playing:function(){return B},select:function(e){if(!E.support)return Promise.reject();if(!e)return Promise.reject();P.length||r.emit(v.events.EMPTY_PLAYLIST,e);var t=P[N[e]];return t?(W()&&r.emit(v.events.DESELECT,q()),G(t).then((function(){L=N[e],V=!0,r.emit(v.events.SELECT,P[L]);var t,n=(0,S.getPlaylistByAudioId)(e);n&&x!==n&&E.setPlaylistId(n),t=W(),ssSet("audio_id",t),H&&((0,f.setCookie)(H,t,1),(0,f.setCookie)(H+"_playlist",x,1))})).catch((function(){return Promise.reject()}))):(r.emit(v.events.NOT_FOUND_PLAYLIST,e),Promise.reject())},autoplay:function(e){E.play(e)},getCurrentPlaylistId:function(){return x},play:function(e){var t=this;if(E.support)return new Promise((function(n){var i=e===W();return B&&i?(E.pause(),n(!0)):I.isPlaying()?(e&&!i?(E.select(e).catch((function(){})),I.resume()):B?I.pause():I.resume(),n(!0)):(B=!0,!e||i?(t._play(),n(!0)):(o.setUrl(_.SILENCE),void E.select(e).then((function(){r.emit(v.events.PLAY_REQUESTED,e),a.clearAllTasks(),I.startPlay(P[N[e]],(function(){return t._play(),n(!0)}))})).catch((function(e){return console.log(e),B=!1,W()&&E.select(W()),n(!1)}))))}))},_play:function(){q()&&(a.play().then((function(){ssSet("audio_play","1"),p.connect()})).catch((function(){B=!1,r.emit(v.events.PAUSE)})),lsSet("audio_current_player",M))},clearCurrentPlaylist:function(){if(!E.support)return!1;B&&!I.isPlaying()&&E.pause(),q()&&r.emit(v.events.DESELECT,q()),P=[],R="",L=null,E.setPlaylistId(null),N={},K(R)},pause:function(){if(!E.support)return!1;B&&(I.isPlaying()?I.pause():o.pause(),B=!1,ssSet("audio_play","0"))},getDeviceId:function(){var e=lsGet("audio_player_device_id");return e||(e=m()(),lsSet("audio_player_device_id",e)),e},getPosition:function(){return E.isAdsPlaying()?I.getCurrentProgress()*I.getDuration():o.getCurrentTime()},getCurrentProgress:function(){return E.isAdsPlaying()?I.getCurrentProgress():o.getCurrentProgress()},setPosition:function(e,t){if(!E.support)return!1;var n=0;t?n=e:e&&E.duration()&&(n=e/E.duration()),a.seek(n).then((function(){ssSet("audio_pos",n),r.emit(v.events.SEEK,W(),n,E.duration())}))},volume:function(e){if(!E.support)return!1;if(void 0===e)return t;var n=Math.min(1,Math.max(0,e));t=n,a.setVolume(t),ssSet("audio_vol",t),I.updateVolume(),r.emit(v.events.VOLUME,W(),t)},loaded:function(){return o.getCurrentBuffered()},duration:function(){if(this.isAdsPlaying())return I.getDuration();var e=o.getDuration(),t=P[L]&&P[L].duration;return e||t||0},played:function(){return o.getPlayedTime()},getListenedTime:function(){return j},next:function(e){return void 0===e&&(e=!1),$(1,e)},prev:function(e){return void 0===e&&(e=!1),$(-1,e)},shuffle:function(){var e=E.isPlaying()&&!E.isAdsPlaying(),t=E.getPosition(),n=E.getCurrentId();E.pause(),E.shuffled=!E.shuffled,E.shuffled?(P.forEach((function(e,t){return e.position=t})),P.sort((function(){return Math.random()-.5}))):P.sort((function(e,t){return e.position-t.position})),N=P.reduce((function(e,t,n){return e[t.fullId]=n,e}),{}),n&&(E.select(n),E.setPosition(t),e&&requestAnimationFrame((function(){return E.play()})))},repeat:function(){switch(E.canRepeat){case k.audioRepeat.NONE:E.canRepeat=k.audioRepeat.ALL;break;case k.audioRepeat.ALL:E.canRepeat=k.audioRepeat.ONE;break;case k.audioRepeat.ONE:E.canRepeat=k.audioRepeat.NONE;break;default:E.canRepeat=k.audioRepeat.NONE}},playlist:function(e,t){return!!E.support&&(void 0===e?P:(B&&!I.isPlaying()&&E.pause(),q()&&r.emit(v.events.DESELECT,q()),P=e,R=t&&t.q||"",L=null,N={},each(e,(function(e,t){return N[t.fullId]=e})),void K(R)))},addToPlaylist:function(e,t){var n={},i=t||P.length;P.forEach((function(e){return n[e.fullId]=!0})),e.forEach((function(e){n[e.fullId]||(t?P.splice(i,0,e):P.push(e))}))},playlist_q:function(){return R},setIsPlaying:function(e){B=e},isAdsPlaying:function(){return I.isPlaying()},isPlaying:function(){return B},initSplash:function(){T||(window.audioRestrictionSplash=new c.RestrictionSplash,T=!0)},playNothing:function(){o.setUrl(_.SILENCE,(function(){}))},events:v.events}}();window.Artist=o.Artist,window.Curator=a.Curator;var I=new r.AudioAds(new s.AdsPlayerAdapter(E),null,!0);E.ads=I,window.audio=E,window.AudioBackgroundRestriction=u.AudioBackgroundRestriction,window.audioBackgroundRestriction=null,document.addEventListener("DOMContentLoaded",(function(){(0,l.partConfigEnabled)("audio_mvk_background_restriction_enabled")&&(window.audioBackgroundRestriction=new u.AudioBackgroundRestriction)})),document.addEventListener("DOMContentLoaded",(function(){"audio"===cur.module&&E.initSplash()})),window.page.onChange((function(){"audio"===cur.module?E.initSplash():window.audioRestrictionSplash&&window.audioRestrictionSplash.popup&&window.audioRestrictionSplash.close()}))},74734:function(e,t,n){"use strict";n.d(t,{AdsPlayerAdapter:function(){return a}});var i=n(9961),o=n(9046),a=function(){function e(e){this.audioplayer=e}var t=e.prototype;return t.notify=function(e){var t,n=this.audioplayer.getCurrent();switch(e){case i.events.AD_COMPLETED:case i.events.AD_STARTED:this.audioplayer.notify(e,n);break;case i.events.PAUSE:case i.events.PLAY:this.audioplayer.notify(e,n.fullId);break;case i.events.PROGRESS:for(var o=arguments.length,a=new Array(o>1?o-1:0),r=1;r<o;r++)a[r-1]=arguments[r];(t=this.audioplayer).notify.apply(t,[e,n.fullId].concat(a))}},t.setIsPlaying=function(e){this.audioplayer.setIsPlaying(e)},t.getVolume=function(){var e=(0,o.ssGet)("audio_vol");return null===e?1:e},t._getPlayingContextSection=function(){return window.playerAdapter.getContext()},e}()},3045:function(e,t,n){"use strict";n.d(t,{Artist:function(){return i}});var i=function(){function e(){}return e.follow=function(t,n,i,o){lockButton(o),ajax.post("/audio",{_ajax:1,act:"artist_follow",ref:n,hash:i,artist_id:t},{onDone:function(i){unlockButton(o),o.classList.add("MusicAuthorCover__followBtn__followed"),o.onclick=function(a){a.preventDefault(),e.unfollow(t,n,i,o)}},onFail:function(){return unlockButton(o)}})},e.unfollow=function(t,n,i,o){lockButton(o),ajax.post("/audio",{_ajax:1,act:"artist_unfollow",ref:n,hash:i,artist_id:t},{onDone:function(i){unlockButton(o),o.classList.remove("MusicAuthorCover__followBtn__followed"),o.classList.contains("MusicAuthorCover__followBtn__canFollow")&&(o.onclick=function(a){a.preventDefault(),e.follow(t,n,i,o)})},onFail:function(){return unlockButton(o)}})},e.trackToOfficial=function(e,t){ajax.post("/audio",{_ajax:1,act:"artist_track_to_official",hash:e,url:t})},e}()},21105:function(e,t,n){"use strict";n.d(t,{PageVisibility:function(){return o}});var i=n(62691),o=function(){function e(){this.visibleCallbacks=[],this.hiddenCallbacks=[],this.visibilityPrefix="",this.hiddenStateName="hidden",this.isHidden=!1,this.listen()}e._supports=function(e){return e+"Hidden"in document};var t=e.prototype;return t.onVisible=function(e){this.visibleCallbacks.push(e)},t.onHidden=function(e){this.hiddenCallbacks.push(e)},t.listen=function(){var e=this,t=arguments;try{var n=i.default.version.split(".")[0];if(i.default.safari_mobile&&n<=7)return window.addEventListener("pagehide",(function(){return e._hidden()})),void window.addEventListener("pageshow",(function(){return e._visible()}));var o=i.default.android&&i.default.safari&&n<5,a=!o&&this.isSupported();a?(document.addEventListener(this.visibilityPrefix+"visibilitychange",(function(){return e._nativeSwitch(t)})),window.addEventListener(this.visibilityPrefix+"visibilitychange",(function(){return e._nativeSwitch(t)}))):document.addEventListener?(window.addEventListener("focus",(function(){return e._visible()}),1),window.addEventListener("blur",(function(){return e._hidden()}),1)):(document.attachEvent("onfocusin",(function(){return e._visible()})),document.attachEvent("onfocusout",(function(){return e._hidden()})))}catch(e){}},t.isSupported=function(){for(var t=0;t<e.prefixes.length;t++){var n=e.prefixes[t];if(e._supports(n))return this.hiddenStateName=(n?n+"H":"h")+"idden",this.visibilityPrefix=n,!0}return!1},t._visible=function(){this.isHidden=!1,this.visibleCallbacks.forEach((function(e){return e()}))},t._hidden=function(){this.isHidden=!0,this.hiddenCallbacks.forEach((function(e){return e()}))},t._nativeSwitch=function(){!0===document[this.hiddenStateName]?this._hidden():this._visible()},e}();o.prefixes=["webkit","o","ms","moz",""]},1481:function(e,t,n){"use strict";n.d(t,{AudioBackgroundRestriction:function(){return s}});var i=n(61124),o=n(21105),a=n(45150),r=n(27813),s=function(){function e(){audioSubscribe||(this.isIdle=!1,this.showAlertCountToday=function(e,t){void 0===t&&(t=0);var n=parseInt((0,r.getCookie)(e),10);if(isNaN(n,10))return t;return n}(e.SHOW_ALERT_COOKIE),this.initVisibilityChangeEvent())}e.writePopupStat=function(e){statlogsValueEvent("mvk_audio_background_popup",e)},e.createPopup=function(){var t={href:e.EXPLANATION_LINK,onclick:'AudioBackgroundRestriction.writePopupStat("explanation_click");',class:"AudioPopup__explanation",inner:getLang("mobile_audio_background_restriction_explanation")};return Wd.elem((0,a.AudioPopup)({popupClass:"AudioRestrictionPopup",title:getLang("mobile_audio_background_restriction_title"),description:getLang("mobile_audio_background_restriction_description"),action_button:{href:e.REMOVE_RESTRICTION_LINK,onclick:'AudioBackgroundRestriction.writePopupStat("link_click");',text:getLang("mobile_audio_background_restriction_button")},additional_link:t}))};var t=e.prototype;return t.onIdle=function(){window.audio.playing()&&this.triggerRestriction()},t.showBackgroundMessage=function(){var t=e.createPopup();this.showAlertCountToday+=1,(0,r.setCookie)("remixaudio_show_alert_today",this.showAlertCountToday,1),this.showAlertCountToday%3||(i.default.open(t,!0),e.writePopupStat("show"))},t.triggerRestriction=function(){audio.pause(),this.showBackgroundMessage()},t.initVisibilityChangeEvent=function(){var e=this;this.pageVisibility=new o.PageVisibility,this.pageVisibility.onVisible((function(){e.isIdle=!1})),this.pageVisibility.onHidden((function(){e.isIdle=!0,e.onIdle()}))},e}();s.SHOW_ALERT_COOKIE="remixaudio_show_alert_today",s.REMOVE_RESTRICTION_LINK="/offermusic",s.EXPLANATION_LINK="https://vk.cc/9uFgyl"},33669:function(e,t,n){"use strict";n.d(t,{Curator:function(){return o}});var i=n(49751),o=function(){function e(){}return e.follow=function(t,n,o){i.default.setDisabled(o,!0),ajax.post("curator.php",{_ajax:1,act:"follow",hash:n,curator_id:t},{onDone:function(n){i.default.setDisabled(o,!1),o.classList.add("MusicAuthorCover__followBtn__followed"),o.onclick=function(i){i.preventDefault(),e.unfollow(t,n,o)}},onFail:function(){return i.default.setDisabled(o,!1)}})},e.unfollow=function(t,n,o){i.default.setDisabled(o,!0),ajax.post("curator.php",{_ajax:1,act:"unfollow",hash:n,curator_id:t},{onDone:function(n){i.default.setDisabled(o,!1),o.classList.remove("MusicAuthorCover__followBtn__followed"),o.onclick=function(i){i.preventDefault(),e.follow(t,n,o)}},onFail:function(){return i.default.setDisabled(o,!1)}})},e}()},94403:function(e,t,n){"use strict";n.d(t,{MvkPlayerAdapter:function(){return c}});var i=n(53006),o=n(14786),a=n(42058),r="group_list",s="search",l="other",c=function(e){function t(){return e.apply(this,arguments)||this}(0,i.default)(t,e);var n=t.prototype;return n.getPausedBy=function(e){return ge("StoriesView")?"stories":null},n.getState=function(){var t=e.prototype.getState.call(this),n=this.getAudioId();return n&&ge("audio"+n)?o.FULL_SCREEN_STATE:t},n.getProgress=function(){var e=this.player.getCurrent();return e?this.player.getPosition()/e.duration:0},n.getProgressInSeconds=function(){return Math.round(this.player.getPosition())},n.getVolume=function(){return Math.round(100*this.player.volume())},n.getAudioId=function(){return this.player.getCurrentId()},n.getAudio=function(){return this.player.getCurrent()},n.getAudioTrackCode=function(){try{return this.player.getCurrent().trackCode}catch(e){return!1}},n.getPrevAudioId=function(){var e=this.getAudioId(),t=window.audioplayer.getPlaybackQueue();if(e){var n=t.lastIndexOf(e);if(-1!==n)return t[n-1]}},n.getPlaylistIdFromAudioId=function(e){return(0,a.getPlaylistByAudioId)(e)},n.getPlaylistTypeFromAudioId=function(e){if(e&&isString(e)){var t=e.split("_"),n=t[0],i=t[1],o=t[2],a=t[3];return n&&i?o&&0===o.indexOf("playlist")?o.replace("playlist","")+"_"+a:o:void 0}},n.getPrevPlaylistId=function(){return this.getPlaylistIdFromAudioId(this.getPrevAudioId())},n.getPlaylistId=function(){return this.getPlaylistIdFromAudioId(this.getAudioId())},n.updateContext=function(){var e=this.getPlaylistTypeFromAudioId(this.getAudioId());if(e){var t=this.getContextByType(e);t===l&&nav.getQuery("from")?this.context=this.getContextByType(nav.getQuery("from")):this.context=t}else this.context=l},n.getContextByType=function(e){if(void 0===e&&(e=""),0===e.indexOf("recoms"))return nav.getQuery("q")?s:"recs";if(0===e.indexOf("audios")){var t=intval(e.replace("audios",""));return t===vk.id?"my":t<0?r:"user_list"}return 0===e.indexOf("popular")?"recs_audio":0===e.indexOf("search")?s:0===e.indexOf("wall")?r:0===e.indexOf("mail")?"im":0===e.indexOf("feed")?"feed":l},n.getContext=function(){return this.context||l},n.getSequence=function(){return 0},n.getSearchParams=function(){return null},n.getType=function(){return"html5"},n.isPlaying=function(){return this.player.playing()},n.isAutoPlayed=function(){return window.audioplayer.isAutoPlayed()},n.isRepeatCurrentAudio=function(){return!1},n.isRepeatAll=function(){return!1},n.isShuffledPlaylist=function(){return!1},n.isPodcast=function(){return!1},n.isAdPlaying=function(){return!1},n.isRealPlaylist=function(){return!0},n.isRealPrevPlaylist=function(){return!0},n.isLastTrack=function(){var e=this.player.getCurrent(),t=this.player.playlist();return!!e&&(!(!e||t&&t.length)||t.indexOf(e)+1===t.length)},n.hasPrevPlaylist=function(){return!1},n.hasPlaylist=function(){var e=this.player.playlist();return Boolean(e&&e.length>1)},n.hasPrevAudio=function(){var e=this.getAudioId(),t=window.audioplayer.getPlaybackQueue();return Boolean(e&&t.length>1)},n.hasSearchParams=function(){return!1},n.isDebug=function(){return Boolean(lsGet("audio_stats_debug"))},n.sendListenedData=function(e){var t=nav.getQuery("from");ajax.post("/audio",{_ajax:1,act:"playback",audio:e.audio_id,track_code:e.track_code,prev:e.prev_audio_id,state:e.state,from_block:t,listened:e.listened,hash:e.hash,playlist_id:e.playlist_id,end_stream_reason:e.end_stream_reason,auto:e.auto,unique_user_id:e.unique_id})},t}(o.AudioStatsPlayerAdapter)},87119:function(e,t,n){"use strict";var i=n(199),o=n(91461),a=n(9046),r=n(1730),s=null;function l(e){for(var t=geByClass("audio-msg-track--wave-wrapper",e),n=(0,r.$)(".audio-msg-track__transcriptionButton",e),i=0,o=0;o<t.length;o++){try{var a=n&&parseInt(window.getComputedStyle(n,null).getPropertyValue("width"))||0;i=parseInt(window.getComputedStyle(t[o],null).getPropertyValue("width"))-a-8}catch(e){var s=n&&parseInt(n.currentStyle.width)||0;i=parseInt(t[o].currentStyle.width)-s-8}if(i>0)break}return i}function c(e,t){t=Math.round(t),e.length!=t&&(e=(0,o.fastResample)(e,t));for(var n="",i=0,a=0;a<e.length;a++)0===(i=Math.floor(7.5*e[a]*.95))&&(i=.5),n+="M"+(4*a+1)+","+(10-i)+"v"+2*i+"Z";return'<svg class="audio-msg-track--wave" width="'+4*e.length+'px"><path d="'+n+'"></path></svg>'}function u(){for(var e=geByClass("audio-msg-track"),t=0;t<e.length;t++){var n=(0,a.attr)(e[t],"data-wave");if((0,a.hasClass)(e[t],"audio-msg-player")&&t>0){var i=e[t].getAttribute("id");if(i.startsWith("vmp_")){var o=document.getElementById(i.replace("vmp_",""));n=(0,a.attr)(o,"data-wave")}else n=(0,a.attr)(e[t-1],"data-wave")}var r=l(e[t]);if(n&&r){n=n.split(",");for(var s=geByClass("audio-msg-track--wave",e[t]),u=c(n,r/4),d=0;d<s.length;d++){var _=(0,a.ce)("div",{innerHTML:u}).firstChild;s[d].parentNode.replaceChild(_,s[d])}}}}function d(){return s||(s=new i.VoiceMessagePlayer({onListened:function(e){AudioMessagePlayer.events.emit("listened",e)}})),s}addEvent(window,"orientationchange",(function(){return setTimeout(u,500)})),window.mail&&window.mail.onMessagesRepainted&&(onDOMReady(u),window.mail.onMessagesRepainted(u)),window.AudioMessagePlayer={loaded:!0,events:new EventEmitter,togglePlay:function(e,t,n){void 0===n&&(n=null);var i=d(),o=i.attachTo(e),a=function(){null!==n?n?i.play():i.pause():i.play()};!0===o?a():o.then((function(){a()}))},detachPlayer:function(e){d().detach(e)},getAttachedTrackPlayer:function(){return(0,r.$)(".audio-msg-track_player-attached")},pauseGlobalMedia:function(){i.VoiceMessagePlayer.pauseGlobalMedia()},resumeGlobalMedia:function(){i.VoiceMessagePlayer.resumeGlobalMedia()},redrawWaves:u,getWave:c,toggleTranscription:function(e,t,n){void 0===t&&(t=null),void 0===n&&(n=null),e&&(e.preventDefault(),e.stopPropagation());var i=t||e.target,o=i.closest(".audio-msg-player"),a=o?o.parentNode.querySelector("#"+o.id.replace("vmp_","")):i.closest(".audio-msg-track"),s=o?(0,r.$)(".audio-msg-track__transcriptionButton",a):i,l=null===n?"true"===s.getAttribute("aria-expanded"):!n;i.setAttribute("aria-expanded",l?"false":"true"),o&&s.setAttribute("aria-expanded",l?"false":"true"),a.setAttribute("data-transcription-expanded",l?"false":"true"),o&&o.setAttribute("data-transcription-expanded",l?"false":"true"),this.events.emit("transcription_toggle",!l,a)}}},12925:function(e,t,n){"use strict";n.d(t,{audioRepeat:function(){return i}});var i={NONE:0,ALL:1,ONE:2}},77935:function(e,t,n){"use strict";var i=n(46769),o=n(1730),a=n(11393),r=n(3226),s=n(62691),l=n(43946),c=n(94403),u=n(17999),d=n(78869),_=n(9961),f=n(42058),p=n(46950),m=n(91687),h=n(54773),v=n(22770),g=n(96694),A=n(86353),y=n(80576),w=n(51452),S="ad_placeholder",b="ad_mode",k=window.audio,C=function(){if(!HTMLAudioElement)return{init:function(){},initAudio:function(){}};var e=!1,t="1"==lsGet("audio_time_left"),n={},g=!1,E=!1,I=!1,T=[],M=null,P=[];function L(e){if(e){$$("#lm_player").forEach((function(e){show(e)})),$$("#lm_audio").forEach((function(t){t&&(t.querySelector(".ai_artist").innerHTML=e.performer,t.querySelector(".ai_title").innerHTML=e.title,t.querySelector(".ai_play").style.backgroundImage=e.coverUrl_p?"url("+e.coverUrl_p+")":""),k.isAdsPlaying()&&oe(e,!0)}));var t=(0,f.getAudioElementsById)(e.fullId);t&&each(t,(function(t,n){k.isAdsPlaying()?(ie(e,!0),addClass("ai_playing",n)):(W(n,0),G(n,0),q(n,Q(0,k.duration()))),Y(n,k.volume()),addClass("ai_current",n)}))}else $$("#lm_player").forEach((function(e){hide(e)}))}function N(e){var t=e.fullId,i=e.duration;$$("#lm_audio").forEach((function(e){removeClass("ai_playing",e)}));var o=(0,f.getAudioElementsById)(t);o&&(each(o,(function(e,t){q(t,K(i)),removeClass("ai_playing",t),removeClass("ai_current",t)})),n[t]&&delete n[t],k.isAdsPlaying()&&ie(e,!1))}function R(e,t,i,o){var a=(0,f.getAudioElementsById)(e);if(a.length){var r=t*(i||0);each(a,(function(e,n){D||G(n,t),q(n,C.getFormatedTime(r,i))})),r>1&&(n[e]=1)}}function x(e,t){window.audio.playNothing(),ajax.post("/audio",{act:"block_playlist",block_id:e},{onDone:function(n){if(n){var i=n.map((function(e){return(0,d.asObject)(e)}));k.playlist(i),k.setPlaylistId(e),t&&t(i)}}})}function B(e,t){void 0===t&&(t=!1);var n=(0,f.getAudioElementById)(e),i=gpeByClass("audios_list",n)||gpeByClass("AudioBlock",n),o=geByClass("audio_item",i),a=[],r=!1;each(o,(function(t,n){var i=JSON.parse(domData(n,"audio"));if(i){var o=(0,d.asObject)(i);a.push(o),o.fullId===e&&(r=!0)}})),k.playlist(a,{q:attr(i,"data-query")}),t&&r&&r&&k.play(e)}onDOMReady((function(){window.playerAdapter=new c.MvkPlayerAdapter(k),new l.AudioStats(window.playerAdapter),P=w.BannersController.initBannerBlocks()})),window.page.onChange((function(){"audio"===cur.module&&(P&&P.forEach((function(e){return e.destroy()})),P=w.BannersController.initBannerBlocks())})),k.subscribe(_.events.PLAY,(function(e){var t=k.getCurrent();t&&k.playing()&&!k.isAdsPlaying()&&ajax.post("/audio",{act:"start_playback",audio_id:t.id,owner_id:t.ownerId,hash:t.actionHash,uuid:k.getDeviceId()});e,$$("#lm_audio").forEach((function(e){addClass("ai_playing",e)}));var n=(0,f.getAudioElementsById)(e);if(!n)return;each(n,(function(e,t){addClass("ai_playing",t),addClass("ai_current",t)})),T[T.length-1]!==e&&T.push(e);I?I=!1:(E=g,g=!1,C.onPlay(e));ee()})),k.subscribe(_.events.PLAY_REQUESTED,(function(e){ne(e)})),k.subscribe(_.events.PAUSE,(function(e){$$("#lm_audio").forEach((function(e){removeClass("ai_playing",e)})),ee();var t=(0,f.getAudioElementsById)(e);if(!t.length)return;each(t,(function(e,t){removeClass("ai_playing",t),addClass("ai_current",t)})),I||(C.onPause(e),ee())})),k.subscribe(_.events.SELECT,L),k.subscribe(_.events.DESELECT,N),k.subscribe(_.events.PROGRESS,R),k.subscribe(_.events.SEEK,R),k.subscribe(_.events.AD_STARTED,(function(e){ie(e,!0),oe(e,!0)})),k.subscribe(_.events.AD_COMPLETED,(function(e){ie(e,!1),oe(e,!1),R(e.id,0,0)})),k.subscribe(_.events.NOT_FOUND_PLAYLIST,B),k.subscribe(_.events.EMPTY_PLAYLIST,B),k.subscribe(_.events.ENDED,(function(e){var t=geBySel('.audio_item[data-id="'+e+'"]');t&&(each(t,(function(e,t){G(t,1)})),g=!0,window.Unauthorized&&window.vk&&!window.vk.id&&(0,A.partConfigEnabled)("audio_unauth_preview_box")&&(g=!1,window.audio.pause(),window.Unauthorized.showMoreBox(null,0,y.UnauthorizedSourceType.AUDIO)),C.onEnded(e))})),k.subscribe(_.events.VOLUME,(function(e,t){var n=geBySel('.audio_item[data-id="'+e+'"]');n&&(each(n,(function(e,n){Y(n,t)})),C.onVolume(e,t))}));var D=null,O=null,U=!1,H=!1,F=!1;function V(e){if(D){F||(addEvent(document,s.isTouch?"touchmove":"mousemove",V),addEvent(document,s.isTouch?"touchend touchcancel":"mouseup",j),F=!0);var t=gpeByClass("audio_item",D),n=$(D,e);e&&cancelEvent(e);var i=attr(t,"data-id"),o=(0,f.getAudioElementsById)(i);each(o,(function(e,t){U&&G(t,n),H&&(Y(t,n),k.volume(n))})),O=n}}function j(e){if(D){F=!1,removeEvent(document,s.isTouch?"touchmove":"mousemove",V),removeEvent(document,s.isTouch?"touchend touchcancel":"mouseup",j);var t=gpeByClass("audio_item",D),n=$(D,e)||O;e&&cancelEvent(e);var i=geBySel('.audio_item[data-id="'+attr(t,"data-id")+'"]');each(i,(function(e,i){U&&(G(i,n),k.setPosition(n,!0)),H&&Y(t,n)})),U&&(I=k.playing(),C.onSeek(n)),D=O=null,U=H=!1}}function $(e,t){var n=gpeByClass("Slider__scroll",e),i=hasClass("touch",window.bodyNode)?10:8,o=(t.pageX||t.touches&&t.touches[0]&&t.touches[0].pageX||0)-(n?e.getBoundingClientRect().left:getX(e))-i/2,a=e.offsetWidth-i;return a?Math.max(0,Math.min(o/a,1)):0}function q(e,t){if(e){var n=geByClass1("ai_dur",e);val(n,t)}}function W(e,t){if(e){var n=geByClass1("aic_progress_wrap",e),i=geByClass1("aic_load_line",n);i&&(i.style.width=100*Math.max(0,Math.min(t,1))+"%")}}function G(e,t){if(e){var n=geByClass1("aic_progress_wrap",e),i=geByClass1("aic_progress_line",n);i&&(i.style.width=100*t+"%")}}function Y(e,t){if(e){var n=geByClass1("aic_volume_wrap",e),i=geByClass1("aic_progress_line",n);i&&(i.style.width=100*t+"%")}}function K(e){var t,n,i,o=e<0;return t=(n=(e=Math.round(o?-e:e))%60)<10?"0"+n:n,t=(i=(e=Math.floor(e/60))%60)+":"+t,(e=Math.floor(e/60))>0&&(i<10&&(t="0"+t),t=e+":"+t),o&&(t="-"+t),t}function Q(e,n){return K(t&&n?e-n:e)}function z(e){var t=window.cur;t.deletedAudios||(t.deletedAudios={}),t.deletedAudios[e]=!0}function X(e){var t=window.cur;t.deletedAudios&&delete t.deletedAudios[e]}function J(e,t,n){void 0===n&&(n=null),t?function(e){var t=window.cur;t.addedAudios||(t.addedAudios={}),t.addedAudios[e]=!0}(e):function(e){var t=window.cur;t.addedAudios&&delete t.addedAudios[e]}(e);var i=geBySel('.audio_item[data-id="'+e+'"]');each(i,(function(e,n){toggleClass("ai_added",n,t),val(geByClass1("ai_add",n),t?lang.global_delete_audio:lang.global_add_to_audio)}));var o=geBySel1('body > [id="ai_menu_'+e+'"]'),a=geByClass1("ai_add",o);val(a,t?lang.global_delete_audio:lang.global_add_to_audio),ae[e]=t,n&&((n.querySelector(".Btn__text")||n).innerText=t?lang.global_delete_audio:lang.global_add_to_audio),ActionMenu.update()}function Z(e,t,n){void 0===n&&(n=null),t?z(e):X(e);var i=geBySel('.audio_item[data-id="'+e+'"]');each(i,(function(e,n){toggleClass("ai_deleted",n,t),val(geByClass1("ai_del",n),t?lang.global_add_to_audio:lang.global_delete_audio)}));var o=geBySel1('body > [id="ai_menu_'+e+'"]'),a=geByClass1("ai_del",o);val(a,t?lang.global_add_to_audio:lang.global_delete_audio),ae[e]=!t,n&&((n.querySelector(".Btn__text")||n).innerText=t?lang.global_add_to_audio:lang.global_delete_audio),ActionMenu.update()}function ee(){var e=window.audio.getCurrentId(),t=(0,f.getAudioElementsById)(e),n=[],i=window.audio.playing();i&&e&&t.length&&t.forEach((function(e){var t=gpeByClass("audios_list",e)||gpeByClass("mcont",e);n.push(t)})),each(geByClass("_AudioPlayStatus"),(function(e,t){var n=i&&t.dataset.playlistId===k.getCurrentPlaylistId();toggleClass(t,"playing",n)}))}function te(e,t,n){if(window.isArticleWebView)return Article.audioPlay(k.getCurrentId(),k.playlist()),cancelEvent(e),!1;var i=window.lang;if(k.support){var o=(0,f.getAudioElementById)(t);if(o&&hasClass("ai_deleted",o)&&!hasClass("ai_current",o))return!0;n&&t!==k.getCurrentId()||(0,f.getPlaylistByAudioId)(t)!==k.getCurrentPlaylistId()?B(t,!0):k.operate(t)}else alert(i.mobile_audio_player_not_support);return cancelEvent(e),!1}function ne(e,t,n){void 0===t&&(t=null),void 0===n&&(n=null);var i=(0,f.getAudioElementsById)(e);k.playing()?(each(i,(function(e,t){addClass("ai_playing",t)})),$$("#lm_audio").forEach((function(e){addClass("ai_playing",e)}))):(each(i,(function(e,t){removeClass("ai_playing",t)})),$$("#lm_audio").forEach((function(e){removeClass("ai_playing",e)}))),null!==t&&null!==n&&each(i,(function(e,i){W(i,t/n),addClass("ai_current",i)}))}function ie(e,t){var n=(0,f.getAudioElementById)(e.fullId);toggleClass(b,n,t);var i=geByClass1("ai_title",n);val(i,t?(0,p.getLang)("global_audio_ad"):e.title),toggleClass(S,i,t)}function oe(e,t){geBySel(".audio_item.al_player").forEach((function(n){if(n){var i=geByClass1("ai_title",n);val(i,t?(0,p.getLang)("global_audio_ad"):e.title),toggleClass(S,i,t),toggleClass(b,n,t),toggle(geByClass1("ai_artist"),!t)}}))}var ae={},re={};return page.onChange((function(){ae={},re={}})),{init:function(t){e||(e=!0,onDOMReady((function(){window.nav&&window.audio&&window.audioplayer&&"#player"==nav.hash&&k.playlist().length&&C.openPlayer(geByClass1("AudioPlayerMini"),!0)})))},initAudio:function(){each(geByClass("ai_current"),(function(e,t){N(t=function(e){if(!(e=ge(e))||!e.dataset.audio)return null;var t=null;try{t=JSON.parse(e.dataset.audio)}catch(e){return null}return(0,d.asObject)(t)}(t))}));var e=k.loaded(),t=k.getPosition(),n=k.duration(),i=n?t/n:0;ne(k.getCurrentId(),e,n),L(k.getCurrent()),R(k.getCurrentId(),i,n),setTimeout((function(){ee()}),1)},getDOMFromAudio:function(e,t,n,i){if(!Object.keys(e).length)return'<div class="audio_item audio_item_disabled"></div>';var o=(0,d.asObject)(e);if(!o)return"";var r=(0,u.htsc)(o.ownerId+"_"+o.id),l=o.coverUrl_p||o.coverUrl_s,c=e,_=[];if(function(e){var t=window.cur;return!!t.deletedAudios&&t.deletedAudios[e]}(r)){if(n)return"";_.push(" ai_deleted")}(function(e){var t=window.cur;return!!t.addedAudios&&t.addedAudios[e]})(r)&&_.push("ai_added"),r===k.getCurrentId()&&(k.playing()&&_.push("ai_playing"),_.push("ai_current"));var f=!!vk.id&&(!o.isClaimed||o.canDelete);vk.id||_.push("ai_no_menu");var p=new h.default({is_playlist_forced:t,is_disabled:o.isClaimed,audio_id:r,is_authenticated:!!vk.id,login_redirect_url:"",is_explicit:o.isExplicit,can_add:o.canAdd,can_del:o.canDelete,serialized:JSON.stringify(c),classes:_,has_cover:i,cover_style:l?"background-image: url("+l+")":"",has_actions_menu:f,position:o.chartInfo?o.chartInfo.position:"",duration:o.duration,is_mobile:s.isTouch,_duration_title:K(o.duration),title:o.title,subtitle:o.subtitle,artist:o.performer,url:o.url});return a.default.html(p)},morePopup:function(e,t,n,i){if(void 0===t&&(t=null),void 0===n&&(n=null),void 0===i&&(i=null),null===t){var o=k.getCurrent()||{};t=o.fullId,n=o.accessKey,i=o.canDelete,re[t]=o}var r="";r=void 0!==ae[t]?ae[t]?(0,p.getLang)("global_delete_audio"):(0,p.getLang)("global_add_to_audio"):i?(0,p.getLang)("global_delete_audio"):(0,p.getLang)("global_add_to_audio"),m.default.open(a.default.elem((0,m.default)({on_overlay_click:["return ContextMenu.close","this"],class:"ContextMenu",close:!0,onClose:["return ContextMenu.close","this"],items:[{tag:"ul",class:"ContextMenu__list",inner:[!i&&{tag:"li",class:"ContextMenu__listItem",inner:[{tag:"a",class:"ContextMenu__listLink",href:"#",inner:r,onclick:"return audioplayer.add('"+t+"', '"+n+"', event, this);"}]},i&&{tag:"li",class:"ContextMenu__listItem",inner:[{tag:"a",class:"ContextMenu__listLink",href:"#",inner:r,onclick:"return audioplayer.del('"+t+"', event, this);"}]}]}]})),!0),e&&cancelEvent(e)},add:function(e,t,n,o){void 0===t&&(t=null),void 0===o&&(o=null);var a=(0,f.getAudioElementById)(e);if(!hasClass("ai_ajax",a)){var r=a?(0,d.asObject)(JSON.parse(a.dataset.audio)):re[e]||{};re[e]||(re[e]=(0,i.default)({},r));var s=!1;a?(s=hasClass("ai_added",a),re[e].deleteid=attr(a,"data-deleteid"),re[e].deleteHash=attr(a,"data-delete-hash")):void 0!==ae[e]&&(s=ae[e]),r.deleteid=r.deleteid||re[e].deleteid,r.deleteHash=r.deleteHash||re[e].deleteHash,r.restoreHash=r.restoreHash||re[e].restoreHash,J(e,!s,o),addClass("ai_ajax",a),C.onAdd(),o&&(o.disabled=!0),ajax.post("/audio",{_ajax:1,act:s?"delete":"add",audio:s?r.deleteid:r.fullId,hash:s?r.deleteHash:r.addHash,access_key:t,track_code:r.trackCode,source_playlist_id:(0,f.getPlaylistByAudioId)(r.fullId)},{redirectToLoginPage:!0,onDone:function(t,n){removeClass("ai_ajax",a),t?(re[e].deleteid=t,re[e].deleteHash=n,attr(a,"data-deleteid",t),attr(a,"data-delete-hash",n)):J(e,s,o),o&&(o.disabled=!1)},onFail:function(){removeClass("ai_ajax",a),J(e,s,o);var n=Array.prototype.slice.call(arguments),i=n.shift();switch(i){case 2:nav.go("/audio?act=add&audio="+e+"&hash="+(s?r.deleteHash:r.addHash)+"&access_key="+t)}o&&(o.disabled=!1)}}),n&&cancelEvent(n)}},del:function(e,t,n){void 0===n&&(n=null);var o=(0,f.getAudioElementById)(e),a=!1;o?a=hasClass("ai_deleted",o):void 0!==ae[e]&&(a=!ae[e]),Z(e,!a,n);var r=o?(0,d.asObject)(JSON.parse(o.dataset.audio)):re[e]||{};re[e]||(re[e]=(0,i.default)({},r)),a?X(e):z(e),C.onDel(),n&&(n.disabled=!0),r.deleteid=r.deleteid||re[e].deleteid,r.deleteHash=r.deleteHash||re[e].deleteHash,r.restoreHash=r.restoreHash||re[e].restoreHash,ajax.post("/audio",{_ajax:1,act:a?"restore":"delete",audio:e,playlist_id:(0,f.getPlaylistByAudioId)(e),hash:a?r.restoreHash:r.deleteHash},{redirectToLoginPage:!0,onDone:function(t){t||Z(e,a,n),n&&(n.disabled=!1)},onFail:function(){Z(e,a,n);var t=Array.prototype.slice.call(arguments),i=t.shift();switch(i){case 2:nav.go("/audio?act="+(a?"restore":"delete")+"&audio="+e+"&hash="+(a?r.restoreHash:r.deleteHash))}n&&(n.disabled=!1)}}),t&&cancelEvent(t)},playPause:te,getFormatedTime:Q,switchTimeFormat:function(e,n){var i=gpeByClass("audio_item",e);return!(hasClass("ai_current",i)&&!hasClass("ai_select",i))||(t=!t,lsSet("audio_time_left",t?"1":"0"),q((0,f.getAudioElementById)(k.getCurrentId()),Q(k.getPosition(),k.duration())),n&&cancelEvent(n),!1)},setPosition:function(e,t){D||k.isAdsPlaying()||(D=e,U=!0,V(t))},setVolume:function(e,t){D||(D=e,H=!0,V(t))},openPlayer:function(e,t){var n=window.audio,i=nav.path,o=n.getCurrentPlaylistId(),a=nav.params;o&&!a.includes("playlist_id")&&(a=(a?a+"&":"")+"playlist_id="+o);var r="#player",s=i+(a?"?":"")+a+r;return nav.al_go(s,null,{local:!0,target:e,nav:{push:s,path:i,params:a,hash:r},no_push:t})},getCurrentElem:function(){return(0,o.$)(".ai_current")},playFirst:function(e,t){e&&cancelEvent(e);var n=k.getCurrent(),i=gpeByClass("_audioPlaylist",t),o=n?n.fullId:null;if(!o||!geByClass1("ai_current",i)){var a=(i||ge("mcont")).$(".audio_item");o=a&&a.getAttribute("data-id")}o&&te(e,o)},hasArticleWebViewClientAudioSupport:function(){return window.clientWebviewAudioSupport},getPlaybackQueue:function(){return T},isAutoPlayed:function(){return E},playBlock:function(e,t,n){t.preventDefault(),k.getCurrentPlaylistId()!==e?x(e,(function(t){if(t.length){var i=t[0].fullId;k.select(i).then((function(){k.play(i),n.classList.add("playing"),n.dataset.playlistId=e}))}})):k.operate()},playShuffledBlock:function(e,t){e.preventDefault(),x(t.dataset.blockId,(function(e){if(e.length){var t=e[0].fullId;window.audio.play(t)}}))},openModal:function(e,t){var n=t.parentElement.querySelector(".Popup");return m.default.open(n,!0),M=(0,v.expandPopup)(t),cancelEvent(e),!1},closeModal:function(e){m.default.close(e),M&&M()},onAdd:(0,r.default)(),onDel:(0,r.default)(),onPlay:(0,r.default)(),onPause:(0,r.default)(),onProgress:(0,r.default)(),onVolume:(0,r.default)(),onSeek:(0,r.default)(),onPlaylistChanged:(0,r.default)(),onEnded:(0,r.default)(),sliderMove:V,sliderUp:j}}();window.audioplayer=C,window.Section=g.Section},58154:function(){var e=function(){var t=null,n=!1,i=!1,o={},a=[],r=0,s=null,l="",c="";function u(e,t){return!t&&g(e)}function d(e){i=!1;var t=ge("medias_map"),o=ge("attached_wrap");t||(t=ce("div",{id:"medias_map",className:"pi_medias"}),append(t,o));var a=+e[1]||0,r=e[3]||"",s=e[4]||"",l=e[5]||"",c=(+e[6].lat||0)+"_"+(+e[6].lng||0),u=geByClass1("medias_map",t),d='<div class="medias_map_close" onclick="checkin.remove();"><i class="i_close">&nbsp;</i></div><div class="medias_map_label" onclick="checkin.changePlace();">'+r+(l?", "+l:s?", "+s:"")+"</div>",_='<input type="hidden" name="place_id" value="'+a+'"><input type="hidden" name="place" value="'+c+'">';if(u)val(u,d+_);else{d='<div class="medias_map">'+d+_+"</div>";val(t,d)}addClass("cp_geo_btn_sel","geo_btn"),n=!0,show(t)}function _(e){return g(t)}function f(){val("place_add_box",""),hide("place_add_box"),show("places_box")}function p(e,n){m();var i=o[n];i&&(t={latitude:+i[6].lat||0,longitude:+i[6].lng||0},n?d(i):h(t,i))}function m(e){if(!s)return!0;val("m",s),s=null,scrollToEl(geByClass1("create_post_extra","mcont"));var t=nav.path+(nav.params?"?"+nav.params:"");return nav.go(t,null,{push_only:!0,no_push:e}),!1}function h(e,t){i=!0;var o=ge("medias_map"),a=ge("attached_wrap");o||(o=ce("div",{id:"medias_map",className:"pi_medias"}),a.appendChild(o));var r=e.latitude,s=e.longitude,l=(window.devicePixelRatio,t&&t[4]||!1),c=geByClass1("medias_map",o),u=l?'<div class="medias_map_close" onclick="checkin.remove();"><i class="i_close">&nbsp;</i></div><div class="medias_map_label" onclick="checkin.changePlace();">'+l+"</div>":"",d='<input type="hidden" name="map" value="'+(r+"_"+s+"_0")+'">';c?val(c,u+""+d):val(o,'<div class="medias_map">'+u+d+"</div>");n=!0,addClass("cp_geo_btn_sel","geo_btn"),show(o)}function v(){t=null,o={},a=[],r=0,ajax.post(c,{_ajax:1}),remove("medias_map")}function g(e){var t=window.al;remove("feed_extra_field");var n=Math.round(1e8*e.latitude)/1e8,i=Math.round(1e8*e.longitude)/1e8,o=gpeByTag("form","geo_btn"),a=ce("input",{id:"feed_extra_field",type:"hidden",name:"add_place",value:n+","+i});if(!o)return nav.go(nav.path+"?act=places&lat="+n+"&lng="+i);var r=!1;return each(o,(function(e,t){if("submit"===t.type)return r=t,!1})),r?(append(a,o),window.al&&t.ver?nav.go(r,null,{removeAfterNextResponse:!1}):o.submit()):void 0}function A(e){e&&e.coords&&u(t={latitude:+e.coords.latitude||0,longitude:+e.coords.longitude||0})}function y(t){e.remove(),hide("geo_waiting")}return{toggle:function(){n?e.remove():e.add()},addNewPlace:function(){var e=val("place_name_fld"),n=val("place_address_fld");return e?(lockButton("place_add_btn"),ajax.post("/places.php",{_ajax:1,act:"add_place",latitude:t.latitude,longitude:t.longitude,title:e,address:n,hash:l},{onDone:function(e,t){if(unlockButton("place_add_btn"),e){var n={};n[e]=t,extend(o,n),a.splice(a[0]?0:1,0,e),f(),p(null,e)}},onFail:function(){unlockButton("place_add_btn");var e=Array.prototype.slice.call(arguments),t=e.shift(),n=ge("place_add_form");switch(t){case 2:n&&n.submit()}}}),!1):(elfocus("place_name_fld"),!1)},addPlaceShow:function(e,n){var i=window.lang,o="/places.php"+obj2qs({act:"add_place",latitude:t.latitude,longitude:t.longitude,hash:l});val("place_add_box",'<h3 class="sub_header">'+i.mobile_geo_new_place_header+'</h3><div class="form_item fi_fat"><form id="place_add_form" action="'+o+'" method="post"><dl class="fi_row"><dt class="fi_label">'+i.mobile_geo_place_name_label+'</dt><dd class="iwrap"><input type="text" class="textfield" id="place_name_fld" name="title" /></dd></dl><dl class="fi_row"><dt class="fi_label">'+i.mobile_geo_place_address_label+'</dt><dd class="iwrap"><input type="text" class="textfield" id="place_address_fld" name="address" /></dd></dl><dl class="fi_row"><dd><input class="button" type="submit" id="place_add_btn" value="'+i.mobile_geo_place_add_btn+'" onclick="return checkin.addNewPlace(this);" /><a class="near_btn" onclick="checkin.addPlaceCancel(); return false;">'+i.mobile_cancel+"</a></dd></dl></form></div>"),val("place_name_fld",unescapeAttr(e)||""),val("place_address_fld",unescapeAttr(n)||""),hide("places_box"),show("place_add_box"),e?elfocus("place_address_fld"):elfocus("place_name_fld")},addPlaceCancel:f,selectPlace:p,changePlace:_,back:m,refreshCurrentPosition:function(){geo.getCurrentPosition(A,y)},getCurrentAddress:function(){return o[0]&&o[0][5]||""},savePlaces:function(e){extend(o,e)},add:function(e){if(!e&&n)return _();e&&(e.latitude||e.longitude)&&e.place?(t={latitude:+e.latitude||0,longitude:+e.longitude||0},e.place[1]?d(e.place):h(t,e.place),u(t,!0)):(geo.getCurrentPosition(A,y),show("geo_waiting"))},add_place:function(e){if(!e&&n)return _();e&&(e.latitude||e.longitude)&&e.place?(t={latitude:+e.latitude||0,longitude:+e.longitude||0},e.place[1]?d(e.place):h(t,e.place),u(t,!0)):(geo.getCurrentPosition(A,y),show("geo_waiting"))},remove:function(){n=!1,removeClass("cp_geo_btn_sel","geo_btn"),v()},stash:function(e){if(!e)return[t,n,i,o,a,r,s];t=e[0],n=e[1],i=e[2],o=e[3],a=e[4],r=e[5],s=e[6]},init:function(u,d,_){return hide("geo_waiting"),t=null,n=!1,i=!1,o={},a=[],r=0,s=null,l=d||"",c=_||"",u&&e.add(u),geo.init()}}}();window.checkin=e},27378:function(){window.FeedAssistance={hide:function(n,a,r){var s=domCA(n,i),l=hasClass(s,o);remove(s),l||function(n,i,o){var a=FeedAssistanceStats.getFromRef(n);ajax.post(e,{_ajax:1,type:i,hash:o,act:t,from:a})}(n,a,r);return!1},setFilled:function(e){var t=hasClass(e,n)?e:domCA(e,i);addClass(o,t)}};var e="/feed",t="hide_assistance",n="feedAssistance",i=".feedAssistance",o="feedAssistance_filled"},49861:function(){function e(e){var n=0;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(e=function(e,n){if(!e)return;if("string"==typeof e)return t(e,n);var i=Object.prototype.toString.call(e).slice(8,-1);"Object"===i&&e.constructor&&(i=e.constructor.name);if("Map"===i||"Set"===i)return Array.from(i);if("Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i))return t(e,n)}(e)))return function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}};throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}return(n=e[Symbol.iterator]()).next.bind(n)}function t(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}window.FeedAssistanceExploreBait={onSubscribeLinkClick:function(e,t,a,s,l,c){var u=hasClass(e,n),d=u?s:a,_=u?getLang("mobile_groups_public_subscribe"):getLang("mobile_groups_you_are_in_public"),f=!u,p=(m=e,h=domCA(m,o),intval(domData(h,"block-id")));var m,h;attr(e,"aria-label",escapeAttr(_)),toggleClass(n,e,f),"group"===l?function(e,t,n,o){var a=n?Groups.leave:Groups.enter,s=n?FeedAssistanceStats.EVENTS.SUB_EVENT_EXPLORE_BAIT_UNSUBSCRIBE:FeedAssistanceStats.EVENTS.SUB_EVENT_EXPLORE_BAIT_SUBSCRIBE;o&&r(s),a.call(Groups,e,t,i)}(t,d,u,c):function(e,t,n,o,a){var s=n?Friends.decline:Friends.accept,l=n?FeedAssistanceStats.EVENTS.SUB_EVENT_EXPLORE_BAIT_UNSUBSCRIBE:FeedAssistanceStats.EVENTS.SUB_EVENT_EXPLORE_BAIT_SUBSCRIBE;a&&r(l),s.call(Friends,e,t,i,o)}(t,d,u,p,c);return!1}},FeedAssistanceStats.registerTrackingCls("post_exploreBait"),FeedAssistanceStats.onStartViewElement((function(t){if(FeedAssistanceStats.getElementType(t)===FeedAssistanceStats.BLOCKS.BLOCK_TYPE_EXPLORE_BAIT){if(t._exploreBaitClickHandlerAdded)return;a=!0,addEvent(t,"click",(function(t){!function(t){for(var n,i=t.target,o=e(s);!(n=o()).done;){if(!0===n.value.call(null,i))return}}(t)})),t._exploreBaitClickHandlerAdded=!0}})),nav.onBeforeGo((function(e){if(!a)return;if(!function(e){return e.tagName&&"explore-bait"===domData(e,"post-type")}(e))return;!function(e){for(var t=0,n=["pi_text_more","wi_date","pi_text","i_replies","v_replies","item_replies"];t<n.length;t++){var i=n[t];if(hasClass(i,e))return r(FeedAssistanceStats.EVENTS.SUB_EVENT_EXPLORE_BAIT_OPENED),!0}}(e)}));var n="post__subscribeBtn_unsubscribe",i="feed",o=".post_exploreBait",a=!1;function r(e){FeedAssistanceStats.dispatchEvent({type:FeedAssistanceStats.EVENTS.EVENT_EXPLORE_BAIT,data:FeedAssistanceStats.serializeEventData(FeedAssistanceStats.EVENTS.EVENT_EXPLORE_BAIT_SUB,e)})}var s=[function(e){if(domData(e,"post-owner-type"))return r("user"===domData(e,"post-owner-type")?FeedAssistanceStats.EVENTS.SUB_EVENT_EXPLORE_BAIT_OPEN_USER:FeedAssistanceStats.EVENTS.SUB_EVENT_EXPLORE_BAIT_OPEN_GROUP),!0},function(e){var t={report:FeedAssistanceStats.EVENTS.SUB_EVENT_EXPLORE_BAIT_REPORT,hide:FeedAssistanceStats.EVENTS.SUB_EVENT_EXPLORE_BAIT_HIDE}[domData(e,"post-action")];if(t)return r(t),!0}]},11299:function(){window.FeedAssistanceImportContacts={importContacts:function(t,n,i){if(!window.XMLHttpRequest||i)return;var o=domData(t,"service-id");return window.open(n),e[o]=t,!1}};var e={},t="feedAssistanceImportContacts__desc",n="mobile_join_friends_found_count",i=!1;FeedAssistanceStats.registerTrackingCls("feedAssistance_importContacts"),FeedAssistanceStats.onStartViewElement((function(e){FeedAssistanceStats.getElementType(e)===FeedAssistanceStats.BLOCKS.BLOCK_TYPE_IMPORT_CONTACTS&&(i=!0)})),Friends.onImportSuccess((function(){var o=arguments[0],a=arguments[2],r=e[o];if(r){var s=geByClass1(t,r);s.textContent=getLang(n,a)}i&&FeedAssistanceStats.dispatchEvent({type:FeedAssistanceStats.EVENTS.EVENT_FEED_ASSISTANCE,data:FeedAssistanceStats.serializeEventData(FeedAssistanceStats.EVENTS.EVENT_FEED_ASSISTANCE,r,"m_mp",FeedAssistanceStats.EVENTS.SUB_EVENT_FILLED)})})),Friends.onImportFailed((function(n){var i=e[n];i&&(geByClass1(t,i).textContent=getLang("mobile_friends_import_error"))}))},86490:function(){FeedAssistanceStats.registerTrackingCls("feedAssistance_profilePhoto")},58532:function(){FeedAssistanceStats.registerTrackingCls("feedAssistance_promoButton"),FeedAssistanceStats.onStartViewElement((function(e){if(FeedAssistanceStats.getElementType(e)===FeedAssistanceStats.BLOCKS.BLOCK_TYPE_PROMO_BUTTON){if(e._promoButtonClickHandlerAdded)return;var t=geByClass1("feedAssistancePromoButtonInstallApp__button",e),n=t?"install_app":"";addEvent(t||e,"click",(function(){!function(e,t,n){FeedAssistanceStats.dispatchEvent({type:FeedAssistanceStats.EVENTS.EVENT_PROMO_BUTTON,data:FeedAssistanceStats.serializeEventData(FeedAssistanceStats.EVENTS.EVENT_PROMO_BUTTON_SUB,e,t,n)})}(e,FeedAssistanceStats.EVENTS.SUB_EVENT_PROMO_BUTTON_CLICK,n)})),e._promoButtonClickHandlerAdded=!0}}))},93855:function(e,t,n){"use strict";var i=n(3811);onDOMReady(r),window.page&&page.onChange(r);var o="feedAssistance_pushNotificationsSwitch",a="enable_browser_notifications";function r(){window.pushNotifier&&pushNotifier.canBeEnabled().then((function(e){return e&&PushNotifier.getPermission()===i.PUSH_NOTIFIER_PERMISSION_DEFAULT})).then((function(e){if(e){FeedNotifications.addWebActionAcceptHandler(a,s),FeedNotifications.addWebActionDeclineHandler(a,l);var t=geByClass1(o);if(!t)return;FeedAssistanceStats.registerTrackingCls(o),FeedAssistanceStats.register(t,"feed")}}))}function s(e){return pushNotifier.requestPermission().then((function(t){var n,o=!0;return unlockButton(e),t===i.PUSH_NOTIFIER_PERMISSION_DEFAULT?o=!1:(n=t===i.PUSH_NOTIFIER_PERMISSION_GRANTED?FeedAssistanceStats.EVENTS.SUB_EVENT_ENABLE_PUSH:FeedAssistanceStats.EVENTS.SUB_EVENT_DECLINE_PUSH,u(e,n),c(),o)}),(function(){return l(e)}))}function l(e){return unlockButton(e),u(e,FeedAssistanceStats.EVENTS.SUB_EVENT_DECLINE_PUSH),c(),!0}function c(){var e=geByClass1(o);remove(e)}function u(e,t){FeedAssistanceStats.dispatchEvent({type:FeedAssistanceStats.EVENTS.EVENT_FEED_ASSISTANCE,data:FeedAssistanceStats.serializeEventData(FeedAssistanceStats.EVENTS.EVENT_FEED_ASSISTANCE,e,"m_push_switch",t)})}},14903:function(){FeedAssistanceStats.registerTrackingCls("feedAssistance_recommendedFriends"),FeedAssistanceStats.onStartViewElement((function(e){if(FeedAssistanceStats.getElementType(e)===FeedAssistanceStats.BLOCKS.BLOCK_TYPE_RECOMMENDED_SLIDER){if(e._friendsSliderHandlersAdded)return;e._friendsSliderHandlersAdded=!0}}))},78631:function(){FeedAssistanceStats.registerTrackingCls("feedAssistance_recommendedGroups"),FeedAssistanceStats.onStartViewElement((function(e){if(FeedAssistanceStats.getElementType(e)===FeedAssistanceStats.BLOCKS.BLOCK_TYPE_RECOMMENDED_GROUPS_SLIDER){var t,n,i=e.querySelector(".Slider__scroll").dataset.code;if(i)null==(t=window.RecommendedGroupsSlider)||t.viewBlock(i),null==(n=window.RecommendedGroupsSlider)||n.onScroll();if(e._groupsSliderHandlersAdded)return;e._groupsSliderHandlersAdded=!0}}))},97708:function(){var e={init:function(e){var t=this;this.store?addEvent(window,"scroll touchstart",this._onScrollHandler):(this.store=extend({},e),this.loadCount=20,this.store.offset=this.store.offset?this.store.offset:this.loadCount,this.isLoading=!1,this.elems={wrap:geByClass1("author-page"),nav:geByClass1("author-page-nav",this.wrap),header:geByClass1("author-page-header",this.wrap),content:geByClass1("author-page__inner",this.wrap),spinner:geByClass1("author-page__spinner",this.wrap)},this._onScrollHandler=this._onScrollHandler.bind(this),addEvent(window,"scroll touchstart",this._onScrollHandler),e.isStandalone&&(window.al=!1),window.cur.destroy.push((function(){removeEvent(window,"scroll touchstart",t._onScrollHandler)})))},_getLoadOffset:function(){return this.store.offset},_showLoader:function(){this.isLoading=!0,addClass(this.elems.spinner,"active")},_hideLoader:function(){this.isLoading=!1,removeClass(this.elems.spinner,"active")},_onScrollHandler:function(){var e=this,t=this.elems,n=t.nav,i=t.header,o=t.content,a=this.store.totalCount>this._getLoadOffset();toggleClass(n,"author-page-nav_shown",i.getBoundingClientRect().bottom-n.clientHeight<0),a&&window.scrollTop()+2*window.innerHeight>o.offsetHeight&&this._loadMore(this.store.sortBy,this._getLoadOffset(),(function(t){e.elems.content.innerHTML+=t}))},_loadMore:function(e,t,n){var i=this;void 0===e&&(e=!1),void 0===t&&(t=!1),this.isLoading||(e&&(this.store.sortBy=e),isFunction(n)||(n=function(){}),this._showLoader(),ajax.post("author_page.php",{act:"load_more",author_id:this.store.authorId,sort_by:e||this.store.sortBy,count:this.loadCount,offset:void 0!==t?t:this._getLoadOffset()},{onFail:function(){i._hideLoader()},onDone:function(e){i._hideLoader(),i.store.offset+=20,e&&n(e)}}))},subscribe:function(e,t,n){ajax.post("author_page.php",{act:"subscribe",author_id:t,hash:n},{onDone:function(t,n){toggleClass(e,"Btn_theme_link",t),e.innerHTML=n}})},sortBy:function(e,t){e.preventDefault(),Unfold.setActive(e.target.parentNode),this._closeUnfold(e),t!==this.store.sortBy&&this.updateList(t)},updateList:function(e,t){var n=this;void 0===t&&(t=!1),e=e||this.store.sortBy,addClass(this.elems.content,"loading"),t&&Unfold.setActive(geByClass1("Unfold__item")),this._loadMore(e,0,(function(e){n.elems.content.innerHTML=e,n.store.offset=n.loadCount,removeClass(n.elems.content,"loading")}))},_closeUnfold:function(e){if(e){var t=e.target.closest(".Unfold");t&&removeClass(t,"Unfold_open")}},addToBookmark:function(e,t,n,i,o){e.preventDefault(),this._closeUnfold(e);var a=+domData(t,"is-bookmarked"),r=a?"bookmark_remove":"bookmark_add",s=geByClass1("Unfold__itemText",t);ajax.post("bookmarks.php",{_ajax:1,act:r,item_type:5,item_oid:n,item_id:i,hash:o},{onDone:function(e,n,i){domData(t,"is-bookmarked",a?0:1),a?s&&(s.innerHTML=lang.mobile_bookmarks_actions_add):s&&(s.innerHTML=lang.mobile_bookmarks_actions_remove),i&&Bookmarks.showSuccessSnack(i)}})},pinArticle:function(e,t,n,i,o){var a=this;e.preventDefault(),this._closeUnfold(e),ajax.post("author_page.php",{act:"pin_article",article_owner_id:t,article_id:n,do_pin:i?0:1,hash:o},{onDone:function(){a.updateList("date",!0)}})},hideArticle:function(e,t,n,i){var o=this;e.preventDefault(),this._closeUnfold(e),ajax.post("author_page.php",{act:"hide_article",article_owner_id:t,article_id:n,hash:i},{onDone:function(){o.updateList()}})}};window.AuthorPage=e},38532:function(e,t,n){"use strict";var i=n(3226),o={onIframeReady:(0,i.default)("{ is_api, check_transfer_url, on_success_url }"),onPostMessage:(0,i.default)(),onAcceptCookieClick:(0,i.default)()};function a(e){var t;if(e.origin.match(/^https?:\/\/([a-zA-Z0-9\-\.]+\.)?money\.mail\.ru$/)){try{t=JSON.parse(e.data)}catch(e){t={}}"billing"===t.type&&o.onPostMessage(t.action,t.action_params)}}o.onIframeReady((function(){addEvent(window,"message",a),window.cur.destroy.push((function(){removeEvent(window,"message",a)}))})),window.BasisMoneyTransfer=o,t.default=o},8055:function(e,t,n){"use strict";n(38532).default.onPostMessage((function(e){"waiterStart"!==e&&"3dsPage"!==e||document.activeElement&&document.activeElement.blur()}))},17769:function(e,t,n){"use strict";var i=n(38532);i.default.onPostMessage((function(e,t){"resizeFrame"===e&&setStyle(geByClass1("pageMoneyTransfer__iframe"),"height",t.height+40)}))},86207:function(e,t,n){"use strict";var i=n(38532),o=["touchstart","touchend","touchmove","touchcancel"];i.default.onIframeReady((function(e){e.is_api&&registeredEvents.forEach((function(e){var t=e[0],n=e[1],i=e[2];o.indexOf(n)>=0&&removeEvent(t,n,i)}))}))},3206:function(e,t,n){"use strict";n(38532).default.onPostMessage((function(e){"resizeFrame"!==e&&"pageLoad"!==e||window.scrollTop(0)}))},30512:function(e,t,n){"use strict";var i,o,a,r=n(38532),s=n(9046),l="pageMoneyTransfer",c="pageMoneyTransfer_error",u="pageMoneyTransfer__errorText",d="pageMoneyTransfer__iframe";r.default.onIframeReady((function(e){f(),o={checkUrl:e.check_transfer_url,onSuccessUrl:e.on_success_url},m(),window.cur.destroy.push(h)})),r.default.onPostMessage((function(e,t){if("paySuccess"===e)addClass("pageMoneyTransfer_success",geByClass1(l));else if("payError"===e)h(),addClass(c,geByClass1(l)),val(geByClass1(u),t.descr);else if("session_fail"===e){if(_)return void p();h(),addClass(c,geByClass1(l)),addClass("pageMoneyTransfer_errorCookie",geByClass1(l))}else if("putPixel"===e&&"page_load"===t.alias){var n=null;(0,s.isVkWebView)()&&((0,s.isIosWebView)()?n="iphone":isAndroidWebView()&&(n="android")),n||(n=""),(0,s.statlogsValueEvent)("money_transfers",0,"iframe_loaded",n)}}));var _=0;function f(){var e=geByClass1(d);if(e){var t=e.contentWindow.document;t.open("text/html","replace"),t.write(attr(e,"data-html")),t.close()}else setTimeout(f,2e3)}function p(){var e=geByClass1(d);if(e){var t=ce("div",{innerHTML:attr(e,"data-html")});hide(e),geByClass1(l).appendChild(t),ge("payment_form").submit()}else setTimeout(p,2e3)}function m(){var e=o,t=e.checkUrl,n=e.onSuccessUrl;i=setInterval((function(){a=ajax.post(t,{},{onDone:function(e,t,i){if(1===e||3===e){if(h(),i)return void nav.go(i,null,{replace:!0});"/"===n[0]?nav.go(n,null,{replace:!0}):location.href=n}else 2===e&&(h(),addClass(c,geByClass1(l)),val(geByClass1(u),t))}})}),2e3)}function h(){i&&(clearInterval(i),i=null),a&&(a.abort(),a=null)}r.default.onAcceptCookieClick((function(){var e=window.open("https://top-fwz1.mail.ru/counter2?id=1;","","width=300; height=300");setTimeout((function(){e.close();var t=geByClass1(d),n=clone(t);removeClass(c,geByClass1(l)),replace(n,t);var i=n.contentWindow.document;i.open("text/html","replace"),i.write(attr(t,"data-html")),i.close(),m()}),500),_++}))},31728:function(e,t,n){"use strict";n(38532),n(8055),n(17769),n(86207),n(3206),n(30512)},69393:function(e,t,n){"use strict";var i=n(22770),o=function(){var e,t,n,o="ai_menu_opened",a=!1;function r(e){for(var t=!1;e;){var n=getStyle(e,"overflow-y");if(("scroll"===n||"auto"===n)&&e.offsetHeight<e.scrollHeight){e===document.documentElement||e===document.body?e=null:t=!0;break}e=e.parentElement}return{cursor:e,isOverflowYContainer:t}}function s(e){for(var t=!1;e;){var n=getStyle(e,"overflow-x"),i=hasClass(e,"Slider__scroll");if("scroll"===n||"auto"===n||i){t=!0;break}e=e.parentElement}return{cursor:e,isOverflowXContainer:t}}function l(){if(e&&t){var n=geByClass1("i_pointer",e);if(document.body.contains(n))r(n).isOverflowYContainer?setStyle(t,"top",n.getBoundingClientRect().top):setStyle(t,"top",getY(n)),s(n).isOverflowXContainer?setStyle(t,"left",function(e){return e.getBoundingClientRect().left}(n)-getW(t)):setStyle(t,"left",getX(n)-getW(t))}}function c(e){e&&"A"===e.target.tagName&&requestAnimationFrame((function(){l()}))}function u(u){!function(n){e=gpeByClass("ai_menu_wrap",n),t=geByClass1("ai_menu",e)}(u),addClass(o,e),append(t,document.body),(n=(0,i.setFocusTrap)(t))&&(n.exitIntent=function(){d()}),a=d,tooltip.addHandler(a),tooltip.show(e,t),addEvent(window,"resize",l),addEvent(t,"click",c);var _=geByClass1("i_pointer",e),f=r(_);f.isOverflowYContainer&&addEvent(f.cursor,"scroll",l);var p=s(_);p.isOverflowXContainer&&addEvent(p.cursor,"scroll",l),l()}function d(){removeClass(o,e),append(t,e),tooltip.removeHandler(a),tooltip.hide(),n&&(n(),n=null),removeEvent(window,"resize",l),removeEvent(t,"click",l);var i=geByClass1("i_pointer",e),c=r(i);c.isOverflowYContainer&&removeEvent(c.cursor,"scroll",l);var u=s(i);u.isOverflowXContainer&&removeEvent(u.cursor,"scroll",l)}return{closeMenu:d,toggleMenu:function(t,n){cancelEvent(t),hasClass(o,e)?d():u(n)},update:function(){!function(){if(t){var e=geByClass("wia_item",t);e&&each(e,(function(e,t){var n=clone(t);before(n,t),remove(t),addClass("unhover",n),setTimeout((function(){removeClass("unhover",n)}),100)}))}}(),l()}}}();window.ActionMenu=o},33927:function(){var e,t=need("Control"),n=need("Popup"),i=(e="adultConfirm__submit_disabled",{init:function(){var n=geByClass1("_adultConfirm"),i=geByClass1("_adultConfirm__submit",n),o=geByClass1("adultConfirm__checkbox",n);toggleClass(e,i,!t.isChecked(o))},toggle:function(t){var n=gpeByClass("_adultConfirm",t.$control),i=geByClass1("_adultConfirm__submit",n);toggleClass(e,i,!t.checked)},submit:function(t,i){if(cancelEvent(t),!hasClass(e,i)){var o=gpeByClass("_adultConfirm",i),a=geByClass1("_adultConfirm__form",o),r={_ajax:1};each(geByTag("input",a),(function(e,t){var n=t.type.toLowerCase(),i=t.name.toLowerCase();"hidden"!==n&&"checkbox"!==n&&"radio"!==n||(r[i]=t.value)}));var s=attr(a,"action");ajax.post(s,r),n.close()}},back:function(e){cancelEvent(e),window.history?window.history.back():window.location="/"}});window.AdultConfirm=i},30506:function(e,t,n){"use strict";var i=n(9046),o=n(11393),a=n(17656),r=n(49751);window.page&&page.onChange((function(){$$(".AlertBox").forEach((function(e){return a.default.close(e)}))})),window.AlertBox=function(e,t,n,s){void 0===s&&(s={});var l=(0,i.ceFromString)(o.default.html((0,a.default)({id:s.id,class:"AlertBox",scrollable:!0,header:{title:t||getLang("mobile_warning_header")},content:[e,{class:"Popup__buttons",inner:[(0,r.default)({onClick:n||"Popup.close(this)",use_native_onclick:!0,class:"Popup__button",theme:"regular",inner:o.default.wrap(getLang("mobile_close"))})]}]})));domInsert(document.body,l),a.default.open(l,!0)}},2862:function(e,t,n){"use strict";var i=n(1730),o=n(29804),a=!1;page.onChange(u),photo.onZLayerToggle((function(e){e?(a=!0,d(s)):u()})),o.colorScheme.onInit((function(){a||c()})),o.colorScheme.subscribe((function(){a||c()}));var r,s="#050505",l=(0,i.$)('meta[name="theme-color"]');function c(){o.colorScheme.isDarkScheme()?d("#19191a"):d("#ffffff")}function u(){a=!1,c()}function d(e){r||(r=(0,i.$)("#theme_color_shim")),l&&l.setAttribute("content",e),r&&(r.style.backgroundColor=e)}},85601:function(e,t,n){"use strict";n.d(t,{default:function(){return i}});var i=function(){function e(e,t){var n=Object.assign({},{tick:100,onEnd:function(){},onTick:function(){},onStart:function(){},onPause:function(){},onStop:function(){}},t);this.left=e,this.initialTime=e,this.tick=n.tick,this.onEnd=n.onEnd,this.onTick=n.onTick,this.onStart=n.onStart,this.onPause=n.onPause,this.onStop=n.onStop,this.started=!1}var t=e.prototype;return t.stop=function(e){void 0===e&&(e=!1),this.started&&(this.pause(e),this.left=this.initialTime,e||this.onStop())},t.pause=function(e){void 0===e&&(e=!1),this.timer&&(this.timer=clearInterval(this.timer),this.started=!1,e||this.onPause())},t.start=function(){var e=this;if(this.started)return!1;var t=new Date(Date.now()+this.left).getTime();this.started=!0,this.timer=setInterval((function(){var n=(new Date).getTime();e.left=t-n,e.left<=0?(e.onTick(0),e.onEnd(),e.stop(!0)):e.onTick(e.left)}),this.tick),this.onStart()},t.isStarted=function(){return this.started},t.getTimeLeft=function(){return this.left},e}()},43116:function(e,t,n){"use strict";n.d(t,{updateCounters:function(){return o}});var i=n(1659);function o(){var e=nav.cur||window.location.pathname||"",t=location.protocol+"//"+location.host+e,n=window.page.lastTrackedPage&&window.page.lastTrackedPage!==t?location.protocol+"//"+location.host+window.page.lastTrackedPage:"";window.page.lastTrackedPage=e,(0,i.updateCounters)(t,n)}},51758:function(){var e="dropdown_open",t={_onTogglerClick:function(t,n){preventEvent(t),stopEvent(t);var i=gpeByClass("dropdown",n);if(toggleClass(i,e),!1!==i.isFirstClick){i.isFirstClick=!1;var o=function(){removeClass(i,e)};addEvent(window,"click",o),window.cur.destroy.push((function(){removeEvent(window,"click",o),i.isFirstClick=!0}))}}};window.Dropdown=t},51105:function(){var e,t=(e=document.getElementsByClassName("gift_create_post_counter"),{counter:function(t){var n=e[0];if(n){var i=t.value.length,o=t.maxLength;if(i>o)t.value=t.value.substr(0,o);else if(i>o/2){var a=Math.max(o-i,0);n.innerText=langNumeric(a,lang.text_N_symbols_remain),show(n)}else hide(n)}}});window.GiftsSendFormCounter=t},57069:function(){var e,t,n=(e="_locked",t={1:"SEND_EMAIL",2:"CALL_PHONE",6:"OPEN_GROUP_APP"},{processButton:function(n,i,o,a,r,s){if(void 0===s&&(s=!1),n.classList.contains(e))return!1;var l=!0;return t[i]&&(l=!1),n.classList.add(e),ajax.post("/groups",{_ajax:1,act:"proxy_cta_button",action:i,resource:o,group_id:a,hash:r},{onDone:function(){if(n.classList.remove(e),s)s();else if(l){var t=attr(n,"href");nav.go(t)}}}),!l}});window.GroupActionButton=n},60207:function(e,t,n){"use strict";var i,o,a,r,s,l=n(62691),c="groupCover-vk_animationYes",u="groupCover-vk_animationStep",d=[".basis__header_unauthorized"],_=!1;function f(){_||(i={vk:geByClass1("vk"),basis:geByClass1("basis"),header:geByClass1("basis__header"),headerTitle:geByClass1("mh_header",geByClass1("basis__header")),headerFirstIcon:geByClass1("GroupCoverIcons__icon--back_outline_28",geByClass1("basis__header")),headerSecondIcon:geByClass1("GroupCoverIcons__icon--back_outline_white_28",geByClass1("basis__header")),cover:geByClass1("groupCover"),coverImage:geByClass1("groupCover__image"),coverDimmer:geByClass1("groupCover__dimmer")}).cover&&(_=!0,addClass(i.vk,c),o=!l.default.chrome||Number(l.default.version.split(".")[0])>50,a="fixed"===getStyle(i.header,"position"),r=getH(i.header),s=getH(i.cover),onBodyScroll(m),onBodyResize(h),m(),window.cur.destroy=window.cur.destroy.filter((function(e){return e!==p})),window.cur.destroy.push(p))}function p(){(!0||menu.opened())&&(removeClass(i.vk,u),removeClass(i.vk,c)),onBodyScroll("__clear",m),onBodyResize("__clear",h),_=!1}function m(){var e=scrollTop();if(a)if(e<0)setStyle(i.header,"top",-e),g(),setStyle(i.coverDimmer,"opacity",0),setStyle(i.coverImage,"top",0);else{var t=document.body,n=Math.min(1,e/(s-r)),l=t&&t.classList.contains("vk_tabbar_top")&&!i.header.classList.contains("basis__header_noBottomMenu")?48:0;setStyle(i.header,"top",l),setStyle(i.headerTitle,"display","block"),setStyle(i.headerFirstIcon,"display","block"),setStyle(i.headerSecondIcon,"display","block"),n<=.9?(g(),o&&setStyle(i.coverImage,"top",.5*e),setStyle(i.coverDimmer,"opacity",n/.9),setStyle(i.headerTitle,"opacity",0),setStyle(i.headerFirstIcon,"opacity",0),setStyle(i.headerSecondIcon,"opacity",1)):(setStyle(i.headerTitle,"opacity",1),setStyle(i.headerFirstIcon,"opacity",1),setStyle(i.headerSecondIcon,"opacity",0),v())}else Math.min(1,e/s)<1?(g(),setStyle(i.coverDimmer,"opacity",0),o&&setStyle(i.coverImage,"top",.5*e),setStyle(i.headerTitle,"display","none"),setStyle(i.headerFirstIcon,"display","none"),setStyle(i.headerSecondIcon,"display","block")):v()}function h(){p(),f()}function v(){d.map((function(e){return $(e)})).some((function(e){return e}))||removeClass(i.vk,u)}function g(){d.map((function(e){return $(e)})).some((function(e){return e}))||addClass(i.vk,u)}onDOMReady((function(){(l.default.chrome||l.default.safari&&l.default.ios>=9)&&(f(),page.onChange(f),zlayer.onClose((function(){setTimeout(f,0)})))}))},61795:function(){var e=function(){function e(e){var t=e.closest(".si_body");return{buttons:$(".si_links",t),message:$(".si_msg",t)}}return{sendRequest:function(t,n){t&&t.preventDefault();var i=n.getAttribute("href");ActionMenu.closeMenu();var o=e(n);ajax.post(i,{_ajax:1},{onDone:function(e){!function(e){hide(e.buttons),show(e.message)}(o),val(o.message,e)}})},cancelRequest:function(t,n){t&&t.preventDefault();var i=n.getAttribute("href"),o=e(n);ajax.post(i,{_ajax:1},{onDone:function(e){}}),function(e){hide(e.message),show(e.buttons)}(o)}}}();window.GroupsInvite=e},72378:function(e,t,n){"use strict";var i=n(9046),o={cachedProgress:{}},a={init:function(e,t){return void 0===e&&(e=(0,i.srand)()),void 0===t&&(t=20),this.radius=t,{component:this._getLoader(e,o.cachedProgress[e]),id:e}},update:function(e,t){var n=$('[data-loader-id="'+e+'"] circle');if(n){var i=this.radius,a=Math.PI*(2*i);o.cachedProgress[e]=t;var r=(100-Math.max(5,t))/100*a;n.setAttribute("stroke-dashoffset",r)}},ready:function(e){var t=$('[data-loader-id="'+e+'"]');re(t)},_getLoader:function(e,t){void 0===t&&(t=0);var n=this.radius,i=Math.PI*(2*n);return{class:"Loader",inner:[{class:"Loader__progress","data-loader-id":e,inner:{tag:"svg",viewPort:"0 0 100 100",inner:{tag:"circle",r:n,cx:"30",cy:"30","stroke-dashoffset":(100-Math.max(5,t))/100*i,"stroke-dasharray":i}}}]}}};t.default=a},85708:function(e,t,n){"use strict";var i=n(42516),o=n(3226),a=function(){var e=38,t=40,n=13,a=27,r="MentionContainer_opened",s="Mention_inited",l="Mention_noScroll",c="MentionItem_active",u={},d={},_=!1;function f(){u={ignoredTerm:null,curValue:"",curTerm:"",curPos:"",input:{}},d={container:null,scroll:null,index:{},cache:{},shown:[],lastQ:null,text:null,requestTimer:null,opts:{}}}f();var p=!0;function m(){p=!1}function h(){var e,t,n,i,o,a,r=val(u.input),s=Math.max(r.lastIndexOf("@"),r.lastIndexOf("*")),l=!1;if(s>-1){var c=function(e){if(void 0!==e.selectionStart)return e.selectionStart!==e.selectionEnd?e.selectionEnd:e.selectionStart;if(void 0!==window.getSelection){var t=window.getSelection();if(!t||!t.rangeCount)return 0;var n=t.getRangeAt(0),i=n.cloneRange(),o=ce("div");return i.selectNodeContents(e),i.setEnd(n.startContainer,n.startOffset),o.appendChild(i.cloneContents()),val(o).replace(/\n$/,"").length}return 0}(u.input),_=r.substr(0,c);s=Math.max(_.lastIndexOf("@"),_.lastIndexOf("*"));var f=_.match(/(^|[\s.,:\'\"\u00BB\u00AB;>\)\(]|\#[\w_\.\u0400-\u04FF]+)[@\*]([^,@\*\(\)\?\!\s\n\r \u00A0]*)$/);f&&"."!==f[2].substr(-1)&&(l=f[2])}!1===l&&delete u.ignoredTerm,void 0!==u.ignoredTerm&&l==u.ignoredTerm&&(l=!1),u.curValue=r,u.curTerm=l,u.curPos=s,d.text=l,!1===u.curTerm?A():(E(!1,u.curTerm),g(),e=ge("mhead").offsetHeight,t=d.container.getBoundingClientRect(),n=u.input.offsetHeight,i="Mention_openToBottom",o=parseInt(getStyle(d.scroll,"maxHeight"),10),a=!1,a=hasClass(i,d.container)?t.top-n-o<e:t.bottom-o<e,getXY(u.input)[1]>=e+o&&(a=!1),toggleClass(i,d.container,a),toggleClass(i,d.opts.appendTo,a))}function v(e){u.input=e}function g(){N(),document.addEventListener("click",y,!0),addClass(r,d.opts.appendTo),show(d.container),function(){if(!_){var e=browser.ipad?"touchend":"click";_=!0,addEvent(window,e,A),addEvent(window,"touchmove",m),nav.onBeforeGo(A)}}()}function A(e){!browser.ipad||p?e&&e.target&&gpeByClass(s,e.target)&&!gpeByClass("uMailWrite__button",e.target)&&!hasClass("uMailWrite__button",e.target)||hasClass(r,d.opts.appendTo)&&(removeClass(r,d.opts.appendTo),hide(d.container),function(){if(_){var e=browser.ipad?"touchend":"click";removeEvent(window,e,A),removeEvent(window,"touchmove",m),nav.onBeforeGo.off(A),_=!1}}()):p=!0}function y(e){var t=e.target;t&&!gpeByClass(s,t)&&(e.preventDefault(),e.stopImmediatePropagation(),A()),document.removeEventListener("click",y,!0)}function w(e){void 0===e&&(e={}),d.opts=extend(d.opts,e),S(),E(!0)}function S(){var e,t,n=d.opts.defaultItems,i=d.opts.items,o=[];for(e=0,t=n.length;e<t;++e)o.push(e);for(d.cache[""]=o,e=0,t=i.length;e<t;++e)b(e,i[e])}function b(e,t){var n,i,o,a="",r=d.opts.searchKeys,s={};for(n=0,o=r.length;n<o;++n)a+=" "+(t[r[n]]||"").replace(d.opts.delimeter," ").replace(/<[^>]*>/g,"");for(a+=(parseLat(a)||"")+(parseCyr(a)||""),a=trim(a.toLowerCase()).split(/\s+/),n=0;n<a.length;n++)for(i=1;i<=d.opts.wholeIndex;i++){var l=a[n].substr(0,i);s[l]||(d.index[l]||(d.index[l]=[]),d.index[l].push(e),s[l]=1)}}function k(){var e=trim(d.text);e&&ajax.post(d.opts.url,extend({str:e,mobile:1},d.opts.params||{}),{onDone:function(t){d.cache[e]=C(e).concat(t),I(d.cache[e],!0)}})}function C(e){if(!(e=trim(e.toLowerCase().replace(d.opts.delimeter," "))))return d.cache[""];var t=d.opts.wholeIndex;if(e.length<=t&&-1===e.indexOf(" "))return d.index[e]||[];var n,i,o=0,a="";for(n=0,i=(e=e.split(" ")).length;n<i;++n){var r=e[n].substr(0,t),s=d.index[r];if((!a||!s||s.length<o)&&(o=s?s.length:0,a=r),!o)return[]}var l=[],c=d.opts.searchKeys,u=c.length,_=e.length;for(n=0,i=d.index[a].length;n<i;++n){for(var f=d.index[a][n],p=d.opts.items[f],m=!1,h="",v=0;v<u;++v)h+=" "+(p[c[v]]||"").replace(d.opts.delimeter," ").replace(/<[^>]*>/g,"");h=(h+=(parseLat(h)||"")+(parseCyr(h)||"")).toLowerCase();for(var g=0;g<_;++g)if(-1===h.indexOf(" "+e[g])){m=!0;break}m||l.push(f)}return l}function E(e,t){if(d.cache[""])if(t=void 0!==t?t:trim(d.text),d.lastQ!==t||e){d.lastQ=t,clearTimeout(d.requestTimer);var n=d.cache[t];n?I(n,!0):(I(n=C(t),!d.opts.url),d.opts.url&&(d.requestTimer=setTimeout(k,d.opts.requestWait)))}else g()}function I(e,t){var n=[];d.shown=[];for(var o=e.slice(0,d.opts.maxItems),a=0,r=o.length;a<r;++a){var s=o[a];isArray(s)||(s=d.opts.items[s]),d.shown[s[0]]||(d.shown[s[0]]=s,n.push(T(s)))}d.container&&d.opts.appendTo.contains(d.container)||(d.container=ce("div"),addClass("Mention",d.container),d.scroll=ce("div"),addClass("ScrollView Mention__scroll",d.scroll),(0,i.setScrollView)(d.scroll,{topBanner:!1}),d.opts.appendTo.appendChild(d.container),d.container.appendChild(d.scroll),addEvent(d.scroll,"touchmove",(function(e){hasClass(l,d.scroll)&&preventEvent(e)}))),toggleClass("Mention_empty",d.container,!n.length),val(d.scroll,n.join("")),d.scroll.scrollTop=0,P(),setTimeout((function(){toggleClass(l,d.scroll,!function(){if(!browser.ios&&!browser.ipad)return!0;if(d.scroll.scrollHeight>d.scroll.offsetHeight)return!0;return!1}())}),0)}function T(e){var t=e[0],n=e[1],i=e[2],o=e[3],a=e[10];return'<div class="MentionItem" onclick="Mention.onSelect(\''+t+'\');" onmouseover="Mention.onItemHover(this);">\n              <div class="MentionItem__cell">\n                '+(a||'<img src="'+o+'" class="MentionItem__img"/>')+'\n              </div>\n              <div class="MentionItem__cell MentionItem__cell_name">\n                <div class="MentionItem__name">'+n+'</div>\n                <div class="MentionItem__tag">'+i+"</div>\n              </div>\n            </div>"}function M(){var e=geByClass1(c,d.container),t=e.offsetTop;d.scroll.scrollTop=t-e.offsetHeight-parseInt(getStyle(d.scroll,"paddingTop"),10)}function P(e){void 0===e&&(e=null);var t=geByClass("MentionItem",d.container);if(t.length){var n=t.find((function(e){return hasClass(c,e)}));e?(removeClass(c,n),addClass(c,e)):n||addClass(c,t[0])}}function L(e,t){setTimeout((function(){v(t),h()}),0)}var N=(0,o.default)();return{onKeyUp:function(n,i){n.keyCode!==e&&n.keyCode!==t&&(E(!0),v(i),h())},onKeyDown:function(i,o){var s;hasClass(r,d.opts.appendTo)&&(i.keyCode===e?(!function(){var e=geByClass1(c,d.container);if(e){var t=domPS(e);t&&(P(t),M())}else P(),M()}(),i.preventDefault()):i.keyCode===t?(!function(){var e=geByClass1(c,d.container);if(e){var t=domNS(e);t&&(P(t),M())}else P(),M()}(),i.preventDefault()):i.keyCode===n?(s=geByClass1(c,d.container))&&(s.click(),1)&&i.preventDefault():i.keyCode===a&&(A(),i.preventDefault()))},onFocus:L,onClick:L,onSelect:function(e){var t=d.shown[e];t&&function(e){if(!e)return!1;var t,n=e[2].replace("@",""),i=u.curValue.substr(0,u.curPos),o=u.curValue.substr(u.curPos),a=!!i.match(/\#[\w_\.\u0400-\u04FF]+$/i);d.opts.preferDomain&&e[9]&&(a=!0);a||(t=replaceEntities(e[8]||e[1]));var r=new RegExp("^(@|\\*)"+escapeRE(u.curTerm)+"(?:\\s+\\((?:(.*?)\\))?\\s*)?","");o=o.replace(r,(function(e,i,o){var r=i+n+" ";return a||(r+="("+t.replace(/[\(\)\]\[]/g,"")+") "),r})),a||!i||i.match(/[\.\(\)\?\!\s\n\r\'\"\u00BB\u00AB \u00A0]$/)||(o=" "+o);A(),val(u.input,i+o),elfocus(u.input),d.opts.afterInsert&&d.opts.afterInsert(u.input)}(t),A()},onItemHover:function(e){P(e)},onOpen:N,init:function(e){void 0===e&&(e={}),f(),d.opts=extend({appendTo:document.body,url:"hints",params:{act:"a_json_friends",from:"composer"},delimeter:/[\s\(\)\.,\-]+/g,requestWait:300,wholeIndex:2,maxItems:51,searchKeys:[1,4],preferDomain:!1,defaultItems:[],items:[],afterInsert:function(){}},e),addClass("Mention_inited",d.opts.appendTo),d.scroll&&removeClass(l,d.scroll),S()},update:w,addItems:function(e){if(d.opts.defaultItems){e=d.opts.defaultItems.concat(e);var t={};e.filter((function(e){return!t[e[0]]&&(t[e[0]]=!0,!0)})),w({defaultItems:e,items:e})}}}}();window.Mention=a},91533:function(){var e={show:function(t,n){window.grecaptcha?grecaptcha.reset():(window.recaptchaCallback=function(){e.onCallback(t)},document.body.appendChild(ce("script",{type:"text/javascript",src:"https://www.google.com/recaptcha/api.js?onload=recaptchaCallback&render=explicit&hl="+n})))},onResponse:function(e){ge("field_recaptcha").value=e,ge("recaptcha_form").submit()},onCallback:function(t){if(grecaptcha&&t){var n=geByClass1("recaptcha_box"),i=geByClass1("recaptcha",n);i&&(val(i,""),grecaptcha.render(i,{sitekey:t,callback:e.onResponse}))}}};window.ReCaptcha=e},30006:function(){var e={OPEN_CLASS:"reply_owner_show",OPEN_BOTTOM_CLASS:"reply_owner_open_bottom",NO_LIMIT_CLASS:"reply_owner_picker_nolimit",CONTAINER_CLASS:"reply_owner_picker_container",PICKER_CLASS:"reply_owner_picker",PICKER_ITEM_CLASS:"reply_owner_option",LOADING_CLASS:"reply_owner_loading",IMAGE_CLASS:"_reply_owner_image",SELECTED_IMAGE_CLASS:"_reply_owner_selected_image",SELECTED_IMAGE_CONTAINER_CLASS:"reply_owner_selected_image",OPTION_CLASS:"reply_owner_option",PICKER_MAX_HEIGHT:null,LOADING_SHOW_TIME:300,container:null,picker:null,clickEvent:"ontouchend"in document.documentElement?"touchend":"click",clickHandler:null,requestHandler:null,request:null,loading:!1,setElements:function(e){this.container=gpeByClass(this.CONTAINER_CLASS,e),this.picker=geByClass1(this.PICKER_CLASS,this.container),this.clickHandler=this.clickHandler||bind(this.onDocumentClick,this),this.requestHandler=this.requestHandler||bind(this.onDocumentClickBeforeLoad,this)},unsetElements:function(){removeEvent(document.body,this.clickEvent,this.clickHandler),removeEvent(document.body,this.clickEvent,this.requestHandler),this.container=this.picker=null},show:function(e){this.setElements(e),addClass(this.OPEN_CLASS,this.container),this.calcPosition()},hide:function(){removeClass(this.OPEN_CLASS,this.container),removeClass(this.OPEN_BOTTOM_CLASS,this.container),this.unsetElements()},toggle:function(){toggleClass(this.OPEN_CLASS,this.container),this.calcPosition(),hasClass(this.OPEN_CLASS,this.container)?(this.scrollToSelected(),addEvent(document.body,this.clickEvent,this.clickHandler)):(this.hide(),this.unsetElements())},calcPosition:function(){var e=ge("mhead").offsetHeight,t=this.picker.getBoundingClientRect(),n=domClosestOverflowHidden(this.picker),i=!0;n&&n.getBoundingClientRect().bottom<this.container.getBoundingClientRect().bottom+this.PICKER_MAX_HEIGHT?i=!1:hasClass(this.LOADING_CLASS,this.container)?i=t.top-e-this.PICKER_MAX_HEIGHT+t.height<0:hasClass(this.OPEN_BOTTOM_CLASS,this.container)||(i=t.top-e<0),toggleClass(this.OPEN_BOTTOM_CLASS,this.container,i)},onDocumentClick:function(e){var t=e.target;t===this.container||gpeByClass(this.CONTAINER_CLASS,t)||this.hide()},onDocumentClickBeforeLoad:function(e){var t=e.target;t===this.container||gpeByClass(this.CONTAINER_CLASS,t)||this.cancelRequest()},cancelRequest:function(){this.request&&(this.request.abort(),this.unsetElements())},getList:function(){var e=this;if(!this.loading){this.PICKER_MAX_HEIGHT=parseInt(getStyle(this.picker,"maxHeight"),10);var t=geBySel1('input[name="from_oid"]',this.container).value,n=geBySel1('input[name="post_oid"]',this.container).value;this.loading=!0;var i=setTimeout((function(){addClass(e.LOADING_CLASS,e.container),e.calcPosition()}),this.LOADING_SHOW_TIME);addEvent(document.body,this.clickEvent,this.requestHandler),this.request=ajax.post("/wall.php",{act:"get_reply_clubs_list",oid:t,post_oid:n},{onDone:function(t){clearTimeout(i),e.picker.innerHTML=t,e.onLoadEnd(),e.toggle(e.picker)},onFail:function(){e.onLoadEnd()}})}},onLoadEnd:function(){this.loading=!1,removeClass(this.LOADING_CLASS,this.container),removeEvent(document.body,this.clickEvent,this.requestHandler)},onChange:function(e){var t=gpeByClass(this.OPTION_CLASS,e),n=geByClass1(this.IMAGE_CLASS,t).src;each(geByClass(this.SELECTED_IMAGE_CLASS),(function(){this.src=n})),attr(geByClass1("al"+this.SELECTED_IMAGE_CLASS),"href",attr(t,"data-href")),this.hide()},onClick:function(e){this.setElements(e),geByClass(this.PICKER_ITEM_CLASS,this.picker).length?this.toggle():this.getList()},scrollToSelected:function(){var e=gpeByClass(this.OPTION_CLASS,geBySel1(":checked",this.picker));this.PICKER_MAX_HEIGHT||(this.PICKER_MAX_HEIGHT=parseInt(getStyle(this.picker,"maxHeight"),10)),e&&(this.picker.scrollTop=e.offsetTop-this.PICKER_MAX_HEIGHT/2+e.offsetHeight/2)}};window.replyOwnerPicker=e},29443:function(e,t,n){"use strict";var i=n(81691);i.default.init({platform:"mvk",animatorLoader:function(){return Promise.all([n.e(8695),n.e(5544)]).then(n.bind(n,34206)).then((function(e){return e.default}))}}),window.SpecialEvent=i.default;i.default},96567:function(){window.SubscribeBtn={onClick:function(t,n,i,o,a,r){try{var s=r+"_unsubscribe",l=r+"Icon",c=r+"Icon_unsubscribe",u=r+"Icon_subscribe",d=hasClass(t,s),_=d?o:i,f=d?getLang("mobile_groups_public_subscribe"):getLang("mobile_groups_you_are_in_public"),p=!d,m=geByClass1(l,t),h=function(t){var n=intval(domData(t,"block-id"));if(!n){var i=domCA(t,e);n=intval(domData(i,"block-id"))||null}return n}(t),v=domData(t,"from")||null;m&&(toggleClass(c,m,p),toggleClass(u,m,!p)),attr(t,"aria-label",escapeAttr(f)),toggleClass(s,t,p),"group"===a?function(e,t,n,i){(n?Groups.leave:Groups.enter).call(Groups,e,t,i)}(n,_,d):function(e,t,n,i,o){(n?Friends.decline:Friends.accept).call(Friends,e,t,i,o)}(n,_,d,v,h)}catch(e){console.trace(e)}return!1}};var e=".feedAssistance"},93424:function(e,t,n){"use strict";var i,o,a=n(9046),r=n(22770),s="tabs_block",l="mhb_back",c="TopMenu_open",u=function(){return(0,a.geByClass1)(s)},d=function(){return(0,a.geByClass1)("tab_item_top")},_=!0,f=0;function p(){o&&o(),i&&i()}function m(e){(0,a.stopEvent)(e),(0,a.preventEvent)(e),f=300,_&&((0,a.toggleClass)("TopMenu__switcher_on",(0,a.geByClass1)("TopMenu__switcher")),"touchstart"===e.type&&setTimeout((function(){nav.go(d(),null)}),130))}function h(e){(0,a.gpeByClass)(s,e.target)||(0,a.gpeByClass)(l,e.target)||((0,a.stopEvent)(e),(0,a.preventEvent)(e),(0,a.removeClass)(c,u()),v(),p())}function v(){p(),(0,a.removeEvent)(window,"touchstart mousedown click",h)}window.TopMenu={onHeaderClick:function(e){if(!_)return;var t=u();(0,a.stopEvent)(e),(0,a.preventEvent)(e);var n=(0,a.geByClass1)(l);if((0,a.hasClass)(c,t))(0,a.removeClass)(c,t),p();else{var s=d();(0,a.addClass)(c,t),(0,a.geByClass1)("_hfixed")&&(0,a.setStyle)(t,"max-height",window.innerHeight-70),(0,a.append)(t,n),(0,a.addEvent)(window,"touchstart mousedown click",h),(0,a.addEvent)(s,"touchstart mousedown",m),(0,a.addEvent)(s,"click",(function(e){(0,a.stopEvent)(e),(0,a.preventEvent)(e)})),o=(0,r.expandPopup)((0,a.geByClass1)("al_back")),(i=(0,r.setMenuNavigation)(t))&&(i.exitIntent=function(){(0,a.removeClass)(c,t),p()}),cur.destroy.push(v),cur.destroy.push((function(){return(0,a.removeEvent)(s,"touchstart mousedown",m)}))}}},nav.onBeforeGo((function(){_=!1,setTimeout((function(){f=0,_=!0,p()}),f)}))},98886:function(){window.FeedBlocks={hideReason:function e(t,n){if(e.progress)return!1;e.progress=!0;var i="block_"+t,o=ge(i);cur.feedBlocksHTML&&delete cur.feedBlocksHTML[i],ajax.post("feed.php",{act:"block_hide_reason",block_id:t,reason:0|n,hash:attr(o,"data-hash"),pos:attr(o,"data-pos"),ref:attr(o,"data-ref")},{onDone:function(t){e.progress=!1,t?val(o,t):hide(o),e.progress=!1},onFail:function(){e.progress=!1}})},restore:function(e){var t="block_"+e,n=ge(t);cur.feedBlocksHTML&&cur.feedBlocksHTML[t]&&val(t,cur.feedBlocksHTML[t]),ajax.post("feed.php",{act:"block_restore",block_id:e,hash:attr(n,"data-hash"),pos:attr(n,"data-pos"),ref:attr(n,"data-ref")})},hide:function e(t,n){if(e.progress)return!1;e.progress=!0,post.wallActionsHide();var i="block_"+t,o=ge(i);return ajax.post("feed.php",{act:"block_hide",block_id:t,hash:attr(o,"data-hash"),pos:attr(o,"data-pos"),ref:attr(o,"data-ref")},{onDone:function(t){post.wallActionsHide(),cur.feedBlocksHTML||(cur.feedBlocksHTML={}),cur.feedBlocksHTML[i]=val(o),val(o,t),e.progress=!1},onFail:function(){e.progress=!1}}),!1}}},85653:function(e,t,n){"use strict";var i=n(92424),o=n(9046);window.FriendsRecommendedSlider={init:function(){window.cur&&(A($("."+m)),cur.destroy.push((function(){h=null,v=null,g=null})))},hideRecommended:function(e,t,n,i){var s=gpeByClass(r,e);if(!s)return i&&(0,o.cancelEvent)(i);var l=S(s),c=domData(s,"code")||domData(l,"code"),u=domData(l,"ref");!function(e){var t=S(e);remove(e),g=null,v=null,y().length||w(t)}(s);var d=a+obj2qs({act:"hide_possible",hash:n,id:t,track_code:c,ref:u});return ajax.post(d,{_ajax:1}),i&&(0,o.cancelEvent)(i)},hideBlock:w,acceptFriend:function(e,t,n,a){if(hasClass(s,e)||hasClass(e))return a&&(0,o.cancelEvent)(a);var c=gpeByClass(r,e),_=e.querySelector(".prettyCard__buttonText"),f=S(e),m=domData(c,"code")||domData(f,"code"),h=domData(f,"ref");return addClass(l,e),Friends.accept(t,n,"user_rec",0,h,m,(function(t,n){var a=t||getLang("mobile_friends_feed_recom_got_notification");removeClass(l,e),addClass(s,e),_.innerHTML=a,function(e){var t=function(e){var t=domCA(e,p);if(!t)return;return geByClass1(u,t)}(e);addClass(d,t)}(e);var r=(0,o.isObject)(null==n?void 0:n.friend_request_add_sent_message_nudge)?n.friend_request_add_sent_message_nudge:void 0;if(r){var c=r.url,f=r.text;(0,i.init)({text:a,type:i.SNACKBAR_TYPE_SUCCESS,vertical:!0,action:{text:f,url:c,callback:function(e,t){var n=t.id;(0,i.close)(n),(0,o.cancelEvent)(e),window.nav.go(c)}}})}}),(function(t,n){2===t&&nav.hard_go(n),removeClass(l,e)})),a&&(0,o.cancelEvent)(a)},onOpenUser:function(e){var t=gpeByClass(r,e);if(!t)return;var n=S(t),i=domData(t,"uid")||"",o=domData(t,"code")||domData(n,"code"),a=domData(n,"ref");FriendsStats.log(FriendsStats.EVENTS.EVENT_OPEN_USER,{uid:i,ref:a,trackCode:o})},onScroll:throttle(A,50)};var a="/friends",r="prettyCard",s="prettyCard__button_accepted",l="prettyCard__button_loading",c="recommended_carousel",u="prettyCard__closeButton",d="prettyCard__closeButton_hidden",_="Slider__line",f="Slider__scroll",p=".prettyCard",m="friendsRecommendedSliderWrap",h=null,v=null,g=null;function A(e){if(!h&&e&&(h=S(e)),h&&(h._lastScroll=h.scrollLeft,!e.ajaxIsRunning)){var t=h.scrollLeft,n=function(){if(v)return v;if(!h)return{};var e=getSize(h)[0],t=getX(h),n=y(),i=getX(n[0])-t,o=getSize(n[0])[0],a=getX(n[1])-t-i-o,r=Math.floor(o/3);return v={width:e,itemWidth:o+a,leftMargin:i,part:r,scrollWidth:h.scrollWidth}}(),i=Math.max(0,Math.floor((t-n.leftMargin)/n.itemWidth)),o=Math.max(0,Math.floor((t+n.width-n.leftMargin)/n.itemWidth));i*n.itemWidth+n.itemWidth-n.part<t&&i++,o*n.itemWidth+n.part>t+n.width&&o--;var r=y();i=Math.max(0,i),o=Math.min(r.length,o);for(var s=domData(h,"ref"),l=domData(h,"code"),u=i;u<=o;u++){var d=r[u];if(d&&!d.viewed){d.viewed=!0;var f=domData(d,"uid")||"",p=domData(d,"code")||l;FriendsStats.log(FriendsStats.EVENTS.EVENT_VIEW_USER,{uid:f,pos:u,ref:s,trackCode:p})}}!e.allLoaded&&t+n.width>=n.scrollWidth/2&&function(e){(e=S(e)).currentPage=e.currentPage||1;var t=domData(e,"next")||"";if(e.allLoaded||!t||e.currentPage++>=3)return void(e.allLoaded=!0);var n=domData(e,"code")||"",i=domData(e,"ref")||"",o=intval(domData(e,"friend-id")),r=a+obj2qs({act:c,next:t,ref:i,friendId:o,track_code:n});e.ajaxIsRunning=!0,ajax.post(r,{_ajax:1},{onDone:function(t,n){if(t){var i=geByClass1(_,e),o=cdf(t);append(o,i),v=null,g=null}domData(e,"next",n||null),e.allLoaded=!n,e.ajaxIsRunning=!1},onFail:function(){setTimeout((function(){return e.ajaxIsRunning=!1}),500)}})}(e)}}function y(){return g||(h&&(g=geByClass(r,h)),g||[])}function w(e,t){var n=gpeByClass(m,e);if(!n)return t&&(0,o.cancelEvent)(t);var i=h;if(!i&&e&&(i=S(n)),i){var a=domData(i,"code"),r=domData(i,"ref");FriendsStats.log(FriendsStats.EVENTS.EVENT_HIDE_BLOCK,{ref:r,trackCode:a},!0)}if(remove(n)){var s=nav.getQuery();delete s.recs,nav.go(location.pathname+obj2qs(s),!1,{replace:!0,push_only:!0})}return t&&(0,o.cancelEvent)(t)}function S(e){var t;return hasClass(e,f)?t=e:(t=geByClass1(f,e))||(t=gpeByClass(f,e)),t}},65906:function(e,t,n){"use strict";var i=n(53769);window.landingsSlider=i.default},53769:function(e,t){"use strict";var n=function(){function e(e,t){isObject(t)||(t={items:t}),this.opts=extend({slideClassName:"",onStartChange:!1,onChange:!1,pointsWrap:!1,slideContFn:!1,shownSlidesNum:1},t),this.wrap=ge(e),this.parseItems(t.items),this.init()}var t=e.prototype;return t.parseItems=function(e){for(var t=[],n=0;n<e.length;n++){var i=e[n];"string"==typeof i&&(i={className:i}),i=extend({html:"",className:"",pos:t.length},i),t.push(i)}this.items=t},t.init=function(){if(addClass("landings_slider_wrap",this.wrap),addEvent(this.wrap,"touchstart mousedown",this.touchStart.bind(this)),this.opts.pointsWrap){var e="";for(var t in this.items)e+='<div class="landings_slider_point"></div>';addClass("landings_slider_points",this.opts.pointsWrap),val(this.opts.pointsWrap,e)}this.changeSlide(0)},t.getTouchX=function(e){return e.targetTouches&&e.targetTouches.length>0?e.targetTouches[0].pageX:e.pageX},t.getTouchY=function(e){return e.targetTouches&&e.targetTouches.length>0?e.touches[0].pageY:e.pageY},t.touchStart=function(e){var t=this.getTouchX(e),n=this.getTouchY(e),i=this,o=!1,a=!1,r=vkNow(),s=0,l=this.getTouchX(e),c=getW(this.wrap);function u(e){if(!a)if(!o&&Math.abs(i.getTouchY(e)-n)>20)a=!0;else{i.lock&&(o=!0,t=i.getTouchX(e),r=vkNow(),i.changeSlide(i.newPos),cancelEvent(e),i.lock=0,clearTimeout(i.changeTimeout));var u=i.getTouchX(e),d=t-u;(Math.abs(d)>20||o)&&(cancelEvent(e),o||(t=i.getTouchX(e),d=0,o=!0),s=d,l=u,d=-(100+d/c*100),d-=100*i.opts.shownSlidesNum-100,setStyle(i.helper,"transform","translateX("+d+"%)"))}}function d(e){if(removeEvent(bodyNode,"mousemove touchmove",u),removeEvent(bodyNode,"mouseup touchend touchcancel",d),!i.lock)if(i.lock=1,Math.abs(s)>50){var n=s<0?"prev":"next",o=Math.abs(l-t)/(r/vkNow());o+=.2*o;var a=100*i.opts.shownSlidesNum;a="next"==n?100+a:a-100,setStyle(i.helper,{transition:"transform "+o+"ms",transform:"translateX(-"+a+"%)"});var c=i.items.length-1,_="prev"==n?i.pos-1:i.pos+1;_<0?_=c:_>c&&(_=0),i.opts.onStartChange&&i.opts.onStartChange(_,n),i.newPos=_,i.changeTimeout=setTimeout((function(){i.lock=0,i.changeSlide(_)}),o)}else setStyle(i.helper,{transition:"transform 200ms",transform:"translateX(-"+100*i.opts.shownSlidesNum+"%)"}),setTimeout((function(){i.lock=0}),200)}removeEvent(bodyNode,"mousemove touchmove",u),removeEvent(bodyNode,"mouseup touchend touchcancel",d),addEvent(bodyNode,"mousemove touchmove",u),addEvent(bodyNode,"mouseup touchend touchcancel",d)},t.makeItem=function(e){var t=this.pos==e.pos?"_active_slide ":"",n=this.opts.slideContFn?this.opts.slideContFn(e):e.html;return'<div class="landings_slider_item '+t+e.className+" "+this.opts.slideClassName+'">'+n+"</div>"},t.getSlidesHtml=function(e){for(var t=this.opts.shownSlidesNum,n=this.items.length-1,i="",o=e,a=0;a<t;a++)--o<0&&(o=n),i=this.makeItem(this.items[o])+i;i+=this.makeItem(this.items[e]),o=e;for(var r=0;r<t;r++)++o>n&&(o=0),i+=this.makeItem(this.items[o]);return i},t.changeSlide=function(e){if(this.pos=Math.max(0,Math.min(e,this.items.length-1)),this.replaceHtml(this.getSlidesHtml(this.pos)),this.opts.onChange&&this.opts.onChange(this.pos),this.opts.pointsWrap){var t=ge(this.opts.pointsWrap);removeClass("selected",geByClass1("selected",t)),addClass("selected",t.children[this.pos])}},t.replaceHtml=function(e){val(this.wrap,'<div class="landings_slider_helper">'+e+"</div>"),this.helper=geByClass1("landings_slider_helper",this.wrap),setStyle(this.helper,"transform","translateX(-"+100*this.opts.shownSlidesNum+"%)")},t.toSlide=function(e,t){this.lock=1;var n=this.makeItem(this.items[this.pos]),i=this.makeItem(this.items[e]);e>this.pos?n+=i:n=i+n,this.replaceHtml(n),t||(t=e>this.pos?"next":"prev");var o="next"==t?0:-100;setStyle(this.helper,"transform","translateX("+o+"%)"),this.opts.onStartChange&&this.opts.onStartChange(e,t);var a=this;clearTimeout(this.toSlideTimer),this.toSlideTimer=setTimeout((function(){o="next"==t?-100:0,setStyle(a.helper,{transition:"transform 200ms",transform:"translateX("+o+"%)"}),a.toSlideTimer=setTimeout((function(){a.lock=0,a.changeSlide(e)}),200)}),10)},e}();t.default=n},33252:function(e,t,n){"use strict";var i=n(62691),o=n(28708);function a(e,t,n){if(o.isWKWebView){attr(t,"onclick",""),attr(t,"href","vk://vk.com/write"+(2e9+e));var a=new Event("click");return t.dispatchEvent(a),void setTimeout((function(){attr(t,"href","/mail?act=show&chat="+e),t.textContent=n}))}i.default.android?location.href="https://vk.com/write"+(2e9+e):o.isIOS?(attr(t,"onclick",""),attr(t,"href","/mail?act=show&chat="+e),t.textContent=n,location.href="vk://vk.com/write"+(2e9+e)):location.href="/mail?act=show&chat="+e}window.ChatPreview={join:function(e,t,n){return ajax.post(e,{_ajax:1},{onDone:function(e){a(e,t,n)}}),!1},open:function(e,t,n){return setTimeout((function(){a(e,t,n)})),!1}}},20370:function(e,t,n){"use strict";var i=n(11855),o=(n(24945),need("Voting")),a=function(){var e,t,n=[],a=!1,s=!1,l={};function c(e){return function(){if(!a)return e.apply(this,arguments)}}function u(e){return"A"===e.tagName}function d(){s=n.length>0,toggleClass("vk_messages_actions_visible",document.body,s)}function _(){s&&(l={},each(n,(function(e,t){removeClass("mi_selected",geByClass1("_msg"+t))})),a=!1,n=[],d())}function f(){return!!window.getSelection&&window.getSelection().toString().length>0}function p(e,t,i,o){void 0===o&&(o=!1),a=!0,lockButton(e),im.off(),ajax.click("/mail",{},{url_params:{act:o?"spam":"delete",peer:t,hash:i,ids:n.join(","),community:r()}})}function m(){return Boolean(e)}function h(){ge("dialogs")&&m()?addClass("vk_dialogs_forwarding",document.body):e="",_()}return page.onChange(h),mail.onShowDialogsPageFromCache(h),mail.onShowDialogFromCache(h),mail.onShowDialogsPageFromCache(i.showHeader),mail.onShowDialogFromCache(i.showHeader),mail.onMessagesRepainted((function(){each(n,(function(e,t){addClass("mi_selected",geByClass1("_msg"+t))}))})),{onMessageClick:c((function(e){var t=e.target,i=e.currentTarget,a=u(t)||u(t.parentNode);t.closest("."+o.cls)?e.stopPropagation():(a&&_(),browser.uc_mini||f()||a||setTimeout((function(){var e,t,o;f()||(e=i,t=attr(e,"data-id"),(o=n.indexOf(t))>=0?(n.splice(o,1),removeClass("mi_selected",e),delete l[t]):(n.push(t),addClass("mi_selected",e),l[t]=hasClass("msg_item_important",e)),d(),function(){var e=window.lang,t=Math.max(n.length,1);val(geByClass1("messagesActions__row_counter"),langNumeric(t,e.mobile_mail_messages_selected).replace("{count}",t))}())}),40))})),remove:c(p),reply:c((function(e,t,i){a=!0,lockButton(e),ajax.click("/attachments",{},{url_params:{act:"add",target:"mail"+t,hash:i,object:"mail"+n.join(";"),community:r()}})})),forward:c((function(i,o){a=!0,lockButton(i),e="mail"+n.join(";"),t=o;var s=r(),l=s?"?community="+s:"";nav.go(location.pathname+l,null,{ignore_cur_process:!0})})),spam:c((function(e,t,n){p(e,t,n,!0)})),close:c(_),toggleImportant:c((function(e){var t,i=n.length,o=0;for(t=0;t<i;t++)if(!l[n[t]]){o=1;break}for(t=0;t<i;t++)toggleClass("msg_item_important",geByClass1("_msg"+n[t]),1===o);ajax.post("/mail",{_ajax:1,act:"mark_important",ids:n,val:o,hash:e}),_()})),hasFwdMessages:m,attachFwdMessages:function(n){ajax.click("/attachments",{},{url_params:{act:"add",target:"mail"+n,hash:t,object:e,community:r()}}),e=""}}}();function r(){return nav.getQuery("community")}window.MessagesActions=a},84124:function(e,t,n){"use strict";var i=n(1730),o=need("nav");window.PinnedMsg={onHideClick:befall(),getByMsgId:function(e){return(0,i.$)(a(e))}};var a=function(e){return'.pinnedMsg[data-msg-id="'+e+'"]'};function r(e,t){var n=t.parentNode.getAttribute("data-msg-id");window.isNewMail&&n?(e.preventDefault(),uMessenger.goToMsg(Number(n))):o.go(t,e)}PinnedMsg._onClick=r,PinnedMsg._onHideClick=PinnedMsg.onHideClick},8380:function(e,t,n){"use strict";n(76653);var i=n(33912),o=n(24945),a=n(9046),r=n(27557),s=n(29804);window.StickersHints=function(){var e,t,n,l,c,u,d=864e5,_=!0,f=0,p=new r.default({mvk:!0});i.EMOJI_HINTS;function m(e){var i=window.cur;if(n=geByTag1("textarea",gpeByTag("form",geByClass1("cp_sticker_btn"))),p.setConfig(e),n&&!n.initialized){var o=function(e){var t=n.value.length;t-f>1,f=t,h(),_&&(!function(){S()&&vkNow()-b()>d*(2+Math.random())&&v();e=function(e){e*=1e3,S()&&e>b()&&v()},ajax.post("/attachments",{_ajax:1,act:"stickers_hints_change_date"},{onDone:e});var e}(),_=!1)};n.initialized=!0,c=geByClass1("stickersHints"),l=geByClass1("stickersHints__content"),addEvent(n,"focus",h),addEvent(n,"input",o),addEvent(document,"click",g),onBodyResize(A),onBodyResize(C),i.destroy.push((function(){c=null,l=null,n=null,removeEvent(n,"focus",h),removeEvent(n,"input",o),removeEvent(document,"click",g),onBodyResize("__clear",A),onBodyResize("__clear",C),t&&t.destroy(),f=0})),document.activeElement===n&&h()}}function h(){var i;n&&(e&&clearTimeout(e),i=function(i){var a=p.getQueries(n.value).find((function(e){return i.hasOwnProperty(e)})),r=a&&i[a];r?e=setTimeout((function(){var e,n,i=r.userStickers||[],u=r.promotedStickers||[];if(i.length>0||u.length>0){var d=[];each(i,(function(e,t){d.push(y({stickerId:t,query:a,isPromoted:!1}))})),each(u,(function(e,t){d.push(y({stickerId:t,query:a,isPromoted:!0}))})),p.isBotLinkEnabled()&&d.push((e=(0,o.getStickerSize)(),n="light",s.colorScheme.isDarkScheme()&&(n="dark"),Wd.html({inner:[{inner:[{class:"th_img",src:p.getBotLinkImageUrl(e,n),tag:"img"}],class:"sticker_thumb",href:p.getBotLinkUrl(),onclick:"StickersHints.onSuggestionsBotLinkClick();",target:"_blank",tag:"a"}],class:"sticker_item",tag:"div"}))),l.innerHTML=d.join(""),show(c),A(),C(),(t=new Scroller(c)).init()}}),300):(t&&t.destroy(),hide(c))},u?i(u):S()?(u=lsGet("stickers_keywords").keywords,i(u)):w((function(e){u=e,k(e),i(e)})))}function v(){w((function(e){u=e,k(e),h()}))}function g(t){var i=t.target;i===n||gpeByClass(i,"stickersHints")||(hide(c),e&&clearTimeout(e))}function A(){attr(l,"style","")}function y(e){var t=e.isPromoted,n=t?"":"onclick=\"return StickersHints.onStickerThumbClick(event, this, {{stickerId}}, '{{stickerReferrer}}');\"",i=t?'href="/attachments?'+["act=stickers_store","target="+attr(c,"data-target"),"sticker_id={{stickerId}}","from=inline","sticker_referrer={{stickerReferrer}}"].join("&")+'"':"",a=Stickers.getStickerUrl(e.stickerId,(0,o.getStickerSize)());return('<div class="sticker_item sticker{{stickerId}} {{promotedClass}}">        <a class="sticker_thumb thumb_item" '+i+" "+n+'>          <img class="th_img" src="{{stickerUrl}}" />        </a>      </div>').replace(/{{stickerId}}/g,e.stickerId).replace(/{{stickerUrl}}/g,a).replace("{{promotedClass}}",t?"sticker_item_promoted":"").replace("{{stickerReferrer}}","suggestion_"+e.query)}function w(e){ajax.post("/attachments",{_ajax:1,act:"stickers_hints_keywords"},{onDone:function(t){e(function(e){var t={};return each(e,(function(e,n){var i=n.user_stickers,o=n.promoted_stickers;each(n.words,(function(e,n){t[n]={userStickers:i,promotedStickers:o}}))})),t}(t))}})}function S(){return Boolean(lsGet("stickers_keywords"))}function b(){return lsGet("stickers_keywords").time}function k(e){!e||isEmpty(e)?lsSet("stickers_keywords"):lsSet("stickers_keywords",{keywords:e,time:vkNow()})}function C(){var e=geByClass1("stickersHints__callout");if(e){var t=e.offsetWidth-4,n=t/64,i=n%1;i<.3?n=Math.floor(n)-.5:i>.7&&(n=Math.ceil(n)-.5);var o=Math.round(t/n-8);each(geByClass("sticker_item",e),(function(e,t){var n=geByClass1("sticker_thumb",t),i=geByClass1("th_img",t);setStyle(t,"width",o),setStyle(t,"height",o),setStyle(n,"width",o),setStyle(n,"height",o),setStyle(i,"height",o)}))}}return onDOMReady((function(){lsCheck()&&!geByClass1("vk_stickers_hints_support_no")&&(post.onStickersInit((function(){m()})),geByClass1("stickersHints")&&m())})),ajax.onRedirect((function(e){qs2obj(e.split("?")[1]).invalidate_stickers_hints&&v()})),post.onReplyClick((function(e){var t=window.cur;e,setTimeout(h,10),t.destroy.push((function(){;""}))})),{actualizeVisibility:h,init:m,onStickerThumbClick:function(t,i,o,a){window.isNewMail&&preventEvent(t);var r=gpeByClass("sticker_item",i),s=geByClass1("th_img",r);return attr(r,"style",""),attr(i,"style",""),attr(s,"style",""),hide(c),n.value="",e&&clearTimeout(e),post.sendSticker(i,o,!0,a)},onCheckboxLabelClick:function(e,t){setTimeout((function(){!function(e,t,n){var i={_ajax:1,act:"stickers_hints_enabled",value:e,hash:t};ajax.post("/attachments",i,{onDone:n})}(val(geByTag1("input",e.parentElement))?1:0,t,v)}),0)},onCheckboxAutoAnimationLabelClick:function(e,t){setTimeout((function(){!function(e,t,n){var i={_ajax:1,act:"stickers_auto_animation_enabled",value:e,hash:t};ajax.post("/attachments",i,{onDone:n})}(val(geByTag1("input",e.parentElement))?1:0,t,v)}),0)},onSuggestionsBotLinkClick:function(){a.statlogsValueEvent.apply(void 0,[p.getBotLinkClickStatName(),0].concat(p.getBotLinkClickStatKeys()))},showNewConvoHints:function(){var n=StickersCache.getStickers()[-3];if(n&&n.stickers.length){e&&clearTimeout(e);var i=n.stickers.reduce((function(e,t,n){var i=t[0];return e.push(y({stickerId:i,query:"hi",isPromoted:!1})),e}),[]);l.innerHTML=i.join(""),show(c),A(),C(),(t=new Scroller(c)).init()}}}}()},86465:function(e,t,n){"use strict";var i=n(10098),o=n.n(i),a=n(29804);window.MoneyLink={copy:function(e){var t=e.$btn,n=t.nextElementSibling,i=geByClass1("TextInput__native",gpeByClass("Pad__content",t));copyToClipboard(i)&&(MoneyLink.lastCopyLabel&&hide(MoneyLink.lastCopyLabel),MoneyLink.lastCopyLabel=n,show(n))},genQRCode:function(e,t){var n=arguments,i=this;if(!MoneyLink.qrcode){var r,s,l=a.colorScheme.isDarkScheme();t?(r=geByClass1("snippet__icon",geByClass1(t)),s=l?128:80):(r=ge("money_link_qr"),s=200);var c={isShowLogo:!0};l&&(c.isShowBackground=!0,c.backgroundColor="#fff"),val(r,o().createQR(e,s,"qr-code",c));var u=a.colorScheme.subscribe((function(){u(),i.genQRCode.apply(i,n)}))}}}},77819:function(e,t,n){"use strict";var i=n(3226),o={_onMouseDown:(0,i.default)(),_onCancelClick:(0,i.default)()};window.MoneyTransferButton=o,t.default=o},81750:function(e,t,n){"use strict";var i=n(77819),o="-webkit-tap-highlight-color";i.default._onMouseDown((function(e){for(var t=e;!(!(t=gpeByClass("msg_item",t))||t&&attr(t,"data-id")););t&&(setStyle(t,o,"transparent"),setTimeout((function(){return function(e){setStyle(e,o,"initial")}(t)}),400))}))},48385:function(e,t,n){"use strict";var i,o,a=n(77819),r=!1,s=null;function l(){s&&Btn.setLoading(s,!1),i&&(clearInterval(i),i=null),o&&(o.abort(),o=null)}a.default._onCancelClick((function(e,t){var n,a;t?(r=!1,preventEvent(e),cancelEvent(e),lockButton(t)):(r=!0,t=e.$btn,e=null,s=t,Btn.setLoading(t,!0)),n={cancelUrl:attr(t,"href")},a=n.cancelUrl,i=setInterval((function(){o=ajax.post(a,{_ajax:1},{onDone:function(e){if(1===e){if(r){var t=arguments[1];return s.closest(".BtnStack").outerHTML='\n            <div class="notification__tempText">'+t+"</div>\n          ",void l()}var n=window.scrollTop();nav.go(location.pathname+location.search,null,{replace:!0}),cur.destroy.push((function(){window.scrollTop(n)})),l()}}})}),1500),window.cur.destroy.push(l)}))},20357:function(e,t,n){"use strict";n(77819),n(81750),n(48385)},52779:function(e,t,n){"use strict";var i=n(1730),o=(need("attr"),need("geByClass1"),need("preventEvent")),a=need("Popup");window.SendMoneyForm={},SendMoneyForm._onAmountChange=k,SendMoneyForm._onSubmit=M,SendMoneyForm._onRecommAmountChange=C,SendMoneyForm._onAutoAcceptToggle=P,SendMoneyForm._onNoAmountToggle=L,SendMoneyForm._onChooseCardClick=b,SendMoneyForm._onChooseCardCancelClick=S,SendMoneyForm._onChooseCardContinueClick=A,SendMoneyForm._onCardSelect=y,SendMoneyForm._onVkPayOfferToggle=w;var r="sendMoneyForm_error_min",s="sendMoneyForm_error_max",l="sendMoneyForm_addCardVisible",c="sendMoneyForm_requestedVisible",u="sendMoneyForm_recommErrorMin",d="sendMoneyForm_recommErrorMax",_="sendMoneyForm_noAmount",f="sendMoneyForm_autoAccept",p=".sendMoneyForm",m=".sendMoneyForm__cardsPopup",h=".sendMoneyForm__input_amount",v=".sendMoneyForm__recommAmountInput input",g=".sendMoneyForm__amountNote_requestAmount";function A(){var e=(0,i.$)('.Control__native[name="card"]:checked').value,t=(0,i.$)('.Control__native[name="card"]:checked ~ .Control__label').innerText;(0,i.$)('input[name="accept_card"]').value=e,(0,i.$)('input[name="accept_card"]').setAttribute("data-value",e),(0,i.$)(".sendMoneyForm__chooseCard").innerText=t,a.close()}function y(e){var t="-1"===e.value;(0,i.$)(p).classList.toggle(l,t)}function w(e){var t=e.checked,n=(0,i.$)(".sendMoneyForm__sendButton");t?n.removeAttribute("disabled"):n.setAttribute("disabled",!0)}function S(){a.close()}function b(){var e=(0,i.$)(m);a.open(e)}function k(e){e||(e=(0,i.$)('input[name="amount"]')),I(e),T(e,6);var t=e.closest(p),n="1"===t.getAttribute("data-is-chat-request"),o=Number(e.value),a=Number(t.getAttribute("data-max-amount"));if(t.classList.remove(r),t.classList.remove(s),n||o>a&&t.classList.add(s),n){var l=E(),_=Number(t.getAttribute("data-min-amount"))*(l?2:1),f=function(e,t){var n=(0,i.$)('input[name="amount"]').closest(p),o=Number(n.getAttribute("data-min-amount")),a=Number(n.getAttribute("data-max-amount")),r=Number(n.getAttribute("data-chat-members-count")),s=Math.ceil(e/(r-(t?0:1)));return Math.min(a,Math.max(o,s))}(o,l);if((0,i.$)(v).value=f,t.classList.remove(d),t.classList.remove(u),!_||o>=_){var m=l?o-f:o;(0,i.$)(g).innerText=m,t.classList.add(c)}else t.classList.remove(c)}}function C(e){I(e),T(e,6);var t=e.closest(p),n=Number(e.value),i=t.getAttribute("data-max-amount");t.classList.remove(d),t.classList.remove(u),n>i&&t.classList.add(d)}function E(){var e=(0,i.$)('input[name="participiate"]');return e&&e.checked}function I(e){e.value=parseInt(e.value,10)||""}function T(e,t){e.value=e.value.slice(0,t)}function M(e,t){var n=t.$(h).value,a=Number(n),l=Number(t.getAttribute("data-min-amount")),c=Number(t.getAttribute("data-max-amount")),f="1"===t.getAttribute("data-is-chat-request"),m=!1;(t.classList.remove(r),t.classList.remove(s),f&&(t.classList.remove(d),t.classList.remove(u)),(0,i.$)(p).classList.contains(_))||(a<l*(!!f&&E()?2:1)||!n||n!==a.toString()?(t.classList.add(r),m=!0):a>c&&!f&&(t.classList.add(s),m=!0));if(f){var g=t.$(v).value,A=Number(g);A<l||!g||g!==A.toString()?(t.classList.add(u),m=!0):A>c&&(t.classList.add(d),m=!0)}if(m)o(e),stopEvent(e);else{o(e),stopEvent(e),t.insertAdjacentHTML("beforeend",'<input id="submit" type="submit" style="display: none" />');var y=(0,i.$)("#submit");ajax.click(y)}}function P(e){(0,i.$)(p).classList.toggle(f,e.checked),e.checked?(0,i.$)('input[name="accept_card"]').value=(0,i.$)('input[name="accept_card"]').getAttribute("data-value"):(0,i.$)('input[name="accept_card"]').value=""}function L(e){(0,i.$)(p).classList.toggle(_,e.checked)}},63212:function(e,t,n){"use strict";var i=n(46769),o=n(49751),a=n(9046);window.groupInvitationClick=function(e,t){var n=t.$btn,i=n.getAttribute("href");(n.nextElementSibling||n.previousElementSibling).remove(),ajax.post(i,{_ajax:1},{onDone:function(){}}),n.closest(".BtnStack").outerHTML='\n    <div class="notification__tempText">'+e+"</div>\n  "},window.apiCallAction=function(e,t,n,i,a,r,s){var l=s.$btn,c=l.getAttribute("href"),u=l.nextElementSibling||l.previousElementSibling,d=t?'<span class="notification__tempIcon '+t+'Icon"></span>':"";i&&!confirm(i)||(o.default.setLoading(l,!0),ajax.post(c,{_ajax:1},{onDone:function(){o.default.setLoading(l,!1),u&&u.remove(),l.closest(".BtnStack").outerHTML='<div class="notification__tempText">'+d+e+"</div>"}}))},window.NotifierPage={notifyMarkAsViewed:function(e){ajax.post("feed.php",{_ajax:1,section:"notifications",hash:e,action:"mark_as_viewed"})}},window.NotifyItem={_onPhotoTagAcceptClick:function(e,t,n){var i=n.$btn,o=i.getAttribute("href");i.nextElementSibling||i.previousElementSibling;ajax.post(o,{_ajax:1},{onDone:function(){}}),i.closest(".BtnStack").outerHTML='\n      <div class="notification__tempText">'+t+"</div>\n    "},_onPhotoTagDeclineClick:function(e,t,n){var i=n.$btn,o=i.getAttribute("href");i.nextElementSibling||i.previousElementSibling;ajax.post(o,{_ajax:1},{onDone:function(){}}),i.closest(".BtnStack").outerHTML='\n      <div class="notification__tempText">'+t+"</div>\n    "},_onHideClick:function(e,t,n,i){e.preventDefault();var o=e.target.getAttribute("href"),r=o+"&action=hide",s=o+"&action=restore",l=!n||confirm(n);ContextMenu.close(),l&&ajax.post(r,{_ajax:1},{onDone:function(){var e="nid"+i,n=document.getElementById(e),o=n.closest(".notificationList__items")||n.closest(".notificationList"),r=o.closest(".notificationList"),l=!0;if(each(geByClass("notification",o),(function(t,n){isVisible(n)&&n.id!==e&&(l=!1)})),l)nav.reload();else if(hide(n),NotifyItem._onBodyScroll(),r.classList.contains("notificationList_type_unread")){var c=r.$(".Pad__title"),u=parseInt(c.innerText,10)-1;c.innerText=langNumeric(u,(0,a.getLang)("mobile_notifications_new"))}var d=window.Snackbar;d&&d.init&&d.init({text:t,action:{url:s,text:lang.mobile_notifications_restore,callback:["NotifyItem._onRestoreClick","event",e]}})}})},_onRestoreClick:function(e,t,n){var i=n.id,o=n.url;e.preventDefault();var a=ge(t);ajax.post(o,{_ajax:1},{onDone:function(){ge(t).style.display="",Snackbar.close(i);var e=a.closest(".notificationList__items")||a.closest(".notificationList"),n=e.closest(".notificationList");if(n.classList.contains("notificationList_type_unread")){var o=n.$(".Pad__title"),r=parseInt(o.innerText,10)+1;o.innerText=langNumeric(r,lang.mobile_notifications_new)}var s=!0;each(geByClass("notification",e),(function(e,t){isVisible(t)&&(s=!1)})),s||n.classList.remove("Pad_empty")}})},_onBodyScroll:function(){$$(".notification_actionsOpen").forEach((function(e){e.classList.remove("notification_actionsOpen")})),window.removeEventListener("scroll",NotifyItem._onBodyScroll)},_onActionTriggerClick:function(e){window.addEventListener("scroll",NotifyItem._onBodyScroll);var t=e.closest(".notification");t.classList.remove("notification_reverse"),t.classList.toggle("notification_actionsOpen"),$$(".notification_actionsOpen").forEach((function(e){e!==t&&e.classList.remove("notification_actionsOpen")})),t.$(".notification__actionsBubble").getBoundingClientRect().y<50&&t.classList.add("notification_reverse")}},window.FriendRequest={_onAcceptClick:function(e,t){var n=t.$btn,i=n.getAttribute("href"),o=n.nextElementSibling||n.previousElementSibling;o&&o.remove(),ajax.post(i,{_ajax:1},{onDone:function(){}}),n.closest(".BtnStack").outerHTML='\n      <div class="notification__tempText">'+e+"</div>\n    "},_onDeclineClick:function(e,t){var n=t.$btn,i=n.getAttribute("href"),o=n.nextElementSibling||n.previousElementSibling;o&&o.remove(),ajax.post(i,{_ajax:1},{onDone:function(){}}),n.closest(".BtnStack").outerHTML='\n      <div class="notification__tempText">'+e+"</div>\n    "}},window.GroupNotify={deleteSource:function(e,t){return ajax.post("feed.php",{gid:e,hash:t,act:"group_notify_delete_source"},{onDone:function(){}}),!1},addSource:function(e,t,n){this.processQuery("group_notify_add_source",e,t,n)},editSource:function(e,t){this.processQuery("group_notify_edit_source",e,t)},processQuery:function(e,t,n,o){var a=$(".group_notify_general .Control_type_switcher input.Control__native").checked?1:0,r={};$$(".group_notify_params .Control_type_switcher input.Control__native").forEach((function(e){r["setting_"+e.name]=e.checked?1:0})),ajax.post("feed.php",(0,i.default)({gid:t,hash:n,unmuted:a,from:o},r,{act:e}),{onDone:function(){}})},gn_grProcess:function(e,t,n,i){ajax.post("club"+e,{act:"user_action",mid:t,hash:n,from:"top_notifier",action:i},{onDone:function(){}})}}},89137:function(){function e(e){(e=ge(e))&&(addClass(e,"profileEdit_selected"),setTimeout((function(){addClass(e,"profileEdit_animated"),setTimeout((function(){removeClass(e,"profileEdit_selected"),removeClass(e,"profileEdit_animated")}),1e3)}),1500))}function t(t){(t=ge(t))&&setTimeout((function(){var n=getXY(t)[1],i=getSize("mhead")[1],o=scrollGetY(),a=getCh();n<i+o||n>o+a?setTimeout((function(){scrollTo(0,n-i),e(t)}),0):e(t)}),0)}window.ProfileEditor={init:function(){var e=(qs2obj(nav.params)||{}).hl;e&&t(geByClass1("_"+e))},highlightRow:e,scrollHighlightRow:t}},91512:function(__unused_webpack_module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,{QueueManager:function(){return QueueManager}});var _babel_runtime_helpers_esm_extends__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(46769),_mobile_lib_Utils__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(9046),QUEUE_CREATION_TIME_INDEX=0,QUEUE_TIMESTAMP_INDEX=1,QUEUE_KEY_INDEX=2,QUEUE_CALLBACK_INDEX=3,INCORRECT_KEY_OR_TIMESTAMP_ERROR_CODE=2,KEY_IS_BLOCKED_BY_ANOTHER_REQUEST_ERROR_CODE=4,TRANSPORT_FRAME_ID="queue_transport_frame",QueueManager=function(){function QueueManager(){}return QueueManager.addQueue=function(e,t){QueueManager.initialized&&(QueueManager.queues[e.key]=[vkNow(),e.ts,e.key,t])},QueueManager.start=function(){QueueManager.initialized&&!QueueManager.started&&(QueueManager.createFrame(QueueManager.check),QueueManager.started=!0)},QueueManager.check=function check(){var _this=this,params={act:"a_check",ts:curNotifier.timestamp,key:curNotifier.key,id:curNotifier.uid,wait:25},addQueues=[],now=vkNow();Object.keys(QueueManager.queues).forEach((function(e){var t=QueueManager.queues[e],n=t[QUEUE_CREATION_TIME_INDEX],i=t[QUEUE_TIMESTAMP_INDEX];now-n>3e4&&!e.match(/nccts/)?delete QueueManager.queues[t]:(params.ts+="_"+i,params.key+=e,addQueues.push(e))})),curNotifier.lpMakeRequest&&curNotifier.lpMakeRequest(curNotifier.frame_url,params,(function(text){try{var response=eval("("+text+")"),main_response=response,addResponse,addQueue,busy=0;if(isArray(response))for(main_response=response.shift(),curNotifier.timestamp=main_response.ts;(addResponse=response.shift())&&(addQueue=addQueues.shift(),addQueue);)addResponse.failed!==INCORRECT_KEY_OR_TIMESTAMP_ERROR_CODE||addResponse.err!==KEY_IS_BLOCKED_BY_ANOTHER_REQUEST_ERROR_CODE?addResponse.failed?delete QueueManager.queues[addQueue]:QueueManager.callQueue(addQueue,addResponse):busy|=1;else if(response.failed)for(;addQueue=addQueues.shift();)delete QueueManager.queues[addQueue];busy||(clearTimeout(curNotifier.lpCheckTO),curNotifier.lpCheckTO=setTimeout(QueueManager.check.bind(_this),curNotifier.request_timeout||1e3),curNotifier.error_timeout=Math.max(1,(curNotifier.error_timeout||1)/1.5))}catch(e){curNotifier.error_timeout=curNotifier.error_timeout||1,clearTimeout(curNotifier.lp_error_to),curNotifier.lp_error_to=setTimeout(QueueManager.check.bind(_this),1e3*curNotifier.error_timeout),curNotifier.error_timeout<64&&(curNotifier.error_timeout*=2)}}),(function(){return!0}))},QueueManager.init=function(e){window.curNotifier=(0,_babel_runtime_helpers_esm_extends__WEBPACK_IMPORTED_MODULE_1__.default)({},e),QueueManager.initialized=!0,delete curNotifier.makeRequest},QueueManager.createFrame=function(e){re(TRANSPORT_FRAME_ID),(0,_mobile_lib_Utils__WEBPACK_IMPORTED_MODULE_0__.createIframe)({id:TRANSPORT_FRAME_ID,name:TRANSPORT_FRAME_ID,src:window.curNotifier.frame_path,ariaHidden:!0});var t=setInterval((function(){curNotifier.lpMakeRequest&&(clearInterval(t),e())}),500);setTimeout((function(){return clearInterval(t)}),1e4)},QueueManager.callQueue=function(e,t){var n=QueueManager.queues[e];if(Array.isArray(n)&&n.length){n[QUEUE_TIMESTAMP_INDEX]=t.ts;var i=n[QUEUE_CALLBACK_INDEX];isFunction(i)&&i(n[QUEUE_KEY_INDEX],t)}},QueueManager}();QueueManager.queues={},QueueManager.started=!1,QueueManager.initialized=!1,window.QueueManager=QueueManager},37875:function(){function e(e,i){var o=i.$select,a=i.value;o.closest(t.email).classList.toggle(n.groupsVisible,e.includes(a)||e.includes(Number(a)))}window.SettingsEmail={},SettingsEmail._onFrequencyChange=e;var t={email:".settingsEmail"},n={groupsVisible:"settingsEmail_groupsVisible"}},55477:function(){window.SettingsNotifyGroup={},SettingsNotifyGroup._onChange=n;var e=".settingsNotifyGroup",t=".settingsNotifyGroup__description";function n(n,i){i.$control.closest(e).$(t).innerHTML=n}},72402:function(e,t,n){"use strict";n(3811);function i(e){pushNotifier.canBeEnabled().then((function(t){var n=!!e.$control&&geByTag1("input",e.$control);n&&(t?pushNotifier.setupSubscription().then((function(){!function(e){var t=ce("input",{type:"submit"},{display:"none"});e.$control.form.appendChild(t),ajax.click(t),e.$control.form.removeChild(t)}(e)})).catch((function(e){PushNotifier.PUSH_NOTIFIER_BLOCKED_BY_BROWSER_SETTINGS===e?(n.checked=!1,addClass("Popup_open",geByClass1("pageAllowPushPopup"))):n.checked=!1})):n.checked=!1)}))}window.SettingsNotifyPush={},SettingsNotifyPush._onSwitch=i},13231:function(e,t,n){"use strict";var i=n(11393);window.SettingsRow_select={},SettingsRow_select._onChange=r;var o=".settingsRow",a=".settingsRow__description";function r(e,t){!function(e){var t=e.$select,n=e.label;t.closest(o).$(a).textContent=n}(t),i.default.handle(e,t)}},23564:function(){function e(e){return function(t){t.$control.closest(n.sms).classList.toggle(i[e])}}function t(e,t){var o=t.$select,a=t.value;o.closest(n.sms).classList.toggle(i.pmUsersVisible,e.includes(a)||e.includes(Number(a)))}window.SettingsSms={},SettingsSms._onEnabledChange=e("enabled"),SettingsSms._onTimeLimitedChange=e("timeLimited"),SettingsSms._onFrequencyChange=t;var n={sms:".settingsSms"},i={enabled:"settingsSms_enabled",timeLimited:"settingsSms_timeLimited",pmUsersVisible:"settingsSms_pmUsersVisible"}},93685:function(e,t,n){"use strict";var i=n(1730),o=n(9046),a=(n(6915),10),r={setMaxAttach:function(e){a=e},checkAttaches:function(){r.toggleEnableAttaches(mediaUpload.getAttachesCount()<a)},toggleEnableAttaches:function(e){if(void 0===e&&(e=!0),(0,i.$)("#feed_add_form")){(0,i.$$)(".cp_attach_btn",(0,i.$)("#feed_add_form")).forEach((function(t){t.classList.toggle("cp_disabled_btn",!e)})),["photo","video","audio","doc","poll"].forEach((function(t){Unfold.toggleItemEnabled(Unfold.getByName("attaches"),t,e)})),["photo","audio"].forEach((function(t){var n=(0,i.$)(".CreatePostButtons__item--"+t);n&&n.classList.toggle("CreatePostButtons__item--disabled",!e)}));var t=(0,i.$)(".CreatePostButtons__item--photo .inline_upload");(0,o.attr)(t,"disabled",!e)}}};window.CreatePost=r},13747:function(){var e="";window.DonutDuration={init:function(t){e=t.select_url||""},selectDuration:function(t){var n=document.querySelector("#value_link");if(n){var i=e.replace("{value}",t);n.setAttribute("href",i)}}}},76581:function(e,t,n){"use strict";var i=n(9046);window.closePostSuggest=function(e,t){return suggestionEvent(e,t,!1),stopEvent(t)},window.suggestionEvent=function(e,t,n){void 0===n&&(n=!1);var o=(0,i.geByClass1)("post_suggest");return ajax.post("wall.php",{_ajax:1,act:"suggestion_event",event_type:e,suggest_id:o.getAttribute("data-suggest-id"),not_hide_by_click:intval(n)}),n||(0,i.re)(o),stopEvent(t)}},1166:function(e,t,n){"use strict";var i=n(46769),o=n(72378),a=n(9046),r=n(94713),s=n(11393),l=n(69756),c=n(61124),u=n(80140),d=n(88444),_="ThumbsEdit",f="Thumb",p="Thumb-wrap",m="Thumb--moving",h="te_i",v="ThumbsEdit-splitter",g="phototemp_",A="mousemove touchmove",y="mouseup touchend touchcancel",w={drag:{curEl:null},cachedPhoto:{}};window.ThumbsEdit={initialized:!1,_init:function(){onDOMReady((function(){window.ThumbsEdit.init(!1),page.onChange((function(){window.ThumbsEdit.init(!1,"/wall")}))}))},init:function(e,t){var n=this;if(void 0===t&&(t=nav.path),e||(e=$("#feed_add_form .cp_attached_wrap")),!e||0!==t.indexOf("/wall")&&0!==t.indexOf("/board"))return this.initialized=!1,removeClass(document.body,h),void(w.destroyLongpress&&w.destroyLongpress());if(addClass(document.body,h),!geByClass1(_,e)){var o=(0,a.ceFromString)(s.default.html({class:_,style:"width: 100%; height: 100%",id:_})),r=(0,a.ceFromString)(s.default.html({class:["ThumbsEdit-wrap"," _preventMenuOpen"],inner:o}));r.appendChild(o),e.insertBefore(r,e.firstChild),w=(0,i.default)({},w,{previews:[],loaders:{},attachEl:o});var l=this.parsePreviews((0,a.getPreloadData)());this.initialized=!0,l.length&&(w.previews=l,this.draw(),(0,a.onBodyResize)((function(){return n.draw()})))}},parsePreviews:function(e){return e.map((function(e){return u.convert.apply(void 0,e)})).filter((function(e){var t=e.type;return(0,u.isValidThumbType)(t)}))},draw:function(){var e=this,t=w,n=t.previews,o=t.attachEl,a=n[0]?(0,u.getRatio)(n[0]):u.THUMBS_CONTAINER_DEFAULT_RATIO,r={width:o.parentNode.offsetWidth,height:Math.min(Math.round(o.parentNode.offsetWidth/a),360),wide:!0},s=(0,u.processThumbs)(r.width,r.height,n,r),l=s.thumbs,c=s.height,d=s.width;w=(0,i.default)({},w,{thumbs:l,height:c,options:r});var _=document.createDocumentFragment();l.forEach((function(t,n){_.appendChild(e.createThumbEl(t,n))})),this.updateIds();var f=ce("div");f.id=v,val(o,""),o.style.width=d+"px",o.parentNode.style.height=c+"px",o.appendChild(_),ge(v)||o.parentNode.appendChild(f),mediaUpload.refreshUploadState(),this.updatePhotos()},update:function(e,t){var n=this;if(e=ge(e)){var i=e.id,o=ge(i),r=w.thumbs,l=w.height,c=w,d=c.options,p=c.drag,m=t[0]?(0,u.getRatio)(t[0]):u.THUMBS_CONTAINER_DEFAULT_RATIO,h=d.width,v=d.height;h&&v||(h=e.parentNode.offsetWidth,v=Math.min(Math.round(h/m),360)),d.width=h,d.height=v,d.wide=!0;var g=(0,u.processThumbs)(h,v,t,d),A=g.thumbs,y=g.height,S=g.width,b=(0,a.ceFromString)(s.default.html({class:_,style:"width: "+S+"px; height: "+y+"px; position: fixed; left: "+p.wpos[0]+"px; top: "+p.wpos[1]+"px; visibility: hidden"}));A.forEach((function(e,t){b.appendChild(n.createThumbEl(e,t,!0))})),document.body.appendChild(b);var k=this.getCoords(b,p.wpos);re(b),k.forEach((function(e,t){var n=w.drag.coords.find((function(t){return t.id===e.id}));if(n){var i=geByClass1(f,n.node),o=$("img",i),s=r[n.index],l=A.find((function(e){return e.id===s.id}));w.drag.toIndex!==t&&a.setStyle.transform(i,1,[0,0]),n.height===e.height&&e.x===n.x&&e.y===n.y&&n.index!==w.drag.i||setTimeout((function(){a.setStyle.animate(i,"margin-left, margin-top, height, width, opacity, transform",{duration:u.THUMB_DRAG_ANIMATION_DURATION+"ms"}),(0,a.setStyle)(i,{"margin-left":0,"margin-top":0,height:e.height,width:e.width,opacity:1}),a.setStyle.transform(i,1,[e.x-n.x,e.y-n.y]),a.setStyle.animate(i.parentNode,"background",{duration:u.THUMB_DRAG_ANIMATION_DURATION+"ms"}),(0,a.setStyle)(i.parentNode,{func:"ease-in",background:"transparent"});var t=(0,u.crop)(l,e.width,e.height);o&&(a.setStyle.animate(o,Object.keys(t).join(),u.THUMB_DRAG_ANIMATION_DURATION+"ms"),(0,a.setStyle)(o,t))}))}})),l!==y&&setTimeout((function(){[o,o.parentNode].forEach((function(e){a.setStyle.animate(e,"height",{duration:u.THUMB_DRAG_ANIMATION_DURATION+"ms"}),(0,a.setStyle)(e,{height:y})}))})),S>=h&&(a.setStyle.animate(o,"width",{duration:u.THUMB_DRAG_ANIMATION_DURATION+"ms"}),(0,a.setStyle)(o,{width:S})),setTimeout((function(){(0,a.setStyle)(o,{width:S}),w.thumbs=A,w.previews=t,w.height=y;var e=document.createDocumentFragment();A.forEach((function(t,i){e.appendChild(n.createThumbEl(t,i))})),o.innerHTML="",o.appendChild(e),w.drag.updating=!1,n.updatePhotos()}),u.THUMB_DRAG_ANIMATION_DURATION)}else console.error("empty el to update")},createThumbEl:function(e,t){var n=e.image,i=e.width,l=e.height,c=e.type,_=(0,u.crop)(e,i,l),m=[p,"Thumb-wrap--"+c],h=0===e.id.indexOf(g),v=h||i<=30||l<=60,A=e.orig.restriction;h&&m.push("Thumb-wrap--temp"),e.lastColumn&&m.push("last_column"),e.lastRow&&m.push("last_row");var y="Thumb__overlay",S=w.previews[t],b=null;S.label&&(b=s.default.wrap(S.label));var k=this.getCached(e.id,n.src);this.cachePhoto(e.id,n.src);var C=[{class:A?"VideoRestriction__thumb":"",inner:[{tag:"img",src:(k?k.src:n.src)||"/images/blank.gif",width:""+Math.round(_.width),height:""+Math.round(_.height),style:"margin-left: "+_.marginLeft+"px; margin-top: "+_.marginTop+"px;"}]},{class:y,inner:[!v&&{class:"Thumb__overlay-closeBtn",tag:"button",type:"button","aria-label":(0,a.getLang)("mobile_share_delete_object"),onclick:"ThumbsEdit.remove(null, "+t+")"},b]},{tag:"input",type:"hidden",name:"attach"+(t+1)+"_type",value:c},{tag:"input",type:"hidden",name:"attach"+(t+1),value:e.id.slice(c.length,e.id.length)}];if(h){var E,I=Math.min(Math.min((_.width-24)/2,30),Math.min((_.height-24)/2,30));w.loaders[e.id]&&(E=w.loaders[e.id]);var T=o.default.init(E,I),M=T.component,P=T.id;w.loaders[e.id]=P,C.push(M)}var L=[f];A&&(L.push("VideoRestriction"),L.push("VideoRestriction--onlyIcon"),e.orig.restriction.canPreview&&L.push("VideoRestriction--canPreview"),e.orig.restriction.needBlur&&L.push("VideoRestriction--blur"));var N=(0,a.ceFromString)(s.default.html({class:L.join(" "),style:"width: "+Math.round(i)+"px; height: "+Math.round(l)+"px",inner:C})),R=(0,a.ceFromString)(s.default.html({class:m.join(" "),style:"width: "+Math.round(i)+"px; height: "+Math.round(l)+"px","data-media":e.id,"data-index":t,"data-upload":S.upload}));if(w.destroyLongpress=(0,r.onLongpress)(N,350,this.startDrag.bind(this,N)),addEvent(R,"click",this.showPopup.bind(this)),A){var x=s.default.html((0,d.default)({canPreview:e.orig.restriction.canPreview,iconFilename:e.orig.restriction.icon,title:e.orig.restriction.title}));N.appendChild((0,a.ceFromString)(x))}return R.appendChild(N),R},addTempPreview:function(e){var t;if(w.attachEl){var n=this.parsePreviews([e]);(t=w.previews).push.apply(t,n),this.draw()}},replaceTemp:function(e,t,n,i){void 0===i&&(i={});var a=w.previews.findIndex((function(t){return t.ownerId===e})),r=w.previews[a],s=t.split("_").ownerId,l=t.split("_").itemId;r.ownerId=s,r.owner_id=s,r.itemId=l,r.temp=!1,r.upload=e,r.list=n,r.photo.sizes=i,r.photo.id="photo"+t,r.photo.pid=l,r.data=r.photo,o.default.ready(w.loaders[g+e]),this.draw()},onUploadProgress:function(e,t){o.default.update(w.loaders[g+e],t)},preventScroll:function(e){preventEvent(e)},startDrag:function(e,t){if(addEvent(window,"touchmove",this.preventScroll),e.classList.contains(f)&&!e.classList.contains(m)){window.navigator.vibrate&&navigator.vibrate(50),(0,a.setStyle)(document.body,"overflow","hidden"),(0,a.setStyle)(document.body,"max-height","100%"),(0,a.setStyle)(document.body,"user-select","none");var n=this.onDrag.bind(this),o=this.onDrop.bind(this);addEvent(window,A,n),addEvent(window,y,o),statlogsValueEvent("mvk_thumb_edit_interaction",""),w.drag=(0,i.default)({},w.drag,{curEl:e,curIndex:e.parentNode.dataset.index,dragListener:n,dropListener:o});var r=e.offsetWidth>=40&&e.offsetHeight>=80,s=e.parentNode.parentNode,l=$("img",e),c=intval(e.parentNode.getAttribute("data-index")),d=w.thumbs[c],_=getXY(s),p=getXY(e.parentNode),h=this.getCoords(s,_);w.drag.id=s.id,w.drag.i=c,w.drag.toIndex=c,w.drag.x=(t.pageX||t.detail.pageX)-p[0],w.drag.y=(t.pageY||t.detail.pageY)-p[1],w.drag.t=d,w.drag.w=d.width,w.drag.h=d.height,w.drag.pos=p,w.drag.wpos=_,w.drag.crop=(0,u.crop)(d,d.width,d.height),w.drag.coords=h,w.drag.needScale=r;var v=r?(0,u.scale)(d.width,d.height,.9*e.offsetWidth,.9*e.offsetHeight):[d.width,d.height],g=v[0],S=v[1],b=intval((d.width-g)*(browser.android?.5:w.drag.x/d.width)),k=intval((d.height-S)*(browser.android?.5:w.drag.y/d.height));addClass(e,m),(0,a.setStyle)(e,{zIndex:100}),(0,a.setStyle)(e.parentNode,{zIndex:100});var C=(0,u.crop)(d,g,S);(0,a.setStyle)(e,{opacity:.75,width:g,height:S,marginLeft:b,marginTop:k}),l&&(0,a.setStyle)(l,C),w.drag.state=!0}},onDrag:function(e){var t=w.drag.curEl;if(e.touches&&e.touches.length>1)return this.drop();var n=this._getClickCoord(e),i=n.x,o=n.y,r=w.drag,s=i-(r.pos[0]+r.x),l=o-(r.pos[1]+r.y);a.setStyle.transform(t,1,[s,l]);var c=r.wpos;s=r.pos[0]+intval(t.style.marginLeft)+s-c[0],l=r.pos[1]+intval(t.style.marginTop)+l-c[1];var d=s,_=l,f=(t.offsetWidth,t.offsetHeight,r.i),p=!1,m=r.i,h=-1,g=window.innerWidth>=480?u.THUMBS_MESH_GAP_MVK:u.THUMBS_MESH_GAP_MVK_SMALL,A={};if(r.coords.forEach((function(e,t){if(t!==r.i&&t!==h){e.offsetX=e.node.offsetWidth+g,e.offsetY=e.node.offsetHeight+g;var n=r.coords[t-1],i=r.coords[t+1],o=d+r.x,s=_+r.y,l=e.x+e.offsetX/2,c=e.y+e.offsetY/2,u=e.x+e.offsetX,v=e.y+e.offsetY,y=(n&&n.x===e.x&&n.y!=e.y&&0!=e.y||i&&i.x===e.x&&i.y!=e.y)&&0!=e.x,w=o>=l&&(i&&(o<=i.x+i.offsetX/2&&(i.offsetY===e.offsetY||o<u)||i.y!=e.y)||!i&&d<=u)&&s>e.y&&s<v,S=o<l&&o>=e.x&&(!n||n.y!=e.y&&!(n.x===e.x&&!i))&&s>e.y&&s<v,b=y&&s>=c&&s<v&&o>e.x&&o<u,k=y&&s<c&&s>=e.y&&o>e.x&&o<u;w=w&&!y,S=S&&!y&&!w,(w||S||b||k)&&(p=!0,m=e.index<r.i&&(w||b)?e.index+1:f<e.index&&(k||S)?e.index-1:e.index),m!==r.i?(a.setStyle.transform(e.node,1,[w?-5:S?5:0,b?-5:k?5:0]),w?(A.side="right",A.toIndex=e.index):S&&(A.side="left"),b?(A.side="down",A.toIndex=e.index):k&&(A.side="up")):a.setStyle.transform(e.node,1,[0,0]),w&&i&&i.y===e.y&&i.x>e.x&&f>e.index&&(a.setStyle.transform(e.node,1,[0,0]),a.setStyle.transform(e.node,1,[0,0]),a.setStyle.transform(i.node,1,[5,0]),h=t+1,A.side="left",A.toIndex=m),b&&i&&i.x===e.x&&i.y>e.y&&s<=c&&(a.setStyle.transform(i.node,1,[0,0]),h=t+1),k&&n&&n.x===e.x&&n.y<e.y&&s<=c&&(a.setStyle.transform(n.node,1,[0,-5]),a.setStyle.transform(e.node,1,[0,0]),A.side="down",A.toIndex=n.index),m===t&&"number"!=typeof A.toIndex&&(A.toIndex=e.index)}})),A&&(!r.split||r.split.toIndex!==A.toIndex||r.split.side!==A.side)){var y=ge(v);if((0,a.setStyle)(y,{opacity:0}),r.split=A,"number"==typeof A.toIndex){var S=r.coords[A.toIndex].node,b=g===u.THUMBS_MESH_GAP_MVK_SMALL;"left"===r.split.side&&(0,a.setStyle)(y,{left:Math.max(0,S.offsetLeft-(b?0:1)),top:S.offsetTop+8,height:S.offsetHeight-16,width:"2px",opacity:1}),"right"===r.split.side&&(0,a.setStyle)(y,{left:Math.min(S.offsetLeft+S.offsetWidth-(b?2:1),w.options.width-2),top:S.offsetTop+8,height:S.offsetHeight-16,width:"2px",opacity:1}),"up"===r.split.side&&(0,a.setStyle)(y,{left:S.offsetLeft+8,top:S.offsetTop,height:"2px",width:S.offsetWidth-16,opacity:1}),"down"===r.split.side&&(0,a.setStyle)(y,{left:S.offsetLeft+8,top:S.offsetTop+S.offsetHeight-1,height:"2px",width:S.offsetWidth-16,opacity:1})}}return r.toIndex=p?m:r.i,cancelEvent(e)},onDrop:function(e){var t=w.drag;t.state=!1,t.updating=!0;var n=t.curEl,i=$("img",n),o="touchcancel".split(" ").includes(e.type);if(removeEvent(window,A,t.dragListener),removeEvent(window,y,t.dropListener),removeEvent(window,"touchmove",this.preventScroll),document.body.contains(t.curEl)){if((0,a.setStyle)(document.body,"overflow",null),(0,a.setStyle)(document.body,"max-height",null),(0,a.setStyle)(document.body,"user-select",null),a.setStyle.transform(n.parentNode,1,[0,0]),t.split)delete t.split,ge(v).removeAttribute("style");if(!hasClass(n,m))return t.updating=!1,cancelEvent(e);if(o){var r=t.coords[t.toIndex].node;a.setStyle.transform(r,1,[0,0])}if(t.toIndex===t.i||o){var s=t.crop,l="100ms";a.setStyle.animate(n,"transform, margin-top, margin-left, width, height, opacity",{duration:l},(function(){removeClass(n,m)})),a.setStyle.animate(i,"transform, margin-top, margin-left, width, height, opacity",{duration:l});var c=w.thumbs[t.i];a.setStyle.transform(n,1,[0,0]),(0,a.setStyle)(n,{"margin-top":0,"margin-left":0,width:c.width,height:c.height,opacity:1,zIndex:null}),(0,a.setStyle)(n.parentNode,{zIndex:null}),i&&(0,a.setStyle)(i,s)}else{var d=w.previews;d=(0,u.move)(d,t.i,t.toIndex),this.update(t.id,d)}return cancelEvent(e)}},getCoords:function(e,t){var n=[];t=t||getXY(e);var i=Array.from(e.childNodes||[]);return[].concat(i).forEach((function(e,i){var o=getXY(e);n[i]={id:e.getAttribute("data-media"),x:intval(o[0]-t[0]),y:intval(o[1]-t[1]),width:intval(e.offsetWidth),height:intval(e.offsetHeight),index:intval(e.getAttribute("data-index")),node:e}})),n},remove:function(e,t){var n=w.previews[t];e&&c.default.close(e.target),mediaUpload.reset(null,null,n.remove,(function(){w.previews=w.previews.filter((function(e,n){return n!==t})),ThumbsEdit.draw()}))},showPopup:function(e){var t=e.target;if(!w.drag.state&&!t.classList.contains(m)&&!t.classList.contains("Thumb__overlay-closeBtn")){e.cancelable&&cancelEvent(e);var n=t.closest(".Thumb-wrap").getAttribute("data-index"),i=(0,a.ceFromString)(s.default.html(this.getPopup(n)));l.default.open(i,!0)}},getPopup:function(e){var t=w.previews[e],n=null;switch(t.type){case"doc":t.is_gif&&(n='\n            Gif.openPopup(null, null, {\n              raw: "'+t.doc.id.slice(3,t.doc.id.length)+'",\n              hasVideo: '+Gif.isMp4Supports()+"\n            });\n            Popup.close(this);\n          ");break;case"photo":n='\n          photo.zopen(null, null, "'+t.data.id.slice(5,t.data.id.length)+'", "'+t.list+'", {\n            hideOverlay: true,\n            single: true,\n          });\n          Popup.close(this);\n        '}var i=(0,l.ModalMenuBtn)({inner:(0,a.getLang)("mobile_delete"),onclick:"ThumbsEdit.remove(event, "+e+")"}),o=null;return n&&!t.temp&&(o=(0,l.ModalMenuBtn)({inner:(0,a.getLang)("mobile_open"),onclick:""+n})),(0,l.default)({class:"ThumbsEdit__modal",close:!0,items:[o,i]})},_getClickCoord:function(e){return{x:e.touches?e.touches[0].pageX:e.pageX,y:e.touches?e.touches[0].pageY:e.pageY}},cachePhoto:function(e,t,n){var i=ce("img");if(i.src=t,w.cachedPhoto[e]){var o=w.cachedPhoto[e].find((function(e){return e.src===t}));o?n&&n(o.src):i.onload=function(){w.cachedPhoto[e].push({width:i.width,height:i.height,src:t}),w.cachedPhoto[e].sort((function(e,t){return e.width>t.width?-1:e.width<t.width?1:0})),n&&n(t)}}else w.cachedPhoto[e]=[]},updatePhotos:function(){var e=this;w.thumbs.forEach((function(t){var n=$("[data-media="+t.id+"] img");n.src!==t.image.src&&e.cachePhoto(t.id,t.image.src,(function(e){n.src=e}))}))},getCached:function(e,t){var n=ce("img");return n.src=t,n.complete?t:w.cachedPhoto[e]&&0!==w.cachedPhoto[e].length?w.cachedPhoto[e].find((function(e){var t=e.src,n=ce("img");return n.src=t,n.complete})):null},getThumbsCount:function(){return(w.thumbs||[]).length},updateIds:function(){var e=$$(".mr_x_wrap"),t=this.getThumbsCount()+1;e.forEach((function(e,n){var i=$$("input",e),o=t+n;i[0].name="attach"+o+"_type",i[1].name="attach"+o}))}}},75874:function(e,t,n){"use strict";var i=n(46769),o=n(53006),a=n(61927),r=n(11393),s=n(93319),l=n(86658),c=(n(9046),function(e){function t(t){var n;return(n=e.call(this,t)||this).onSendClick=function(e){e.preventDefault();var t=n.state.info,i=Object.keys(t).map((function(e){return e+": "+t[e]})).join("\n");l.default.post("/?device",{_ajax:!0,device_info:i},{onDone:function(e){1===e?(self.setState({needSendButton:!1}),Snackbar.init({text:getLang("mobile_device_info_sent")})):Snackbar.init({text:getLang("mobile_unknown_error")})}})},n.state=(0,i.default)({},t),n}(0,o.default)(t,e);var n=t.prototype;return n._testAudio=function(){return!!window.Audio&&(new Audio).canPlayType("audio/mpeg")},n._testPhotoView=function(e){var t=document.createElement("div").style,n=[];return void 0!==t.webkitTransform&&n.push("webkitTransform"),void 0!==t.MozTransform&&n.push("MozTransform"),void 0!==t.msTransform&&n.push("msTransform"),void 0!==t.OTransform&&n.push("OTransform"),e+" ("+n.join(", ").replace(/^(, )+|(, )+$|(, )(, )+/g,"$3")+")"},n._testFileAPI=function(e){return e+" ("+[window.XMLHttpRequest?"XMLHttpRequest":"",window.XDomainRequest?"XDomainRequest":"",window.FormData?"FormData":"",window.FileReader?"FileReader":"",window.XMLHttpRequest&&XMLHttpRequest.sendAsBinary?"sendAsBinary":"",window.ArrayBuffer?"ArrayBuffer":"",window.Uint8Array?"Uint8Array":"",window.MozBlobBuilder?"MozBlobBuilder":"",window.WebKitBlobBuilder?"WebKitBlobBuilder":"",window.BlobBuilder?"BlobBuilder":""].join(", ").replace(/^(, )+|(, )+$|(, )(, )+/g,"$3")+")"},n.componentDidMount=function(){var e=this.state.info;e.Audio=this._testAudio(),e["Fullscreen Photoview"]=this._testPhotoView(e["Fullscreen Photoview"]),e.FileAPI=this._testFileAPI(e.FileAPI),this.setState({info:e})},n.render=function(){return r.default.preact(s.default,(0,i.default)({},this.state,{onSendClick:this.onSendClick}))},t}(a.Component));t.default=c},55638:function(e,t,n){"use strict";var i=n(11393),o=n(75874),a=n(46950);function r(){var e=$("#DeviceInfo");i.default.hydrate(o.default,(0,a.getState)("DeviceInfo"),e)}n(63269).default.getRouter().addRoute("/?device",r),window.initDeviceInfo=r},62318:function(e,t,n){"use strict";var i=n(89907),o=n(1730),a=n(46950),r=n(63269),s=n(11393);function l(){var e=(0,a.getState)("StoriesArchive"),t=(0,o.$)("#StoriesArchive");s.default.mountPreactComponent(i.StoriesArchive,e,t)}r.default.getRouter().addRoute((function(){return"/stories_archive"===nav.path}),l),window.initStoriesArchive=l},20329:function(e,t,n){"use strict";function i(e,t){var n=t.peers&&t.peers[e];return!!n&&n.isNew}function o(e,t,n){var i=n.peers&&n.peers[e];i&&(i.isNew=t)}n.d(t,{isNewPeer:function(){return i},setIsNewPeer:function(){return o}})},46172:function(e,t,n){"use strict";function i(e){var t=window.store.mail.cur;if(t){var n=e.showOnlyNotMuted,i=e.countNotMuted,o=e.count,a=e.businessNotifyUnread;t.countBusinessNotify=a,t.unreadCounters={countNotMuted:i,count:o},t.settings.show_only_not_muted_messages=n}}function o(e){return!!e.settings.show_only_not_muted_messages}function a(){var e=window.store.mail.cur;return e?o(e)?e.unreadCounters.countNotMuted:e.unreadCounters.count:0}function r(e,t){void 0===t&&(t=!1),function(e,t){var n=window.store.mail.cur;n&&((void 0!==t?t:o(n))&&(n.unreadCounters.countNotMuted=e),n.unreadCounters.count=e)}(Math.max(0,a()+e),!t)}n.d(t,{setUnreadCountFromEvent:function(){return i},getUnreadCount:function(){return a},addToUnreadCount:function(){return r}})},99345:function(e,t,n){"use strict";var i,o=n(62691);function a(){return qs2obj(nav.params)}function r(e){return"dialogs"===e.tab||!e.q}function s(e){var t=nav.getQuery("community");return t?(e?"?":"&")+"community="+t:""}function l(){var e=window.lang;qsearch.init({init_once:!0,action:"/mail?act=write&fast=1",container:ge("ma_search_items"),field:ge("ma_search_field"),btn:ge("ma_search_btn"),top_items:[],_cache:{},item_tpl:function(e,t,n,i,o){return this.id>2e9||-1===this.id?'<a href="'+(e||"")+'" class="simple_item'+(-1==this.id?" simple_item_create":"")+'">'+(t||"")+'<div class="si_body"><span class="si_owner">'+this.highlight(n||"")+"</span>"+(i||"")+(o?'<div class="si_slabel">'+o+"</div>":"")+"</div></a>":'<a href="'+(e||"")+'" class="inline_item"><div class="ii_body">'+(t||"")+'<span class="ii_owner">'+this.highlight(n||"")+"</span>"+(i||"")+"</div></a>"},null_tpl:function(){return'<div class="service_msg_box"><div class="service_msg service_msg_null">'+e.mobile_mail_no_peers+"</div></div>"},need_invalid_keys:o.default.desktop,onLoaded:function(e){for(var t in e)mail.saveDialog(e[t][e[t].length-1],t)}})}im.clearSearchInput=function(e){if(preventEvent(e),r(a())){var t=ge("ma_search_field");val(t,""),im.onFilterKeyDown(t)}else nav.go("/mail"+s(!0))},im.onFilterKeyDown=function(e){setTimeout((function(){var t=window.lang,n=encodeURIComponent(e.value),o=a();if(toggle(geByClass1("mail_search_clear_button"),n),attr(geByClass1("tab_dialogs_search"),"href",n?"/mail?tab=dialogs&q="+n+s():"/mail"+s(!0)),attr(geByClass1("tab_messages_search"),"href","/mail?q="+n+s()),r(o)){var l,c=ge("mail_tabs"),u=ge("ma_search_items"),d=ge("dialogs"),_=o.offset;if(removeClass("mail_show_filtered",geByClass1("mail")),i&&clearTimeout(i),toggleClass("dialogs_filter_without_important",ge("dialogs_filter"),n||0===intval(val(geByClass1("dialogs_filter_button_important")))),n)show(c),show(u),hide(d),i=setTimeout((function(){l="/mail?tab=dialogs&q="+n+(_?"&offset="+_:"")+s(),"/mail"!==nav.path||a().act||nav.go(l,null,{push_only:!0})}),200);else{if(hide(c),hide(u),show(d),!nav.getQuery("community")){var f=geByClass1("mhb_back"),p=geByClass1("mh_header");val(p,t.mobile_mail_head_title),removeClass("mhi_back",p),f.outerHTML=f.outerHTML.replace("<a","<div").replace("</a>","</div>")}l="/mail"+(_?"?offset="+_:"")+s(!_),nav.go(l,null,{push_only:!0})}}}),40)},mail.onShowWritePageFromCache(l),mail.onShowDialogsPageFromCache(l)},1425:function(){window.Friends={onImportSuccess:befall("serviceId","friendsHtml","total"),onImportFailed:befall("serviceId"),accept:function(t,n,i,o,a,r,l,c){void 0===i&&(i="");void 0===o&&(o=null);void 0===a&&(a="");void 0===r&&(r="");void 0===l&&(l=e);void 0===c&&(c=e);s("accept",t,n,i,o,a,r,l,c)},decline:function(t,n,i,o,a,r,l,c){void 0===i&&(i="");void 0===o&&(o=null);void 0===a&&(a="");void 0===r&&(r="");void 0===l&&(l=e);void 0===c&&(c=e);s("decline",t,n,i,o,a,r,l,c)},makeImportRequest:function(e,s,c){if(!window.XMLHttpRequest)return void(window.location=e);ajax.plainpost(e,{_ajax:1},(function(e){return function(e,s,c){var u=parseJSON(e),d=u.user,_=u.user_hash,f=u.contacts,p=t+c;u.error?l(c):ajax.post(p,{_ajax:1,user:d,userhash:_,hash:s,contacts:f},{onDone:function(e,t){return function(e,t,s){var l=geByClass1(n),c=geByClass1(o);addClass(i,l),c&&(c.innerHTML=t,addClass(a,c)),autoScroll((function(){return geByClass1(r)}),ImportedFriends,{no_cache:!0}),Friends.onImportSuccess(e,t,s),window.opener&&window.opener.Friends.onImportSuccess(e,t,s)}(c,e,t)},onFail:function(){return l(c)}})}(e,s,c)}),(function(){return l(c)}),!0)}};var e=null,t="/friends.php?act=save_contacts&type=",n="friendsImport__loading",i=n+"_hidden",o="friendsImport__result",a=o+"_shown",r="friendsList__footerBtn_showMore";function s(e,t,n,i,o,a,r,s,l){var c={act:e,hash:n,id:t};i&&(c.from=i),o&&(c.block_id=o),a&&(c.ref=a),r&&(c.track_code=r);var u="/friends"+obj2qs(c);ajax.post(u,{_ajax:1},{onDone:s,onFail:l})}function l(e){Friends.onImportFailed(e),window.opener&&(window.opener.Friends.onImportFailed(e),window.close())}},88070:function(e,t,n){"use strict";var i=n(94338),o=function(){var e=null;function t(e,t,n,i,o,a){var r="/club"+t+obj2qs({act:e,hash:n,id:t,from:i});ajax.post(r,{_ajax:1},{onDone:o,onFail:a})}return{enter:function(n,i,o,a,r){void 0===a&&(a=e),void 0===r&&(r=e),t("enter",n,i,o,a,r)},leave:function(n,i,o,a,r){void 0===a&&(a=e),void 0===r&&(r=e),t("leave",n,i,o,a,r)},init:function(e,t){void 0===t&&(t={}),t&&t.hasOwnProperty("add_recent_hash")&&(0,i.addRecent)(e,t.add_recent_hash)}}}();window.Groups=o},21922:function(e,t,n){"use strict";n(45542);var i=n(9046),o=(n(5606),n(29804),n(22770),n(18613),n(85489),n(3226),n(65861),n(67571),n(63269)),a=n(53502),r=n(33127),s=n(75951),l=(n(59025),n(99144),n(39161)),c=n(86900),u=n(88941),d=n(6103),_=(n(62623),n(70793),n(62691)),f=(n(19270),n(86658),n(39757),n(91063),n(80574)),p=n(56399),m=(n(67078),n(66556)),h=n(20848),v=(n(65249),n(86353)),g=(n(51571),n(33965),n(11150),n(35576),n(12408),n(89828),n(96675),n(35979),n(79908),n(4580),n(58154),n(65572),n(20123),n(73735),n(3644),n(77935),n(66948),n(66347),n(26256),n(64537),n(25914),n(3873),n(86657),n(43492),n(99345),n(87119),n(61311),n(11116),n(72592),n(64723),n(65354),n(39423),n(60767),n(54440),n(80540),n(61124),n(87712),n(43027),n(47295),n(49751),n(81755),n(72775),n(9873),n(3061),n(66274),n(10729),n(84597),n(87879),n(14194),n(37174),n(92424),n(93817),n(62493),n(65834),n(80908),n(51782),n(9616),n(19682)),A=(n(92553),n(30097),n(91687),n(2302),n(54604),n(36980),n(89359),n(93918),n(60279),n(74489),n(28735),n(23992),n(36386),n(2162),n(80815),n(53198),n(47919),n(90191),n(96872),n(38949),n(94227),n(97518),n(35243),n(3302),n(37505),n(24969),n(38220),n(44767),n(87844),n(42016),n(67395),n(11878),n(85843),n(77292),n(69604),n(63281),n(56804),n(44556),n(4850),n(19598),n(10079),n(19574),n(31927),n(3921),n(60578),n(16320),n(38247),n(10284),n(1425),n(88070),n(84604),n(65023),n(22682),n(2862),n(51758),n(60207),n(61795),n(51105),n(30006),n(93424),n(69393),n(33927),n(70675),n(30506),n(85708),n(96567),n(91533),n(72378),n(57069),n(11855),n(43116)),y=(n(29443),n(31728),n(20357),n(52779),n(86465),n(20370),n(8380),n(84124),n(98886),n(13231),n(23564),n(37875),n(55477),n(72402),n(65906),n(72539),n(97708),n(89137),n(85653),n(42512),n(27378),n(14903),n(49861),n(86490),n(58532),n(63212),n(33252),n(93685),n(1166),n(11299),n(93855),n(76581),n(13747),n(54247),n(78631),n(55787),n(46548),n(53557),n(52242),n(16978),n(62195),n(63766),n(4994),n(85584),n(97620),n(5339),n(44075),n(8833),n(19503),n(48738),n(97946),n(86149),n(41824)),w=(n(75851),n(74814),n(75808),n(83055),n(52109),n(27018),n(91145),n(55638),n(62318),n(60561),n(76661),n(80876)),S=n(19588),b=(n(1730),n(31591)),k=(n(85828),n(38576),n(32124));window.jsc=function(e){return"dist/"+e},(0,u.initAPI)(),(0,a.initStaticManager)(),document.scrollListenerAlreadyInited||(document.scrollListenerAlreadyInited=!0,(0,i.addEvent)(window,"scroll touchmove",(function(){var e,t;(null==(e=window.Speech)||null==(t=e.recorder)?void 0:t.isRecording)||(0,i.onBodyScroll)(!0)}),{passive:!0})),window.trackEvent=f.trackEvent;var C=window,E=C.thover,I=C.ajax;if(_.default.safari_mobile&&15===_.default.ios){var T="_safari_ios15_keyboard_opened";p.onOpenCallback((function(){return document.documentElement.classList.add(T)})),p.onCloseCallback((function(){return document.documentElement.classList.remove(T)}))}function M(){if((0,i.lsGet)("custom_opts"))return(0,i.addClass)("_copts","vk_wrap");var e=(0,i.ce)("div",{innerHTML:'<input id="copts_test_radio" type="radio" checked="checked"><div id="copts_test_label"></div>'});(0,i.append)(e,"vk_utils");var t=(0,i.ge)("copts_test_label");t&&Math.abs(t.offsetWidth-5)<1&&((0,i.addClass)("_copts","vk_wrap"),(0,i.lsSet)("custom_opts",1)),(0,i.remove)(e)}(0,i.addEvent)(document,"touchmove touchcancel",E.cancel,{passive:!0}),(0,i.addEvent)(document,"touchend",E.end,{passive:!0}),onDOMReady((function(){(0,b.initInteractionMethodListener)(document.body.classList.contains("_touch")?"touch":"mouse")})),(0,b.onLastInteractionMethodChanged)((function(e){})),I.enabled=!0,I.enabled&&(onDOMReady((function(){(0,i.remove)("app_go_frame"),I.prepare_click(),menu&&menu.init(),audioplayer&&audioplayer.initAudio(),(0,i.addClass)("_js","vk_wrap")})),page.clear()),onDOMReady((function(){o.default.getRouter().checkRoutes(),window.page&&page.onReadyOrChanged((function(){return o.default.getRouter().checkRoutes()}));var e=document.getElementById("utils");e||((e=document.createElement("div")).id="utils",document.body.insertAdjacentElement("afterbegin",e)),window.utilsNode=e})),onDOMReady(d.resizePosters),(0,i.addEvent)(window,"resize",d.resizePosters),(0,i.addEvent)(document,"touchstart",(function(e){var t=(0,i.checkTouchHover)(e.target);E.clear(),t&&E.start.call(t,e)}),{passive:!0}),document.clickListenerAlreadyInited?setTimeout((function(){var e=Array.from(document.querySelectorAll("script")).map((function(e){return e.src}));(0,c.statlogsValueEvent)("mvk_click_common_multiple_init",1,"common",e.join("|"),location.href)}),0):(document.clickListenerAlreadyInited=!0,(0,i.addEvent)(document,"click",(function(e){var t,n;if((null==(t=e.target)||null==(n=t.dataset)?void 0:n.donutLogEvent)&&(0,s.logDonutEvent)(e.target.dataset.donutLogEvent,e.target),(0,i.ajaxLayoutEnabled)()){var o=(0,i.gpeByClass)("al_after",e.target);if(o){var a=(0,i.attr)(o,"data-target"),r=!!a&&(0,i.geByClass1)(a,o);if(r&&!nav.go_after(r,e)||!nav.go_after(o,e))return}var u=(0,i.matchesSelector)(e.target,".mi_text a");if(l.SAKIntegration.isIntegrated&&u)if(!e.target.getAttribute("mention_id"))return void(e.target.target="_blank");var d=(0,i.checkNav)(e.target,{allow_post_away:!0});if(d&&(document.activeElement&&document.activeElement.tagName&&"input"===document.activeElement.tagName.toLowerCase()&&document.activeElement.blur(),nav.go(d,e)||(0,i.cancelEvent)(e)),"bookmarks"===cur.module){var _=e&&e.target&&(e.target.closest(".BookmarksItem_link")||e.target.closest(".BookmarkSlider__item")||e.target.closest(".OwnerRow"));if(!_)return;var f=_.getAttribute("id").match(/^(link|page)(-?\d+)_(-?\d+)?$/)||[],p=f[0],m=f[1],h=f[2],v=f[3];if(!(p&&m&&h&&v))return;var g=!1;switch(m){case"link":g=e.target.closest('a[target="_blank"]');break;case"page":g=e.target.closest(".OwnerRow__content")||e.target.closest(".OwnerColumn")}if(!g)return;(0,c.statlogsValueEvent)("bookmarks_product_analytics",{item_type:m,item_owner_id:intval(h),item_id:intval(v),time:vk.ts+Math.floor(((new Date).getTime()-vk.started)/1e3)})}}}))),document.submitListenerAlreadyInited||(document.submitListenerAlreadyInited=!0,(0,i.addEvent)(document,"submit",(function(e){var t=e.target;(0,i.hasClass)("vk_js_yes",geByTag1("html"))&&!(0,i.hasClass)("opera_mini_yes",geByTag1("body"))&&(0,i.hasClass)("qsearch",t)&&(0,i.gpeByClass)("audioPage",t)&&(geBySel1('[type="submit"]',t).click(),(0,i.cancelEvent)(e))}))),document.touchStartListenerAlreadyInited||(document.touchStartListenerAlreadyInited=!0,(0,i.addEvent)(document,_.isTouch?"touchstart":"mousedown",(function(e){tooltip.closeByTap(e)}),{passive:!0})),onDOMReady(M),onDOMReady((function(){(0,c.statlogsValueEvent)("mvk_feature_is_supported",Number((0,h.isFlexboxSupported)()),"flexbox"),(0,c.statlogsValueEvent)("mvk_feature_is_supported",Number((0,h.isMatchMediaSupported)()),"match_media"),(0,c.statlogsValueEvent)("mvk_feature_is_supported",Number((0,h.isCSSVariablesSupported)()),"css_variables"),(0,c.statlogsValueEvent)("mvk_feature_is_supported",Number((0,h.isAutoSchemesSupported)()),"auto_change_scheme"),(0,c.statlogsValueEvent)("mvk_feature_is_supported",Number((0,h.isSupportsSupported)()),"css_supports"),(0,c.statlogsValueEvent)("mvk_feature_is_supported",Number((0,h.isGridsSupported)()),"grids"),(0,c.statlogsValueEvent)("mvk_feature_is_supported",Number((0,h.isSVGSupported)()),"svg"),(0,c.statlogsValueEvent)("mvk_feature_is_supported",Number((0,h.isIntersectionObserverSupported)()),"intersection_observer"),(0,c.statlogsValueEvent)("mvk_feature_is_supported",Number((0,h.isWebRTCCallsSupported)()),"webrtc_calls"),(0,c.statlogsValueEvent)("mvk_dark_theme",Number((0,h.isDarkTheme)()),"current"),(0,m.init)()}));onDOMReady((function(){UnsupportedBrowser.isDetected&&UnsupportedBrowser.readyToBeShown(7)&&UnsupportedBrowser.show()})),onDOMReady(v.calculateTimeOffsets),(0,i.sgFix)(),onDOMReady((function(){var e=window.vk;e&&!e.id&&(0,i.lsCheck)()&&localStorage.clear()})),window.optionsTest=M,zlayer.isReady=!0,window.PasswordInput={toggleVisibility:g.toggleVisibility},onDOMReady((function(){(0,A.updateCounters)(),window.page.onChange((function(){window.page.lastTrackedPage!==nav.cur&&(0,A.updateCounters)()}))})),window.MsgTemplates||(window.MsgTemplates={Carousel:{handleElementAction:y.handleElementAction,moveSlider:y.moveSlider,onScroll:y.onScroll}}),window.isNewMail&&(n(69924),n(83228),n(41070),n(51106),n(11713),n(98330),n(4331),n(1142),n(30112),n(89581),n(7912),n(80674),n(29290),n(50582),n(75526),n(47666),n(7812),n(69618),n(55010)),window.MarketAnalyticsManager=w.MarketAnalyticsManager,window.Form=S.Form,onDOMReady((function(){if((0,v.partConfigEnabled)("mvk_connection_type"))new k.ConnectionType;r.navigationStat.addStatEvent(r.navigationStat.getModule(),r.NavigationProductionStatEventTypes.TAB_OPEN)}))},86657:function(){var e=window,t=e.gpeByClass,n=e.hasClass,i=e.addClass,o=e.removeClass,a=e.geByClass1,r=e.setStyle,s=e.tooltip,l=e.ajax;window.Fave={showActionsTT:function(e,o){cancelEvent(o);var l=t("FaveArticles__row",e);if(n(l,"wi_actions_opened"))Fave.hideActionsTT();else{var c=a("wi_actions_wrap",l),u=a("FaveArticles__row_actions",l);r(c,"top",e.offsetTop+e.offsetHeight+"px"),i(l,"wi_actions_opened"),s.addHandler(Fave.hideActionsTT),s.show(c,u)}},hideActionsTT:function(){o("wi_actions_opened",a("wi_actions_opened")),s.hide()},removeArticle:function(e,n,a){Fave.hideActionsTT();var r=t("FaveArticles__row",e);i(r,"removed"),l.post("fave.php",{act:"defave_article",link:n,hash:a},{onFail:function(){return o(r,"removed")}})},restoreArticle:function(e,n,a){var r=t("FaveArticles__row",e);o(r,"removed"),l.post("fave.php",{act:"enfave_article",link:n,hash:a},{onFail:function(){return i(r,"removed")}})}}},4580:function(){var e=function(){var t=null,n=!1;function i(e,t){var n=ge("medias_map"),i=ge("attached_wrap");n||(n=ce("div",{id:"medias_map",className:"pi_medias"}),i.appendChild(n));var o=e.latitude,a=e.longitude,r=(window.devicePixelRatio,geByClass1("medias_map",n)),s=t?'<div class="medias_map_close"><i class="i_close">&nbsp;</i></div><div class="medias_map_label">'+t+"</div>":"",l='<input type="hidden" name="map" value="'+(o+"_"+a+"_0")+'">';r?val(r,s+""+l):val(n,'<div class="meias_row medias_map" onclick="geoloc.remove();">'+s+l+"</div>");show(n)}function o(){t=null,remove("medias_map")}function a(e){var n;e&&e.coords&&(t={latitude:+e.coords.latitude||0,longitude:+e.coords.longitude||0},n=t,ajax.post("/places.php",{_ajax:1,act:"map_label",lat:n.latitude,lng:n.longitude},{onDone:function(e){hide("geo_waiting"),i(n,e)},onFail:r}))}function r(t){e.remove(),hide("geo_waiting")}return{toggle:function(){n?e.remove():e.add()},add:function(e){!e&&n||(n=!0,addClass("cp_geo_btn_sel","geo_btn"),e&&(e.latitude||e.longitude)?i(t={latitude:+e.latitude||0,longitude:+e.longitude||0},e.label):(geo.getCurrentPosition(a,r),show("geo_waiting")))},remove:function(){n&&(n=!1,removeClass("cp_geo_btn_sel","geo_btn"),o())},init:function(t){return t&&e.add(t),geo.init()}}}();window.geoloc=e},44755:function(e,t,n){"use strict";var i=n(3226),o=n(62009),a=n(54412),r=function(){var e=null,t={},n=1,s=null,l=!1,c=!1;function u(){n<64&&(n*=2)}function d(e,t){!1===e&&(e=getNotify()+(t||1)),setNotify(e),menu.refreshSingleCounter(a.COUNTERS_POS_MESSAGES,e)}function _(e){return Object.keys(e).some((function(e){return-1!==e.indexOf("attach")}))||e.fwd||e.emoji||e.geo}function f(e,t,n){var i=toInt(e.from_admin)||null,o=toInt(nav.getQuery("community"));return i&&o?o:2&t?window.vk.id:toInt(e.from)||n}function p(){return Number(nav.getQuery("offset"))>0}function m(e){try{return JSON.parse(e)}catch(e){return null}}return{onNewMsg:(0,i.default)("{ peerId, msgId, authorId, text, date, hasAttachments, flags, isService }"),onEditMsg:(0,i.default)("{ peerId, msgId, authorId, text, date, hasAttachments, flags }"),onMsgReadByMe:(0,i.default)("msgId","dialogId"),onMsgReadByOther:(0,i.default)("msgId","dialogId"),onOnlineChange:(0,i.default)("{ userId, isOnline, onlinePlatform, lastActionTime }"),onTyping:(0,i.default)("dialogId","authorId"),onMultiTyping:(0,i.default)("peerId","userIds","totalCount"),onMsgImportantRemove:(0,i.default)("msgId"),onMsgImportantAdd:(0,i.default)("msgId"),onMsgRemove:(0,i.default)("msgId"),onMsgRestore:(0,i.default)("msgId"),onPeerKeyboard:(0,i.default)("peerId"),onPeerBanner:(0,i.default)("peerId"),onDialogImportant:(0,i.default)("peerId","isImportant"),onDialogMarkedUnread:(0,i.default)("peerId","isMarkedUnread"),onDialogPin:(0,i.default)("peerId"),onDialogUnpin:(0,i.default)("peerId"),onUnreadCount:(0,i.default)("event"),onResync:(0,i.default)(),isLongPollingEnabled:function(){return!!l},init:function(t){e||((0,o.setDocumentDomain)(),e=ce("iframe",{src:t.frameUrl},{display:"none"}),onDOMReady((function(){append(e,window.bodyNode),!0}))),r.refreshParams(t),setTimeout(r.check,1e3)},on:function(){clog("[longpoll] start"),l=!0,setTimeout(r.check,1e3)},off:function(){clog("[longpoll] pause"),l=!1},refreshParams:function(e){extend(t,e||{}),extend(r,t)},getKey:function(){if(s)try{s.abort()}catch(e){}s=ajax.post("/mail",{_ajax:1,act:"im_get_key",community:nav.getQuery("community")},{onDone:function(e){/[0-9a-f]{40}/i.test(e)?(r.refreshParams({key:e}),r.check()):clog("[longpoll] invalid key")},onFail:function(e){setTimeout(r.getKey,1e3*n),clog("[longpoll] from getKey delaying getKey for "+n+"secs"),u()}})},check:function(){if(l&&!c)if(r.makeRequest)try{r.makeRequest((function(e,t){if(c=!1,l)if(window.vk.__debug)r.checked(parseJSON(t))&&(r.check(),n=1);else try{r.checked(parseJSON(t))&&(r.check(),n=1)}catch(e){try{clog("[longpoll] error",e.message||"no message",e.type||"no type",e.stack||"no stack")}catch(e){}setTimeout(r.check,1e3*n),u()}}),(function(){c=!1,setTimeout(r.check,1e3*n),u()})),c=!0}catch(e){clog("[longpoll] makeRequest failed")}else setTimeout(r.check,1e3)},checked:function(e){var i,o,a,s=e.failed;if(1==s||t.ts>=e.ts+256){if(r.refreshParams({ts:e.ts}),s)return!0}else{if(2==s)return clog("[longpoll] delaying getKey for "+n+"secs"),setTimeout(r.getKey,1e3*n),u(),!1;if(s)return void clog("[longpoll]",e)}if(r.refreshParams({ts:e.ts}),e.updates){var l=[],c=!1;for(var h in e.updates){if(116==e.updates[h][0])var v=e.updates[h][1],g=[e.updates[h][0],v.id,v.flags,v.peer_id,v.date,v.title||"",v.message,v.kludges,v.random_id];else g=e.updates[h];var A=intval(g[0]),y=intval(g[1]),w=intval(g[2]),S=intval(g[3]);if(1===w){if(10===A){mail.updateImportantDialog(y,!1);continue}if(12===A){mail.updateImportantDialog(y,!0);continue}}if(w&1<<20){if(10===A){mail.updateMarkAsUnread(y,!1);continue}if(12===A){mail.updateMarkAsUnread(y,!0);continue}}if(8&w){if(2===A){if(window.isNewMail){r.onMsgImportantAdd(y);continue}mail.updateImportantMessages(S,y,1);continue}if(3===A){if(window.isNewMail){r.onMsgImportantRemove(y);continue}mail.updateImportantMessages(S,y,-1);continue}}if(51!=A)if(61!=A)if(62!=A)if(8!=A)if(9!=A)if(6!=A&&7!=A)if(80!=A||!y||nav.getQuery("community"))if(52!=A){if(S)if(4!=A&&5!=A&&116!=A)if(0!=A)if(2!=A);else{if(128&w){if(window.isNewMail){r.onMsgRemove(y);continue}mail.markAsDeleted(S,y)}window.isNewMail&&64&w&&r.onMsgRemove(y)}else{if(window.isNewMail){r.onMsgRemove(y);continue}mail.markAsDeleted(y)}else{var b=5==A||116==A;if(window.isNewMail){var k=g,C=k[1],E=k[3],I=k[4],T=k[6],M=k[7],P=void 0===M?{}:M,L=k[8],N=_(P),R=(i=void 0,o=void 0,a=void 0,i=new Date(1e3*I),o=i.getHours(),a=i.getMinutes(),o+":"+(a<10?"0":"")+a),x=toInt(P.from_admin)||null,B=(toInt(nav.getQuery("community")),f(P,w,E)),D=!!P.source_act,O=P.keyboard?m(P.keyboard):null;if(b){var U={peerId:E,msgId:C,authorId:B,text:T,date:R,hasAttachments:N,flags:w,adminId:x,randomId:L};116==A?U.refreshed=1:U.edited=Math.floor(Date.now()/1e3),r.onEditMsg(U)}else r.onNewMsg({peerId:E,msgId:C,authorId:B,text:T,date:R,hasAttachments:N,flags:w,adminId:x,randomId:L,isService:D,keyboard:O});continue}var H=window.vk,F=2&w?H.id:g[7]&&g[7].from||S,V=g[7]&&g[7].source_act;c||(c=!!need("PinnedMsg").getByMsgId(y));var j=g[7].from_admin||V||c?null:mail.getMsgHTML(y,w,S,g[4],g[5],g[6],g[7],116!=A?b:"");if(j&&(b?mail.replaceMessage(S,y,F,j):p()||mail.addMessage(S,y,F,j),2&w||nav.getQuery("community")||d(!1,1)),"chat_kick_user"===V&&g[7].source_mid==H.id){var $=g[3];mail.unpinMessage($)}j&&"chat_pin_message"!==V&&"chat_unpin_message"!==V||l.push({peer:S,msg_id:y,from_id:F,source_act:V,edited:b})}}else{var q=g,W=q[1],G=q[2];if(!window.isNewMail)continue;11==W&&r.onPeerKeyboard(G),10==W&&r.onPeerBanner(G)}else d(y);else{if(window.isNewMail){var Y=g[1],K=g[2];6===A?r.onMsgReadByMe(K,Y):r.onMsgReadByOther(K,Y);continue}mail.markPeerAsRead(y,w,7==A)}else{if(window.isNewMail){r.onOnlineChange({userId:-y,isOnline:!1,lastActionTime:S});continue}mail.updateOnline(-y,0)}else{if(window.isNewMail){r.onOnlineChange({userId:-y,isOnline:!0,onlinePlatform:7===(w||7)?"desktop":"mobile"});continue}mail.updateOnline(-y,w||7)}else{if(window.isNewMail){var Q=2e9+w,z=y;r.onTyping(Q,z);continue}mail.typing(2e9+w,y)}else{if(window.isNewMail){var X=y,J=y;r.onTyping(X,J);continue}mail.typing(y)}}if(l.length){var Z=[];each(l,(function(e,t){Z.push(t.msg_id)}));var ee={_ajax:1,act:"get_messages",msgs:Z.join(","),community:nav.getQuery("community")};c&&(ee.force_pinned=1),ajax.post("/mail",ee,{onDone:function(e,t){var n=window.cur,i=p();each(l,(function(t,n){var o=e[n.msg_id],a=n.peer;o.text&&!i&&(n.edited?mail.replaceMessage(n.peer,n.msg_id,n.from_id,o.text):mail.addMessage(n.peer,n.msg_id,n.from_id,o.text)),o.unpin&&mail.unpinMessage(a),o.pinned&&mail.pinMessage(a,o.pinned)})),t&&(t.play_animation_msg_id&&StickersAnimation?StickersAnimation.loadStickerInMvkIMAndPlay(t.play_animation_msg_id):(extend(n,t),mail.updateStickers()))}})}}return!0}}}();t.default=r},79908:function(e,t,n){"use strict";var i=n(44755),o=n(62018);window.isNewLongpoll?window.im=o.default:window.im=i.default},62018:function(e,t,n){"use strict";var i=n(9046),o=n(3226),a=n(76829),r=n(4819),s=n(68660),l=n(14116),c=n(24945),u=n(39161),d=n(72989),_=n(91512),f=d.MAIL_CHAT_UPDATE_TYPE_CALL_IN_PROGRESS_CHANGED,p=d.MAIL_CHAT_UPDATE_TYPE_IS_NEW_CHANGED,m={onNewMsg:(0,o.default)("{ peerId, msgId, authorId, text, date, hasAttachments, flags, isService }"),onEditMsg:(0,o.default)("{ peerId, msgId, authorId, text, date, hasAttachments, flags }"),onMsgReadByMe:(0,o.default)("msgId","dialogId"),onMsgReadByOther:(0,o.default)("msgId","dialogId"),onOnlineChange:(0,o.default)("{ userId, isOnline, onlinePlatform, lastActionTime }"),onConvoMinorIdChanged:(0,o.default)("peerId","{ minorSortId }"),onConvoMajorIdChanged:(0,o.default)("peerId","{ majorSortId }"),onTyping:(0,o.default)("dialogId","authorId"),onMultiTyping:(0,o.default)("peerId","userIds","totalCount"),onRecordingAudio:(0,o.default)("peerId","userIds","totalCount"),onMsgImportantRemove:(0,o.default)("msgId"),onMsgImportantAdd:(0,o.default)("msgId"),onMsgRequestChange:(0,o.default)("peerId","type"),onCallInProgress:(0,o.default)("peerId","inProgress"),onIsNewChange:(0,o.default)("peerId","isNew"),onMsgRemove:(0,o.default)("msgId"),onMsgListen:(0,o.default)("msgId"),onMsgRestore:(0,o.default)("msgId"),onPeerKeyboard:(0,o.default)("peerId"),onPeerBanner:(0,o.default)("peerId"),onPeerConvert:(0,o.default)("peerId","convertId"),onPeerAdmin:(0,o.default)("peerId","userId","isAdmin"),onDialogImportant:(0,o.default)("peerId","isImportant"),onDialogMarkedUnread:(0,o.default)("peerId","isMarkedUnread"),onDialogPin:(0,o.default)("peerId"),onDialogUnpin:(0,o.default)("peerId"),onDialogAdTag:(0,o.default)("peerId"),onDialogRemove:(0,o.default)("peerId"),onUnreadCount:(0,o.default)("event"),onIncomingCall:(0,o.default)("event"),onKeyboardCallback:(0,o.default)("eventId","peerId","ownerId","action"),onResync:(0,o.default)(),_onLpEvents:(0,o.default)("Array<Object>"),init:function(e){m._lpConnect&&(m._onLpEvents.off(),m._lpConnect.stopConnection(),m._lpQueue=null,m._lpConnect=null),m._unsubscribeEventQueue&&(m._unsubscribeEventQueue(),m._unsubscribeEventQueue=null),m._lpConfig=e},isLongPollingEnabled:function(){return!(!m._lpConnect||m._lpConnect.isStopped())},on:function(){clog("[longpoll] start"),window.addEventListener("online",h),window.addEventListener("offline",h),m._unsubscribeEventQueue||m._createEventQueue(),m._lpConnect?m._lpConnect.reinitConnection():m._createLongpoll(m._lpConfig)},off:function(){clog("[longpoll] stop"),window.removeEventListener("online",h),window.removeEventListener("offline",h),m._lpConnect&&m._lpConnect.stopConnection(),m._unsubscribeEventQueue&&(m._unsubscribeEventQueue(),m._unsubscribeEventQueue=null)},pause:function(){clog("[longpoll] pause"),m._lpQueue&&m._lpQueue.pause()},resume:function(){clog("[longpoll] resume"),m._lpQueue&&m._lpQueue.resume()},abortWaiting:function(){clog("[longpoll] abort waiting"),m._lpConnect.abortWaiting()},_createLongpoll:function(e){if(!m._lpConnect){var t=(0,r.createLongpollEventsQueue)(e.ts,(function(e){m._onLpEvents(e)})),n=(0,a.createLongpollConnect)(e,{onEvents:function(e,n,i){i.length?i.forEach((function(i){t.onLp(e,n,[i])})):t.onLp(e,n,[])},onHistoryLost:function(){clog("[longpoll] ts expired")},onKeyExpired:function(e){return clog("[longpoll] key expired"),(0,s.post)("/mail",{act:"get_key",user_id:e.id})},onLpBroken:function(){clog("[longpoll] broken, reload"),window.location.reload()}});m._lpQueue=t,m._lpConnect=n,m._onLpEvents((function(e){try{e.forEach(m._onEvent)}catch(e){console.error(e)}}))}},_onEvent:function(e){var t=e.type;switch("edu"===u.SAKIntegration.type&&u.SAKIntegration.sendMessage("longpoll",{event:e},"mvk_embedded_background"),t){case d.REPLACE_FLAGS:var n=e.flags,o=e.messageId;e.peerId;n&d.FLAG_IMPORTANT?m.onMsgImportantAdd(o):m.onMsgImportantRemove(o),n&d.FLAG_DELETED||n&d.FLAG_SPAM?m.onMsgRemove(o):m.onMsgRestore(o);break;case d.SET_FLAGS:var a=e.flags,r=e.messageId;e.peerId;a&d.FLAG_IMPORTANT&&m.onMsgImportantAdd(r),(a&d.FLAG_DELETED||a&d.FLAG_SPAM)&&m.onMsgRemove(r),a&d.FLAG_AUDIO_MESSAGE_LISTENED&&m.onMsgListen(r);break;case d.RESET_FLAGS:var s=e.flags,l=e.messageId;e.peerId;s&d.FLAG_IMPORTANT&&m.onMsgImportantRemove(l),(s&d.FLAG_DELETED||s&d.FLAG_SPAM)&&m.onMsgRestore(l);break;case d.ADD_MESSAGE:case d.EDIT_MESSAGE:case d.REPLACE_MESSAGE:var c=e.messageId,_=e.peerId,h=e.randomId,v=e.text,g=e.minorSortId,A=e.flags,y=e.attaches,w=e.kludges,S=e.date,b=(0,i.toInt)(w.from_admin)||null,k=function(e){if(e.flags&d.FLAG_OUTBOUND)return m._lpConfig.id;return e.userId}(e),C=!!w.source_act,E=t===d.EDIT_MESSAGE||t===d.REPLACE_MESSAGE,I=A&d.FLAG_OUTBOUND,T=!!(A&d.FLAG_STEALTH),M=w.keyboard,P=function(e,t){t&d.FLAG_HAS_REPLY&&function(e){e.fwd_count}(e)}(w,A),L=!!w.has_template,N={peerId:_,id:c,authorId:k,attaches:y,text:v,ts:S,flags:A,adminId:b,randomId:h,isService:E?void 0:C,edited:!!E||void 0,replaced:t===d.REPLACE_MESSAGE,keyboard:M,isStealth:T,isOut:I,hasReply:P,hasTemplate:L,ttl:w.ttl||w.expire_ttl&&parseInt(w.expire_ttl)||null,isExpired:w.is_expired};E?m.onEditMsg(N):m.onNewMsg(N,g);break;case d.READ_INBOUND:case d.READ_OUTBOUND:var R=e.peerId,x=e.upToId;e.unread;t===d.READ_INBOUND?m.onMsgReadByMe(x,R):m.onMsgReadByOther(x,R);break;case d.RESET_DIRECTORIES:case d.SET_DIRECTORIES:var B=e.mask,D=e.peerId;e.local;B&d.FOLDER_IMPORTANT?m.onDialogImportant(D,t===d.SET_DIRECTORIES):B&d.FOLDER_AD_TAG?m.onDialogAdTag(D):B&d.FOLDER_MARKED_UNREAD&&m.onDialogMarkedUnread(D,t===d.SET_DIRECTORIES);break;case d.REPLACE_DIRECTORIES:var O=e.mask,U=e.peerId;e.local;m.onDialogImportant(U,!!(O&d.FOLDER_IMPORTANT));break;case d.DELETE_DIALOG:var H=e.peerId;m.onDialogRemove(H);break;case d.CONVO_MAJOR_ID_CHANGED:var F=e.peerId,V=e.majorId;m.onConvoMajorIdChanged(F,{majorSortId:V});break;case d.CONVO_MINOR_ID_CHANGED:var j=e.peerId,$=e.minorId;m.onConvoMinorIdChanged(j,{minorSortId:$});break;case d.CONVERSATION_UPDATED:var q=e.peerId,W=e.updateType,G=e.updateArg;if(11===W&&m.onPeerKeyboard(q),10===W&&m.onPeerBanner(q),13===W&&m.onPeerConvert(G,q),12===W){var Y="";switch(G){case 3:Y="created";break;case 2:Y="rejected";break;case 1:Y="accepted";break;case 0:Y="canceled"}m.onMsgRequestChange(q,Y)}3===W&&m.onPeerAdmin(q,G,!0),9===W&&m.onPeerAdmin(q,G,!1),W===f&&m.onCallInProgress(q,G),W===p&&m.onIsNewChange(q,G);break;case d.TYPING:var K=e.peerId,Q=e.userIds,z=e.totalCount;e.ts;m.onMultiTyping(K,Q,z);break;case d.RECORDING_AUDIO:var X=e.peerId,J=e.userIds,Z=e.totalCount;e.ts;m.onRecordingAudio(X,J,Z);break;case d.VIDEO_CALL:break;case d.UNREAD_COUNT:m.onUnreadCount(e);break;case d.NOTIFY_SETTINGS_CHANGED:break;case d.INCOMING_CALL:m.onIncomingCall(e);break;case d.KEYBOARD_CALLBACK_RECEIVED:var ee=e.owner_id,te=e.peer_id,ne=e.event_id,ie=e.action;m.onKeyboardCallback(ne,te,ee,ie);break;case d.RESYNC:m.onResync()}},_createEventQueue:function(){if(!m._unsubscribeEventQueue){var e=new l.EventQueue({getQueue:function(){return(0,c.mailRequest)("/mail",{act:"queue_params"})},registerQueue:function(e,t){_.QueueManager.addQueue(e,t),_.QueueManager.start()}});m._unsubscribeEventQueue=e.subscribe(m._onEventQueueEvent)}},_onEventQueueEvent:function(e){switch(e.entity_type){case l.EntityType.Online:m.onOnlineChange({userId:e.data.user_id,isOnline:e.data.online,onlinePlatform:[1,2,3,4,5].includes(e.data.platform)?"mobile":"desktop",lastActionTime:e.data.last_seen})}}};function h(e){"online"===e.type?(clog("[longpoll] online"),m._lpConnect.reinitConnection()):(clog("[longpoll] offline"),m._lpConnect.stopConnection())}t.default=m},49066:function(e,t,n){"use strict";n.d(t,{loadMessage:function(){return r}});var i=n(24945),o=null,a=null;function r(e){l(e)}function s(e){if(a&&(clearTimeout(a),a=null),o&&(o=Object.assign({},o,{fails:0})),"online"===e.type&&o){var t=o;o=null,l(t)}}function l(e){if(!1!==navigator.onLine)return(0,i.mailRequest)("/mail",{act:"message",message_id:e.msgId,forcePinned:e.forcePinned}).then((function(t){e.onResult(t)})).catch((function(t){if(e.onTryError&&e.onTryError(t),!1!==navigator.onLine){var n=Math.min(1+(0|e.fails),6),i=Math.pow(2,Math.max(n-2,0));o=Object.assign({},e,{fails:n}),a=setTimeout((function(){a=null,l(o)}),1e3*i)}else o=Object.assign({},e,{fails:0})}));o=Object.assign({},e,{fails:0})}window.addEventListener("online",s),window.addEventListener("offline",s)},40997:function(e,t,n){"use strict";n.d(t,{onStopped:function(){return l},onSent:function(){return c},onCaptcha:function(){return d},onErrorMessage:function(){return _},onMessage:function(){return f},onMessageRemove:function(){return p},ready:function(){return h},getItems:function(){return v},send:function(){return g},retry:function(){return A},remove:function(){return y}});var i=n(93954),o=n(31136),a=n(24945),r=n(3226),s=n(80444),l=(0,r.default)(),c=(0,r.default)(),u=(0,r.default)(),d=(0,r.default)(),_=(0,r.default)(),f=(0,r.default)(),p=(0,r.default)(),m="mail_send";function h(){return(0,o.queueWhenReady)(m)}function v(){return(0,o.queueGetItems)(m)}function g(e){h().then((function(){i.logQueueSize((0,o.queueGetSize)(m));var t=(0,a.sendDataToMessage)(e);(0,o.queueAddItem)(m,t.sendId,{data:e}),f(t)}))}function A(e,t){var n=(0,o.queueGetItem)(m,e);t&&(n.data=t(n.data)),(0,o.queueRemoveItem)(m,e),g(n.data.data)}function y(e,t){(0,o.queueRemoveItem)(m,e),"silent"!==t&&p(e)}(0,o.registerQueue)(m,{onSend:function(e,t){!function(e,t){e=Object.assign({},e);var n="/mail",r="edit_message"===e.act;r?Object.keys(e).forEach((function(t){"attached_messages"!==t&&"has_reply"!==t||delete e[t]})):(n=(0,s.makeUrl)("/mail",{act:"send",to:e.to,from:e.from,hash:e.hash,_af:e._af,ref:e.ref||"",ref_source:e.ref_source||""}),Object.keys(e).forEach((function(t){"act"!==t&&"to"!==t&&"from"!==t&&"hash"!==t&&"_af"!==t&&"attachesHTML"!==t||delete e[t]})));i.log(t,r?"edit":"send");var l=function(e){i.mark(t,"server"),r&&!e.was_modified&&p(t),c(),(0,o.queueSignalSuccess)(m)},f=function e(n){var r=n.type,s=n.code,c=n.message,f=n.data;if(i.error(t,"server_send",r),"captcha"!==r&&i.clean(t),"server"===r&&s&&s!==a.UNKNOWN_ERROR)return c&&_(c),void(0,o.queueSignalStop)(m);"captcha"!==r?((0,o.queueSignalFail)(m),u()):d(f,(function(n){if(!n)return i.clean(t),void(0,o.queueSignalStop)(m);n.then(l,e)}))};(0,a.mailRequest)(n,e).then(l,f)}(t.data,e)},onStopped:l,maxFails:5})},49825:function(e,t,n){"use strict";n.d(t,{onUnidle:function(){return r},start:function(){return s},stop:function(){return l},addAction:function(){return c}});var i,o,a=n(72864),r=(0,n(3226).default)();function s(){i||((i=new a.default({id:"mail_user",element:document,focusElement:window,triggerEvents:"mouseover mousedown keypress touchstart",idleTimeout:15e3})).on("unidle",u),i.on("unidle",r)),o={},i.start()}function l(){o=null,i&&i.stop()}function c(e,t){i&&(i.is_idle?o[e]=t:setTimeout(t,0))}function u(){var e=o;o={},Object.keys(e).forEach((function(t){(0,e[t])()}))}},45877:function(e,t,n){"use strict";n.d(t,{getNetworkType:function(){return o}});var i={bluetooth:"2g",cellular:"2g",ethernet:"4g",mixed:"unknown",none:"none",other:"unknown",unknown:"unknown",wifi:"3g",wimax:"4g"};function o(){if(!1===navigator.onLine)return"none";var e=navigator.connection||navigator.webkitConnection||navigator.mozConnection;if(!e)return"unknown";if(e.effectiveType)return e.effectiveType;var t=+(e.downlinkMax||e.downlink);return t?t<50?"slow-2g":t<70?"2g":t<700?"3g":"4g":i[e.type]||"unknown"}},46359:function(e,t){"use strict";function n(e,t){function n(e){var t=["Webkit","Moz","O","ms"],n=document.createElement("div");if(void 0!==n.style[e])return!0;for(var i in e=e.charAt(0).toUpperCase()+e.slice(1),t)if(void 0!==n.style[t[i]+e])return!0;return!1}function o(e,t){new RegExp("(\\s|^)"+t+"(\\s|$)").test(e.className)||(e.className+=" "+t)}function a(e,t){e.className=e.className.replace(new RegExp("(\\s+|^)"+t+"(\\s+|$)","g")," ").replace(/^\s+|\s+$/g,"")}function r(e,t){0>e?e=0:e>g-1&&(e=g-1);for(var n=k.dots.length-1;n>=0;n--)a(k.dots[n],T.activeDot);return o(k.dots[e],T.activeDot),E=e,s(-e*k.width,void 0===t?I.speed:t),f(),I.onSlideChange&&I.onSlideChange(e),e}function s(e,t){var n=t?t+"ms":"";y.style.webkitTransitionDuration=y.style.MozTransitionDuration=y.style.msTransitionDuration=y.style.OTransitionDuration=y.style.transitionDuration=n,c(e)}function l(e,t){if(b&&clearInterval(b),t){var n=+new Date,i=k.left;b=setInterval((function(){function o(e,t){return(t-e)*s+e}var a,r,s=(+new Date-n)/t,l=[0,.7,1,1];return s>=1?(c(e),void clearInterval(b)):(a=e-i,r=o(o(o(l[0],l[1]),o(l[1],l[2])),o(o(l[1],l[2]),o(l[2],l[3]))),void c(Math.floor(r*a+i)))}),15)}else c(e)}function c(e){y.style.webkitTransform="translate("+e+"px,0) translateZ(0)",y.style.msTransform=y.style.MozTransform=y.style.OTransform=y.style.transform="translateX("+e+"px)",k.left=e}function u(e){y.style.left=e+"px",k.left=e}function d(){var e=E+1;return e>g-1&&(e=0),r(e)}function _(){S=!0,f()}function f(){S&&(w&&clearTimeout(w),w=setTimeout((function(){d()}),I.slideshowInterval))}function p(){w&&clearTimeout(w)}function m(){S=!1,w&&clearTimeout(w)}function h(){k.width=e.offsetWidth,y.style.width=k.width*g+"px";for(var t=0;g>t;t++)k.slides[t].style.width=k.width+"px";s(-E*k.width)}function v(e,t,n,i){t&&(e.addEventListener?e.addEventListener(t,n,!!i):e.attachEvent("on"+t,n))}var g,A,y,w,S,b,k={slides:[],dots:[],left:0},C=200,E=0,I={speed:300,touchSpeed:300,slideshow:!1,slideshowInterval:4e3,stopSlideshowAfterInteraction:!1,startSlide:0,mouseDrag:!0,disableIfOneSlide:!0,cssPrefix:"peppermint-",dots:!1,dotsPrepend:!1,dotsContainer:void 0,slidesContainer:void 0,onSlideChange:void 0,onSetup:void 0};t&&function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])}(I,t);var T={inactive:I.cssPrefix+"inactive",active:I.cssPrefix+"active",mouse:I.cssPrefix+"mouse",drag:I.cssPrefix+"drag",slides:I.cssPrefix+"slides",dots:I.cssPrefix+"dots",activeDot:I.cssPrefix+"active-dot",mouseClicked:I.cssPrefix+"mouse-clicked"},M={transforms:n("transform"),transitions:n("transition")};return function(){var t=I.slidesContainer||e,n=I.dotsContainer||e;if(!(I.disableIfOneSlide&&t.children.length<=1)){(!M.transforms||window.opera)&&(c=u),(!M.transitions||window.opera)&&(s=l),o(y=I.slidesContainer||document.createElement("div"),T.slides);for(var d=0,f=t.children.length;f>d;d++){var w=t.children[d],S=document.createElement("li");k.slides.push(w),S.setAttribute("tabindex","0"),S.setAttribute("role","button"),S.innerHTML="<span></span>",function(t,n){v(n,"click",(function(){r(t),I.stopSlideshowAfterInteraction&&m()})),v(n,"keyup",(function(e){13==e.keyCode&&(r(t),I.stopSlideshowAfterInteraction&&m())})),v(n,"mouseup",(function(){o(n,T.mouseClicked)})),v(n,"blur",(function(){a(n,T.mouseClicked)}),!0),v(w,"focus",w.onfocusin=function(){e.scrollLeft=0,setTimeout((function(){e.scrollLeft=0}),0),r(t)},!0)}(d,S),k.dots.push(S)}g=k.slides.length,100/g,o(e,T.active),a(e,T.inactive),I.mouseDrag&&o(e,T.mouse),k.width=e.offsetWidth,y.style.width=k.width*g+"px";for(d=0;g>d;d++)k.slides[d].style.width=k.width+"px",y.appendChild(k.slides[d]);if(I.slidesContainer||e.appendChild(y),I.dots&&g>1){o(A=document.createElement("ul"),T.dots);for(d=0,f=k.dots.length;f>d;d++)A.appendChild(k.dots[d]);I.dotsPrepend?n.insertBefore(A,n.firstChild):n.appendChild(A)}v(window,"resize",h),v(window,"orientationchange",h),setTimeout((function(){r(I.startSlide,0)}),0),I.slideshow&&_(),i(y,{mouse:I.mouseDrag,start:function(){o(e,T.drag)},move:function(e,t,n){p(),n.x=n.x/(!E&&n.x>0||E==g-1&&n.x<0?Math.abs(n.x)/k.width*2+1:1),s(n.x-k.width*E)},end:function(t,n,i){if(i.x){var o=Math.abs(i.x)/k.width,s=Math.floor(o)+(o-Math.floor(o)>.25?1:0);s+=i.time<C+C*s/1.8&&Math.abs(i.x)-s*k.width>(s?-k.width/9:20)?1:0,i.x<0?r(E+s,I.touchSpeed):r(E-s,I.touchSpeed),I.stopSlideshowAfterInteraction&&m()}a(e,T.drag)}}),setTimeout((function(){I.onSetup&&I.onSetup(g)}),0)}}(),{slideTo:function(e,t){return r(parseInt(e,10),t)},next:d,prev:function(){var e=E-1;return 0>e&&(e=g-1),r(e)},start:_,stop:m,pause:p,getCurrentPos:function(){return E},getSlidesNumber:function(){return g},recalcWidth:h}}function i(e,t){function n(e,t,n,o){return t?(e.addEventListener?e.addEventListener(t,n,!!o):e.attachEvent("on"+t,n),{remove:function(){i(e,t,n,o)}}):void 0}function i(e,t,n,i){t&&(e.removeEventListener?e.removeEventListener(t,n,!!i):e.detachEvent("on"+t,n))}function o(e){}function a(e){if((h={x:(_?e.clientX:e.touches[0].clientX)-m.x,y:(_?e.clientY:e.touches[0].clientY)-m.y,time:Number(new Date)-m.time}).time-g[g.length-1].time){for(var t=0;t<g.length-1&&h.time-g[t].time>80;t++);v={x:(h.x-g[t].x)/(h.time-g[t].time),y:(h.y-g[t].y)/(h.time-g[t].time)},g.length>=5&&g.shift(),g.push({x:h.x,y:h.y,time:h.time})}}function r(e,t){y=!0,b[_=t](e)||(n(document,S[_][1],s),n(document,S[_][2],l),n(document,S[_][3],l),u.preventDefault,m={x:_?e.clientX:e.touches[0].clientX,y:_?e.clientY:e.touches[0].clientY,time:Number(new Date)},d=void 0,h={x:0,y:0,time:0},v={x:0,y:0},g=[{x:0,y:0,time:0}],u.start(e,m))}function s(e){!u.preventScroll&&d||b[_](e)||(a(e),(Math.abs(h.x)>u.clickTolerance||Math.abs(h.y)>u.clickTolerance)&&(y=!1),void 0===d&&3!==_&&(d=Math.abs(h.x)<Math.abs(h.y)&&!u.preventScroll)||(u.preventDefault,u.move(e,m,h,v)))}function l(e){_&&a(e),!y&&e.target&&e.target.blur&&e.target.blur(),i(document,S[_][1],s),i(document,S[_][2],l),i(document,S[_][3],l),u.end(e,m,h,v)}var c=function(){},u={preventDefault:!0,clickTolerance:0,preventScroll:!1,mouse:!0,start:c,move:c,end:c,click:c};t&&function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])}(u,t);var d,_,f=!!window.navigator.pointerEnabled,p=!!window.navigator.msPointerEnabled,m={},h={},v={},g=[],A=[],y=!0,w=f?1:p?2:0,S=[["touchstart","touchmove","touchend","touchcancel"],["pointerdown","pointermove","pointerup","pointercancel"],["MSPointerDown","MSPointerMove","MSPointerUp","MSPointerCancel"],["mousedown","mousemove","mouseup",!1]],b=[function(e){return e.touches&&e.touches.length>1||e.scale&&1!==e.scale},function(e){return!e.isPrimary||e.buttons&&1!==e.buttons||!u.mouse&&"touch"!==e.pointerType&&"pen"!==e.pointerType},function(e){return!e.isPrimary||e.buttons&&1!==e.buttons||!u.mouse&&e.pointerType!==e.MSPOINTER_TYPE_TOUCH&&e.pointerType!==e.MSPOINTER_TYPE_PEN},function(e){return e.buttons&&1!==e.buttons}];return A.push(n(e,S[w][0],(function(e){r(e,w)}))),A.push(n(e,"dragstart",o)),u.mouse&&!w&&A.push(n(e,S[3][0],(function(e){r(e,3)}))),A.push(n(e,"click",(function(e){y&&u.click(e)}))),{getClicksAllowed:function(){return y},kill:function(){for(var e=A.length-1;e>=0;e--)A[e].remove()}}}window.jQuery&&function(e){e.fn.Peppermint=function(t){return this.each((function(){e(this).data("Peppermint",n(this,t))})),this}}(window.jQuery),window.Peppermint=n,window.EventBurrito=i,t.default=n},82470:function(e,t,n){"use strict";var i=n(46359);t.default=i.default},31136:function(e,t,n){"use strict";n.d(t,{registerQueue:function(){return l},queueAddItem:function(){return c},queueRemoveItem:function(){return u},queueGetItem:function(){return d},queueGetSize:function(){return _},queueSignalSuccess:function(){return f},queueSignalFail:function(){return p},queueSignalStop:function(){return m},queueGetItems:function(){return h},queueWhenReady:function(){return v}});var i=n(9046),o={},a={},r="idle",s="sending";function l(e,t){o[e]={pending:[],failed:[],items:{},onSend:t.onSend,onStopped:t.onStopped,maxFails:0|t.maxFails,loaded:!1,sendingItemId:null,backoffTimer:null},a[e]=r}function c(e,t,n){var i={id:t,data:n,fails:0},a=o[e];u(e,t),a.items[t]=i,a.pending.push(t),g(e),A(e)}function u(e,t){var n=o[e];delete n.items[t];var i=n.pending.indexOf(t),a=n.failed.indexOf(t);-1!==i&&n.pending.splice(i,1),-1!==a&&n.failed.splice(a,1),A(e)}function d(e,t){return o[e].items[t]||null}function _(e){var t=o[e];return t?t.pending.length:0}function f(e){var t=o[e],n=t.sendingItemId;n&&(t.pending[0]===n&&t.pending.shift(),delete t.items[n]),a[e]=r,t.sendingItemId=null,g(e),A(e)}function p(e){var t=o[e],n=t.sendingItemId;if(n&&t.pending[0]===n){var i=t.items[n];if(i&&(i.fails+=1,i.fails>=t.maxFails))return void m(e)}a[e]=r,t.sendingItemId=null,g(e)}function m(e){var t=o[e];t.failed=t.failed.concat(t.pending),t.pending=[],a[e]=r,t.sendingItemId=null,t.onStopped(),A(e)}function h(e){var t=o[e];return{pending:t.pending,failed:t.failed,items:t.items}}function v(e){var t=o[e];return t.loaded?Promise.resolve():(t.retrieving||(t.retrieving=function(e){return new Promise((function(t){var n=(0,i.lsGet)("q_"+e)||{items:{},pending:[],failed:[]};n.failed=n.failed.concat(n.pending).filter((function(e){return!!n.items[e]})),n.pending=[],t(n)}))}(e).then((function(t){var n=t.pending,i=t.failed,a=t.items,r=o[e];r.retrieving=null,r.loaded=!0,r.pending=n,r.failed=i,r.items=a}))),t.retrieving)}function g(e,t){if(!1!==navigator.onLine){var n=o[e];if(a[e]!==s&&n.pending.length&&!n.backoffTimer){var i=n.pending[0],r=n.items[i];if(!r.fails||t)a[e]=s,n.sendingItemId=i,n.onSend(r.id,r.data);else{var l=Math.pow(2,Math.max(r.fails-2,0));n.backoffTimer=setTimeout((function(){n.backoffTimer=null,g(e,!0)}),1e3*l)}}}}function A(e){var t=o[e],n=t.pending,a=t.failed,r=t.items;(0,i.lsSet)("q_"+e,{pending:n,failed:a,items:r})}window.addEventListener("online",(function(){Object.keys(o).forEach((function(e){g(e)}))}))},59025:function(e,t,n){"use strict";var i=n(39161),o=n(24945);window.SAKIntegration=i.SAKIntegration,window.SAKIntegrationInit=function(e){e.isNewMail=(0,o.isNewMailPage)(location.pathname,location.search),i.SAKIntegration.init(e)}},512:function(e,t,n){"use strict";function i(e,t){return void 0===e&&(e=""),void 0===t&&(t=[]),!!t.find((function(t){return"*"===t[t.length-1]?e.startsWith(t.slice(0,t.length-1)):e===t}))}n.d(t,{isForbiddenPage:function(){return i}})},6103:function(e,t,n){"use strict";n.d(t,{resizePosters:function(){return i}});function i(e,t,n){var i=ge(t)||document,o="poster-resized",a="[data-poster-resized='false']";(e||n)&&(a="");var r=domQuery(".poster__text"+a,i),s=[],l=cur.posterConfig&&cur.posterConfig.constants;if(!l){if(!r.length)return;l=JSON.parse(domData(r[0].parentElement,"poster-constants"))}for(var c=0;c<r.length;c++){var u=r[c],d=domPN(u);s.push(domPN(d).clientWidth)}for(var _=0;_<r.length;_++){var f=r[_],p=domPN(f),m=s[_],h=l.font_size_ratio_range_1*m+"px",v=Math.round(l.line_height_ratio_range_1*m)+"px",g="0 "+Math.round(.05555555555555555*m)+"px";f.textContent.length>l.range_threshold&&(h=Math.round(l.font_size_ratio_range_2*m)+"px",v=Math.round(l.line_height_ratio_range_2*m)+"px"),setStyle(p,{height:.75*m+"px",width:m}),setStyle(f,{fontSize:h,lineHeight:v,padding:g}),domData(f,o,!0)}}},96675:function(e,t,n){"use strict";n(1730);var i=n(62691),o=n(67952),a=n(74521),r=n(9046),s=function(){var e={},t={},n=null,u=!1,d={},_={},f={},p=null;function m(){if(n){var t=[],i=!1;if(each(geByClass("_unread"),(function(){var e=+attr(this,"data-id");e&&t.push(e),i=s.getPeerByMsg(e),replaceClass("_unread","_read",this)})),i){var o=ge("messages"+i);o&&e[i]&&(e[i].messages=val(o))}if(t.length)s.sendMarkAsRead(n,t);else{var a=e[n].last_msg;s.sendMarkAsRead(n,a?[a]:[]),s.updateMarkAsUnread(n,!1)}}}function h(e,t){t?(addClass("lvi",e),toggleClass("mlvi",e,!!i.mobPlatforms[t])):(removeClass("lvi",e),removeClass("mlvi",e))}function v(e){(0,e.updater)(document.body),each(e.caches,(function(t,n){var i=n.storage,o=n.getter,a=function(e,t){var n,i=t.split("."),o=i.length,a=e;for(n=0;n<o;n++)if(!(a=a[i[n]]))return null;return a}(i,o);if(a){var r="string"==typeof a;r&&(a=ce("div",{innerHTML:a})),e.updater(a),function(e,t,n){var i,o,a=t.split("."),r=a.length-1,s=e;for(o=0;o<r;o++)s=s[i=a[o]]||(s[i]={});s[a[r]]=n}(i,o,r?a.innerHTML:a)}}))}return!window.isNewMail&&window.nav&&window.nav.onBeforeGo((function(e,t,n){if(nav.getQuery("community")&&(!n||!n.ignore_cur_process)&&"/mail"===("string"==typeof e?e:attr(e,"href")||attr(e,"data-href")))return nav.go(e,t,{ignore_cur_process:!0}),!0})),!window.isNewMail&&window.nav&&window.nav.onBeforeGo((function(){if(nav.getQuery("community"))var e=ajax.post("/",{_ajax:1,act:"ping"},{onDone:function(){try{var t=JSON.parse(e.response),n=t&&t[1]&&t[1][2];s.actualizeMessagesCornerCounter(n)}catch(e){}}})})),{wrapLinks:o.wrapLinks,wrapMention:c,onShowDialogFromCache:(0,r.se)(),onShowWritePageFromCache:(0,r.se)(),onShowDialogsPageFromCache:(0,r.se)(),onMessagesRepainted:(0,r.se)(),init:function(t,o){var a=window.im;window.cur.destroy.push((function(){AudioMessagePlayer.detachPlayer()})),o&&(cur.ref=o.ref,cur.refSource=o.ref_source),t&&(n=t,o&&(s.saveDialog(o,t),e[t])),u||(u=!0,addEvent(document,i.isTouch?"touchstart":"mousedown",m)),setTimeout((function(){a.on()}))},unpinMessage:function(t){v({caches:[{storage:e,getter:t+".write_form"}],updater:function(e){e.$$(".cm_unpin").forEach(hide),e.$$(".head_actions_wrap").forEach((function(e){return e.classList.remove("head_actions_has_pinned")})),e.$$(".pinnedMsg_peer_"+t).forEach((function(e){return e.classList.add("pinnedMsg_hidden")}))}})},pinMessage:function(t,n){v({caches:[{storage:e,getter:t+".write_form"}],updater:function(e){e.$$(".cm_unpin").forEach(show),e.$$(".head_actions_wrap").forEach((function(e){return e.classList.add("head_actions_has_pinned")})),$$(".pinnedMsg_peer_"+t).forEach((function(e){return e.outerHTML=n}))}})},clear:function(){nav.clear();var o=window.im;e={},t={},d={},n=null,removeEvent(document,i.isTouch?"touchstart":"mousedown",m),u=!1,o.off()},send:function(e,t){if(mediaUpload&&!mediaUpload.checkUploading())return!1;var n=ajax.click(e,extend({clear:!0,save:!0},Dialog),{lock:!0,url_params:{ref_source:cur.refSource,ref:cur.ref}});return cur.ref=void 0,cur.refSource=void 0,n},save:function(t){each(t,(function(t,n){e[t]&&n.last_msg==e[t].last_msg&&delete n.messages,s.saveDialog(n,t)}))},saveDialog:function(t,n){e[n]||(e[n]={});var i=e[n];extend(i,t),i.msgs&&each(i.msgs,(function(e,t){d[t]=n}))},getPeerByMsg:function(e){return d[e]||!1},cacheDialogsPage:function(){nav.getQuery("community")&&nav.getQuery("tab")||(t.page=val("m"),nav.getQuery().act?t.link=l("/mail"):t.link=nav.cur)},keyup:function(e,t,n){var i=p||"",o=e.value||"";i.length==o.length&&i==o||(s.myTyping(t,n),p=o)},myTyping:function(e,t){if(!(e<=-2e9)){var n=vkNow();f[e]&&n-f[e]<5e3||(f[e]=n,ajax.post("/mail",{_ajax:1,act:"typing",peer:e,hash:t,community:nav.getQuery("community")}))}},typing:function(e,t){t=t||e;e>2e9?(_[e]||(_[e]={}),_[e][t]=vkNow()):_[e]=vkNow(),s.updateTyping(e)},updateTyping:function(e){var t=function(e,t){return e.getAttribute&&e.getAttribute(t)},n=window.lang,i=ge("dialog_near"+e),o=geByClass1("di_current_peer",i),a=geByClass1("di_typing",i);if(i){var r=[],l=vkNow();if(e>2e9)each(_[e]||{},(function(e,n){t(a,"data-u"+e)&&n&&l-n<6e3&&r.push(e)}));else{var c=_[e];t(a,"data-u"+e)&&c&&l-c<6e3&&r.push(e)}if(r.length){if(1==r.length){var u=r[0],d=t(a,"data-u"+u),f=t(a,"data-s"+u);val(a,'<i class="i_typing"></i>'+(n.mobile_mail_typing[f]||"").replace("{user}",d))}else{each(r,(function(e,n){r[e]=t(a,"data-u"+n)}));var p=r.pop();val(a,'<i class="i_typing"></i>'+(n.mobile_mail_multi_typing||"").replace("{users}",r.join(", ")).replace("{last_user}",p))}o.offsetWidth&&setStyle(a,"minWidth",o.offsetWidth),addClass("di_typing_now",i),setTimeout((function(){addClass("di_typing_animated",i)}),10),setTimeout((function(){s.updateTyping(e)}),2e3)}else val(a,""),setStyle(a,"minWidth",0),removeClass("di_typing_animated",i),removeClass("di_typing_now",i)}},updateOnline:function(t,n){var i=ge("messages"+t);if(i&&remove(geByClass1("di_activity",i)),each(geByClass("_lv"+t,"mcont"),(function(e,t){h(t,n)})),e[t]){if(e[t].write_form){var o=ce("div",{innerHTML:e[t].write_form});each(geByClass("_lv"+t,o),(function(e,t){h(t,n)})),e[t].write_form=val(o)}if(e[t].messages){o=ce("div",{innerHTML:e[t].messages});remove(geByClass1("di_activity",o)),e[t].messages=val(o)}}},updateImportantMessages:function(n,i,o){v({caches:[{storage:t,getter:"page"},{storage:nav.page_get(l("/mail")),getter:"html"}],updater:function(e){var t=geByClass1("dialogs_filter_button_important",e);if(t){var n=intval(val(t))+o;val(t,n),toggleClass("dialogs_filter_without_important",geByClass1("dialogs_filter",e),0===n)}}}),v({caches:[{storage:e,getter:n+".messages"}],updater:function(e){var t=geByClass1("_msg"+i,e);t&&toggleClass("msg_item_important",t,1===o)}})},updateImportantDialog:function(e,n){nav.getQuery("community")&&v({caches:[{storage:t,getter:"page"},{storage:nav.page_get(l("/mail")),getter:"html"}],updater:function(t){var i=geByClass1("_peer"+e,t);i&&toggleClass("dialog_item_important",i,n)}})},markAsListened:function(t){var i=+t.getAttribute("data-msg");if(i&&n){var o=e[n];o&&o.hash&&ajax.post("/mail",{_ajax:1,act:"listen_audiomsg",msg_id:i,hash:o.hash},{onDone:function(){var e=$$('.audio-msg-track[data-msg="'+i+'"]');if(e&&(e.forEach((function(e){e.closest(".im_msg_audiomsg").classList.add("im_msg_audiomsg_listened")})),o&&o.messages)){var t=ce("div",{innerHTML:o.messages}),n=geByClass1("_msg"+i,t),a=$('.audio-msg-track[data-msg="'+i+'"]',n);a&&a.closest(".im_msg_audiomsg").classList.add("im_msg_audiomsg_listened"),o.messages=val(t)}}})}},sendMarkAsRead:function(t,n){isArray(n)||(n=[n]);var i=e[t];i&&i.hash&&ajax.post("/mail",{_ajax:1,act:"mark_read",peer:t,msgs:n.join(","),mark_conversation_as_read:0===n.length,hash:i.hash,community:nav.getQuery("community")},{onDone:function(e){e&&each(n,(function(e,n){s.markAsRead(t,n)}))}})},markAsRead:function(t,n){window.im;var i=ge("messages"+t);if(i){var o=geByClass1("_msg"+n,i);hasClass("_read",o)||removeClass("mi_unread",o);var a=e[t];if(a&&a.messages){var r=ce("div",{innerHTML:a.messages});o=geByClass1("_msg"+n,r);hasClass("_read",o)||removeClass("mi_unread",o),a.messages=val(r)}}},markPeerAsRead:function(n,i,o){var a=ge("messages"+n);if(a&&(each(geByClass("msg_item",a),(function(){if(!o==!hasClass("_unread",this))return!0;+attr(this,"data-id")<=i&&!hasClass("_read",this)&&removeClass("mi_unread",this)})),(u=e[n])&&u.messages)){var r=ce("div",{innerHTML:u.messages});each(geByClass("msg_item",r),(function(){if(!o==!hasClass("_unread",this))return!0;+attr(this,"data-id")<=i&&!hasClass("_read",this)&&removeClass("mi_unread",this)})),u.messages=val(r)}var s=ge("dialogs"),c=o?"di_unread_outbox":"di_unread_inbox";if(s)(u=geByClass1("_peer"+n,s))&&hasClass(c,u)&&(removeClass(c,u),remove(geByClass1("di_unread_cnt",u)));else if(t.page){var u;r=ce("div",{innerHTML:t.page});(u=geByClass1("_peer"+n,r))&&hasClass(c,u)&&(removeClass(c,u),remove(geByClass1("di_unread_cnt",u))),t.page=val(r)}v({caches:[{storage:nav.page_get(l("/mail")),getter:"html"}],updater:function(e){var t=geByClass1("_peer"+n,e);t&&hasClass(c,t)&&(removeClass(c,t),remove(geByClass1("di_unread_cnt",t)))}})},markAsDeleted:function(t,n){var i=ge("messages"+t);if(i){remove(geByClass1("_msg"+n,i));var o=e[t];if(o&&o.messages){var a=ce("div",{innerHTML:o.messages});remove(geByClass1("_msg"+n,a)),o.messages=val(a)}}ajax.click(l(nav.path),extend({no_scroll:!0},Dialogs))},updateMarkAsUnread:function(e,t){v({caches:[{storage:nav.page_get(l("/mail")),getter:"html"}],updater:function(n){var i=$("._peer"+e,n);if(i){i.classList.toggle("di_unread_inbox",t);var o=$(".di_head",i);if(t){var a=$(".di_chat_user",i),r=document.createElement("span");r.classList.add("di_unread_cnt"),r.innerHTML="&nbsp;",o.insertBefore(r,a)}else{var s=$(".di_unread_cnt",i);s&&s.remove()}}}})},addMessage:function(t,n,i,o){if(t<2e9?delete _[t]:_[t]&&delete _[t][i],s.updateTyping(t),!0!==o){if(t&&n&&(d[n]=t),!geByClass1("_msg"+n)){var a=e[t];if(a&&a.messages){a.msgs&&a.msgs.push(n);var r=ce("div",{innerHTML:a.messages});(u=geByClass1("di_activity",r))?(after(cdf(o),u),a.messages=val(r)):a.messages=o+a.messages,(c=ge("messages"+t))&&(val(c,a.messages),s.onMessagesRepainted(!0))}else{var c,u;if(c=ge("messages"+t))(u=geByClass1("di_activity",c))?after(cdf(o),u):val(c,o+val(c))}}}else if(ge("dialogs")&&"/mail"==nav.path){var f=nav.getQuery();f.act||f.offset||f.q||ajax.click(l(nav.path),extend({no_scroll:!0},Dialogs))}},replaceMessage:function(t,n,i,o){var a=ge("messages"+t),r=e[t];if(r&&r.messages){var s=ce("div",{innerHTML:r.messages}),l=geByClass1("_msg"+n,s);l&&(l.outerHTML=o),r.messages=val(s),val(a,r.messages)}else geByClass1("_msg"+n).outerHTML=o},getMsgHTML:function(t,n,i,o,a,r,c,u){var d=window,_=d.vk,f=d.lang,p=2&n?_.id:c&&c.from||i;if(!p)return!1;if(!ge("messages"+i))return!0;if(c.attach1||c.fwd||c.geo||c.emoji)return!1;if(c.source_act)return!1;if(!e[i]||!e[i].hash)return!1;var m="_u"+p,h=geByClass1(m,"mcont","a"),v=stripTags(attr(h,"data-name")||val(h)||""),g=getHref(h),A=geByClass1(m,"mcont","img"),y=A&&A.src||"";if(!v||!g||!y)return!1;i=intval(i),t=intval(t),a=a&&-1==a.toString().indexOf(" ... ")&&i<2e9?a:"";var w,S,b,k=1&n?" mi_unread":"";return!(2&n)&&1&n&&(k+=k?" _unread":""),r=s.wrapLinks(r,n),r=s.wrapMention(r),('<a name="msg{{msgId}}"></a><div  class="msg_item _msg{{msgId}}{{msgClass}}"  data-id="{{msgId}}"  onclick="return MessagesActions.onMessageClick(event);">  <div class="mi_iwrap">    <a class="al{{cl}}" href="{{href}}">      <img src="{{photo}}" class="mi_img {{cl}}" />    </a>  </div>  <div class="mi_cont">    <div class="mi_head">      <a class="mi_date" href="'+l("/mail?act=msg&id={{msgId}}").replace(/\&/g,"&amp;")+'">        {{time}}      </a>      {{edited}}\n      <a class="mi_author al{{cl}} {{cl}}" href="{{href}}" data-name="{{dataName}}">        {{name}}      </a>    </div>    <div class="mi_body">      {{mi_title}}      <div class="mi_text">{{text}}</div>    </div>  </div></div>').replace(/{{msgId}}/g,t).replace(/{{cl}}/g,m).replace(/{{href}}/g,g).replace("{{msgClass}}",k).replace("{{edited}}",u?'<span class="mi_edited">'+f.mobile_mail_edited+"</span>":"").replace("{{photo}}",y).replace("{{time}}",(w=new Date(1e3*o),S=w.getHours(),b=w.getMinutes(),S+":"+(b<10?"0":"")+b)).replace("{{dataName}}",escapeAttr(v)).replace("{{name}}",v.split(" ").shift()).replace("{{mi_title}}",a?'<div class="mi_title">'+a+"</div>":"").split("{{text}}").join(r)},updateStickers:function(){window.cur;var t=window.post,i=e[n];if(i){var o=i.write_form?(a.default.getStickerPanel()||"").split("mail-0").join("mail"+n):"",r=ge("stickers_panel");r&&(replace(cdf(o),r),r=null,t.stickersInit())}},showDialog:function(i,o,r){window.cur;var l=window,c=l.MessagesActions,u=l.Mention,d=l.Dialog,_=window.post;if(c.hasFwdMessages())return c.attachFwdMessages(o),!1;t.scroll_top=scrollTop();var f=e[o];if(f){var m=ce("div",{innerHTML:val("m")}),h=geByClass1("mhb_back",m);if(h&&f.header){var v=ce("div");val(v,f.header),before(v.firstElementChild,h),remove(h)}var g=f.write_form?(a.default.getStickerPanel()||"").split("mail-0").join("mail"+o):"";val(geByClass1("pcont",geByClass1("mcont",m)),f.write_form+g+(o?'<div id="messages'+o+'" class="messages bl_cont">'+(f.messages||"")+'<div id="al_loading"></div></div>':"")),val("m",m.innerHTML),_.stickersInit(),ajax.refreshLinks(f.fv_link,f.app_link),alLoadingFix(),n=o,f;var A=getHref(i);nav.go(A,null,{push_only:!0,no_push:r}),o?(p=null,s.updateTyping(o),ajax.click(A,extend({save:o},d),{scroll:!0})):s.onShowWritePageFromCache(!0),s.onShowDialogFromCache(!0),scrollTop(0,10)}else nav.al_go(f&&f.cur_link||getHref(i)||nav.cur);nav.getQuery("community")&&"unread"===nav.getQuery("ctab")&&removeClass("al_back",geByClass1("mhb_back"));var y=geByClass1("MentionContainer"),w=parseJSON(attr(y,"data-mentions"))||[];return w.length&&u.init({url:!1,appendTo:y,defaultItems:w,items:w,preferDomain:!0}),AudioMessagePlayer.events.on("listened",s.markAsListened),!1},backToDialogs:function(e){if(t.page)nav.go(t.link,null,{push_only:!0,no_push:e}),ajax.click(t.link,extend({no_scroll:!0},Dialogs)),val("m",t.page),ajax.refreshLinks(attr("fv_link","href")||attr("fv_link","data-href"),"vkontakte://vk.com/mail"),n=null,scrollTop(t.scroll_top||0),s.onShowDialogsPageFromCache(!0);else{var i=l(t.link||"/mail");nav.go(i,null,{push_only:!0,no_push:e}),nav.al_go(i)}},actualizeMessagesCornerCounter:function(e){v({caches:[{storage:t,getter:"page"},{storage:nav.page_get(l("/mail")),getter:"html"}],updater:function(t){var n=geByClass1("mhi_notify",t),i=geByClass1("mh_notify_counter",n);i||(i=ce("em",{className:"mh_notify_counter"}),append(i,n)),e?i.innerText=e:n.innerHTML="&nbsp;"}})}}}();function l(e){var t=window.nav.getQuery(),n=t.community,i=t.ctab,o=n&&-1===e.indexOf("community=")?"community="+n:"",a=n&&i&&-1===e.indexOf("ctab=")?"&ctab="+i:"";return o?e+(e.indexOf("?")>=0?"&":"?")+o+a:e}function c(e){return e.replace(/\[(id|club)(\d+)(?:\:([a-z0-9_\-]+))?\|([^\$]+?)\]/g,(function(e,t,n,i,o){return'<a href="/'+(t+n)+'" class="mem_link">'+o+"</a>"}))}window.mail=s,window.makeUrl=l},39757:function(e,t,n){"use strict";var i=n(46769),o=n(3226),a=n(11393),r=n(86205),s=n(92424),l=n(1730),c=n(42368),u={isUploading:!1,onBeforeRemove:(0,o.default)(),onRemove:(0,o.default)("removeElem"),onStart:(0,o.default)(),onError:(0,o.default)("response"),onComplete:(0,o.default)("response"),_uploadData:{},_uploadQueue:[],_readerQueue:[],_processUploadQueue:!1,_processReaderQueue:!1,_isFakeUploading:!1,fallback:function(e,t){var n=window.post;return e&&n.add_attach(e,t),!1},getLastAttachId:function(){if(!ge("attached_wrap"))return 0;var e,t=0;return each(geByTag("input"),(function(){if(e=this.name.match(/^attach(\d+)_type$/i)){var n=intval(e[1]);t<n&&(t=n)}})),t},refreshAttachIds:function(e){var t=ge("attached_wrap");if(t){var n,i=gpeByClass("mr_x_wrap",e),o=geByTag1("input",i),a=intval((o&&o.name.match(/^attach(\d+)(_type)?$/i)||[])[1]);if(gpeByClass("mr_timer",e)){var r=attr("add_post_btn","data-value");r&&val("add_post_btn",r)}else a&&each(geByTag("input",t),(function(){if(n=this.name.match(/^attach(\d+)(_type)?$/i)){var e=intval(n[1]);e==a?this.disabled=!0:e>a&&(this.name="attach"+(e-1)+(n[2]||""))}}))}},startFakeUploading:function(){u._isFakeUploading=!0,u.onStart()},finishFakeUploading:function(){u._isFakeUploading=!1,u.onComplete()},getAttachesCount:function(e){void 0===e&&(e=!0);var t=0;return window.ThumbsEdit&&window.ThumbsEdit.initialized&&e&&(t=ThumbsEdit.getThumbsCount()),t+=geByClass("mr_x_wrap","attached_wrap").length},refreshUploadState:function(e){isUndefined(e)&&(e=u.getAttachesCount(!0));var t=ge("attached_wrap"),n=geByClass1("mr_timer",t),i=geByClass1("pi_medias",t),o=ge("attach_photo_btn");if(toggle(i,e>0||isVisible(n)),toggleClass("attached_wrap_empty",t,e<=0),o){toggleClass("cp_attachBtnEl_sel",o,e>0);var a=geByClass1("inline_upload",o);if(a||(a=geByClass1("inline_upload",o.parentNode)),a){var r=attr(a,"data-max-attaches")||10;a.disabled=e>=r}}show("attached_options"),show("attached_flush")},checkUploading:function(e){return!u._processUploadQueue&&!u._isFakeUploading||cancelEvent(e)},attachedPhotoTpl:function(e){var t=[{id:"upload_item_"+e,class:"medias_thumb thumb_item mr_x_wrap thumb_upload",inner:[{id:"upload_image_"+e,class:"tu_img"},{id:"item_progress_wrap_"+e,class:"tu_progress_wrap",inner:[{id:"item_progress_"+e,class:"tu_progress"}]},{id:"item_cancel_wrap_"+e,class:"tu_cancel_wrap",onclick:"return mediaUpload.reset(this, event, '"+e+"');",inner:[{id:"item_cancel_"+e,class:"tu_progress"}]}]}];return ceFromString(a.default.html(t))},attachedTpl:function(e){void 0===e&&(e={});var t=e,n=t.id,i=t.type,o=["medias_row","mr_x_wrap","thumb_upload"];i&&o.push("attachment_type_"+i);var s=(0,c.getDocument24Icon)(),l={inner:[{inner:[{inner:[{inner:[(0,r.default)({icon:s})],class:"medias_link_icon",tag:"span"}],class:"medias_link_icon",tag:"span"},{inner:[{inner:[e.label],class:"medias_link_labeled medias_link_title",tag:"span"}],class:"medias_link_texts",tag:"span"}],class:"mr_label medias_link",tag:"span"},{inner:[{class:"tu_progress",id:"item_progress_"+n,tag:"div"}],class:"tu_progress_wrap",id:"item_progress_wrap_"+n,tag:"div"},{inner:[{class:"tu_progress",id:"item_cancel_"+n,tag:"div"}],class:"tu_cancel_wrap",id:"item_cancel_wrap_"+n,onclick:"return mediaUpload.reset(this, event, '"+n+"');",tag:"div"}],id:"upload_item_"+n,class:o,tag:"div"};return ceFromString(a.default.html([l]))},onUploadProgress:function(e){var t=ge("item_progress_"+this.id);window.ThumbsEdit&&ThumbsEdit.initialized?ThumbsEdit.onUploadProgress(this.id,e.loaded/e.total*100):setStyle(t,{width:e.loaded/e.total*100+"%",visibility:"visible"})},onUploadComplete:function(e){var t=this,n=e.target.responseText,i=!1;try{i=parseJSON(n)}catch(e){i={error:"ERR_CLIENT_BAD_RESPONSE: bad request response"}}if(i.error)u.onUploadError.call(t,e);else{var o=ThumbsEdit.initialized;t.xhr=ajax.post(t.done_url,{_ajax:1,_query:n,te:intval(o)},{onDone:function(e){var n,i=ge("item_progress_wrap_"+t.id),a=u.getLastAttachId()+1,r=ge("upload_item_"+t.id);if(r&&r.classList.add("thumb_uploaded"),o?(ThumbsEdit.replaceTemp(t.id,e.photo_raw,e.list||"",e.sizes),n=(0,l.$)('[data-media="phototemp_'+t.id+'"]')):n=ge("upload_image_"+t.id),n)if(e.src)var s=ce("img",{id:"upload_image_"+t.id,className:"ph_img",onload:function(){if(o&&(n.src=e.src,n.classList.remove("Thumb__wrap--temp"),n.setAttribute("data-media","photo"+e.photo_raw),n.setAttribute("data-upload",t.id)),replace(s,n),t.iw&&t.ih){if(t.iw>t.ih==s.width>s.height)var i=Math.min(130,Math.floor(75/t.ih*t.iw));else i=Math.min(130,Math.floor(75/t.iw*t.ih));setStyle(s,"width",i)}reflow(s),setStyle(s,"opacity",1)},src:e.src});else{var c=ge("upload_image_"+t.id);setStyle(c,"opacity",1)}var d=t.attach_type||"photo",_=(e.hash,e.photo_raw);t.attach_type&&"photo"!==t.attach_type&&(_=e.owner_id+"_"+e.id),r&&(r.appendChild(ce("input",{type:"hidden",name:"attach"+a,value:_})),r.appendChild(ce("input",{type:"hidden",name:"attach"+a+"_type",value:d}))),setStyle(i,"opacity",0),t.attached=!0,t.delete_url=e.delete_url,u._processUploadQueue||(u.isUploading=!1,u.onComplete(e))}}),addClass("tu_progress_request","item_progress_wrap_"+t.id),t.uploaded=!0,u.uploadQueueNext()}},onUploadError:function(e){clog("upload error.",e.target.responseText),Snackbar.init({text:"blog"===cur.module?lang.mobile_jobs_upload_error:lang.mobile_unknown_error,type:s.SNACKBAR_TYPE_ERROR}),this.id&&u.reset(null,null,this.id),u.uploadQueueNext(),u.onError(e.target.responseText)},uploadFile:function(e){function t(t){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}((function(e){var t,n=e.file_attr_name||"photo",o=JSON.parse(e.upload_params);e.xhr=uploadFile(e.upload_url,(0,i.default)(((t={})[n]=e.file,t),o),{onProgress:bind(u.onUploadProgress,e),onComplete:bind(u.onUploadComplete,e),onError:bind(u.onUploadError,e)})})),readFile:function(e){function t(t){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}((function(e){readFile(e.file,(function(t){var n=ge("upload_image_"+e.id);if(n)var i=ce("img",{id:"upload_image_"+e.id,className:"ph_img",onload:function(){replace(i,n),e.iw=i.width,e.ih=i.height},src:t});u.readerQueueNext()}))})),addFile:function(e){var t,n=ge("attached_wrap"),i=geByClass1("pi_medias",n),o=i?geByClass("medias_thumb",i):[],a=i?geByClass1("medias_row",i):null,r=o[o.length-1],s=e.attach_type||"photo";if(t="photo"===s?u.attachedPhotoTpl(e.id):u.attachedTpl({id:e.id,type:s,label:e.file?e.file.name:""}),n){if(window.ThumbsEdit&&ThumbsEdit.initialized)readFile(e.file,(function(t){var n=ce("img");n.src=t,n.onload=function(){var i=n.width,o=n.height;window.fakeImg=n;var a=getImageOrientation(t);t="/images/blank.gif";var r=!1;a>4&&a<9&&(r=!0);var s=["photo",e.id,{sizes:{temp:[t,r?o:i,r?i:o]}},{remove:e.id}];ThumbsEdit.addTempPreview(s),CreatePost.checkAttaches()}}));else{if(!i){var l=geByClass1("AddedAttach",n);i=ce("div",{className:"pi_medias"}),append(i,l||n)}r?after(t,r):a?before(t,a):append(t,i)}u._processReaderQueue||u.readerQueueNext()}},uploadQueueNext:function(){clog("next upload"),u._processUploadQueue=!0;var e=u.uploadQueueRemove();if(!e)return clog("empty upload"),u._processUploadQueue=!1,void(u.isUploading=!1);u.uploadFile(e)},readerQueueNext:function(){clog("next reader"),u._processReaderQueue=!0;var e=u.readerQueueRemove();if(!e)return clog("empty reader"),void(u._processReaderQueue=!1);u.readFile(e)},queueInsert:function(e){var t=srand();return u.getUploadDataById(t)?u.queueInsert(e):(u._uploadData[t]=extend(e,{id:t}),u._uploadQueue.push(t),u._readerQueue.push(t),u._uploadData[t])},uploadQueueRemove:function(){var e=u._uploadQueue.shift();return!!e&&u.getUploadDataById(e)},readerQueueRemove:function(){var e=u._readerQueue.shift();return!!e&&u.getUploadDataById(e)},getUploadDataById:function(e){return u._uploadData[e]||!1},delUploadDataById:function(e){delete u._uploadData[e]},start:function(e,t){if(!e||!canUploadFile())return u.fallback(e,t);var n=e.files,i=e.form||gpeByTag("form",e),o=submitBtn(i),a=ge("attach_photo_btn"),r=attr(e,"data-upload-url"),s=attr(e,"data-upload-params"),l=domData(e,"file-attr-name"),c=domData(e,"attach-type"),d=attr(e,"data-done-url"),_=attr(e,"data-max-attaches")||10,f=u.getAttachesCount();return r&&d?(each(n,(function(){var e={attach_type:c,file_attr_name:l,upload_url:r,upload_params:s,done_url:d,file:this,uploaded:!1,attached:!1};if(f>=_)return!1;u.queueInsert(e),u.addFile(e),f++})),removeEvent(i,"submit",u.checkUploading),addEvent(i,"submit",u.checkUploading),removeEvent(o,"click",u.checkUploading),addEvent(o,"click",u.checkUploading),removeEvent(a,"click",u.checkUploading),addEvent(a,"click",u.checkUploading),u.refreshUploadState(f),replace(clone(e),e),u._processUploadQueue||u.uploadQueueNext(),window.isNewMail&&u.onStart(),u.isUploading=!0,!1):u.fallback(e,t)},reset:function(e,t,n,i){if(cancelEvent(t),window.isNewMail&&u.onBeforeRemove(e),"/"==n[0]){ajax.post(n,{_ajax:1}),u.refreshAttachIds(e);var o=gpeByClass("mr_x_wrap",e)||gpeByClass("mr_timer",e);i?i():remove(o)}else{var a=n,r=u.getUploadDataById(a);if(!r)return!1;r.attached?r.delete_url&&(ajax.post(r.delete_url,{_ajax:1}),u.refreshAttachIds(e)):(r.xhr&&r.xhr.abort&&r.xhr.abort(),r.loaded||u.uploadQueueNext()),i?i():remove("upload_item_"+a),u.delUploadDataById(a)}return u.refreshUploadState(),window.isNewMail&&u.onRemove(e),Replies.abortTimer("editing"),!1},onUnfoldItemClick:function(e,t){var n=(0,l.$)('[type="file"]',t);e.target!==n&&n.click()}};window.mediaUpload=u},89828:function(e,t,n){"use strict";var i=n(62691),o=n(1730),a=n(42516),r=n(11393),s=n(58107),l=n(54412),c=n(9046),u=!1,d={NEED_MENU_PARAM:"_nlm",NEED_MENU:1,FORCE_NEED_MENU:2,enabled:function(e){return!1},opened:function(){return(0,c.hasClass)("lm_opened",window.bodyNode)},toggle:function(e,t){return(0,c.checkEvent)(e),!0},open:function(e){window.zlayer;return(0,c.checkEvent)(e),!0},close:function(e){return(0,c.checkEvent)(e),!0},fix_size:function(e){var t=(0,c.ge)("l"),n=(0,c.ge)("m"),i=(0,c.ge)("mhead"),o=i&&i.offsetHeight||0,a=d._st||0;t&&n&&(e?n.style.minHeight="0":(a=a>o?a:0,n.style.minHeight=t.offsetHeight+a+"px"),!d.fixed||(0,c.getCw)()<320?e?n.style.marginTop="0":(t.style.minHeight=(0,c.getCh)()+"px",n.style.marginTop=-a+"px"):t.style.minHeight="0")},clear_hover:function(){thover.clear()},hasMenu:function(){return window.al&&window.al.menu},isMenuHasItems:function(){return d.hasMenu()&&(0,c.isArray)(window.al.menu)&&window.al.menu.length||(0,c.isObject)(window.al.menu)&&Object.keys(window.al.menu).length},refreshCounters:function(e){if(!d.hasMenu())return!0;if(!e)return!0;if((0,c.isArray)(e)&&!e.length)return!0;if((0,c.isObject)(e)&&!Object.keys(e).length)return!0;if((0,c.isArray)(e)&&!(0,c.isArray)(window.al.menu))return!1;if((0,c.isObject)(e)&&!(0,c.isObject)(window.al.menu))return!1;if((0,c.isArray)(e)&&e.length!=window.al.menu.length)return!1;if((0,c.isObject)(e)&&Object.keys(e).length!=Object.keys(window.al.menu).length)return!1;void 0!==e[l.COUNTERS_POS_NOTIFICATIONS]&&Tabbar.setCounter(Tabbar.TAB_ID_NOTIFICATION,e[l.COUNTERS_POS_NOTIFICATIONS]),void 0!==e[l.COUNTERS_POS_MESSAGES]&&Tabbar.setCounter(Tabbar.TAB_ID_MESSAGES,e[l.COUNTERS_POS_MESSAGES]);var t=e[l.COUNTERS_POS_NOTIFICATIONS];"number"==typeof t&&isFinite(t)&&(Bell.setCount(t),window.store&&(store.notificationsCount=t));var n=window.al,i=(0,o.$)(".main_menu",document.getElementById("l"));return Object.entries(e).forEach((function(e){var t=e[0],a=e[1];if(void 0===a)return!0;var r=n.menu[t],s=(0,o.$)(".mmi_"+r[0],i),l=(0,o.$)(".mm_item",s),u=(0,o.$)(".mmi_wrap",s),d=(0,o.$)(".mm_counter",u);(0,c.attr)(l,"data-href",!1),a?(r[3]&&(0,c.attr)(l,"href",r[3]),d?(0,c.val)(d,a):(0,c.append)((0,c.ce)("em",{className:"mm_counter",innerHTML:a}),u)):(r[2]&&(0,c.attr)(l,"href",r[2]),(0,c.remove)(d)),ajax.prepare_click(l)})),!0},refreshSingleCounter:function(e,t){var n;d.hasMenu()&&((0,c.isArray)(window.al.menu)&&((n=new Array(al.menu.length))[e]=t),(0,c.isObject)(window.al.menu)&&(n={},Object.entries(window.al.menu).forEach((function(i){i[0];var o=i[1];parseInt(o,10)===parseInt(e,10)?n[o]=t:n[o]=void 0}))),d.refreshCounters(n))},refreshNotifications:function(e){window.store&&(store.menuNotifications=e);var t=(0,o.$)(".mmi_apps .mmi_wrap");if(t){var n=(0,o.$)('[data-id="menu-apps-notification"]',t);!e[l.COUNTERS_POS_APPS]&&n&&n.remove(),e[l.COUNTERS_POS_APPS]&&!n&&(t.innerHTML+=r.default.render((0,s.default)({id:"menu-apps-notification"})))}},refresh:function(e){e=e||{},ajax.refreshLinks(e.fv_link,e.app_link),void 0!==e.pp&&!1!==e.pp&&(0,c.val)("lm_prof_panel",e.pp),void 0!==e.tn&&!1!==e.tn&&(0,c.val)("lm_top_notify",e.tn),void 0!==e.bn&&!1!==e.bn&&(0,c.val)("lm_bottom_notify",e.bn),e.lm&&(0,c.val)("l",e.lm),e.counters&&d.refreshCounters(e.counters),e.notifications&&d.refreshNotifications(e.notifications),e.tab&&Tabbar.setCurrentId(e.tab),e.topbar||(0,c.remove)("vk_topbar")},initEvents:function(){var e=d.getStickedScrollingHandler();e&&((0,c.onBodyScroll)(e),e((0,c.scrollGetY)())),(0,c.onBodyResize)((function(){var t=(0,c.ge)("vk_wrap"),n=t&&t.offsetWidth,i=(0,c.hasClass)("_hfixed",window.bodyNode);n>=882&&d.close(),d.fix_size(!d.opened(),i),e&&e((0,c.scrollGetY)())}))},init:function(){d.fixed=(0,c.hasClass)("_hfixed",window.bodyNode),d.initEvents(),(0,c.addEvent)(window,"orientationchange",(function(){var e=(0,c.ge)("vk_wrap").offsetWidth,t=d._st||0;e>=882&&t>44&&d.close()}));var e=(0,o.$)(".leftMenu__content");e&&(0,a.setScrollView)(e,{topBanner:!!i.default.ipad&&void 0,overscrollY:!1,standalone:!0})},blockScroll:function(e){var t=(0,c.ge)("vk_wrap");d.opened()&&(0,c.getW)(t)<882&&(0,c.preventEvent)(e)},qsOpened:!1,qsOpen:function(){d.qsOpened||(d.qs_st=(0,c.scrollTop)(),(0,c.addClass)("qs_opened","vk_wrap"),(0,c.addClass)("qs_opened",window.bodyNode),(0,c.getW)("vk_wrap")<882&&(0,c.scrollTop)(0),d.qsOpened=!0)},qsClose:function(){d.qsOpened&&((0,c.removeClass)("qs_opened","vk_wrap"),(0,c.removeClass)("qs_opened",window.bodyNode),(0,c.getW)("vk_wrap")<882&&(0,c.scrollTop)(d.qs_st||0),d.qsOpened=!1)},initSearch:function(){u||(u=!0,(0,c.addEvent)("lm_search_items","mousedown touchstart",(function(e){e.stopPropagation()}),{passive:!0}),(0,c.addEvent)((0,o.$)(".head_search",document.getElementById("l")),"mousedown touchstart",(function(e){e.stopPropagation()}),{passive:!0}),(0,c.addEvent)(document,"mousedown touchstart",(function(e){(0,c.ge)("vk_wrap");d.qsOpened&&(d.qsClose(),(0,c.elblur)("lm_search_field"))}),{passive:!0}))},closeSearch:function(){return!0},cancelSearch:function(){return!0},headerAction:function(e,t){return(0,c.getW)("vk_wrap")>=882?nav.go(e,t):d.toggle()},getStickedScrollingHandler:function(){var e=(0,o.$)(".leftMenu__content"),t=document.body;if(e&&t&&t.classList.contains("_hfixed")&&!t.classList.contains("_touch")){var n,i=(0,c.scrollGetY)(),a=(0,c.scrollGetY)(),r=!1,s=function(t,n){void 0===n&&(n=0),e.style.position=t,e.style.top=n+"px",e.style.bottom=""};return function(t){if(!(t<0||t+window.innerHeight>document.body.scrollHeight||(0,c.getCw)()<882)){var o=e.getBoundingClientRect(),l=Math.round(o.top),u=Math.floor(o.height);if(0!==u){var d=document.body,_=document.documentElement;if(u+56>=Math.max(d.scrollHeight,d.offsetHeight,_.clientHeight,_.scrollHeight,_.offsetHeight))s("absolute");else if(!(u+56>_.scrollHeight)){if((t>i||t===i&&t>0)&&(n="down"),t<i&&(n="up"),i=t,u<window.innerHeight)return s("fixed"),void(a=t+l-56);switch(n){case"down":r=u+l<=window.innerHeight;break;case"up":r=0<=l-56}var f,p;r?("down"===n?(f="fixed",void 0===p&&(p=0),e.style.position=f,e.style.top="",e.style.bottom=p+"px"):s("fixed"),a=t+Math.round(e.getBoundingClientRect().top)-56):s("absolute",a)}}else s("absolute")}}}}};window.menu=d},67078:function(e,t,n){"use strict";var i=n(6103),o=n(1358),a=n(86205),r=n(24945),s=n(9046),l=n(1374),c={onChange:se(),onChanged:se(),onReadyOrChanged:se(),onRestore:se(),fast_load:!1,need_hard_go:!1,getHash:function(e){if("#player"===e.hash)return e.path+e.hash;var t=qs2obj(e.params);return delete t.z,e.path+obj2qs(t)},getAlias:function(e){if(!e)return!1;var t=(e||"").split("?"),n=t[0],i=qs2obj(t[1]);return i.from&&delete i.offset,delete i.from,delete i.z,delete i.ref,Object.keys(i).forEach((function(e){0===e.indexOf("_")&&delete i[e]})),n+obj2qs(i)},set:function(e,t,n,a){void 0===n&&(n={});var l=window,u=l.zlayer,d=l.cur,_=l.nav,f=l.menu,p=l.audioplayer,m=$("body.fixed"),h=m?Math.abs(parseInt(getStyle(m,"top"),10)):scrollTop(),v=null;if(window.isNewMail){var g=e.split("?");toggleClass("vk__page_mail",window.bodyNode,(0,r.isNewMailPage)(g[0],g[1]))}u.opened()&&(h=u._st);var A=n.forceUpdate&&t.newHTML,y=!A&&_.hasUpdate(a,e,t),w=!!y||_.needUpdate(a,e,t),S=0;if(!n.force&&!y&&w||A?(S=scrollTop(),v=remove("m"),each(geByClass("_cntr",v),(function(){remove(this)})),each(geByClass("ScrollView",v),(function(){(0,o.unhealScroll)(this)})),remove(geByClass1("_cntrs",v))):each(geByClass("ScrollView",geByClass1("m")),(function(){(0,o.unhealScroll)(this)})),!n.after&&!c.fast_load){var b=c.getHash(_),k=a||t.options||{};a&&a.is_native_back&&(k.prev_tab=k.native_prev),c.save(b,{html:null,st:h,page:v,state:c.stash(),cur:window.cur,options:k},!0)}if(n.before||c.clear(),(n.before||!n.before&&!n.after)&&(window.lm_qsearch_counter?window.lm_qsearch_counter++:window.lm_qsearch_counter=1),n.before){var C=a&&a.target;c.fast_load=!0,C&&addClass("__al_target",C);var E=v.cloneNode(!0);C&&removeClass("__al_target",C);var I=geByClass1("__al_target",E);removeClass("__al_target",I),n.beforeAppend&&n.beforeAppend(E,I),after(E,"l"),scrollTop(S),d.toggleHeaderSearch&&d.toggleHeaderSearch(!1),n.afterAppend&&n.afterAppend(E),f&&f.clear_hover(),f&&f.closeSearch(),f&&f.enabled(!0)}else{a&&a.zProcess&&a.zProcess(0,!0)&&delete a.zProcess;var T=!1;if(a&&_.set(a),c.need_hard_go)return _.hard_go(_.cur,null,{replace:!0});if(!n.force&&!y&&w||A){var M;if(t.title&&(document.title=(0,s.winToUtf)(t.title)),A?((M=ce("div",{className:"layout__basis",id:"m"})).setAttribute("role","main"),val(M,t.newHTML)):(M=t.page)?T=!0:((M=ce("div",{className:"layout__basis",id:"m"})).setAttribute("role","main"),val(M,t.html)),f.opened()){var P=ce("div",{id:"m_helper",onclick:f.close});append(P,M)}after(M,"l")}c.fast_load=!1,thover.clear(),!y&&w&&(t.lm&&f.refresh(t.lm),t.bc&&window.bodyNode&&(window.bodyNode.className=t.bc),u.opened(),a&&a.zProcess?a.zProcess(0,!1)&&delete a.zProcess:u.close()),n.force||(T&&(window.qsearch.isCachedPage=!0),t.js&&evalJs(t.js),T&&(window.qsearch.isCachedPage=!1),t.state&&c.stash(t.state),t.cur&&extend(window.cur,t.cur),a&&(t.options=a),post.wallActionsHide(),c.save(e,t));var L=a?a.nav&&a.nav.hash:_.hash;(y||w)&&(y?Tabbar.showUpdateButton(y.currentCache.d.page):t.st||!L?(scrollTop(t.st),scrollTop(t.st,10)):L?scrollToHash(L):n.no_scroll&&!n.force?(scrollTop(h),scrollTop(h,10)):scrollToHash()),p&&p.initAudio(),AudioMessagePlayer&&AudioMessagePlayer.redrawWaves()}var N=window.Tabs;onBodyResize(N.actualizeShowMoreVisibility),N.actualizeShowMoreVisibility(),(0,i.resizePosters)(),c.onChange(!0,a&&a.nav&&a.nav.push),(n.al_transition||n.restored)&&c.onChanged(!0)},save:function(e,t,n){if(e){var i=window.nav,o=n?i.page_get(e,t.options.prev_tab):{};o&&i.page_set(e,extend(o,t),c.getAlias(e))}},restore:function(e){var t=window.nav,n=t.page_get(e);return n||(n=t.page_get(c.getAlias(e))),!!n&&(c.onRestore(!0),n)},stash:function(e){var t=window.cur;return window.cur&&t.stash&&t.stash(e)||!1},clear:function(){var e=window.cur,t=window.zlayer,n=window.menu,i=window.tooltip;onBodyScroll("__clear"),onBodyResize("__clear"),n&&n.initEvents(),t.isReady&&t.initEvents(),i&&i.clear(),window.cur&&e.destroy&&each(e.destroy,(function(){this()})),window.cur={destroy:[]}},hideHeader:function(e){var t=geByClass1("mhead",e);hide(t)},setMhead:function(e,t,n,i,o){void 0===o&&(o={});var r=geByClass1("mhead",e),s=geByClass1("mhb_logo",r),c=geByClass1("mh_header",e),u=!1,d=window.nav,_=document.body,f=geByClass1("SliderTabs",r),p=geByClass1("header__right",r),m=geByClass1("header__gear",r);f&&remove(f),p&&remove(p),m&&remove(m),removeClass("vk_header_tabs",_);var h="header__title hb_btn mh_header mhi_back";if(o.movable&&(h+=" header__title--movable header__title--initial-position"),n){!0===n?u=d.path+(d.params?"?"+d.params:""):n&&(u=n),t||(t=val(c)||"&nbsp;");var v=geByClass1("mhb_back",e),g="",A=hasClass("mh_nobr",v)?" mh_nobr":"",y=i?' onclick="'+i+'"':"";if("/"==u)g='<div class="hb_wrap mhb_back'+A+'"'+y+'><h1 class="hb_btn mh_header">'+t+"</h1></div>";else{var w=Wd.html((0,a.default)((0,l.getBackOutline28Icon)()));g='\n        <div class="header__center hb_wrap mhb_back '+A+'">\n          <a class="header__back al_back" href="'+escapeAttr(u)+'" accesskey="0" '+y+">"+w+'</a>\n          <h1 class="'+h+'">\n            <div class="header__text">\n                '+t+"\n            </div>\n          </h1>\n        </div>\n      "}if(r&&s){var S=geByClass1("mhb_notify",e);val(r,(window.al&&window.al.menu?'<a href="/" class="hb_wrap mhb_home" accesskey="*" onclick="return menu.toggle(event);"><div class="hb_btn mhi_home">&nbsp;</div></a>':'<a href="/" class="hb_wrap mhb_home mhb_vkhome" accesskey="*"><div class="hb_btn mhi_home mhi_vkhome">&nbsp;</div></a>')+'<div id="header_msgs" class="hb_wrap mhb_notify'+(!S||hasClass("mhb_no_notify",S)?" mhb_no_notify":"")+'">'+val(S)+"</div>"+g)}else v&&(v.outerHTML=g);var b=$(".header__center");b&&b.classList.toggle("is_unfold",$(".Unfold",b))}else t&&val(c,t)}};window.page=c,onDOMReady((function(){c.onReadyOrChanged(!0),c.onChanged((function(){c.onReadyOrChanged(!0)}))})),t.default=c},61876:function(e,t,n){"use strict";n.d(t,{getPaymentIcon:function(){return r}});var i=n(86205),o=n(35909),a=n(83652),r=function(e){switch(e){case"error":return{inner:[(0,o.Icon56ErrorOutline)()],class:"SplashScreen__icon",tag:"div"};case"timeout":return{inner:[(0,o.Icon56RecentOutline)()],class:"SplashScreen__icon",tag:"div"};case"loading":return{inner:[(0,i.default)({icon:(0,a.getLoading40Icon)()})],class:"SplashScreen__icon SplashScreen__icon--loading",tag:"div"};case"success":default:return{inner:[(0,o.Icon56CheckCircleOutline)()],class:"SplashScreen__icon",tag:"div"}}}},73735:function(e,t,n){"use strict";var i=n(46769),o=n(37665),a=n(46950),r=n(94374),s=n(74521),l=n(39161),c=n(86353),u=n(80576),d=n(89359),_=n(46042),f=n(16365),p=n(76073),m=n(1730),h=n(54412),v=n(78466),g=n(3226),A=n(38240),y=n(86900),w=n(42516),S=n(11386);window.photo=function(){var e,t,n,b,k,C,E,I,T,M,P,L=4,N=!1,R={},x={},B={},D=null,O=null,U=!1,H=null,F=null,V=!0,j=0,$=!1,q=!1,W=!1;function G(){if(!(e=(0,m.$)(".PhotoviewPage")))return nav.al_go(nav.cur),!1;if(geByClass1("pv_summary",e),geByClass1("photo_msg",e),I=geByClass1("pv_tag_wrap",e),b=geByClass1("PhotoviewPage__thumb",e),n=geByClass1("pv_nav",b),E=geByClass1("PhotoviewPage__photo",e),C=(0,m.$)(".PhotoviewPage__photo img",b),geByClass1("pv_footer",e),N=hasClass("pv_touch_full",e),n){var t=geByClass1("pv_nav_left",n),i=geByClass1("pv_nav_z",n),o=geByClass1("pv_nav_right",n);T=geByClass1("pv_nav_link",t),P=geByClass1("pv_nav_link",i),M=geByClass1("pv_nav_link",o),attr(T,"onclick","return photo.prev(event);"),attr(M,"onclick","return photo.next(event);"),attr(k,"onclick",!N&&"return photo.next(event);"),ajax.prepare_click([T,M,k])}return removeEvent(window,"orientationchange",te),addEvent(window,"orientationchange",te),removeEvent(window,"keydown",ne),addEvent(window,"keydown",ne),removeEvent(window,"resize",ie),addEvent(window,"resize",ie),PostPhotoRestriction.onClear.off(ie),PostPhotoRestriction.onClear(ie),!0}var Y=!1;function K(){if(!Y){var t=(0,v.getMediaView)();if(!t)throw new Error("Subscribe to mediaview events before load");var n=t.emitter,i=t.actionBridge,o=[];window.clog("Subscribe MediaView events"),Y=!0;var a=function(t){if(!t&&W){!function(e){void 0===e&&(e={});var t=qs2obj(nav.params);delete t.z;var n=!!t.z;if($$(".mediaview_target").forEach((function(e){return e.classList.remove("mediaview_target")})),W=!1,photo.onZLayerToggle(!1),nav.onBeforeGo.off(ce),!e.local&&!e.crop){if(n&&history.length>1&&nav.tryHistoryBack())return clog("History back done"),!1;var i=nav.path+obj2qs(t)+nav.hash;nav.go(i,null,{push_only:!0,replace:!0})}}();var n=qs2obj(nav.params);e&&n.list===O&&oe(j,!0),window.clog("Unsubscribe MediaView events"),Y=!1,o.forEach((function(e){return e()})),(0,A.enableBodyScroll)(),(0,w.restoreDocumentScroll)()}else t&&!W&&(W=!0,photo.onZLayerToggle(!0),(0,w.preventDocumentScroll)({topBanner:!1}),(0,A.disableBodyScroll)((0,m.$)("#MediaView_container")))},r=function(e){var t=se(e);return!!t&&(j=e,ae(e,{no_open:!0,replace:!0}),Promise.resolve({target:t?(0,m.$)('[data-id="'+t.id+'"]'):null}))};n.on("toggle",a),n.on("index_change",r),o.push((function(){n.off("toggle",a),n.off("index_change",r)})),o.push(i.handle("repliesOpen",(function(e){var t=z(e.id);if(!t)return!0;var n=(0,_.a)("/photo"+t.id,{list:O,rev:U?1:0})+"#comments";return nav.go(n,null,{alMode:"photo"})}))),o.push(i.handle("tagClick",(function(e){var t=se(j),n=t.tags,i=t.market_tags;if(e.startsWith("market")){var o=parseInt(e.split("market_")[1]),a=i.tags[o];a.url&&nav.go(a.url)}else{var r=n[e];r&&r[2]&&nav.go(r[2])}}))),o.push(i.handle("onContextMenuOpen",(function(e){e.list;var t=z(e.item);t.actions?d.ContextMenu.open(Wd.elem(t.actions),null,{pureMenu:!0}):clog("Photo has no actions")}))),o.push(i.handle("onBlurRestrictionAccept",(function(e){var t=e.item;return new Promise((function(e,n){var i=z(t),o=i.restriction;if(!o)return e(!1);window.PostPhotoRestriction.clear(null,null,o.text,o.button,"photo"+i.id,o.hash).then((function(t){var n=t.result,i=t.isFullyAvailable;if(e(n),i){var o=D.map((function(e){var t;return"blur"===(null==(t=e.restriction)?void 0:t.type)&&(e.restriction=null),e}));X(O,o,D.length)}}))}))}))),o.push(i.handle("onActionClick",(function(e){var t,n,i=z(e.item);(null==(t=i.market_tags)||null==(n=t.tags)?void 0:n.length)&&((0,y.statlogsValueEvent)(h.STATLOG_MEDIAVIEW_EVENT,"action","market"),window.ItemsList._openItemsPopup(escape(JSON.stringify(i.market_tags.tags))))})))}}function Q(e){var t;void 0===e&&(e=[]);var n=[];return e.id&&(e=[e]),Object.keys(e).forEach((function(t){var i=e[t];if(!i)return!0;n.push(R[i.id]=i)})),Object.keys(x).forEach((function(e){x[e]=x[e].map((function(e){return R[null==e?void 0:e.id]||e}))})),O&&x[O]&&(D=J(O)),null==(t=(0,v.getMediaView)())||t.setItems(Z(D,O)),function(){if(!D)return;var e=D.filter((function(e){return!e||!e.isDeleted}));e.length!==D.length&&(clog("Filter deleted"),delete x[O],X(O,e,e.length))}(),n}function z(e){return R[e]||{}}function X(e,t,n){var i,o;if(null!==t){n=n||len(t),x[e]||(x[e]=new Array(n),x[e].fill(null)),null==(i=(0,v.getMediaView)())||i.setItemsCount(n);var a=x[e];U&&a.reverse(),extend(a,t),Q(t),a=x[e],U?(D=copy(a),a.reverse()):D=a,(0,v.getMediaView)()&&!0!==(null==(o=D[0])?void 0:o.original_src)&&(0,v.getMediaView)().setItems(Z(D,e))}else delete x[e]}function J(e){if("string"!=typeof e)return e;var t=x[e]||[];return U?copy(t).reverse():t}function Z(e,t){return e.map((function(e){return function(e,t){var n,i,o,a,r,s;if(void 0===t&&(t=null),!e)return null;var l=e.tags&&Object.keys(e.tags).map((function(t){var n=e.tags[t];if("number"!=typeof n){var i=n[0];return{layout:"user",id:t,description:"",left:i[0],top:i[1],width:i[2],height:i[3],avatar:n[4],text:(0,p.unescapeString)(n[1]),appereance:{arrow:!!n[2]}}}})).filter((function(e){return!!e})),c=null==(n=e.market_tags)||null==(i=n.tags)?void 0:i.map((function(e,t){return{layout:"market",id:"market_"+t,left:100*e.x,top:100*e.y,width:0,height:0,title:(0,p.unescapeString)(e.title),text:e.price}})),u=null;("block"===(null==(o=e.restriction)?void 0:o.type)||"blur"===(null==(a=e.restriction)?void 0:a.type)&&!window.PostPhotoRestriction.isCleared("photo"+e.id))&&(u={type:e.restriction.type,text:"blur"===e.restriction.type?e.restriction.title:e.restriction.text});var d=document.createElement("div");d.innerHTML=e.description||"",d.innerHTML+=e.caption||"";var _=(0,m.$)(".pi_text_more",d);_&&_.removeAttribute("onclick"),d.remove();var f=e.original_src||e.photo,h=e.photo&&e.original_src&&!0!==e.original_src;return{id:e.id,src:"boolean"==typeof f?"":f,description:d.innerHTML||"",type:1,list_id:t,tags:l,overlayTags:c,restriction:u,hasContextMenu:!0,action:(null==(r=e.market_tags)||null==(s=r.tags)?void 0:s.length)?{icon:null,text:window.lang.mobile_photos_show_market_items}:null,counters:h?{likes:{state:!!e.likes_me,count:+e.likes_cnt},replies:{state:!1,href:"/photo"+e.id+"?list={list_id}",count:+(e.replies_cnt||0)},shares:{count:+e.share_cnt}}:null}}(e,t)}))}function ee(e,t){for(var n in t||(t=D),t){var i;if((null==(i=D[n])?void 0:i.id)==e)return+n}return-1}function te(){nav.hash||onDOMReady((function(){if(geByClass1("photo_view")){var e=scrollTop();b&&getY(b)<e&&scrollToEl(b)}}))}function ne(e){if(zlayer.opened())return!1;switch(e.which){case 37:e.preventDefault(),photo.prev();break;case 39:e.preventDefault(),photo.next()}}function ie(t){e&&document.body.contains(e)&&(document.activeElement&&["INPUT","TEXTAREA"].includes(document.activeElement.tagName)||isVisible((0,m.$)("#stickers_panel"))||oe(j,!0))}function oe(t,n,l){var c=window.cur,u=window.lang,d=D[t],_=1==D.length;if(d){var f;nav.hash?scrollToHash(nav.hash):te();var p={};H&&(p.list=H),U&&(p.rev=1),F&&(p.from=F);var h=obj2qs(p),v="photo"+d.id+h,g=d.photo,A=(se(t-1)||{}).id,y=(se(t+1)||{}).id;if(_||(E&&(E.href="/photo"+y+h),T&&(T.href="/photo"+A+h),M&&(M.href="/photo"+y+h),ajax.prepare_click([T,M,k])),N){var w="photo"+d.id+"/"+H+(U?"/rev":""),S=extend({},p,{z:w}),R="/photo"+d.id+obj2qs(S);if(zlayer._lastNav){var x=zlayer._lastNav;(S=qs2obj(x.params)).z=w,R=x.path+obj2qs(S)+x.hash}P&&(P.href=R),ajax.prepare_click(P),attr(P,"onclick","return photo.fullscreen('"+escapeAttr(R)+"', event);")}if(C&&C.src!=g){C.onload=null,remove(C);var O;O=Wd.html((0,r._PhotoviewPage_tags)(d.tags)),val(E,'<img src="'+(g||"/images/blank.gif")+'" alt="" class="ph_img" />'+O),C=geByTag1("img",E)}toggleClass("photo_deleted",e,!!d.deleted),toggleClass("pv_one_photo",b,1==D.length),val(I,d.tag_info||"");var $=(s.default.getStickerPanel()||"").split("photo-0_0").join("photo"+d.id),q=d.comments_html||"";$&&(q=q.split("\x3c!--stickers_panel--\x3e").join($)),e.classList.toggle("PhotoviewPage--deleted",!!d.isDeleted),e.childNodes[0].setAttribute("id","photo"+d.id);var W=(0,m.$)(".wi_like_wrap",e);W&&(W.innerHTML=d.liked_people||"",W.classList.toggle("is_empty",!d.liked_people));var G,Y=(0,m.$)(".PhotoviewPage__restrictedInfo"),K=!!(d.restriction&&"block"===d.restriction.type||d.restriction&&"blur"===d.restriction.type&&!PostPhotoRestriction.isCleared("photo"+d.id));K&&(G=(0,i.default)({},d.restriction,{forceText:!0,raw:"photo"+d.id,width:getW(E),height:getH(E)}),C.complete||C.onload||(C.onload=ie)),e.classList.toggle("pv_touch--hideZOpen",K),toggle(Y,K),E.classList.toggle("PhotoviewPage__photo--block",!(!G||"block"!==G.type)),E.classList.toggle("PhotoviewPage__photo--blur",!(!G||"blur"!==G.type)),K&&Y&&(Y.innerHTML=Wd.html(PostPhotoRestriction(G)));var Q=(0,m.$)(".wi_buttons",e);val(Q,d.like_buttons||"");var z=(0,m.$)(".AlbumInfoRow",e);z&&(z.outerHTML=Wd.html((0,o.default)({url:d.album_href,author_url:d.author_href,avatar:d.avatar,id:d.owner_id,name:d.owner_name,title:Wd.wrap(d.album_title),subtitle:Wd.wrap(d.album_info_subtitle),withoutBottomBorder:!d.has_replies})));var X=(0,m.$)(".PhotoviewPage__description",e);if(X){d.description&&d.description,X.innerHTML=d.description,X.classList.toggle("PhotoviewPage__description--empty",!d.description)}var J=(0,m.$)(".PhotoviewPage__caption",e);if(J){var Z="";d.caption&&(Z+=d.caption),val(J,Z)}var ee=(0,m.$)(".Replies");ee&&(ee.outerHTML=d.replies_html);var ne=(0,m.$)(".RepliesField"),oe=s.default.getStickerPanel();ne&&d.reply_field_html&&oe&&(ne.outerHTML=d.reply_field_html.replace("\x3c!--stickers_panel--\x3e",oe));var ae=(0,m.$)("#mhead .HeaderSubtitle__subtitle");ae&&(ae.innerHTML=u.mobile_photos_photo_header.replace("%s",j+1).replace(/%s|{count}/,D.length));var re=ge("photo_actions");if(re&&(re.innerHTML=Wd.render(d.actions)),null==(f=nav.getQuery())?void 0:f.description_expanded){var ce=(0,m.$)(".pi_text_more",X);ce&&ce.click()}if(post.stickersInit(),c.replyTo=0,ajax.refreshLinks(d.fv_link,d.app_link),photo.closeTags(),!n){var ue="/"+v;nav.go(ue,null,{no_push:n,push_only:!0,replace:l}),page.save(ue,{st:scrollTop(),page:ge("m"),state:page.stash(),cur:window.cur,options:{replacePrevPage:!0}},!1)}setTimeout((function(){var e=(0,a.getState)("autoload")||{};Replies.init(e.enable||!1,d.author_id||d.owner_id)}))}V||(le(),function(){for(var e=0,t=j+1;e<L;e++){var n=se(e+t),i=n&&n.photo;if(i&&!B[i]){var o=B[i]=new Image;o.src=i,o.onload=function(){B[i]=!0}}}}())}function ae(e,t){void 0===t&&(t={});var n=t,i=n.isDoc,o=n.hash,a=(n.hasVideo,D[e]);D.length;if(!t.no_open||W){if(a){var r=qs2obj(nav.params);if(r.z=i?"doc"+a.id+"/"+o:"photo"+a.id+"/"+H+(U?"/rev":""),t.no_open||setTimeout((function(){var t=(0,v.getMediaView)();t&&(t.setItemsCount(D.length),t.setItems(Z(D,O)),t.setIndex(e),t.open())})),!t.local&&!t.crop){var s=nav.path+obj2qs(r)+nav.hash;nav.go(s,null,{no_push:t.no_push,push_only:!0,replace:t.replace})}}t.local||t.crop||le(!0,i)}}var re=!1;function se(e){if(D)return e>0?e%=D.length:e=(100*D.length+e)%D.length,D[e]}function le(e,n){if(void 0===n&&(n=!1),re)clog("Prevent photos preload");else{for(var i=!1,o=1,a=0;a<5;a++){if(!(l=se(r=a+j))||!l.owner_id){i=r,o=1;break}}if(!1===i)for(a=-1;a>-3;a--){var r,l;if(!(l=se(r=a+j))||!l.owner_id){i=r,o=-1;break}}if(!1!==i){var c=se(j);if(c){re=!0,show(t);var u=window.cur,d=c.owner_id||(c.id||"").split("_")[0],_=r==j&&c.id?(n?"/doc":"/photo")+c.id+(c.hash?"?hash="+c.hash:""):"/photos.php",f={_ajax:1,oid:d,list:O,offset:i,direction:o,rev:U?1:0};s.default.getStickerPanel()||(f.need_stickers=1),nav.getQuery("community")&&(f.community=nav.getQuery("community"));var p=!0===c.original_src||D.every((function(e){return!e||!e.owner_id||!e.max_src}));ajax.post(_,f,{onDone:function(n,i,o,a){var r;if(c=se(j),hide(t),re=!1,o&&(u.replyNames||(u.replyNames={}),extend(u.replyNames,o)),a&&extend(u,a),null==(r=(0,v.getMediaView)())||r.setItemsCount(i),X(O,n,i||D.length),e){var s;if(!W)return!1;p&&(j=ee(c.id)),null==(s=(0,v.getMediaView)())||s.setIndex(j)}else n.some((function(e){return(null==e?void 0:e.id)===c.id}))&&oe(j,!0)},onFail:function(){return hide(t),re=!1,!1}})}else clog("Can't find current photo "+j)}else clog("Preload offset is false")}}function ce(e,t,n){var i,o,a="string"==typeof e?e:e.href,r="string"==typeof a?qs2obj((null==(i=a.split("?")[1])?void 0:i.split("#")[0])||""):{};h.Z_PHOTO_REGEX.test(r.z)||(null==(o=(0,v.getMediaView)())||o.close())}function ue(e,t,n,i,o){D=[];if(e){var a=gpeByClass("thumbs_list",e)||gpeByClass("wiki_body",e)||gpeByClass("thumbs_list",e)||gpeByClass("photos_page",e);a&&$$(".thumb_map_img_as_div, ._image, .ph_img",a).forEach((function(e,t){var n=domData(e,"id"),i=JSON.parse(domData(e,"restriction")),o=unescape(domData(e,"src_big"));if(!n||!o)return!0;var a=(o=o.split("|"))[0]||attr(e,"src"),r=+o[1]||0,s=+o[2]||0;D.push({id:n,original_src:a,width:r,height:s,restriction:i})}))}D.length||D.push({id:t,original_src:!0,isDoc:n,hasVideo:i,hash:o});var r=(0,v.getMediaView)();r&&(r.setItemsCount(D.length),r.setItems(Z(D,O)))}function de(){addClass("pv_icons_hide",b)}return{save:Q,get:z,saveSource:X,getSource:J,getCurrentListID:function(){return O},isZOpened:function(){return W},onZLayerToggle:(0,g.default)(),clear:function(){removeEvent(window,"resize",ie),removeEvent(window,"orientationchange",te),removeEvent(window,"keydown",ne)},open:function(e,t,n,i,o){if(checkEvent(n))return!0;if(!G())return!0;if(U=!1,"/rev"==t.substr(-4)&&(t=t.slice(0,-4),U=!0),F=i||null,t)O=t;else{var a=z(e);O=a.album?"album"+a.album:""}if(H=O,D=J(O),-1===(j=ee(e,D))){if(!(a=z(e)).id)return!1;D=[a],j=0}V=D.length<2,!1;var r=D[j]&&e!=D[j].id;return oe(j,o&&!r,r),!1},prev:function(e){return!!checkEvent(e)||!(re&&!se(j-1))&&(!G()||(V?photo.close():(--j<0&&(j=D.length-1),oe(j),de(),!1)))},next:function(e){return!!checkEvent(e)||!(re&&!se(j+1))&&(!G()||(V||(++j>=D.length&&(j=0),oe(j),de()),!1))},close:function(e,t){return!!checkEvent(e)},fullscreen:function(e,t){return!!hasClass("pv_photo_tags_selected",b)||nav.go(unescapeAttr(e),t,{need_restore:!0})},showIcons:function(){var e=geByClass1("PhotoviewPage","m");if(!e)return!1;setTimeout((function(){removeClass("pv_hidden_icons",e),setTimeout((function(){addClass("pv_icons_hide",e)}),2e3)}),10)},selectTag:function(e,t,n){if(n&&!hasClass("pv_photo_tags_selected",b))return!0;var i=ge("pv_tag"+e),o=geByClass1("pv_tag_selected","pv_photo_tags_wrap"),a=ge("pv_tag_label"+e),r=geByClass1("pv_tag_label_selected","pv_tags_list");return hasClass("pv_tag_selected",i)||(removeClass("pv_tag_selected",o),addClass("pv_tag_selected",i)),hasClass("pv_tag_label_selected",a)?nav.go(a,t):(removeClass("pv_tag_label_selected",r),addClass("pv_tag_label_selected",a),addClass("pv_photo_tags_selected",b),cancelEvent(t),!1)},closeTags:function(e){if(!hasClass("pv_photo_tags_selected",b))return!0;var t=geByClass1("pv_tag_selected","pv_photo_tags_wrap"),n=geByClass1("pv_tag_label_selected","pv_tags_list");return t&&removeClass("pv_tag_selected",t),n&&removeClass("pv_tag_label_selected",n),removeClass("pv_photo_tags_selected",b),cancelEvent(e),!1},openDeletePhotoPopup:function(e,t){if(t){var n=(0,m.$)(".Popup_open");n&&Popup.close(n),e.preventDefault(),e.stopPropagation();var i=(0,f.default)({title:(0,a.getLang)("mobile_photos_delete_confirm_title"),text:(0,a.getLang)("mobile_photos_delete_confirm_text"),buttons:{yes:{text:(0,a.getLang)("mobile_delete"),href:t,onClick:"return ajax.click(this, PhotoDelete)"},no:{text:(0,a.getLang)("mobile_cancel")}}}),o=Wd.elem(i);return Popup.open(o,!0)}},init:function(e,t,n,i,o,a,r){L=isUndefined(r.preload)?1:r.preload,U=!!o,photo.saveSource(e,t,n),onDOMReady((function(){photo.open(i,e+(o?"/rev":""),null,a,!0)}))},zopen:function(e,t,n,i,o){if(void 0===o&&(o={}),checkEvent(t))return!0;if(l.SAKIntegration.isIntegrated)return l.SAKIntegration.sendMessage("photo",{id:n+"_"+(o.key||"")}),!1;if(t&&t.isTrusted&&!o.forceUnauth&&!window.vk.id&&(0,c.partConfigEnabled)("unauthorized_media_layer_box")&&document.querySelector(".PageBottomBanner--unauth"))return o.forceUnauth=!0,window.Unauthorized.showMoreBox(null,0,u.UnauthorizedSourceType.PHOTO,(function(){window.photo.zopen(e,t,n,i,o)})),!1;var a=o,r=a.isDoc,s=a.hasVideo,d=a.hash,f=(i||"").split("/"),p=f[0],m=f[1];return(q?Promise.reject():$?Promise.resolve():(window.clog("MediaView loading started"),(0,v.fetchMediaView)().then((function(){$=!0,(0,y.statlogsValueEvent)(h.STATLOG_MEDIAVIEW_EVENT,"init","photo");var e=J(O);e&&X(O,e,e.length),window.clog("MediaView loading done")})).catch((function(e){throw window.clog("MediaView loading failed"),e})))).then((function(){if(U="rev"===m,delete qs2obj(nav.params).z,F=o.from||!1,p)O=p;else{var t=z(n);O=t.album?"album"+t.album:""}H=O,(D=J(O))[0]&&D[0].isDoc&&D[0].hasVideo!==s&&(D=[]);var i=!!(0,v.getMediaView)();if(!D.length&&i&&ue(e,n,r,s,d),-1===(j=ee(n,D))&&i&&(ue(e,n,r,s,d),j=ee(n,D)),-1===j){if(!(t=z(n)).id)return!0;D=[t],j=0}V=D.length<2,!1;var a=D[j]&&n!=D[j].id;ae(j,{no_push:o.no_push&&!a,replace:a,local:o.local,showControls:o.showControls,isDoc:r,hasVideo:s,hash:d,wrap:e}),(0,g.onEmitOnce)(nav.onBeforeGo,ce),K(),uRegisterFloatBtn.hide()})).catch((function(e){q=!0,(0,S.logError)(e,{environment:"mobile_photo"}),console.error(e),n&&window.open((0,_.a)("/photo"+n,{list:p,rev:"rev"===m?1:0}),"_blank")})),cancelEvent(t),!1},openExternal:function(e,t){(0,y.statlogsValueEvent)(h.STATLOG_MEDIAVIEW_EVENT,"init","external"),(0,v.fetchMediaView)().then((function(n){var i=n.open,o=n.setItems,a=n.setIndex;o(e.map((function(e){return{src:e,type:1}}))),a(t),i()}))},zclose:function(e,t){return uRegisterFloatBtn.show(),!!checkEvent(e)}}}()},35576:function(e,t,n){"use strict";var i,o,a=n(3226),r=n(6915),s=n(1730),l=n(19102),c=n(53859),u=n(9046),d=n(46950),_=n(33713),f=n(74521),p=n(11393),m=n(8948);onDOMReady((function(){f.default.onStickerPanelUpdate((function(){if(cur.waitingStickerPanel)clog("Show sticker panel after waiting"),h.stickersToggle(null,!0);else if("mail"!==cur.module){var e=(0,s.$)("#stickers_panel");(0,u.domData)(e,"need-update",1),e&&"none"!==e.style.display&&h.stickersToggle(null,!1)}})),(0,l.initReactionsOnboarding)()}));var h={curGif:null,onStickersTabSelected:(0,a.default)(),onStickerClick:(0,a.default)(),onStickersInit:se(),onReplyClick:se(),add_attach:function(e,t){var n=window.al;remove("feed_extra_field");var i=gpeByTag("form",e),o=ce("input",{id:"feed_extra_field",type:"hidden",name:"add_attach",value:2});if(i){var a=!1;if(each(i,(function(e,t){if("submit"===t.type)return a=t,!1})),a)return append(o,i),window.al&&n.ver?nav.go(a,t):i.submit()}return!0},saveDraft:function(e,t,n,i){if(e&&e.preventDefault(),!i||!i.classList.contains("CreatePostButtons__item--disabled")){var o=ge("feed_add_form"),a=qs2obj(nav.params),s={act:"post",save_draft:1,redirect:n,hash:t};a.comment&&(s.comment=a.comment),each(o.elements,(function(e,t){if(!["submit","file"].includes(t.type)){if((0,r.isFieldIgnored)(t))return;s[t.name]="checkbox"===t.type?(+t.checked).toString():t.value}})),ajax.post(window.nav.path,s)}},toggleActions:function(e,t){var n=gpeByClass("post_item",e);return toggleClass("pi_actions_opened",n),cancelEvent(t),!1},wallActions:function(e,t){var n=window.tooltip,i=gpeByClass("_audioPlaylist",e)||gpeByClass("wall_item",e)||gpeByClass("post",e);if(!i)return!0;if(hasClass("wi_actions_opened",i))removeClass("wi_actions_opened",i),n.hide();else{var o=geByClass1("wi_actions_wrap",i),a=geByClass1("wi_actions",o),r=geByClass1("wi_actions_btn",i);h.wallActionsHide(),addClass("wi_actions_opened",i);var s=getY(i)+45+getH(a)+7,l=scrollTop()+getCh();toggleClass("wi_actions_top",o,s>l),n.addHandler(h.wallActionsHide),n.show(o,r)}return cancelEvent(t),!1},wallActionsHide:function(){var e=window.tooltip;removeClass("wi_actions_opened",geByClass1("wi_actions_opened")),e.hide()},wallPostOpen:function(e,t){var n=gpeByClass("wall_item",e),i=geByClass1("wi_date",n);return!i||nav.go_after(i,t)},toggleGif:function(e,t,n,o){return void 0===o&&(o=!1),!e||(!!checkEvent(t)||(clearInterval(i),hasClass("current_gif",e)?h.hideGif(e,t,o):(o||Gif.autoplayTest(),h.showGif(e,t,n,o))))},hidePlayingGifs:function(e,t){geByClass("current_gif","mcont").forEach((function(n,i){n!==e&&h.hideGif(n,!1,t)}))},showGif:function(e,t,n,a){var r=window.cur;if(!e)return!0;if(checkEvent(t))return!0;if(n){if(r.loadedGifs||(r.loadedGifs={}),!r.loadedGifs[e.href]&&!confirm(n))return!1;r.loadedGifs[e.href]=!0}if(clearInterval(i),!a){var l=getY(e),c=scrollTop();scrollTop(c-(l-getY(e)))}geByClass("current_gif","mcont").forEach((function(e,t){h.hideGif(e,!1,a)}));var u=!hasClass("not_mp4",e)&&Gif.isMp4Supports()&&e.href.includes("&mp4"),d=function(t,n){hasClass("current_gif",e)&&(e.classList.remove("gif_loading"),e.classList.add("gif_opened"),"VIDEO"===o.tagName&&document.body.contains(o)?o.play():append(o,e),h.curGif=e,n&&n())};if(u){var _=geByClass1("ph_img",e).src;(o=(0,s.$)("video.gif_original",e)||ce("video",{src:e.href,className:"gif_original",loop:!0,muted:!0,autoplay:!0,poster:_})).setAttribute("playsinline",!0),o.setAttribute("webkit-playsinline",!0),o.setAttribute("controls",!0),o.controls=!1,o.readyState>=2&&"VIDEO"===o.tagName?(e.classList.remove("gif_loading"),e.classList.add("gif_opened"),o.play(),d()):o.load()}else o=ce("img",{src:e.href,className:"gif_original"});return e.classList.add("current_gif"),e.classList.contains("gif_opened")||e.classList.add("gif_loading"),u?o.oncanplay=function(){e!==h.curGif&&(statlogsValueEvent("gif_play",0,"mp4",null,a?1:0),d())}:i=setInterval((function(){o.complete&&(statlogsValueEvent("gif_play",0,"gif",null,a?1:0),d(),clearInterval(i))}),100),t&&!t.defaultPrevented?cancelEvent(t):void 0},hideGif:function(e,t,n){if(void 0===n&&(n=!1),!e)return!0;if(checkEvent(t))return!0;if(removeClass("current_gif",e),removeClass("gif_opened",e),removeClass("gif_loading",e),geByClass("gif_original").forEach((function(e){"VIDEO"===e.tagName?e.pause():remove(e)})),!n){var i=Gif.getState(),o=i.currentAutoplayElement,a=i.ignore;o===e&&(a.push(e),Gif.setState("ignore",a))}return h.curGif=null,t&&!t.defaultPrevented?cancelEvent(t):void 0},replyNamesRE:function(){var e=window.cur;if(!e.replyNames)return!1;var t=[];return each(e.replyNames,(function(){t.push(escapeRE(this[0]))})),new RegExp("^("+t.join("|")+")")},stickerPanelInit:function(){if((0,s.$)("#stickers_panel"))return!0;var e=!1;if("mail"===cur.module&&window.isNewMail)e=(0,s.$)(".uMailWrite__popupStickers").childNodes[0];else{var t=(0,s.$)(".RepliesField_wrap")||((0,s.$)(".create_post")||{}).parentNode;if(!t)return!1;e=(Array.from(t.children).find((function(e){return!(!e||!e.nextSibling||e.nextSibling.nodeType!==Node.COMMENT_NODE)}))||{}).nextSibling}if(e&&e.nodeType===Node.COMMENT_NODE){var n,i=f.default.getStickerPanel();if(!i)return!1;var o=document.createElement("div");return o.innerHTML=i,e&&(n=e).after.apply(n,o.childNodes),e&&e.remove(),h.stickersInit(),!0}return!1},stickersInit:function(){if(!window.isNewMail||!geByClass1("messenger")){var e=window.cur,t=window.Scroller,n=(0,s.$)("#stickers_panel");if(!n)return!h.stickerPanelInit()||(h.stickersInit(),"cached");var i=geByClass1("sp_body",n),o=geByClass1("sp_stickers_tabs",n);e.scroller&&e.scroller.destroy(),e.scroller=new t(i,{byPage:!0}),e.scroller.init(),e.destroy.push((function(){e.scroller.destroy()})),e.tabScroller&&e.tabScroller.destroy(),e.tabScroller=new t(o),e.tabScroller.init(),e.destroy.push((function(){e.tabScroller.destroy()})),h.onStickersInit(!0)}},replyTo:function(e,t,n,i,o){var a=window.cur;if(checkEvent(e))return!0;n=n||0,removeClass("nc_current_reply",geByClass1("nc_current_reply"));var r=ge("nc_form"),s=ge("nc_message"),l=geByClass1("nc_reply_name",r),c=gpeByClass("near_btn",l),u=ge("nc_reply_as"),d=val(s),_=h.replyNamesRE();if(n){var f=ge(t+"_"+n),p=getY(f)+getH(f),m=scrollTop();after(r,f),addClass("nc_current_reply",geByClass1("pi_reply_wrap",f)),scrollTop(m+getY(f)+getH(f)-p);var v=a.replyNames[i]||{},g=v[0]||"",A=v[1]||"";d=d?_?d.replace(_,g):d:g,h.onReplyClick(!0,g)}else{append(r,geByClass1("wall_replies")),scrollToEl(r);A="";d=_?d.replace(_,""):d}return val(s,replaceEntities(d)),val(l,A),toggle(c,n),u&&(val(u,+o),toggleClass("cp_post_as_group",r,+o)),val("nc_reply_to",n),a.replyTo=n,elfocus(s),!1},stickersToggle:function(e,t){var n=window.cur;if(!f.default.getStickers())return f.default.checkStickers(),!0;isUndefined(t)&&(t=!isVisible("stickers_panel")),!t&&n.waitingStickerPanel&&delete n.waitingStickerPanel;var i=ge("write_form")||ge("nc_form"),o=ge("stickers_panel"),a=geByClass1("cp_sticker_btn",i);if(!o){var r=h.stickersInit();if("cached"===r)return h.stickersToggle(e,t);if(!0===r)return n.waitingStickerPanel=!0,void f.default.checkStickers()}if(n.waitingStickerPanel&&delete n.waitingStickerPanel,!t&&(0,u.domData)(o,"need-update")){var l=(0,d.getState)("target")||safeGet(window.store,"mail.cur.peerId"),c=f.default.getStickerPanel(l),_=document.createElement("div");_.innerHTML=c;var p=(0,s.$)(".stickers_panel",_);o.innerHTML=p.innerHTML,h.stickersInit()}return toggle(o,t),toggleClass("cp_sticker_btn_sel",a,t),t&&n.tabScroller&&n.tabScroller.onShow(),n.onStickersToggleCallbacks&&n.onStickersToggleCallbacks.forEach((function(e){return e(t)})),!1},scrollIntoStickersView:function(){var e=ge("stickers_panel");return isVisible("stickers_panel")&&setTimeout((function(){var t=Tabbar.isFixedToBottom()?Tabbar.getHeight():0,n=e.getBoundingClientRect(),i=n.top,o=n.height,a=scrollTop()+i+o+t-window.innerHeight;scrollTop(a)}),200),!1},saveCurrentStickersPanelToCache:function(){var e=(0,s.$)(".stickers_panel");if(e){var t=safeGet(window.store,"mail.cur.peerId"),n=((0,d.getState)("target")||"").toString()||(t?"mail"+t:"");if(n){var i=f.default.getStickerPanel(),o=document.createElement("div");o.innerHTML=i,(0,s.$)(".stickers_panel",o).innerHTML=e.innerHTML.replace(new RegExp(n,"g"),"mail0"),f.default.saveStickerPanel(o.innerHTML)}}},stickersClick:function(e,t){var n=f.default.getStickers();return n&&n[t]?(window.isNewMail&&"/mail"===location.pathname&&(window.uMailWrite.drawStickers(),window.uMailWrite.openStickersPanel()),h.stickersToggle(null,!0),h.stickersSelectTab(null,t)):nav.go(e)},stickersStoreOpen:function(e){var t=window.cur;return setTimeout((function(){f.default.checkStickers({force:!0})}),1e3),ajax.click(e,!1,{url_params:{reply_to:t.replyTo||0}})},fromStickerToObject:function(e){return{id:e[0],size:e[1],url:e[2],animationUrl:e[3],recent:e[4],ref:e[5]}},fromObjectToSticker:function(e){return[e.id,e.size,e.url,e.animationUrl,e.recent,e.ref]},getTarget:function(){var e=((0,d.getState)("target")||"").toString();if(e)return e;var t=safeGet(window.store,"mail.cur.peerId");return t?"mail"+t:null},getStickersTabHTML:function(e){var t=(f.default.getStickers()||{})[e]||{},n=t.title,i=t.can_gift,o=t.stickers,a=window.isNewMail?16:8,r=[];if(o&&o.length)for(var s=0;s<o.length/a;s++)r.push(o.slice(s*a,s*a+a));var l=r.map((function(e){return e&&(0,u.isArray)(e)?'\n        <div class="sp_page scroller_page">\n          <div class="stickers_list">\n            '+e.map((function(e){var t=h.fromStickerToObject(e),n=t.id,i=t.size,o=t.url,a=t.animationUrl,r=t.recent,s=t.ref,l="",c="";return a&&(l=" sticker_animation",c='\n          data-animation-path="'+a+'"\n          data-uniq-id="'+Date.now()+Math.round(1e8*Math.random())+'"\n          data-sticker-id="'+n+'"\n          data-loop-count="3"\n          ontouchstart="StickersAnimation.touchStartSticker(this);"\n          ontouchend="StickersAnimation.touchEndSticker(this);"\n        '),'\n          <div class="sticker_item'+(" sticker"+n)+'">\n            <a class="sticker_thumb thumb_item'+l+'" '+(' onclick="return post.sendSticker(this, '+n+", "+Boolean(r)+", '"+s+"');\"")+" "+c+'>\n              <img src="'+o+'" class="th_img sticker_img" height="'+i+'"/>\n            </a>\n          </div>\n        '})).join("\n")+"\n          </div>\n        </div>\n      ":""})).join("\n"),c='\n        <div class="sp_page scroller_page">\n          <div class="stickers_list">\n            <div class="stickers_null">'+getLang("mobile_common_stickers_no_recent")+"</div>\n          </div>\n        </div>\n    ",d=r.map((function(e,t){return'\n        <span class="sp_ppt '+(0===t?"sp_ppt_sel":"")+'" data-i="'+t+'">\n            <span class="sp_pptw"></span>\n        </span>\n      '})).join("\n"),_=(0,m.StickersKeyboardPackHeader)({packId:e,canGift:i,title:n,target:h.getTarget()});return'\n        <div class="sp_cont scroller_wrap">\n          '+(_?p.default.html(_):"")+'\n          <div class="scroller_cont">\n            '+(o&&o.length?l:c)+'\n          </div>\n        </div>\n        <div class="sp_pages_pts">\n            '+(r.length>1?d:"")+"\n        </div>\n      "},stickersSelectTab:function(e,t){var n=window.cur;if(!window.isNewMail&&n.tabScroller&&!n.tabScroller.canClick())return!1;var i=ge("stickers_panel"),o=geByClass1("sp_body",i),a=geByClass1("sp_tab_selected",i);n.scroller&&n.scroller.destroy(),val(o,h.getStickersTabHTML(t)),n.scroller&&n.scroller.init(),e||(e=geByClass1("sp_tab"+t,i)),removeClass("sp_tab_selected",a),addClass("sp_tab_selected",e);var r=getY(i),s=r+getW(i),l=scrollTop(),c=l+getCh();return(r<l||s>c)&&scrollToEl(i),n.tabScroller&&n.tabScroller.showElem(e),StickersAnimation&&StickersAnimation.loadAutoplayAnimationStickers(),h.saveCurrentStickersPanelToCache(),window.isNewMail&&h.onStickersTabSelected(),!1},addRecentSticker:function(e,t,n){window.cur;var i=gpeByClass("sticker_item",e);if(f.default.getStickers()&&i){var o=Object.keys(f.default.getStickers()).reduce((function(e,n){return e||f.default.getStickers()[n].stickers.find((function(e){return h.fromStickerToObject(e).id===t}))}),null);if(!o)throw new Error("Sticker "+t+" not found");var a=h.fromStickerToObject(o),r=a.id,l=a.size,c=a.url,u=a.animationUrl,d=(f.default.getStickers()[-1]||{}).stickers,p=void 0===d?[]:d;(p=p.filter((function(e){return h.fromStickerToObject(e).id!==r}))).unshift(h.fromObjectToSticker({id:r,size:l,url:c,animationUrl:u,recent:1,ref:"recent"})),p=p.filter((function(e,t){return t<(window.isNewMail?16:8)})),f.default.setStickerTab(-1,p);var m=-1;if(!n){var v=(0,s.$)(".stickers_panel .sp_tab_selected"),g=v&&v.className.split(" ").find((function(e){return/sp_tab.([0-9])*/.test(e)})).split("sp_tab")[1];(0,_.isNumber)(+g)&&(m=+g)}h.stickersSelectTab(!1,m)}},sendSticker:function(e,t,n,i){if(window.isNewMail&&h.onStickerClick(t,i))return h.addRecentSticker(e,t,!1),!1;var o=window.cur;if(o.scroller&&!o.scroller.canClick())return!1;h.stickersToggle(e,!1);var a=ge("write_submit"),r={lock:!0,url_params:{media:"sticker"+t,_af:srand()}};if(n&&!i&&(r.url_params.media_from="recent"),o.ref&&(r.url_params.ref=o.ref,o.ref=void 0),o.refSource&&(r.url_params.ref_source=o.refSource,o.refSource=void 0),!i){var s=attr(e,"href");s&&(i=s.split("sticker_referrer=")[1].split("&")[0])}return i&&(r.url_params.sticker_referrer=i),h.addRecentSticker(e,t,n),a?ajax.click(a,extend({save:!0},Dialog),r):(a=ge("nc_submit"))?(Replies.getCurrentTimestamp()||Replies.setCurrentTimestamp(-1),setTimeout((function(){Replies.setCurrentTimestamp(0)}),0),ajax.click(a,{},r)):void 0},toggleMarkAsAds:function(e,t){var n=(0,s.$)("input[name='from_group']");if(n&&!n.checked)return cancelEvent(t);var i=(0,s.$)("input",e);if(i.disabled)return cancelEvent(t);var o=(0,s.$)("input[name='mute_notifications']");o&&(o.checked=i.checked,o.disabled=i.checked),h.checkCopyright()},toggleDonut:function(e,t){var n=(0,s.$)("input[name='from_group']");if(!n||n.checked){var i=(0,s.$)("#feed_add_form"),o=(0,s.$)('input[name="donut_only"]'),a=(0,s.$)("#select-donut-duration"),l=(0,s.$)('[name="'+c.POST_PARAM_DONUT_DURATION+'"]',i),d=!o.checked,_=(0,s.$)("input",a);(0,r.setFieldIgnored)(l,d),a.classList.toggle("PostSelect--hidden",d),(0,u.domData)(_,"ignore-field",d);var f=(0,s.$)("input[name='marked_as_ads']");if(f){var p="1"===(0,u.domData)(f,"value");o.checked?((0,u.domData)(f,"value",f.checked?"1":"0"),f.checked=!1):((0,u.domData)(f,"value",null),f.checked=p),f.disabled=o.checked}}},toggleSender:function(e,t){t.stopPropagation(),t.preventDefault();var n=e.querySelector("input"),i={group:[],user:["marked_as_ads","signed","close_comments","mute_notifications","donut_only"]},o=(0,s.$)("input[name='marked_as_ads']");(0,s.$)("input[name='donut_only']");$$(".Control.Control_type_switcher.Row").forEach((function(e){if(!hasClass("Control__blocked",e)){var t=e.querySelector("input[name]");if("from_group"!==t.name)(n.checked&&!i.group.includes(t.name)||!n.checked&&i.user.includes(t.name))&&(t.disabled=!n.checked),"mute_notifications"===t.name&&o&&o.checked&&(t.disabled=!0);else{var a=(0,s.$)(".header__user"),r=(0,s.$)(".header__group"),l="header_hidden",c=(0,s.$)("#select-timer"),u=(0,s.$)("input[name=postpone]"),d=(0,s.$)("input#add_post_btn");if(n.checked?(a.classList.add(l),r.classList.remove(l),c.style.display="inline-block",u.disabled=!1):(a.classList.remove(l),r.classList.add(l),c.style.display="none",u.disabled=!0),d){var _=d.value;d.value=d.dataset.value,d.dataset.value=_}}}})),h.checkCopyright()},checkCopyright:function(){var e=(0,s.$)("input[name='marked_as_ads']"),t=(0,s.$)("input[name='from_group']"),n=ge("select-copyright"),i=(0,s.$)('input[name="copyright"]'),o=(0,s.$)(".create_post__source-option");if(n){var a=(0,s.$)(".Btn",o),r=(0,s.$)(".Btn__text",a);e&&e.checked&&(!t||t.checked)?(hide(n),attr(a,"disabled",!0),o.classList.add("create_post__source-option--disabled"),r.innerHTML=getLang("mobile_wall_post_copyright_add_button")):(attr(a,"disabled",!1),o.classList.remove("create_post__source-option--disabled"),i.value?(setStyle(n,"display","inline-block"),r.innerHTML=getLang("mobile_wall_post_copyright_edit_button")):r.innerHTML=getLang("mobile_wall_post_copyright_add_button"))}}};t.default=h,window.post=h},54773:function(e,t,n){"use strict";var i=n(46950),o=n(85489),a=n(86205),r=n(89911),s=n(63602),l=n(35909);function c(e){var t=["ai_controls"];e.position&&t.push("ai_has_position");var n=e.can_del?"true":"false",o="return window.audioplayer.morePopup(event, '"+e.audio_id+"', '"+e.access_key+"', "+n+");",a=e.is_authenticated?"audioplayer.setPosition(this, event);":null,r=e.is_authenticated?"audioplayer.sliderMove(event);":null,s=e.is_authenticated?"audioplayer.sliderUp(event);":null,c="aic_line";e.is_authenticated||(c+=" aic_line_blocked");var d=["ai_chart_info_state"],_="";switch(e.chart_info_state){case"new_release":d.push("ai_chart_info_state-new_release"),_=(0,l.Icon16New)();break;case"no_changes":d.push("ai_chart_info_state-no_changes"),_=(0,l.Icon16Minus)();break;case"moved_up":d.push("ai_chart_info_state-moved_up"),_=(0,l.Icon16Up)();break;case"moved_down":d.push("ai_chart_info_state-moved_down"),_=(0,l.Icon16Down)();break;case"crown":d.push("ai_chart_info_state-crown"),_=(0,l.Icon16Crown)();break;default:_=""}return(e.chart_info_position||_)&&t.push("ai_controls_chart"),{inner:[{inner:[u(e),e.has_actions_menu?{inner:[{class:"i_pointer",tag:"i"},{class:"ai_menu_toggle_button",onClick:o,"aria-label":(0,i.getLang)("mobile_more"),tag:"button"}],class:"ai_menu_wrap",tag:"div"}:null,{inner:[e.chart_info_position||_?{inner:[e.chart_info_position?{inner:[e.chart_info_position],class:"ai_chart_info_position",tag:"div"}:null,_?{inner:[_],class:d,tag:"div"}:null],class:"ai_chart_info",tag:"div"}:null,e.duration?{inner:[e._duration_title],class:"ai_dur","data-dur":e.duration,onClick:"audioplayer.switchTimeFormat(this, event);",tag:"time"}:null,{inner:[{inner:[Wd.wrap(e.title),e.subtitle?{inner:[Wd.wrap(e.subtitle)],class:"ai_subtitle",tag:"span"}:null],class:"ai_title",tag:"span"},e.title?{inner:[Wd.wrap(" &ndash; ")],class:"divider",tag:"span"}:null,{inner:[Wd.wrap(e.artist)],class:"ai_artist",tag:"span"}],class:"ai_label",tag:"div"},{type:"hidden",value:e.url,tag:"input"}],class:"ai_body",tag:"div"}],class:"ai_info",tag:"div"},{inner:[{inner:[{inner:[{inner:[{inner:[{class:"aic_ln aic_back_line",onClick:"cancelEvent(event);",tag:"div"},{class:"aic_ln aic_load_line",onClick:"cancelEvent(event);",tag:"div"},{inner:[{inner:[{class:"aic_slider",onClick:"cancelEvent(event);",tag:"div"}],class:"aic_ln aic_progress_line",onClick:"cancelEvent(event);",tag:"div"}],class:"aic_ln aic_pl_wrap",onClick:"cancelEvent(event);",tag:"div"}],class:c,onTouchStart:e.is_mobile?a:null,onMouseDown:e.is_mobile?null:a,onTouchMove:e.is_mobile?r:null,onTouchEnd:e.is_mobile?s:null,onTouchCancel:e.is_mobile?s:null,onMouseMove:e.is_mobile?null:r,onMouseUp:e.is_mobile?null:s,onClick:"cancelEvent(event);",tag:"div"}],class:"aic_progress_wrap",tag:"td"},{inner:[{inner:[{class:"aic_ln aic_back_line",onClick:"cancelEvent(event);",tag:"div"},{inner:[{inner:[{class:"aic_slider",onClick:"cancelEvent(event);",tag:"div"}],class:"aic_ln aic_progress_line",onClick:"cancelEvent(event);",tag:"div"}],class:"aic_ln aic_pl_wrap",onClick:"cancelEvent(event);",tag:"div"}],class:"aic_line",onTouchStart:e.is_mobile?"audioplayer.setVolume(this, event);":null,onMouseDown:e.is_mobile?null:"audioplayer.setVolume(this, event);",onTouchMove:e.is_mobile?"audioplayer.sliderMove(event);":null,onTouchEnd:e.is_mobile?"audioplayer.sliderUp(this, event);":null,onTouchCancel:e.is_mobile?"audioplayer.sliderUp(this, event);":null,onMouseMove:e.is_mobile?null:"audioplayer.sliderMove(event);",onMouseUp:e.is_mobile?null:"audioplayer.sliderUp(event);",onClick:"cancelEvent(event);",tag:"div"}],class:"aic_volume_wrap",tag:"td"}],tag:"tr"}],class:"row_table",tag:"table"}],class:t,tag:"div"}],tag:"div"}}function u(e){var t=e.is_playlist_forced?", true":"",n="audioplayer.playPause(event, '"+e.audio_id+"'"+t+");",o="",c=e.has_cover?(0,a.default)((0,r.getPlayOnCover24Icon)()):(0,l.Icon24Play)(),u=e.has_cover?(0,a.default)((0,s.getPauseOnCover24Icon)()):(0,l.Icon24Pause)();return e.has_cover&&!e.cover_style&&(o={inner:[(0,l.Icon28SongOutline)()],class:"ai_cover_placeholder",tag:"span"}),{inner:[o,{inner:[c],class:"i_play","aria-label":(0,i.getLang)("mobile_audio_player_play")+" "+(0,i.getLang)("mobile_audio_single_title"),tag:"span"},{inner:[u],class:"i_pause","aria-label":(0,i.getLang)("mobile_audio_player_pause")+" "+(0,i.getLang)("mobile_audio_single_title"),tag:"span"}],class:"ai_play",style:e.cover_style,onClick:n,tag:"button"}}t.default=function(e){var t=e.is_playlist_forced?", true":"",n=e.is_disabled?"":"audioplayer.playPause(event, '"+e.audio_id+"'"+t+")",a=e.classes||[],r={};r[e.audio_id]=!0;var s=[o.default.class("audio_item",r,"_"),e.is_no_progress&&"ai_noProgress",e.is_focus&&"ai_focus",e.is_explicit&&"audio_item_explicit",e.is_disabled&&"audio_item_disabled",(e.can_add||e.can_del)&&"ai_has_btn",!e.has_actions_menu&&"ai_no_menu",e.has_cover&&"ai_has_cover"];e.is_attachment&&s.push("ai_select");var l=(0,i.mergeArrays)(s,a).filter((function(e){return e})).join(" ");return e.is_attachment?{inner:[c(e)],"data-id":e.audio_id,class:l,"data-audio":e.serialized,href:e.attachment_action,tag:"a"}:{inner:[c(e)],"data-id":e.audio_id,"data-playlist-id":e.playlist_id,class:l,onClick:n,"data-audio":e.serialized,tag:"div"}}},45150:function(e,t,n){"use strict";n.d(t,{AudioPopup:function(){return o}});var i=n(61124);function o(e){var t=null;if(e.action_button){var n=e.action_button;t={class:"AudioPopup__actionButtonWrapper",inner:{class:["AudioPopup__actionButton","button"],onclick:n.onclick,href:n.href,inner:n.text}}}var o=["AudioPopup"];e.popupClass&&o.push(e.popupClass);var a={class:"AudioPopup__content",inner:[{class:"AudioPopup__title",inner:e.title},{class:"AudioPopup__description",inner:e.description},t,e.additional_link]};return new i.default({content:a,class:o.join(" ")})}},44767:function(e,t,n){"use strict";var i=n(1730);window.AudioSpecialForYou={selector:".AudioSpecialForYou",setPlaying:function(e){var t=(0,i.$)(o.special);t&&t.classList.toggle(a,e)}};var o={special:window.AudioSpecialForYou.selector},a="AudioSpecialForYou_playing"},82727:function(e,t,n){"use strict";n.d(t,{VoiceMessagePlayer:function(){return a}});var i=n(35909),o=n(46950);function a(e){return void 0===e&&(e={}),{inner:[{inner:[{inner:[(0,i.Icon16Play)()],class:"audio-msg-track--playIcon",tag:"div"},{inner:[(0,i.Icon16Pause)()],class:"audio-msg-track--pauseIcon",tag:"div"}],class:"audio-msg-track--btn audio-msg-track--btnSvg",tag:"button"},{inner:[(0,o.formatDuration)(e.duration)||"0:00"],class:"audio-msg-track--duration",tag:"div"},{inner:[{class:"audio-msg-track--wave",tag:"svg"}],class:"audio-msg-track--wave-wrapper",tag:"div"}],class:"audio-msg-track audio-msg-track--preview clear_fix voicemsg0",onClick:"AudioMessagePlayer.togglePlay(this);cancelEvent(event);","data-duration":e.duration,"data-mp3":e.url,"data-ogg":e.url,"data-wave":e.wave,tag:"div"}}},79241:function(e,t,n){"use strict";n.d(t,{VoiceMessagePlayer:function(){return i.VoiceMessagePlayer}});var i=n(82727)},62195:function(e,t,n){"use strict";var i=n(9046),o=(0,i.need)("page"),a=(0,i.need)("audio"),r=(0,i.need)("onDOMReady"),s=(0,i.need)("audioplayer"),l=(0,i.need)("AudioSpecialForYou");function c(){d(),a.subscribe([a.events.INIT,a.events.SELECT,a.events.PAUSE],d),o.onChange(d)}function u(e){var t=e.$btn;f()?s.playPause():s.playFirst(null,t),s.onPlay(d),s.onPause(d)}function d(){l.setPlaying(a.playing()&&f())}window.uAudioBlock={},r(c),window.uAudioBlock._onSpecialPlayAllClick=u;var _=null;function f(){var e=a.getCurrentPlaylistId();if(!_){var t=document.querySelector(window.AudioSpecialForYou.selector);t&&(_=t.querySelector(".AudioPlaylistRoot").dataset.playlistId)}return!!_&&e===_}},63766:function(e,t,n){"use strict";var i,o=n(9046),a=n(46950),r=n(86658),s=n(91687),l=n(11393),c=n(22770),u=n(86205),d=n(98173),_=(i="audioPlaylist__add_added",{_onMorePopupClose:function(e){return this.expand&&this.expand(),s.default.close(e)},morePopup:function(e,t){var n=parseInt((0,o.attr)(t,"data-owner_id"),10),i=parseInt((0,o.attr)(t,"data-playlist_id"),10),r=(0,o.attr)(t,"data-publish_href"),u="true"===(0,o.attr)(t,"data-is_followed"),d=(0,o.attr)(t,"data-follow_hash"),_=(0,o.attr)(t,"data-can_share"),f=d?"/audio?act=follow_playlist&playlist_owner_id="+n+"&playlist_id="+i+"&hash="+d:"";s.default.open(l.default.elem((0,s.default)({id:"more-"+n+"-"+i,on_overlay_click:["return AudioPlaylist._onMorePopupClose","this"],close:!0,onClose:["return AudioPlaylist._onMorePopupClose","this"],items:[d&&n!==window.vk.id&&(0,s.ModalMenuBtn)({url:f,class:u?" audioPlaylist__add_added":"",inner:[{inner:u?(0,a.getLang)("mobile_playlist_unfollow"):(0,a.getLang)("mobile_playlist_follow"),tag:"span",class:"audioPlaylistSnippet__buttonText"}],attrs:{"data-playlist_owner_id":n,"data-playlist_id":i,"data-hash":d,"data-follow_text":(0,a.getLang)("mobile_playlist_follow"),"data-unfollow_text":(0,a.getLang)("mobile_playlist_unfollow")},onclick:"return AudioPlaylist.followPlaylist(event, this);"}),_&&(0,s.ModalMenuBtn)({url:r,inner:(0,a.getLang)("mobile_like_publish_title"),onclick:'return AudioPlaylist._onMorePopupClose(this) || nav.go("'+r+'");'})]})),!0),this.expand=(0,c.expandPopup)(e.target)},playPause:function(e,t){(0,o.preventEvent)(e);var n=(0,o.gpeByClass)("_audioSnippet",t),i=(0,o.geByClass1)("audio_item",n);window.audioplayer.playPause(e,(0,o.attr)(i,"data-id")),(0,o.toggleClass)("audioSnippet__playpause_paused",t)},followPlaylist:function(e,t){(0,o.preventEvent)(e);var n=(0,o.attr)(t,"data-playlist_owner_id"),a=(0,o.attr)(t,"data-playlist_id"),s=(0,o.attr)(t,"data-hash"),l=(0,o.geByClass1)("_audioPlaylistsPage__item"+n+"_"+a),c=t.querySelector(".audioPlaylistSnippet__buttonText"),u=(0,o.hasClass)(i,t);c&&(c.innerText=u?(0,o.attr)(t,"data-follow_text"):(0,o.attr)(t,"data-unfollow_text")),(0,o.toggleClass)("audioPlaylistsPage__item_removed",l,u),(0,o.toggleClass)(i,t),function(e){r.default.post("/audio",{_ajax:1,act:"follow_playlist",playlist_owner_id:(0,o.attr)(e,"data-playlist_owner_id"),playlist_id:(0,o.attr)(e,"data-playlist_id"),hash:(0,o.attr)(e,"data-hash")},{redirectToLoginPage:!0})}(t);for(var d=document.querySelectorAll('button[data-owner_id="'+n+'"][data-playlist_id="'+a+'"][data-follow_hash="'+s+'"]'),_=0;_<d.length;_++)(0,o.attr)(d[_],"data-is_followed",u?"false":"true")},tplSearchBlockItem:function(e){return'<div class="audioPlaylists__item">\n              <a href="'+e.href+'" class="audioPlaylists__itemLink al_playlist">'+e.title+'</a>\n              <span class="audioPlaylists__itemCover" style="'+e.thumb_style+'">'+e.grid_covers+'</span>\n              <span class="audioPlaylists__itemTitle">'+e.title+'</span>\n              <span class="audioPlaylists__itemAuthor">'+e.author_name+'</span>\n              <span class="audioPlaylists__itemStats">'+e.short_stats+"</span>\n            </div>"},tplSearchBlock:function(e,t,n,i){return e?'<div class="audioPlaylists">\n                <div class="audioPlaylists__header">\n                  <div class="audioPlaylists__cell">\n                    <div class="audioPlaylists__title">'+n+'</div>\n                  </div>\n                  <div class="audioPlaylists__cell">'+i+'</div>\n                </div>\n                <div class="audioPlaylists__body _preventMenuOpen">\n                  <div class="audioPlaylists__items">\n                    '+e+"\n                  </div>\n                </div>\n              </div>":""},tplSearchListItem:function(e,t){void 0===t&&(t=!1);var n='<div class="audioPlaylistsPage__cell audioPlaylistsPage__cell_actions">\n                <div class="audioPlaylistsPage__menu ai_menu_wrap">\n                  <button class="ai_menu_toggle_button" onclick="AudioPlaylist.morePopup(event, this);" data-owner_id="'+e.owner_id+'" data-playlist_id="'+e.id+'" data-publish_href="'+e.publish_href+'" data-is_followed="'+e.is_followed+'" data-follow_hash="'+e.follow_hash+'" aria-label="'+(0,a.getLang)("mobile_more")+'" aria-haspopup="true" aria-expanded="false" aria-controls="more-'+e.owner_id+"-"+e.id+'"></button>\n                </div>\n             </div>\n             '+e.actions;t&&(n='<div class="audioPlaylistsPage__cell audioPlaylistsPage__cell_actions">\n                   <div class="audioPlaylistsPage__menu ai_menu_wrap">\n                     <button class="ai_menu_toggle_button"></button>\n                   </div>\n                 </div>');var i=e.grid_covers;return i||e.thumb_style||(i=l.default.html({class:"audioPlaylistsPage__coverPlaceholder",inner:(0,u.default)((0,d.getPlaylistOutline36Icon)())})),'<div class="audioPlaylistsPage__item _audioPlaylistsPage__item'+e.owner_id+"_"+e.id+'">\n              <div class="audioPlaylistsPage__cell audioPlaylistsPage__cell_link">\n                <a href="'+e.href+'" class="audioPlaylistsPage__itemLink">'+e.title+'</a>\n                <span class="audioPlaylistsPage__container">\n                  <span class="audioPlaylistsPage__cell audioPlaylistsPage__cell_cover">\n                    <span class="audioPlaylistsPage__cover" style="'+e.thumb_style+'">'+i+'</span>\n                  </span>\n                  <span class="audioPlaylistsPage__cell audioPlaylistsPage__cell_desc">\n                    <span class="audioPlaylistsPage__title">'+e.title+'</span>\n                    <span class="audioPlaylistsPage__author">'+e.author_name+'</span>\n                    <span class="audioPlaylistsPage__stats">'+e.short_stats+"</span>\n                  </span>\n                </span>\n              </div>\n              "+n+"\n            </div>"},tplSearchListNull:function(e){return'<div class="audioPlaylistsPage__notFound">\n              '+e+"\n            </div>"},tplPlaylistsPage:function(e,t){return void 0===t&&(t=""),'<div class="PageBlock">\n              <div class="audioPlaylistsPage">\n                <div class="audioPage__search">\n                  '+t+'\n                </div>\n                <div class="audioPlaylistsPage__list _si_container" id="au_search_playlist_items">\n                  '+e+"\n                </div>\n              </div>\n            </div>"},tplPlayerSearch:function(e,t){void 0===e&&(e=""),void 0===t&&(t=!1),(0,o.escapeAttr)(e),(0,a.getLang)("mobile_audio_search_btn");var n=function(e,t){return void 0===e&&(e=""),void 0===t&&(t=""),'<div class="audioPage__search">\n              <div class="hp_block">\n                '+e+'\n                <div class="qsearch">\n                  <table class="row_table">\n                    <tr>\n                      <td class="row_table_main_column">\n                        <div class="qs_field_wrap">\n                          <div class="iwrap">\n                            <input id="au_search_field" type="text" class="textfield qs_textfield" name="q" placeholder="'+(0,a.getLang)("mobile_audio_search_placeholder_simple")+'">\n                          </div>\n                        </div>\n                      </td>\n                      <td class="row_table_last_column">\n                        '+t+"\n                      </td>\n                    </tr>\n                  </table>\n                </div>\n              </div>\n            </div>"};return t?n():function(e,t,n){return'<form action="/audio" class="qsearch" onsubmit="return cur.au_search.go(event);">'+e(t,n)+"</form>"}(n)},copyValue:function(e,t){var n=(0,o.val)(e),i=(0,o.ge)(t+"_field");(0,o.val)(i,n),cur&&cur[t]&&cur[t].go();var a=(0,o.geBySel1)(".audioPage__tabs .tab_item_cur");a&&(0,o.toggleClass)("tab_item_cur_noactive",a,n)}});window.AudioPlaylist=_},16283:function(e,t,n){"use strict";n.d(t,{RestrictionSplash:function(){return r}});var i=n(17656),o=n(82470),a=n(9046),r=function(){function e(){this.initPopup(),this.popup&&(this.connectEvents(),this.initSlider(),e.sendStat("show_screen"))}e.sendStat=function(e){(0,a.statlogsValueEvent)("audio_onboarding",e)};var t=e.prototype;return t.initPopup=function(){var e=document.querySelector(".audioRestrictionSplash");e&&(this.popup=i.default.open(e,!0,{forceScrollDisable:!0}))},t.connectEvents=function(){var t=this;this.popup.querySelectorAll(".audioRestrictionSplash__closeIcon").forEach((function(n){n.addEventListener("click",(function(n){(0,a.gpeByClass)("audioRestrictionSplash__firstScreen",n.target)?e.sendStat("skip_1screen"):(0,a.gpeByClass)("audioRestrictionSplash__secondScreen",n.target)&&e.sendStat("skip_2screen"),t.close()}))})),this.popup.querySelector(".audioRestrictionSplash__explain").addEventListener("click",(function(){return e.sendStat("click_more")})),this.popup.querySelector(".audioRestrictionSplash__continueFreeLink").addEventListener("click",(function(){e.sendStat("continue_free"),t.close()})),this.popup.querySelector(".audioRestrictionSplash__continueButton").addEventListener("click",(function(){t.slider.next(),e.sendStat("next_1screen")})),this.popup.querySelector(".audioRestrictionSplash__specialLink").addEventListener("click",(function(){return e.sendStat("get_offer")}))},t.initSlider=function(){this.screens=this.popup.querySelector(".audioRestrictionSplash__screens"),this.slider=(0,o.default)(this.screens,{dots:!0,speed:500})},t.close=function(){i.default.close(this.popup)},e}()},72775:function(e,t,n){"use strict";var i=n(1730),o=n(9046),a=(0,o.need)("scrollToEl");(0,o.need)("page").onChange(s);var r=function(e){return".Anchor#"+e};function s(){var e=window.nav&&window.nav.cur;if(e)try{var t=e.split("#")[1],n=t&&!~t.indexOf("=")&&(0,i.$)(r(t));n&&a(n)}catch(e){console.error(e)}}},12779:function(e,t,n){"use strict";var i=n(46769),o=n(9046),a={_onCloseClick:function(e){e.stopPropagation(),e.preventDefault(),(0,o.remove)((0,o.geByClass1)(a.class.btn))},class:{btn:"FloatBtn"}};a.class=(0,i.default)({},a.class,{open:a.class.btn+"_open"}),t.default=a},43027:function(e,t,n){"use strict";var i=n(12779);t.default=i.default},66274:function(e,t,n){"use strict";var i=n(1730),o=n(86658),a=n(49751),r=n(47295),s=n(9046);window.LoadMore={setUrl:f,destroy:p},LoadMore._strategy={replace:{onFail:b,onSuccess:function(e){var t=e.response;d.outerHTML=t,p()}},padsExtend:{onFail:b,onSuccess:function(e){var t=e.response,n=t.pads,i=t.nextPageUrl;Object.keys(n).forEach((function(e){var t=n[e];r.Pad.addContent(e,t)})),i?f(i):p()}}},LoadMore._onButtonClick=m,onDOMReady(h),page.onChange(h);var l=".LoadMore",c=".LoadMore__button",u="_loadMore_loading",d=null,_=null;function f(e){_.setAttribute("href",e)}function p(e){d.remove(),d=null,_=null,g()}function m(){S()||A()}function h(){if(d=(0,i.$)(l)){var e=window.cur;_=d.$(c),v(0),(0,s.onBodyScroll)(v),e.destroy.push(g)}}function v(e){if(d&&!S()){var t=(0,s.getY)(d),n=(0,s.getCh)();t-(e+n)<2*n&&A()}}function g(){(0,s.onBodyScroll)("__clear",v)}function A(){w(!0);var e=_.getAttribute("href");o.default.post(e,{_ajax:1},{onDone:function(e){return y(e,!0)},onFail:function(e){return y(e,!1)}})}function y(e,t){if(w(!1),d){var n=t?"data-success-handler":"data-fail-handler";n=d.getAttribute(n),Wd.handle(n,{$loadMore:d,response:e}),d=null,_=null,g(),h()}}function w(e){_&&d&&(a.default.setLoading(_,e),d[u]=e)}function S(){return d&&d[u]}function b(e){console.error("LoadMore: failed to load more",e)}},49742:function(e,t,n){"use strict";var i=n(49751),o=n(91033);t.default=function(e){return void 0===e&&(e={}),"file"===e.type?function(e){void 0===e&&(e={});var t=window.lang,n=e.accept;return(0,o.default)({inner:[(0,i.default)({inner:[{type:"file",name:e.name,id:e.id,attrs:n,style:"display: none;",onchange:"MobileInput.onChange(event, 'file')",tag:"input"},{inner:[t.mobile_upload_btn],class:"MobileInput__text",tag:"span"}],tag:"label",type:"button",theme:"secondary"})],class:"MobileInput MobileInput--file",style:{small_paddings:!0}})}(e):{}}},86176:function(e,t,n){"use strict";var i=n(17999),o=n(9046),a=n(1730),r=function(){function e(){}return e.findButtonInEvent=function(e){return e.target.closest(".Btn")},e.onChange=function(t,n){if(void 0===n&&(n=""),"file"===n){var r=t.target.files;if(r&&r[0]){var s=(0,i.replaceEntities)(r[0].name),l=e.findButtonInEvent(t),c=(0,a.$)(".MobileInput__text",l);(0,o.val)(c,s)}}},e}();t.default=r},9616:function(e,t,n){"use strict";var i=n(49742),o=n(86176);window.MobileInput=o.default;i.default},86229:function(e,t,n){"use strict";var i=n(85489);t.default=function(e){var t=e.items?e.items:[];return{inner:[(t=t.filter((function(e){return e}))).map((function(e){var t=i.default.class("OwnerInfo__row",{extraMargin:e.extraMargin,gray:e.gray,black:e.black});return{inner:[e.href?{inner:[{inner:[e.left],class:"OwnerInfo__rowLeft",tag:"div"},e.center?{inner:[e.center],class:"OwnerInfo__rowCenter",tag:"div"}:null],href:e.href,class:"OwnerInfo__rowInfo",tag:"a"}:{inner:[{inner:[e.left],class:"OwnerInfo__rowLeft",tag:"div"},e.center?{inner:[e.center],class:"OwnerInfo__rowCenter",tag:"div"}:null],class:"OwnerInfo__rowInfo",tag:"div"},e.right?{inner:[e.right],class:"OwnerInfo__rowRight",tag:"div"}:null],class:t,tag:"div"}}))],class:i.default.class("OwnerInfo",{noMargin:e.noMargin}),tag:"div"}}},62493:function(e,t,n){"use strict";var i=n(86229);i.default;window.OwnerInfo=i.default},54989:function(e,t,n){"use strict";n(91033)},65834:function(e,t,n){"use strict";n(54989)},31129:function(e,t,n){"use strict";var i=n(46950),o=n(50775),a=n(86205),r=n(23696),s=n(97786),l=n(35909),c=n(80540);t.default=function(e){var t=e.img?e.img:"",n=!!e.url&&e.url,u=!!e.innerHref&&e.innerHref,d=e.title?e.title:"",_=e.subtitle?e.subtitle:"",f=!!e.verified,p=e.mix?e.mix:"",m=e.type||null,h=e.online?e.online:"",v=!!e.actions&&e.actions,g=e.link?e.link:null,A=!!e.attrs&&e.attrs,y=!!e.linkAttrs&&e.linkAttrs,w=!!e.icon&&e.icon,S="artist"!==m||t?null:{inner:[(0,l.Icon28MusicMicOutline)()],class:"OwnerRow__placeholderWrapper",tag:"div"},b=e.style||{},k=e.titleIcon?e.titleIcon:null,C=(0,i.getAvatarMode)({id:e.owner_id,name:e.owner_name});return{inner:[(0,o.MaybeLink)({inner:[{inner:[w||{inner:[(0,c.Avatar)({mode:C,backgroundTheme:e.owner_id,text:e.owner_name,textLength:(0,i.getAvatarTextLength)(e.owner_id),size:44,src:t,href:u}),h?h.mobile?{inner:[{inner:[(0,a.default)({icon:(0,r.getOnlineMobileComposite16Icon)()})],class:"mlvi_default",tag:"span"},{inner:[(0,a.default)({icon:(0,s.getOnlineMobileCompositeMuted16Icon)()})],class:"mlvi_muted",tag:"span"}],class:"lvi mlvi OwnerRow__online OwnerRow__online--mobile","aria-label":(0,i.getLang)("mobile_accessibility_profile_online"),tag:"b"}:{class:"lvi OwnerRow__online","aria-label":(0,i.getLang)("mobile_accessibility_profile_online"),tag:"b"}:null,S],class:"OwnerRow__img",tag:"div"}],class:"OwnerRow__left",tag:"div"},{inner:[{inner:[(0,o.MaybeLink)({inner:[d],href:u,class:"OwnerRow__title"}),f?{class:"OwnerRow__verified",tag:"div"}:null,k],class:(0,i.classNames)("OwnerRow__header",{"OwnerRow__header--verified":f}),tag:"div"},{inner:[_],class:"OwnerRow__subtitle",tag:"div"}],class:"OwnerRow__right",tag:"div"},g?{inner:[g],class:"OwnerRow__link",tag:"div"}:null],class:"OwnerRow__content",href:n,attrs:y}),v?{inner:[v],class:"OwnerRow__actions",tag:"div"}:null],attrs:A,onClick:e.onClick,class:(0,i.classNames)("OwnerRow",{OwnerRow_actions:!!v,"OwnerRow--noPadding":b.no_padding},p),tag:"div"}}},93817:function(e,t,n){"use strict";var i=n(31129);t.default=i.default,window.OwnerRow=i.default},47295:function(e,t,n){"use strict";n.d(t,{Pad:function(){return o}});var i=n(1730),o={addContent:function(e,t){t&&(0,i.$$)(a(e)).forEach((function(e){var n=e.$(r)||e;e.classList.remove(s),n.insertAdjacentHTML("beforeend",t)}))}};window.Pad=o;var a=function(e){return'.Pad[data-id="'+e+'"]'},r=".Pad__content",s="Pad_empty"},28090:function(e,t,n){"use strict";n(81755),n(46950),n(35909)},17633:function(e,t,n){"use strict";n.d(t,{toggleVisibility:function(){return c}});var i=n(86205),o=n(81755),a=n(1730),r=n(22770),s=n(28813),l=n(80947);function c(e,t,n){void 0===n&&(n=!1),(n?(0,a.$$)(".PasswordInput .PasswordInput__button"):t).forEach((function(e){setTimeout((function(){var t="true"===e.getAttribute("aria-expanded"),n=(0,o.getNative)(e.closest(".TextInput"));e.setAttribute("aria-expanded",t?"false":"true"),n.setAttribute("type",t?"password":"text"),e.innerHTML=Wd.html((0,i.default)({icon:t?(0,s.getViewOutline24Icon)():(0,l.getHideOutline24Icon)()}))}),0)}));var c=t.closest(".TextInput"),u=(0,a.$)(".TextInput__native",c),d=document.activeElement===u||c.classList.contains("TextInput--focused");function _(){!d||(0,r.isTabbing)()?(e.preventDefault(),e.stopPropagation(),t.focus()):u.focus()}_(),setTimeout((function(){return _()}))}},19682:function(e,t,n){"use strict";n.d(t,{toggleVisibility:function(){return i.toggleVisibility}});n(28090);var i=n(17633)},8006:function(e,t,n){"use strict";var i=n(62561),o=n(72592);t.default=function(e){return(0,o.default)({attrs:e.attrs,mix:i.default.class(e.mix,"ScrollView"),inner:e.inner})}},1358:function(e,t,n){"use strict";n.d(t,{unhealScroll:function(){return d}});var i=n(9046),o=n(1730),a=n(42516);n(28708).isIOS&&window.MutationObserver&&document.addEventListener("DOMContentLoaded",l);var r=".ScrollView",s="_scrollViewHealed";function l(){(c(),document.body)&&new MutationObserver(c).observe(document.body,{childList:!0,subtree:!0})}function c(){var e,t;(null==(e=window.Speech)||null==(t=e.recorder)?void 0:t.isRecording)||(0,o.$$)(r).forEach(u)}function u(e){if(!e[s]){e[s]={};var t=getComputedStyle(e),n=parseInt(t.paddingTop,10),o=parseInt(t.paddingBottom,10);e.style.paddingTop=n+1+"px",e.style.paddingBottom=o+1+"px",_(e),(0,a.setScrollView)(e,{override:!1}),(0,i.hasClass)("messenger__body",e)||(0,i.addEvent)(e,"scroll",p),(0,i.addEvent)(e,"scroll",f)}}function d(e){e[s]&&(e[s]=null,e.style.paddingTop="",e.style.paddingBottom="",(0,a.cleanScrollView)(e),(0,i.removeEvent)(e,"scroll",p),(0,i.removeEvent)(e,"scroll",f))}function _(e){var t=e.scrollTop;t<0||(0===t?e.scrollTop+=1:t+e.offsetHeight===e.scrollHeight&&(e.scrollTop-=1))}function f(e){var t=e.target,n=t[s];n&&(n.timer&&clearTimeout(n.timer),n.timer=setTimeout((function(){t[s]&&_(t)}),50))}function p(){onBodyScroll(!0)}},87712:function(e,t,n){"use strict";var i=n(8006);n(1358);t.default=i.default,window.ScrollView=i.default},87879:function(e,t,n){"use strict";var i=n(1730),o=n(11393);window.SearchPanel={setQuery:function(e,t){var n=(0,i.$)(l(e));t=t||"",n.value!==t&&(n.value=t,_(n,t))}},SearchPanel._onInput=u,SearchPanel._onClearClick=d,SearchPanel._onFocus=c;var a="SearchPanel_hasQuery",r=".SearchPanel",s=".SearchPanel__input",l=function(e){return'.SearchPanel[data-id="'+e+'"] .SearchPanel__input'};function c(){}function u(e,t){var n=e.value;_(e,n),o.default.handle(t,{query:n})}function d(e,t){var n=e.closest(r).$(s);n.value="",n.oninput(),o.default.handle(t)}function _(e,t){e.closest(r).classList.toggle(a,!!t)}},9873:function(e,t,n){"use strict";var i=n(11393);window.Select={},Select._onChange=a,Select._onClick=r;var o=function(e){return'.Select__option[value="'+e+'"]'};function a(e,t){var n=e.value,a=e.form,r=e.$(o(n));i.default.handle(t,{$select:e,$option:r,$form:a,value:n,name:e.name,label:r.textContent})}function r(e,t){i.default.handle(t,{$select:e})}},84597:function(e,t,n){"use strict";var i=n(9046),o=n(1730);window.SliderTabs={},SliderTabs._onClick=m,onDOMReady(p),page.onChange(d),page.onRestore(_);var a="SliderTabs",r="Slider__scroll",s="SliderTabs__tab_selected",l={active:".SliderTabs__tab_selected",tab:".SliderTabs__tab",scroll:"."+r,container:"."+a},c="",u=0;function d(){var e=(0,i.ge)(c),t=(0,o.$)(l.container);e?(0,o.$)(l.scroll,e).scrollLeft=u:t?f():(c="",u=0)}function _(){setTimeout((function(){var e=(0,i.ge)(c);if(e){var t=Array.from((0,o.$$)(l.tab,e));if(t)t.some((function(e){return e.getAttribute("href")===nav.cur}))&&t.forEach((function(e){e.getAttribute("href")===nav.cur?e.classList.add(s):e.classList.remove(s)}))}}))}function f(){var e=(0,o.$$)(l.container),t=Math.min((0,i.getCw)(),882);e.forEach((function(e){var n=(0,o.$)(l.scroll,e),a=(0,o.$)(l.active,e);if(a){var r=a.offsetWidth,s=(0,i.getX)(a);s+r>t&&(n.scrollLeft=s-t+r,console.log("$scroll.scrollLeft scrollAllToActiveTab",n.scrollLeft))}}))}function p(){f()}function m(e,t){var n=(0,i.gpeByClass)(a,t),d=(0,i.gpeByClass)(r,t),_=(0,o.$)(l.active,n);return _&&_.classList.remove(s),t.classList.add(s),u=d.scrollLeft,c=(0,i.attr)(n,"id"),!0}},5735:function(e,t,n){"use strict";var i=n(85489),o=n(49751),a=n(86205),r=n(46950),s=n(96966),l=n(19388),c=n(22297),u=n(93449);t.default=function(e){void 0===e&&(e={});var t=e.position||"bottom",n=!(!e.type||e.image),d={class:i.default.class("SnackbarItem__cell",{left:!0,image:!!e.image,top:e.avatar&&"left"===e.avatar_position,icon:n},"_")},_={class:i.default.class("SnackbarItem__cell",{right:!0,avatar:!!e.avatar},"_")},f=!1,p=!1;if(e.type){f=!0;var m=null;switch(e.type){case 1:m=(0,a.default)((0,s.getSnackbarDone24Icon)());break;case 2:m=(0,a.default)((0,l.getSnackbarError24Icon)());break;case 3:m=(0,a.default)((0,c.getFavorites24Icon)());break;case 4:m=(0,a.default)((0,u.getErrorFill24Icon)())}d.inner={class:"SnackbarItem__icon",inner:m}}e.image&&(f=!0,d.inner={class:"SnackbarItem__image",inner:{tag:"img",src:e.image}});e.action&&(p=!0,_.inner=(0,o.default)({theme:"none",class:"SnackbarItem__action",url:e.action.url,target:e.action.target,on_click:e.action.onclick,use_native_onclick:!0,inner:Wd.wrap(e.action.text),attrs:e.action.attrs}));if(e.avatar){var h={tag:"img",class:"SnackbarItem__avatar",src:e.avatar};e.avatar_position&&"right"!==e.avatar_position?"left"===e.avatar_position&&(f=!0,d.inner=h):(p=!0,_.inner=h)}return{style:e.style?e.style:"",class:["SnackbarItem_"+e.id,"SnackbarItem--"+t+" ",i.default.class("SnackbarItem",{static:!!e.static,vertical:!!e.vertical,hasIcon:n}),e.className||e.class],attrs:{"data-snackbar-id":e.id},inner:[{class:"SnackbarItem__table",inner:[f?d:null,e.text?{class:i.default.class("SnackbarItem__cell",{text:!0},"_"),inner:{class:"SnackbarItem__text",inner:(0,r.isObject)(e.text)?e.text:Wd.wrap(e.text)}}:null,p?_:null]}]}}},77212:function(e,t,n){"use strict";n.d(t,{init:function(){return b},close:function(){return E},SNACKBAR_POSITION_MAIL:function(){return c},SNACKBAR_TYPE_SUCCESS:function(){return m},SNACKBAR_TYPE_ERROR:function(){return h},SNACKBAR_TYPE_BOOKMARK:function(){return v},SNACKBAR_TYPE_BULLYING:function(){return g}});var i=n(9046),o=n(1730),a=n(86658),r=n(54412),s=n(39161);window.Snackbar={init:b,close:E,_onActionClick:function(e,t){var n=p[t];if(!n)return void(0,i.hide)(t);var o=n.callback,a=n.url;o?"function"==typeof o?o.call(null,e,{id:t,url:a}):Wd.handle2(o,e,{id:t,url:a}):(0,i.hide)(t)},_onRestoreClick:function(e,t,n){var o=t.closest(".SnackbarItem"),r=(0,i.domData)(o,"snackbar-id"),s=p[r];e.stopPropagation(),e.preventDefault();var l=s.callback;l&&("function"==typeof l?l.call(null,e,{id:r,url:n}):Wd.handle2(l,e,{id:r,url:n}));E(r),a.default.click(n,null,{url_params:{_ajax:1,_snackbar:1}})}};var l="common",c="mail",u="SnackbarItem_added",d="SnackbarItem_removed",_="SnackbarItem--closing",f=0,p={},m=1,h=2,v=3,g=4,A="touchstart",y="touchmove",w="touchcancel touchend",S=[];function b(e){if(!s.SAKIntegration.isIntegrated){var t=isFinite(e.duration)?e.duration:5e3,n=f++,a=e.action&&e.action.callback,r=e.action&&e.action.url;e.position=e.position||l;var d=e.position;e.id=n,a&&!e.action.onclick&&(e.action.onclick=["Snackbar._onActionClick","event",n]),e.bottom&&(e.style="bottom: "+e.bottom+"px");var _,m=Wd.elem(SnackbarItem(e));return function(e,t){if(t.position===l)(0,i.append)(e,document.body);else if(t.position===c){var n="msg"===window.store.mail.cur.page?(0,o.$)(".messenger__layer_page .messenger__header"):(0,o.$)(".messenger__layer_convo .messenger__header");(0,i.append)(e,n)}setTimeout((function(){e.classList.add(u)}),100)}(m,e),t&&(_=C(n,t)),(0,i.addEvent)(m,A,x,{passive:!0}),(0,i.addEvent)(m,y,B,{capture:!1}),(0,i.addEvent)(m,w,D,{passive:!0}),p[n]={id:n,timer:_,callback:a,url:r,duration:t,position:d},S.push(n),k(),n}s.SAKIntegration.sendMessage("show_snackbar",{type:e.type,text:e.text})}function k(){var e=(S=S.filter((function(e){var t=p[e],n=I(e);return!(!t||!n)}))).reduce((function(e,t){var n=p[t];return e[n.position]||(e[n.position]=[]),e[n.position].push(t),e}),{});Object.keys(e).forEach((function(t){var n=e[t],o=0,a=t===c?8:12;n.forEach((function(e,n){var r=I(e),s=(0,i.getH)(r);p[e].vertical=t===c?o:-o,i.setStyle.transform(r,1,[0,p[e].vertical]),o+=s+a}))}))}function C(e,t){return setTimeout((function(){E(e,!1)}),t)}function E(e,t){var n=p[e],o=I(e);n&&(n.timer&&clearTimeout(n.timer),delete p[e]),o&&function(e,t){var n=600;if((0,i.removeEvent)(e,A,x,{passive:!0}),(0,i.removeEvent)(e,y,B,{capture:!1}),(0,i.removeEvent)(e,w,D,{passive:!0}),t)return(0,i.remove)(e),void k();e.classList.add(_);if(!e)return;e.classList.add(d),setTimeout((function(){(0,i.remove)(e),k()}),n)}(o,t)}function I(e){return(0,o.$)(".SnackbarItem_"+e)}onDOMReady((function(){onBodyResize(k)}));var T=!1,M=null,P=!1,L=0,N=!1,R=(0,i.getCw)();function x(e){if(R=(0,i.getCw)(),e.touches&&e.touches.length>1)T=!1;else{var t=e.target.closest(".SnackbarItem");t.classList.add("SnackbarItem--dragging");var n=(0,i.domData)(t,"snackbar-id");if(R>=r.DESKTOP_WIDTH&&(N=!0),p[n].position===c){N=!1;var a=(0,o.$)(".messenger");R=(0,i.getW)(a),p[n].parentXY=(0,i.getXY)(a)}else p[n].parentXY=(0,i.getXY)(bodyNode);p[n].timer&&clearTimeout(p[n].timer),M=e.touches[0],L=e.touches[0].clientX,T=!0,P=n,document.body.style.overflow="hidden"}}function B(e){var t=P;if(e.preventDefault(),e.touches&&e.touches.length>1)T=!1;else if(M&&T){var n=e.touches[0],o=e.target.closest(".SnackbarItem"),a=-(L-n.clientX);N&&(a=Math.min(a,0));var r=(0,i.getX)(o),s=((0,i.getW)(o)+a)/2+r-p[t].parentXY[0],l=s>=.95*R||s<=R/.95-R;p[t].canClose=l,i.setStyle.transform(o,1,[a,p[t].vertical])}}function D(e){var t=e.target.closest(".SnackbarItem");t.classList.remove("SnackbarItem--dragging");var n=(0,i.domData)(t,"snackbar-id"),o=p[n];if(p[n].dragging=!1,P=!1,document.body.style.overflow="visible",o.canClose){var a=(0,i.getX)(t)>0?(0,i.getCw)():-(0,i.getCw)();return(0,i.getCw)()>=r.DESKTOP_WIDTH&&(a=(0,i.getX)(t)>(0,i.getCw)()/2?(0,i.getCw)():-(0,i.getCw)()),i.setStyle.transform(t,1,[a,p[n].vertical||0]),void E(n)}p[n].timer=C(n,o.duration),t&&i.setStyle.transform(t,1,[0,p[n].vertical||0])}},92424:function(e,t,n){"use strict";n.d(t,{init:function(){return o.init},close:function(){return o.close},SNACKBAR_POSITION_MAIL:function(){return o.SNACKBAR_POSITION_MAIL},SNACKBAR_TYPE_SUCCESS:function(){return o.SNACKBAR_TYPE_SUCCESS},SNACKBAR_TYPE_ERROR:function(){return o.SNACKBAR_TYPE_ERROR},SNACKBAR_TYPE_BOOKMARK:function(){return o.SNACKBAR_TYPE_BOOKMARK},SNACKBAR_TYPE_BULLYING:function(){return o.SNACKBAR_TYPE_BULLYING}});var i=n(5735),o=n(77212);i.default;window.SnackbarItem=i.default},81168:function(e,t,n){"use strict";var i=n(1730),o=n(61124),a=n(49751),r=n(3061);window.SwitcherConfirm={},SwitcherConfirm._onSwitcherChange=_,SwitcherConfirm._onConfirmClick=f,SwitcherConfirm._onCancelClick=function(e){return p(e.$btn)},SwitcherConfirm._onPopupOverlayClick=function(e){return p(e.$popup)};var s=function(e){return"SwitcherConfirm_checked_"+(e?"yes":"no")},l=".SwitcherConfirm",c=".SwitcherConfirm__popup",u=".SwitcherConfirm__confirm",d=".SwitcherConfirm__cancel";function _(e){var t=e.$control,n=t.closest(l),a=(0,i.$)(c,n);o.default.open(a),n.$popup=a,n.$control=t,n.checked=e.checked}function f(e,t){var n=t.$btn.closest(l),r=(0,i.$)(u,n),c=(0,i.$)(d,n),_=n.checked;n.isSaving=!0,a.default.setLoading(r,!0),a.default.setDisabled(c,!0),Wd.handle(e,{checked:_,onSuccess:function(){n.isSaving=!1,o.default.close(n.$popup),a.default.setLoading(r,!1),a.default.setDisabled(c,!1),n.classList.toggle(s(!0),_),n.classList.toggle(s(!1),!_)}})}function p(e){var t=e.closest(l);t.isSaving||(r.default.setChecked(t.$control,!t.checked),o.default.close(t.$popup))}},37174:function(e,t,n){"use strict";n(81168)},14194:function(e,t,n){"use strict";var i=n(1730);window.TabRow={setSelectedTab:function(e,t){var n=(0,i.$)(a(e)),l=(0,i.$)(s,n),c=(0,i.$)(r(t),n);l&&l.classList.remove(o),c&&c.classList.add(o)},setTabUrl:function(e,t,n){var o=(0,i.$)(a(e)),s=(0,i.$)(r(t),o);s&&s.setAttribute("href",n)}};var o="TabRow__tab_selected",a=function(e){return'.TabRow[data-id="'+e+'"]'},r=function(e){return'.TabRow__tab[data-id="'+e+'"]'},s=".TabRow__tab_selected"},85584:function(e,t,n){"use strict";var i=n(46769),o=n(97620),a=n(5339),r=n(93817),s=n(11393),l=n(92424),c=n(9046),u=n(1730),d=n(27813),_=window.Popup,f=window.ActionMenu,p=window.attr,m=window.val,h=window.ajax,v=window.replace,g=window.scrollTop,A=window.ceFromString,y=window.Btn;window.Bookmarks={hideTagsList:F,showTagsList:function(e,t){void 0===t&&(t=!1);e&&e.stopPropagation();var n=O(w),i=G();if(n.classList.remove("BookmarksPopup__hideCorner"),t){var a=t.closest(P),r=Y(p(a,"id"));i=i.filter((function(e){return r.includes(e.id)})),n.classList.add("BookmarksPopup__hideCorner")}var l=(0,c.qs2obj)(nav.params),d=Object.keys(i).reduce((function(e,t){var n=i[t];return e.push((0,o.default)({tag:n,current_id:parseInt(l.tag)})),e}),[]),_=s.default.html(d);m(n.$(".Popup__scrollContent"),_);var f=(0,u.$$)(I,n);f&&f.forEach((function(e){(0,c.addEvent)(e,"click",F)}));return!1},hideDeletePopup:V,showDeletePopup:function(e){var t=O(S),n=p(e,"data-id"),i=p(e,"data-hash"),o=p(e,"data-name");return Q(t,{id:n,hash:i}),m(t.$("["+L+"]"),(0,c.htsc)(o)),!1},submitDeleteTag:function(){var e=z(Array.from((0,u.$$)(S)).pop()),t=e.id,n=e.hash;h.post("/bookmarks",{_ajax:1,act:"tag_delete",id:t,hash:n},{onDone:function(e){D(e),V()}})},hideCreatePopup:j,showCreatePopup:function(e){var t=O(b),n=p(e,"data-hash");Q(t,{hash:n});var i=(0,u.$)("[name="+N+"]",t),o=(0,u.$)(M,t),a=m(i).trim();return y.setDisabled(o,!a),!1},submitCreateTag:function(){var e=Array.from((0,u.$$)(b)).pop(),t=Array.from((0,u.$$)(E)).pop(),n=z(e).hash,i=m(e.$("[name="+N+"]")),o=+!!(0,u.$)(E);h.post("/bookmarks",{_ajax:1,act:"tag_edit",tag:i,hash:n,id:0,from_settings:o},{onDone:function(e,n){if(o){var i=[];Array.from(t.$$('[name="tag"][type="checkbox"]:checked')||[]).forEach((function(e){i.push(e.value)})),m(t,e),i.forEach((function(e){var n=t.$('[name="tag"][type="checkbox"][value="'+e+'"]');n&&(n.checked=!0)}))}else D(e);!function(e){var t=W(),n=e[0],i=e[1];t&&t.tags&&t.tags.push({id:n,name:i,order:0})}(n),j()}})},hideEditPopup:$,showEditPopup:function(e){var t=O(k),n=p(e,"data-id"),i=p(e,"data-hash"),o=p(e,"data-name")||"",a=t.$("[name="+R+"]");m(a,o),Q(t,{id:n,hash:i,name:o});var r=Array.from((0,u.$$)(M,t)).pop(),s=m(a).trim();return y.setDisabled(r,!s),!1},submitEditTag:function(){var e=Array.from((0,u.$$)(k)).pop(),t=z(e),n=t.id,i=t.hash,o=m(e.$("[name="+R+"]"));h.post("/bookmarks",{_ajax:1,act:"tag_edit",tag:o,hash:i,id:n},{onDone:function(e){D(e),$()}})},hideSettingsPopup:q,showSettingsPopup:function(e,t){void 0===t&&(t={});var n,i,o,a=p(e,"data-item_id"),r=p(e,"data-item_oid"),l=p(e,"data-item_type"),c=p(e,"data-hash"),u=p(e,"data-raw");t.wrap||(n=O(C),i=n.$(E),o=Y(u),m(i,s.default.html({class:"Bookmarks__tagsSettingsLoading"})),Q(n,{id:a,oid:r,type:l,hash:c,itemRaw:u}));return h.post("/bookmarks",{_ajax:1,act:"tag_settings",hash:c,item_id:a,item_oid:r,item_type:l,wrap:t.wrap?1:0},{onDone:function(e){if(t.wrap){var s=A(e);Q(s=O(s),{id:a,oid:r,type:l,hash:c,itemRaw:u,needRemove:!0,is_from_snackbar:t.is_from_snackbar})}else m(i,e),o.forEach((function(e){var t=n.$('[name="tag"][type="checkbox"][value="'+e+'"]');t&&(t.checked=!0)}))}}),!1},submitSettingsTags:function(){var e=Array.from((0,u.$$)(C)).pop(),t=z(e),n=t.id,i=t.oid,o=t.type,r=t.hash,l=t.itemRaw,c=t.is_from_snackbar,d=[];Array.from(e.$$('[name="tag"][type="checkbox"]:checked')||[]).forEach((function(e){d.push(e.value)}));var _=d.join(",");h.post("/bookmarks",{_ajax:1,act:"tag_set",hash:r,item_id:n,item_oid:i,item_type:o,tag_ids:_,is_from_snackbar:c},{onDone:function(e){q();var t=(0,u.$)("#"+l);if(t){var n=(0,u.$)(".BookmarkListItem__tags, .BookmarksItem__tag",t);if(n)m(n,e);else if(n=(0,u.$)(".Owner__tags",t)){var i=G(),o=d.map((function(e){return parseInt(e,10)})),r=i.filter((function(e){return o.includes(e.id)})),c=s.default.html((0,a.default)({tags:r}));m(n.parentNode,c)}Z(l,d,""),cur&&cur.search_bookmarks&&cur.search_bookmarks.redraw()}}})},closeAll:function(){F(),V(),j(),$(),q()},initStore:K,pushItemsToStore:function(e){var t=W();t&&(t.items=(0,i.default)({},t.items,{},e))},pushItemToStore:Z,removeFromBookmarkLink:function(e){var t=p(e,"data-item_id"),n=p(e,"data-item_oid"),i=p(e,"data-item_type"),o=p(e,"data-hash"),a=p(e,"data-raw"),r=p(e,"data-link_url"),s=p(e,"data-link_title"),l=p(e,"data-link_img"),d=(0,u.$)("#"+a);return f.closeMenu(),(0,c.addClass)(d,x),h.post("/bookmarks",{_ajax:1,act:"bookmark_remove",hash:o,item_id:t,item_oid:n,item_type:i,link_url:r,link_title:s,link_img:l},{onDone:function(e){J(a,[x]),Share.setBookmarkState(a,!1),cur&&cur.search_bookmarks&&cur.search_bookmarks.redraw()}}),!1},addToBookmarkLink:function(e){var t=p(e,"data-item_id"),n=p(e,"data-item_oid"),i=p(e,"data-item_type"),o=p(e,"data-hash"),a=p(e,"data-raw"),r=p(e,"data-link_url"),s=p(e,"data-link_title"),l=p(e,"data-link_img"),d=(0,u.$)("#"+a);return f.closeMenu(),(0,c.removeClass)(d,x),h.post("/bookmarks",{_ajax:1,act:"bookmark_add",hash:o,item_id:t,item_oid:n,item_type:i,link_url:r,link_title:s,link_img:l},{onDone:function(){var e=X(a),t=e.indexOf(x);-1!==t&&e.splice(t,1),J(a,e),Share.setBookmarkState(a,!0),cur&&cur.search_bookmarks&&cur.search_bookmarks.redraw()}}),!1},showSuccessSnack:function(e){var t,n=window.lang,i=(0,c.geByClass1)("RepliesField_fixed");i&&(t=(0,c.getH)(i)+5);Snackbar.init({type:l.SNACKBAR_TYPE_BOOKMARK,text:n.mobile_bookmarks_snackbar_added,bottom:t,action:{url:"/bookmarks",text:n.mobile_bookmarks_snackbar_edit_tags,onclick:"return Bookmarks.showSettingsPopup(this, { wrap: true, is_from_snackbar: 1 });",attrs:Object.keys(e).reduce((function(t,n){return t["data-"+n]=e[n],t}),{})}})},keyupCreateInput:function(e,t){var n=(0,c.gpeByClass)("BookmarksPopup",t),i=(0,u.$)(M,n),o=m(t).trim();y.setDisabled(i,!o)},openSavedTab:function(e,t){var n=(0,u.$)(".mm_counter",t),i=(0,d.getCookie)(B);i&&!n&&(e&&e.preventDefault(),nav.go("/bookmarks?type="+i))},openLikesFeed:function(e){var t=(0,u.$)(".mm_new",e);(0,c.remove)(t)},getStoreItemDataById:ee,getTagsByItemId:te,renderSearchItem:function(e,t,n,i,o){var l="";if(!i||(0,c.isEmpty)(i))l=n;else{var u=te(e),d=X(e);i=JSON.parse(i),u&&(t=u.reduce((function(e,t){return[].concat(e,[t.id])}),[]),i.subtitle=(0,a.default)({tags:u})),d&&(i.mix=[].concat(d).join(" ")),i.title=s.default.wrap(o.highlight(i.title)),l=s.default.html((0,r.default)(i))}return Z(e,t,n),l}};var w=".BookmarksPopup__filter",S=".BookmarksPopup__delete",b=".BookmarksPopup__create",k=".BookmarksPopup__edit",C=".BookmarksPopup__settings",E=".Bookmarks__tagsSettings",I=".Bookmarks__tagsSelectItem",T=".basisDefault",M=".BookmarksPopup__buttonSubmit",P=".BookmarksItem",L="data-deletetagname",N="createtagname",R="edittagname",x="BookmarksItem_removed",B="remixblt";function D(e){var t=g(),n=(0,u.$)(T),i=A(e);v(i,n),g(t)}function O(e){var t;f.closeMenu(),t="string"==typeof e?(0,u.$)(e):e,t=_.open(t,!0);var n="popup"+Date.now();return p(t,"data-popupid",n),t}function U(e){return p(e,"data-popupid")}function H(e){var t;if(t=!("string"==typeof e)?e:Array.from((0,u.$$)(e)).pop()){_.close(t);var n=z(t),i=n&&n.needRemove;!function(e){var t=U(e);delete W().popup[t]}(t),i&&(0,c.remove)(t)}return!1}function F(){var e=Array.from((0,u.$$)(w)).pop(),t=(0,u.$$)(I,e);return t&&t.forEach((function(e){(0,c.removeEvent)(e,"click",F)})),H(e)}function V(){return H(S)}function j(){var e=Array.from((0,u.$$)(b)).pop();if(e){var t=e.$("[name="+N+"]");m(t,"")}return H(b)}function $(){var e=Array.from((0,u.$$)(k)).pop();if(e){var t=e.$("[name="+R+"]");m(t,"")}return H(k)}function q(){return H(C)}function W(){return window.store.bookmarks||K(),window.store.bookmarks}function G(){var e=W();return e.tags?e.tags:{}}function Y(e){var t=W();return t.items[e]?t.items[e][3]:[]}function K(e){void 0===e&&(e={}),window.store.bookmarks=(0,i.default)({},e,{popup:{}})}function Q(e,t){var n=U(e);W().popup[n]=t}function z(e){var t=U(e);return W().popup[t]}function X(e){var t=W();return t&&t.items&&t.items[e]&&t.items[e][5]}function J(e,t){var n=W();n&&n.items&&n.items[e]&&(n.items[e][5]?n.items[e][5]=[].concat(n.items[e][5],t):n.items[e][5]=[].concat(t))}function Z(e,t,n,i){var o=W();o&&o.items&&(t=t.map((function(e){return parseInt(e,10)})),o.items[e]?(o.items[e][3]=t,o.items[e][4]=i):o.items[e]=["",n,e,t,i])}function ee(e){var t=W();return t&&t.items&&t.items[e]}function te(e){var t=ee(e),n=G();if(t&&n){var i=t[3]||[];return n.filter((function(e){return i.includes(e.id)}))}return!1}},98086:function(e,t,n){"use strict";var i=n(11393),o=n(39423);t.default=function(e){var t=e.tag,n=t.id===e.current_id?"control_radio_checked":"control_radio";return{href:t.href,class:"Bookmarks__tagsSelectItem",inner:[{class:"Bookmarks__tagsSelectItemTitle",inner:i.default.wrap(t.name)},(0,o.default)({icon:n})]}}},97620:function(e,t,n){"use strict";var i=n(98086);t.default=i.default,window.BookmarksFilterListItem=i.default},90729:function(e,t,n){"use strict";var i=n(11393);t.default=function(e){var t=!(!e.tags||!e.tags.length)&&e.tags;return{class:"Owner__tags",inner:t?[{class:"Owner__tags_icon Icon Icon_tagLabel"},t.map((function(e){return{class:"Owner__tag",inner:i.default.wrap(e.name)}}))]:null}}},5339:function(e,t,n){"use strict";var i=n(90729);t.default=i.default,window.BookmarksPageItem=i.default},85083:function(e,t,n){"use strict";var i=n(85489),o=n(86205),a=n(35909),r=n(56330),s=n(62719);t.default=function(e){void 0===e&&(e={});var t=e.mode||"tint",n=e.size||"s",l=e.imageTheme||"dark",c="image"===t&&"dark"===l,u=[i.default.class("Banner",{md:t,sz:n,aside:e.asideMode,inverted:c}),e.mix],d="image"===t&&e.background,_=null;return e.link&&(_={href:e.link,onClick:"nav.go('"+e.link+"', event);",class:"Banner__link",tag:"a"}),{inner:[{inner:[d?{inner:[e.background],class:"Banner__bg",tag:"div"}:null,e.before?{inner:[e.before],class:"Banner__before",tag:"div"}:null,{inner:[e.link&&_,e.header?{inner:[e.header],class:"Banner__header",tag:"div"}:null,e.subheader?{inner:[e.subheader],class:"Banner__subheader",tag:"div"}:null,e.text?{inner:[e.text],class:"Banner__text",tag:"div"}:null,e.actions?{inner:[e.actions],class:"Banner__actions",tag:"div"}:null],class:"Banner__content",tag:"div"},"expand"===e.asideMode?{inner:[(0,a.Icon24Chevron)()],type:"button",class:"Banner__expand Btn Btn_theme_none",onClick:e.onExpand,tag:"button"}:null,"dismiss"===e.asideMode?{inner:[(0,o.default)({icon:c?(0,s.getDismissDark24Icon)():(0,r.getDismiss24Icon)()})],type:"button",class:"Banner__dismiss Btn Btn_theme_none",onClick:e.onDismiss,tag:"button"}:null],class:"Banner__in",tag:"div"}],onClick:e.onClick,class:u,tabindex:"0",role:"button",tag:"div"}}},75095:function(e,t,n){"use strict";var i=n(85083);t.default=i.default},9858:function(e,t,n){"use strict";var i=n(11393),o=n(85489),a=n(39423);t.default=function(e){var t=window.lang,n=e.count;return i.default.html({class:[o.default.class("Bell",{empty:!n},"_"),"al_menu"],href:e.url,onclick:e.onclick,"aria-label":t.mobile_notifications_title,"data-header":t.mobile_notifications_title,"data-skiponclick":1,inner:[(0,a.default)({mix:"Bell__icon",icon:"bell"}),{class:"Bell__counter",inner:n,tag:"em"}]})}},34284:function(e,t,n){"use strict";var i=n(9858),o=n(1730);Object.assign(i.default,{setCount:function(e){(0,o.$$)(r).forEach((function(t){var n=t.$(s);t.classList.toggle(a,!e),n.innerText=e}))}});var a="Bell_empty",r=".Bell",s=".Bell__counter"},92553:function(e,t,n){"use strict";var i=n(9858);n(34284);t.default=i.default,window.Bell=i.default},28947:function(e,t,n){"use strict";n.d(t,{CaptchaPopup:function(){return c}});var i=n(61124),o=n(49751),a=n(42685),r=n(13447),s=n(81755),l=n(73512);function c(e){var t=window.lang;return(0,i.default)({inner:[{inner:[(0,a.FormLayout)({inner:[(0,l.default)({inner:[(0,r.FormItem)({inner:[{class:"captcha_img",src:e.captcha_img,alt:"",tag:"img"}]}),(0,r.FormItem)({inner:[(0,s.default)({name:"sig",placeholder:t.mobile_captcha_enter_code})]}),(0,r.FormItem)({inner:[(0,o.default)({inner:[t.mobile_captcha_send_btn],stretch:!0,onClick:["CaptchaPopup.onSend"]})]})]})]})],class:"Popup__buttons",tag:"div"}],class:"CaptchaPopup",scrollable:!0,on_overlay_click:["CaptchaPopup.onHide","this"]})}},46393:function(e,t,n){"use strict";var i=n(85489),o=n(35909);t.default=function(e){void 0===e&&(e={});var t=e.label||e.inner,n=e.mode||"primary",a=!1===e.centered,r=[{inner:[t],class:i.default.class("CellButton__label",{danger:"danger"===n},"--"),tag:"span"},e.href&&!e.hideHrefDefaultIcon?{inner:[(0,o.Icon16Chevron)()],class:"CellButton__go",tag:"div"}:null];e.fileInput&&r.push({attrs:e.inputAttrs,class:"CellButton__file",type:"file",onchange:e.onChange,tag:"input"});var s={inner:[r],class:i.default.class("CellButton",{danger:"danger"===n,nonCentered:a},"--"),id:e.id,onclick:e.onclick,tag:"button"};return e.fileInput&&(s.tag="label",s.role="button"),e.href&&(s.tag="a",s.href=e.href),s}},62438:function(e,t,n){"use strict";var i=n(46393);t.default=i.default},36406:function(e,t,n){"use strict";n.d(t,{onOverlayClick:function(){return s},onButtonClick:function(){return l}});var i=n(1730),o=n(9046),a=n(80444),r=n(61124);function s(e,t){var n=e.closest(".Popup");n&&"false"!==n.dataset.useNavigation&&(0,i.$)('[data-key="no"]',n).click()}function l(e,t){t.preventDefault(),t.stopPropagation();var n=e.closest(".Popup");if(n){var i=(0,a.parseURL)(e.href),s=i.pathname+i.search,l=(0,a.parseURL)(nav.prev_cur),c=l.pathname+l.search,u="false"!==n.dataset.useNavigation;if(!u||"no"===(0,o.domData)(e,"key")&&s===c&&"1"!==(0,o.domData)(e,"force"))return u&&history.back(),r.default.close(n);nav.go(s)}}onDOMReady((function(){window.page.onChange((function(){(0,i.$$)(".ConfirmPopup").forEach((function(e){return r.default.close(e)}))}))}))},93918:function(e,t,n){"use strict";var i=n(36406);window.ConfirmPopup={onOverlayClick:i.onOverlayClick,onButtonClick:i.onButtonClick}},9474:function(e,t,n){"use strict";var i=n(86205),o=n(35909),a=n(31923);t.default=function(e){return void 0===e&&(e={}),{inner:[{inner:[(0,o.Icon24CancelOutline)()],class:"Covid19Banner__close",role:"button","aria-label":e.aria_label_close,onClick:["Covid19Banner.close","event","this"],tag:"div"},{inner:[{inner:[(0,i.default)({icon:(0,a.getCovid1964Icon)()})],class:"Covid19Banner__icon",tag:"div"},{inner:[{inner:[e.title],class:"Covid19Banner__title",tag:"h4"},{inner:[e.text,{inner:[e.more],class:"Covid19Banner__link",href:e.url,onClick:"event.preventDefault()",tag:"a"}],class:"Covid19Banner__text",tag:"p"}],class:"Covid19Banner__content",tag:"div"}],class:"Covid19Banner__wrapper",tag:"div"}],class:"Covid19Banner",role:"complementary",onClick:["Covid19Banner.open","event",e.url,e.statlogsEventOpen],tag:"div"}}},46911:function(e,t,n){"use strict";n.d(t,{close:function(){return l},open:function(){return c}});var i=n(86658),o=n(1730),a=n(9046);function r(){(0,a.throttle)(s,66)()}function s(){var e=(0,o.$)(".Covid19Banner__offset");if(e){var t=(0,o.$)(".Covid19Banner").clientHeight;e.style.height=t+"px"}}function l(e,t){var n;e.preventDefault(),e.stopPropagation(),i.default.post("/stats?act=covid_19_banner_close"),t.parentElement.remove(),n=(0,o.$)(".Covid19Banner__offset"),window.removeEventListener("resize",r),n.remove()}function c(e,t,n){e.preventDefault(),e.stopPropagation(),(0,a.statlogsValueEvent)(n),nav.hard_go(t)}onDOMReady((function(){!function(){var e=(0,o.$)(".Covid19Banner");if(e){var t=(0,o.$)(".layout"),n=e.clientHeight,i=(a=n,(r=document.createElement("div")).classList.add("Covid19Banner__offset"),r.style.height=a+"px",r);t.appendChild(i)}var a,r}(),window.addEventListener("resize",r)}))},52242:function(e,t,n){"use strict";var i=n(9046),o=n(9474),a=n(46911);o.default;window.Covid19Banner=o.default,(0,i.extend)(o.default,{open:a.open,close:a.close})},57673:function(e,t,n){"use strict";var i=n(69756),o=n(86205),a=n(11393),r=n(46950),s=n(14009);t.default=function(){return[(0,i.ModalMenuHeaderCloseButton)({onClose:["DarkSchemeModal.closeAndSendStat","click_close_button","this"]}),(0,i.ModalMenuIcon)({inner:[{inner:[(0,o.default)({icon:(0,s.getImgDarkThemeIcon)()})],class:"DarkSchemeModal__icon",tag:"div"}]}),(0,i.ModalMenuTitle)({inner:[a.default.wrap((0,r.getLang)("mobile_dark_scheme_modal_title"))]}),(0,i.ModalMenuBody)({inner:[{inner:[a.default.wrap((0,r.getLang)("mobile_dark_scheme_modal_description"))],class:"DarkSchemeModal__description",tag:"div"},{inner:[a.default.wrap((0,r.getLang)("mobile_dark_scheme_modal_description_additional"))],class:"DarkSchemeModal__descriptionAdditional",tag:"div"}]}),(0,i.ModalMenuBtn)({inner:[(0,r.getLang)("mobile_dark_scheme_modal_button")],url:"/settings?act=appearance",theme:"regular",size:"large",isBtn:!0,onclick:["DarkSchemeModal.goToAppearance","this","event"]})]}},86366:function(e,t,n){"use strict";n.d(t,{open:function(){return u},close:function(){return d},goToAppearance:function(){return _},closeAndSendStat:function(){return p}});var i,o=n(11393),a=n(91687),r=n(86900),s=n(57673),l=n(29804),c=n(86658);function u(){var e=o.default.elem((0,a.default)({class:"DarkSchemeModal",on_overlay_click:["DarkSchemeModal.closeAndSendStat","click_overlay"],body:(0,s.default)()}));l.colorScheme.applyScheme(e,l.ColorSchemeName.Dark),i=!1,a.default.open(e,!0,"",{onClose:function(){f("close")}}),(0,r.statlogsValueEvent)("mvk_dark_scheme_guide","shown")}function d(e){a.default.close(e)}function _(e,t){return f("click_button"),d(e),nav.go(e,t)}function f(e){if(!i){var t={event:e,_ajax:1};c.default.post("/promo?act=dark_scheme_guide_close",t),i=!0}}function p(e,t){f(e),d(t)}},65249:function(e,t,n){"use strict";var i=n(86366),o={open:i.open,close:i.close,closeAndSendStat:i.closeAndSendStat,goToAppearance:i.goToAppearance};window.DarkSchemeModal=o},93319:function(e,t,n){"use strict";var i=n(49751),o=n(46950);t.default=function(e){var t=e.info||{};return{inner:[{inner:[{inner:[Object.keys(t).map((function(e){var n=t[e];return"boolean"==typeof n&&(n=n?"yes":"no"),function(e,t){return{inner:[{inner:[e],tag:"b"},"\n      :\n      ",{inner:[t],tag:"i"}],tag:"div"}}(e,n)}))],class:"fi_row",tag:"div"},{inner:[{inner:[{inner:[{inner:[{inner:"Audio tag not support",tag:"b"}],src:"//vk.com/mp3/bb1.mp3",tag:"source"}],preload:"none",controls:"controls",style:"width: 100%;",tag:"audio"}],style:"color: #777;",tag:"div"}],class:"fi_row",tag:"div"},{inner:[{inner:[{type:"hidden",id:"device_info_text",name:"device_info",value:e.fallbackText,tag:"input"},{inner:[e.needSendButton&&(0,i.default)({inner:[(0,o.getLang)("mobile_send_device_info")],submit:!0,stretch:!0,onClick:e.onSendClick})],class:"cp_buttons_block",tag:"div"}],action:"/?device",method:"post",tag:"form"}],class:"fi_row",tag:"div"}],class:"form_item",tag:"div"}],class:"PageBlock DeviceInfo fit_box",style:"color: #777; line-height: 1.7",tag:"div"}}},71838:function(e,t,n){"use strict";n.d(t,{LoopSlider:function(){return d}});var i,o,a=n(80413),r=n(9046),s="idle",l="moving",c="resort",u="recalculating",d=function(){function e(e,t){this.container=null,this.scrollEl=null,this.items=null,this.centralElementIndex=0,this.dimensions=[],this.currentIndex=0,this.isTouchActive=!1,this.startOffset=null,this.startInfo=null,this.currentInfo=null,this.state=null,this.container=e,this.scrollEl=t,this.items=this.scrollEl.childNodes,this.handleTouchStart=this.handleTouchStart.bind(this),this.handleTouchMove=this.handleTouchMove.bind(this),this.handleTouchEnd=this.handleTouchEnd.bind(this),this.handleTransitionEnd=this.handleTransitionEnd.bind(this),this.resortSlides=this.resortSlides.bind(this),this.handleWindowDimensionsChange=this.handleWindowDimensionsChange.bind(this),this.handleDragstart=this.handleDragstart.bind(this),this.init()}var t=e.prototype;return t.init=function(){this.items.length<=1||(this.cloneSlides(),this.dimensions=(0,a.prepareEqualizedSlidesDimensions)(this.items),(0,a.applyDimensionsToSlides)(this.items,this.dimensions),this.dimensions=(0,a.prepareEqualizedSlidesDimensions)(this.items),this.setCentralSlidePosition(),this.scrollEl.style.width="max-content",this.setupCallbacks(),this.enableAutoscroll(),this.state=s)},t.setupCallbacks=function(){(0,r.addEvent)(this.container,"dragstart",this.handleDragstart),(0,r.addEvent)(this.container,"mousedown touchstart",this.handleTouchStart),(0,r.addEvent)(this.container,"mousemove touchmove",this.handleTouchMove,{passive:!1}),(0,r.addEvent)(this.container,"mouseleave mouseup touchend touchcancel dragend",this.handleTouchEnd),(0,r.addEvent)(this.scrollEl,"transitionend",this.handleTransitionEnd),window.addEventListener("orientationchange",this.handleWindowDimensionsChange)},t.destroy=function(){this.disableAutoscroll(),cancelAnimationFrame(o),(0,r.removeEvent)(this.container,"dragstart",this.handleDragstart),(0,r.removeEvent)(this.container,"mousedown touchstart click",this.handleTouchStart),(0,r.removeEvent)(this.container,"mousemove touchmove",this.handleTouchMove),(0,r.removeEvent)(this.container,"mouseleave mouseup touchend touchcancel dragend",this.handleTouchEnd),(0,r.removeEvent)(this.scrollEl,"transitionend",this.handleTransitionEnd),window.removeEventListener("orientationchange",this.handleWindowDimensionsChange)},t.handleDragstart=function(e){e.target!==this.scrollEl&&(e.preventDefault(),e.stopPropagation())},t.handleTouchStart=function(e){this.isTouchActive||(this.initTouchEvent(e),this.disableAutoscroll())},t.initTouchEvent=function(e){this.startOffset=this.getScrollPosition(),this.startInfo=(0,a.analyzeTouchEvent)(e,{}),this.currentInfo=this.startInfo},t.handleTouchMove=function(e){if(this.startInfo)if(this.currentInfo=(0,a.analyzeTouchEvent)(e,this.startInfo),this.isTouchActive){e.cancelable&&e.preventDefault();var t=this.startOffset+this.currentInfo.offset.x;this.setScrollPosition(t)}else this.shouldMove(this.currentInfo)&&(this.isTouchActive=!0,this.initTouchEvent(e))},t.shouldMove=function(e){if(this.state===l||this.state===c||this.state===u)return!1;var t=e.offset;return 180*Math.atan(Math.abs(t.y)/Math.abs(t.x))/Math.PI<30},t.handleTouchEnd=function(e){this.startInfo=null,this.isTouchActive&&!(0,a.isLooksLikeClickInfo)(this.currentInfo)?(e.preventDefault(),e.stopPropagation(),this.go(this.currentInfo),this.enableAutoscroll(),this.isTouchActive=!1):(0,a.findLinkParentAndGoToLink)(e.target)},t.cloneSlides=function(){var e=this.items;this.centralElementIndex=e.length;for(var t=document.createDocumentFragment(),n=document.createDocumentFragment(),i=0;i<e.length;i+=1)t.appendChild(e[i].cloneNode(!0)),e.length<4&&n.appendChild(e[i].cloneNode(!0));this.scrollEl.insertBefore(t,this.scrollEl.firstChild),this.scrollEl.appendChild(n)},t.go=function(e){var t=e.speed.x,n=Math.abs(t);if(0!==n){var i=t<0?-1:1,o=this.getScrollPosition();n>.6&&Math.abs(e.offset.x)<150&&(o+=i*Math.min(600*n,this.getContainerWidth()));var r=(0,a.scrollOffsetToSlideIndex)(o,this.dimensions,this.getContainerWidth());r===this.currentIndex&&n>.1&&(r=this.currentIndex-i),r-this.currentIndex>1&&(r=this.currentIndex+1),r-this.currentIndex<-1&&(r=this.currentIndex-1),this.scrollToSlide(r)}},t.resortSlides=function(){var e=this.centralElementIndex,t=this.scrollEl,n=this.currentIndex;if(e!==n){var i=document.createDocumentFragment();if(n>e){for(var o=n-e;o>0;)i.appendChild(t.childNodes[0]),o-=1;t.appendChild(i)}if(n<e){for(var a=e-n,r=t.childNodes.length-a;a>0;)i.appendChild(t.childNodes[r]),a-=1;t.insertBefore(i,t.firstChild)}this.setCentralSlidePosition()}},t.setScrollPosition=function(e){this.scrollEl.style.transform="translateX("+e+"px)"},t.getScrollPosition=function(){return parseFloat(this.scrollEl.style.transform.replace("translateX(",""))},t.getContainerWidth=function(){return this.container.offsetWidth},t.setCentralSlidePosition=function(){var e=(0,a.getSlidePosition)(this.dimensions,this.centralElementIndex,this.getContainerWidth());this.currentIndex=this.centralElementIndex,this.setScrollPosition(e)},t.scrollToSlide=function(e){this.state=l,this.scrollEl.style.transition="transform 200ms cubic-bezier(.42,.65,.27,.99)";var t=(0,a.getSlidePosition)(this.dimensions,e,this.getContainerWidth());this.setScrollPosition(t),this.currentIndex=e},t.handleTransitionEnd=function(){var e=this;this.scrollEl.style.transition=null,this.state=c,o=window.requestAnimationFrame((function(){e.resortSlides(),e.state=s}))},t.scrollToNext=function(){var e=(this.currentIndex+1)%this.items.length;this.scrollToSlide(e)},t.enableAutoscroll=function(){var e=this;i&&clearInterval(i),i=setInterval((function(){e.scrollToNext()}),4e3)},t.disableAutoscroll=function(){i&&(clearInterval(i),i=null)},t.handleWindowDimensionsChange=function(){var e=this;this.state=u,(0,a.resetSlidesStyles)(this.items),this.scrollEl.style.width="",window.requestAnimationFrame((function(){setTimeout((function(){e.dimensions=(0,a.prepareEqualizedSlidesDimensions)(e.items),(0,a.applyDimensionsToSlides)(e.items,e.dimensions),e.dimensions=(0,a.prepareEqualizedSlidesDimensions)(e.items),e.setCentralSlidePosition(),e.state=s}))}))},e}()},80413:function(e,t,n){"use strict";function i(e){for(var t=Array.from(e),n=[],i=0,o=null,a=0;a<t.length;a+=1){var r=t[a],s=r.offsetWidth,l=r.offsetLeft,c=r.offsetHeight;o=0===a?l:o,n.push({width:s,height:c,offsetLeft:l,marginLeft:o}),i<s&&(i=s)}for(var u=0;u<n.length;u+=1)n[u].width=i;return n}function o(e,t){Array.from(e).forEach((function(e,n){e.style.marginLeft=t[n].marginLeft+"px",e.style.width=t[n].width+"px",e.style.height=t[n].height+"px",e.style.flex="none"}))}function a(e){Array.from(e).forEach((function(e){e.style.marginLeft="",e.style.width="",e.style.height="",e.style.flex=""}))}function r(e,t,n){return-1*(e[t].offsetLeft+e[t].width/2-n/2)}function s(e,t,n){for(var i=null,o=null,a=n/2-e,r=0;r<t.length;r+=1){var s=t[r].offsetLeft+t[r].width/2,l=Math.abs(s-a);(null===i||l<i)&&(i=l,o=r)}return o}function l(e,t){var n=e.timeStamp,i=e.touches,o=i?i[0]:e,a=o.clientX,r=o.clientY,s=t.to||{},l=s.x,c=void 0===l?a:l,u=s.y,d={x:a-c,y:r-(void 0===u?r:u)},_=n-(t.time||0);return{to:{x:a,y:r},offset:d,time:n,speed:{x:d.x/_,y:d.y/_},duration:_}}function c(e){if(!e)return!1;var t=e.offset,n=e.duration;return Math.abs(t.x)<1&&Math.abs(t.y)<1&&n<200}function u(e){var t=e.closest("a");t&&t.href&&(window.location=t.href)}n.d(t,{prepareEqualizedSlidesDimensions:function(){return i},applyDimensionsToSlides:function(){return o},resetSlidesStyles:function(){return a},getSlidePosition:function(){return r},scrollOffsetToSlideIndex:function(){return s},analyzeTouchEvent:function(){return l},isLooksLikeClickInfo:function(){return c},findLinkParentAndGoToLink:function(){return u}})},14848:function(e,t,n){"use strict";function i(e){return{inner:[{inner:[e.before],class:"MiniInfoCell__before",tag:"div"},{inner:[e.text],class:"MiniInfoCell__content",tag:"div"}],class:"MiniInfoCell",tag:"div"}}n.d(t,{MiniInfoCell:function(){return i}})},33837:function(e,t,n){"use strict";n.d(t,{ModalCard:function(){return r}});var i=n(91687),o=n(59219),a=n(49751);function r(e){void 0===e&&(e={});var t=window.lang,n=e.icon,r=e.actions||[],s=r.length||e.needCloseButton;e.inner&&1===e.inner.length&&null===e.inner[0]&&(e.inner=null);var l=r.map((function(e){return(0,a.default)({inner:[e.text],theme:e.theme,url:e.url,onClick:e.onClick,use_native_onclick:!0})}));e.needCloseButton&&l.push((0,a.default)({inner:[t.mobile_close],stretch:!0,onClick:"ModalMenu.close(this)",use_native_onclick:!0,theme:"secondary"}));var c={inner:[e.needCloseIcon?(0,i.ModalMenuHeaderCloseButton)({onClose:e.onClose}):null,n?{inner:[n],class:"ModalCard__icon",tag:"div"}:null,{inner:[e.title],class:"ModalCard__title",tag:"h2"},e.subhead?{inner:[e.subhead],class:"ModalCard__subhead",tag:"div"}:null,e.inner?{inner:[e.inner],class:"ModalCard__content",tag:"div"}:null,s?(0,o.BtnStack)({btns:l,mode:e.actionsLayout||"horizontal",stretch:!0}):null],class:"ModalCard__in",tag:"div"};return(0,i.default)({class:"ModalCard",body:c})}},95916:function(e,t,n){"use strict";var i=n(46950),o=n(85489),a=n(35909);t.default=function(e){void 0===e&&(e={});var t=[o.default.class("ModalMenuHeader"),e.mix];return{inner:[{inner:[(0,a.Icon24Cancel)()],class:"ModalMenuHeader__close","aria-label":(0,i.getLang)("mobile_close"),onClick:e.onClose,tag:"button"},{inner:[e.inner],class:"ModalMenuHeader__title",tag:"div"}],class:t,tag:"div"}}},91540:function(e,t,n){"use strict";var i=n(95916);t.default=i.default},37425:function(e,t,n){"use strict";n.d(t,{ModalMenuUserListItem:function(){return s}});var i=n(10729),o=n(45029),a=n(46950),r=n(80540);function s(e){return{class:(0,o.classNames)("ModalMenuUserList__item",e.class),href:e.href,onclick:e.onclick?e.onclick:null,inner:[{class:"ModalMenuUserList__itemAvatar",inner:(0,r.Avatar)({mode:(0,a.getAvatarMode)({id:e.id,name:e.name}),backgroundTheme:e.id,text:e.name,textLength:(0,a.getAvatarTextLength)(e.id),size:56,src:e.image})},{class:"ModalMenuUserList__itemName",inner:e.name}]}}t.default=function(e){return{class:"ModalMenuUserList",inner:(0,i.default)({inner:e.users})}}},92505:function(e,t,n){"use strict";var i=n(49751),o=n(86205),a=n(1374),r=n(55098),s=n(35909);t.default=function(e){return void 0===e&&(e={}),{inner:[{inner:[{inner:[(0,i.default)({inner:[(0,o.default)({icon:e.isLeftActionBack?(0,a.getBackOutline28Icon)():(0,r.getCancelOutline28Icon)()})],theme:"header",class:"ModalPage__headerButton ModalPage__headerButton--close",onClick:e.onLeftActionClick,use_native_onclick:!0,is_icon:!0}),{inner:[e.title],class:"ModalPage__headerTitle",tag:"div"},e.isConfirmActionAvailable?(0,i.default)({inner:[(0,s.Icon28DoneOutline)()],theme:"header",class:"ModalPage__headerButton ModalPage__headerButton--confirm",onClick:e.onConfirmClick,use_native_onclick:!0,is_icon:!0}):null],class:"ModalPage__header",tag:"div"},{inner:[e.content],class:"ModalPage__content",id:e.contentId,tag:"div"}],class:"ModalPage__wrapper",tag:"div"}],class:"Popup ModalPage",tag:"div"}}},54604:function(e,t,n){"use strict";var i=n(1730),o=(0,n(9046).need)("Btn");window.PrivacyPolicy={},PrivacyPolicy._onAcceptToggle=r;var a=".PrivacyPolicy__submit";function r(e){var t=e.checked,n=(0,i.$)(a);o.setDisabled(n,!t)}},76197:function(e,t,n){"use strict";n.d(t,{open:function(){return _},closeModal:function(){return f},openAlbum:function(){return p},selectImage:function(){return m}});var i=n(91687),o=n(69756),a=n(11393),r=n(1730),s=n(22770),l=n(46950),c=n(9046),u="mvk_profile_image_modal",d="close";function _(e){void 0===e&&(e={});var t=e,n=t.profilePhotosUrl,_=t.uploadUrl,f=t.baseUrl,p=t.staticUrl,m=t.inputAccept,h=t.ownerId,v=t.ownerName,g=t.newAvatarStoryData,A=(0,i.default)({id:"profile-photo-modal",close:!0,on_overlay_click:"ProfileImageModal.closeModal(this);",items:[(0,o.ModalMenuBtn)({"aria-label":(0,l.getLang)("mobile_profile_photo_modal_album"),inner:(0,l.getLang)("mobile_profile_photo_modal_album"),onclick:"ProfileImageModal.openAlbum(this, '"+decodeURIComponent(n)+"');"}),(0,o.ModalMenuBtn)({"aria-label":(0,l.getLang)("mobile_profile_photo_modal_change"),class:"ModalMenu__btn_overflow",inner:[{tag:"input",type:"file",class:"inline_upload","data-upload-url":decodeURIComponent(_)||null,"data-static-url":decodeURIComponent(p)||null,"data-base-url":decodeURIComponent(f)||null,"data-owner-id":h,"data-owner-name":v,"data-new-avatar-story-data":JSON.stringify(g),onchange:"return OwnerPhotoUpload2.onUploadInputChange(this, event);",accept:decodeURIComponent(m)},(0,l.getLang)("mobile_profile_photo_modal_change")],onclick:"ProfileImageModal.selectImage(this);"})]});i.default.open(a.default.elem(A),!0),(0,c.statlogsValueEvent)(u,"open");var y=(0,r.$)(".profile_photo_modal_expand");(0,s.expandPopup)(y).exitIntent=function(){(0,c.statlogsValueEvent)(u,d),i.default.close()}}function f(e){(0,c.statlogsValueEvent)(u,d),i.default.close(e)}function p(e,t){(0,c.statlogsValueEvent)(u,"album"),i.default.close(e),nav.go(t)}function m(e){(0,c.statlogsValueEvent)(u,"upload"),i.default.close(e),(0,r.$)(".inline_upload",e).click()}},16978:function(e,t,n){"use strict";var i=n(76197);window.ProfileImageModal={open:i.open,openAlbum:i.openAlbum,selectImage:i.selectImage,closeModal:i.closeModal}},12082:function(e,t,n){"use strict";n.d(t,{TypingRenderNames:function(){return d},TypingIsEmpty:function(){return u}});var i=n(13725),o=n(62561),a=n(85489),r=n(64723),s=n(46950);function l(){var e=(0,i.default)(['\n    <div class="typing__dotsWrap">\n      <div class="typing__dots">...</div>\n    </div>\n  ']);return l=function(){return e},e}function c(){var e=(0,i.default)(['\n    <div class="','">\n      ','\n      <div class="typing__names">',"</div>\n      ","\n    </div>\n  "]);return c=function(){return e},e}function u(e){return!e}function d(e){return"audio"===e.text?function(e,t){var n=window.lang;if(!(0,s.isArray)(e))return e?n.mobile_mail_recaudio_1_short:"";var i=e,o=t,a="";if(1===o&&i.length>=1){var r=i[0];a=(a=n.mobile_mail_recaudio_1).replace("{name}",r)}else if(2===o&&i.length>=2){var l=i[0],c=i[1];a=(a=(a=n.mobile_mail_recaudio_2).replace("{name1}",l)).replace("{name2}",c)}else if(o>1&&i.length>=1){var u=i[0];a=(a=(a=n.mobile_mail_recaudio_many).replace("{name}",u)).replace("{count}",o-1)}else o>=1&&!i.length&&(a=langNumeric(o,n.mobile_mail_recaudio_N_unknown));return a}(e.typing,e.typingCount):"mixed"===e.text?function(e,t){var n=window.lang;if(!(0,s.isArray)(e))return"";var i=e,o=t,a="";if(1===o&&i.length>=1)a="";else if(2===o&&i.length>=2){var r=i[0],l=i[1];a=(a=(a=n.mobile_mail_mixtyping_2).replace("{name1}",r)).replace("{name2}",l)}else if(o>1&&i.length>=1){var c=i[0];a=(a=(a=n.mobile_mail_mixtyping_many).replace("{name}",c)).replace("{count}",o-1)}else o>=1&&!i.length&&(a=langNumeric(o,n.mobile_mail_mixtyping_N_unknown));return a}(e.typing,e.typingCount):function(e,t){var n=window.lang;if(!(0,s.isArray)(e))return e?n.mobile_mail_typing_1_short:"";var i=e,o=t,a="";if(1===o&&i.length>=1){var r=i[0];a=(a=n.mobile_mail_typing_1).replace("{name}",r)}else if(2===o&&i.length>=2){var l=i[0],c=i[1];a=(a=(a=n.mobile_mail_typing_2).replace("{name1}",l)).replace("{name2}",c)}else if(o>1&&i.length>=1){var u=i[0];a=(a=(a=n.mobile_mail_typing_many).replace("{name}",u)).replace("{count}",o-1)}else o>=1&&!i.length&&(a=langNumeric(o,n.mobile_mail_typing_N_unknown));return a}(e.typing,e.typingCount)}t.default=function(e){var t,n,i=e.dimmed,s=e.animation,_=!!e.compact,f=e.typingCount,p=o.default.class("typing",{dimmed:i,id:e.id,empty:u(f),animation:s}),m=d(e);"audio"===s?(t=Wd.html((0,r.default)({class:a.default.class("typing__loading",{audio:!0,compact:_},"_")})),n=""):"dots"===s?(t=Wd.html((0,r.default)({class:a.default.class("typing__loading",{audio:!1,compact:_},"_")})),n=""):"simple-dots"===s&&(t="",n=o.default.html(l()));return o.default.html(c(),p,t,m,n)}},59337:function(e,t,n){"use strict";var i=n(1730),o=n(12082);Object.assign(o.default,{setTyping:function(e,t){var n="string"==typeof e?(0,i.$)(".typing_id_"+e):e,a=n.$(".typing__names");n.classList.toggle("typing_empty",(0,o.TypingIsEmpty)(t.typingCount)),a.innerHTML=(0,o.TypingRenderNames)(t)},getElem:function(e){return(0,i.$)(".typing_id_"+e)}})},30097:function(e,t,n){"use strict";var i=n(12082);n(59337);t.default=i.default,window.Typing=i.default,Object.assign(window,{Typing_renderNames:i.TypingRenderNames,Typing_isEmpty:i.TypingIsEmpty})},55787:function(e,t,n){"use strict";var i=n(32248);t.default=i.default,window.uBell=i.default},32248:function(e,t,n){"use strict";var i=n(92553);t.default=function(){var e=window.store,t="/feed?section=notifications";return(0,i.default)({url:t,count:e.notificationsCount,onclick:["nav.onMenuItemClick",t]})}},53557:function(e,t,n){"use strict";var i=n(45646);window.uOpenInNativeAppFloatBtn=i.default},45646:function(e,t,n){"use strict";var i,o=n(43027),a=n(512),r=n(9046),s=n(51571),l=["/restore","/login","/join*","/","/settings","/album*","/terms","/privacy","/payments*","/attachments*","/pages*","/blog*","/about","/privacy","/jobs","/dev","/legal","/data_protection","/safety","/activation*","/licence","/agelimits"];function c(){i&&i.classList.remove(o.default.class.open)}function u(){i&&i.classList.add(o.default.class.open)}onDOMReady((function(){!function e(t,n){void 0===n&&(n=!0),n||(i=(0,r.geByClass1)(o.default.class.btn),window.page.onChange(e.bind(this))),t=t?t.split("?")[0]:s.default.path,!/^\/photo/.test(t)&&c(),(0,a.isForbiddenPage)(t,l)||s.default.getQuery("z")?c():u()}(null,!1)})),t.default={_onCloseClick:function(e){o.default._onCloseClick(e)},show:u,hide:c,processOpenInNativeApp:function(e,t,n,i,o){void 0===o&&(o={}),o=o||{},s.default.onMenuItemClick(n),s.default.openInNativeApp(i,t,e),(0,r.statlogsValueEvent)("utm_open_in_native_app_button","clicked",o.utm_source,o.utm_param,o.utm_medium,o.utm_time)}}},46548:function(e,t,n){"use strict";var i=n(61702);window.uRegisterFloatBtn=i.default},61702:function(e,t,n){"use strict";var i,o=n(43027),a=n(9046),r=n(512),s=n(27813),l=["/restore","/login","/authorize*","/join*","/","/settings","/album*","/terms","/privacy","/payments*","/attachments*","/page*","/blog*","/about","/privacy","/jobs","/dev","/legal","/data_protection","/safety","/activation*","/licence","/agelimits"];function c(){i&&i.classList.remove(o.default.class.open)}function u(){i&&i.classList.add(o.default.class.open)}onDOMReady((function(){!function e(t,n){void 0===n&&(n=!0),(0,a.isIosWebView)()||(0,a.isAndroidWebView)()||(0,a.isVkWebView)()||(n||(i=(0,a.geByClass1)(o.default.class.btn),window.page.onChange(e.bind(this))),t=t?t.split("?")[0]:nav.path,!/^\/photo/.test(t)&&c(),(0,r.isForbiddenPage)(t,l)||nav.getQuery("z")?(c(),setTimeout(c)):u())}(null,!1)})),t.default={_onCloseClick:function(e){o.default._onCloseClick(e),(0,s.setCookie)("remixregbtn",0,0)},show:u,hide:c}},69924:function(e,t,n){"use strict";n.r(t);var i=n(3226);window.uVK={onReady:(0,i.default)(),onResize:(0,i.default)(),onOrientationChange:(0,i.default)()},onDOMReady((function(){if(window.isNewMail&&document.body){window.uVK.onReady();var e=document.body.getAttribute("onresize"),t=document.body.getAttribute("onorientationchange");document.body.setAttribute("onresize","uVK.onResize(); "+e),document.body.setAttribute("onorientationchange","uVK.onOrientationChange(); "+t)}}))},76566:function(e,t,n){"use strict";n.d(t,{RecommendedNarrativesList:function(){return o}});var i=n(27109);function o(){return{inner:[(0,i.default)({mix:"RecommendedNarrativesList__locker"}),{class:"RecommendedNarrativesList__content",tag:"div"}],class:"RecommendedNarrativesList",tag:"div"}}},13640:function(e,t,n){"use strict";n.d(t,{RecommendedNarrativesListItem:function(){return a}});var i=n(35909),o=n(58942);function a(e){void 0===e&&(e={});var t=e.narrative;return{inner:[(0,o.default)({narrative:t,isOwnerNameVisible:!0,onClick:["RecommendedNarrativesList.onItemClick","this","event",t.ownerId,t.id]}),{inner:[(0,i.Icon16MoreHorizontal)()],class:"RecommendedNarrativesListItem__editIcon",onClick:["RecommendedNarrativesList.onEditMenuClick",t.id],tag:"div"}],class:"RecommendedNarrativesListItem",tag:"div"}}},53999:function(e,t,n){"use strict";n.d(t,{FormItem:function(){return o}});var i=n(46950);function o(e){void 0===e&&(e={});var t=e.name;return{inner:[{inner:[e.top||""],class:(0,i.classNames)("FormItem__top",{"FormItem__top--hidden":!e.top}),id:t?t+"-top":null,tag:"div"},{inner:[e.inner],class:"FormItem__in",tag:"div"},{inner:[e.bottom||""],class:(0,i.classNames)("FormItem__bottom",{"FormItem__bottom--hidden":!e.bottom}),id:t?t+"-bottom":null,tag:"div"}],class:(0,i.classNames)("FormItem",{"FormItem--error":"error"===e.status,"FormItem--withAsterisk":e.isWithAsterisk},e.className||e.class),"data-name":t,tag:"div"}}},13447:function(e,t,n){"use strict";n.d(t,{FormItem:function(){return i.FormItem}});var i=n(53999)},42685:function(e,t,n){"use strict";function i(e){return void 0===e&&(e={}),{inner:[e.inner],id:e.id,class:"FormLayout",action:e.action,method:e.method||"POST",onSubmit:e.onsubmit||e.onSubmit,noValidate:e.noValidate,tag:"form"}}n.d(t,{FormLayout:function(){return i}})},79810:function(e,t,n){"use strict";var i=n(85489);t.default=function(e){void 0===e&&(e={});var t={};t[e.mode||"vertical"]=!0;var n=i.default.class("FormLayoutGroup",t);return e.class&&(n+=" "+e.class),{inner:[e.inner],class:n,tag:"div"}}},73512:function(e,t,n){"use strict";var i=n(79810);t.default=i.default},75808:function(e,t,n){"use strict";var i=n(11393),o=n(26237),a=n(9046);window.Donut={help:function(e,t){var n=window.lang,r=(0,a.geByClass1)("Tooltip",e);if(r)return;return r=i.default.elem((0,o.default)({pos:"left",inner:n.mobile_donut_info_text})),e.appendChild(r),(0,a.cancelEvent)(t)}}},36536:function(e,t,n){"use strict";n.d(t,{DonutPayment_info:function(){return v}});var i=n(54463),o=n(3061),a=n(80908),r=n(81755),s=n(91033),l=n(49751),c=n(59655),u=n(94163),d=n(11393),_=n(46950),f=n(86205),p=(n(62438),n(16083)),m=n(35909);function h(e){void 0===e&&(e={});var t=window.lang,n=e.options,a=e.form_response;return{inner:[g(e),{inner:[a.error?(0,s.default)({inner:[(0,c.default)({inner:[a.error],theme:"error",title:t.mobile_error_page_title})],style:{small_paddings:!0}}):null],"data-section-ref":"donut_payment_form_error",tag:"div"},e.show_donator_advantages?(0,s.default)({inner:[{inner:[{inner:[(0,_.getLang)("mobile_donut_payment_advantages_title")],class:"DonutPayment__noticeTitle",tag:"div"},{inner:[d.default.html((0,_.getLang)("mobile_donut_payment_advantages_list"))],class:"DonutPayment__noticeList",tag:"div"}],class:"DonutPayment__notice",tag:"div"}],style:{no_padding_bottom:!0}}):null,(0,i.default)({inner:[{type:"hidden",value:e.hash,name:"hash",tag:"input"},n.map((function(e){var t={inner:[e.label?e.label:(0,_.getLang)("mobile_donut_payment_per_month_sum").replace("{amount}",e.amount),{inner:[e.badge],class:"DonutPayment__amountOptionBadge",tag:"span"}],tag:"span"};return[(0,o.default)({input_id:-1===e.amount?"custom_price_input":null,checked:e.is_default,name:"price",type:"radio",label:t,value:e.amount,onChange:"DonutPayment.onPriceRadioChange",disabled:e.is_disabled}),-1===e.amount?(0,s.default)({inner:[(0,r.default)({inputmode:"numeric",type:"text",pattern:"d*",error:a.fields.custom.error,style:{error:a.fields.custom.error},name:"custom_price",on_key_press:"DonutPayment.onCustomAmountChange(event, this)",on_change:"DonutPayment.onCustomAmountChange(event, this)"})],style:{no_padding_bottom:!0,no_padding_top:!0},class:"DonutPayment__customAmount DonutPayment__customAmount--visible",attrs:{"data-section-ref":"custom_price_input_container"}}):null]})),e.cancel_section,(0,s.default)({inner:[{inner:[(0,l.default)({inner:[e.submit_button_text||(0,_.getLang)("mobile_donut_payment_pay_button")],is_submit:!0,stretch:!0,size:"large"})],class:"DonutPayment__submitButtonContainer",tag:"div"}],style:{no_padding_bottom:!0,no_padding_top:!0}}),e.terms_text?(0,s.default)({inner:[d.default.wrap(e.terms_text)],class:"DonutPayment__terms DonutPayment__terms--externalLinks",style:{small_paddings:!0},attrs:{"data-section-ref":"donut_payment_external_links"}}):null,e.data_access_url?(0,s.default)({inner:[{inner:[(0,_.getLang)("mobile_donut_data_access_don_link")],href:e.data_access_url,tag:"a"}],class:"DonutPayment__terms DonutPayment__terms--externalLinks",style:{small_paddings:!0}}):null,e.partner_link?(0,s.default)({inner:[{inner:[(0,_.getLang)("groups_edit_donut_settings_by_boosty_link"),{inner:[(0,f.default)((0,p.getBoostyLogoIcon)())],class:"DonutPayment__partnerLinkLogo",role:"img","aria-label":(0,_.getLang)("groups_edit_donut_settings_by_boosty_link_image_label"),title:(0,_.getLang)("groups_edit_donut_settings_by_boosty_link_image_label"),tag:"div"}],href:e.partner_link,target:"_blank",rel:"noopener",class:"DonutPayment__partnerLink",tag:"a"}],class:"DonutPayment__terms",style:{small_paddings:!0}}):null],no_border:!0,noShadow:!0,title:t.mobile_donut_payment_select_head})],action:e.action,method:"post",class:"DonutPaymentForm",onSubmit:"DonutPayment.onFormSubmit(event, this)","data-section-ref":"donut_payment_form",tag:"form"}}function v(e){void 0===e&&(e={});var t={inner:[e.icon],class:"SplashScreen__icon",tag:"div"};return(0,u.default)({icon_raw:t,title:e.title,text:e.description,action_text:e.action_text,action_url:e.action_url,before:g(e),class:"DonutPaymentInfo"})}function g(e){return void 0===e&&(e={}),{inner:["form"===e.layout?[{inner:[{inner:[(0,m.Icon12StarCircleFillYellow)()],class:"DonutPayment__avatarIcon",tag:"div"}],class:"DonutPayment__avatar",style:"background-image: url("+e.avatar+")",tag:"div"},{inner:[e.title],class:"DonutPayment__title",tag:"h2"},e.description?{inner:[e.description],class:"DonutPayment__description",tag:"span"}:null]:null],class:"DonutPayment__header",tag:"div"}}t.default=function(e){return void 0===e&&(e={}),e.layout||(e.layout="form"),[(0,a.default)({hideOnDesktop:!0}),(0,i.default)({inner:["form"===e.layout?h(e):null,"info"===e.layout?v(e):null],class:"DonutPayment",attrs:{"data-section-ref":"donut_payment_content"}})]}},26127:function(e,t,n){"use strict";n.d(t,{DonutPaymentGlobals:function(){return S}});var i=n(46769),o=n(1730),a=n(80444),r=n(11393),s=n(83242),l=n(9046),c=n(93858),u=n(49751),d=n(54774),_=n(81755),f=n(80400),p=n(22402),m=n(10612),h=n(83055),v=n(86205),g=n(83652),A={},y=(0,m.getPaymentSessionInitialData)(),w=function(){return b({title:(0,l.getLang)("mobile_donut_payment_info_error"),description:(0,l.getLang)("mobile_donut_payment_info_canceled_text")})},S={init:function(e){var t=e.backURL,n=e.isCustomPriceVisible,i=e.ownerId,a=e.source,r=e.type,s=e.waitingTimeSec,c=e.successActionUrl;(0,m.handlePaymentComponentChange)(y,S),A={backURL:t,ownerId:i,source:a,type:r,waitingTimeSec:s,successActionUrl:c};var u=(0,o.$)("#custom_price_input"),d=u&&u.checked;I(n||d),"subscribe"===r&&(_=(0,o.$)('[data-section-ref="donut_payment_external_links"]'))&&(0,l.addEvent)(_,"click",(function(e){(0,l.matchesSelector)(e.target,"a")&&P()}));var _;(0,m.handlePaymentComponentDestroy)(y,S)},onCustomAmountChange:function(e,t){return(0,o.$)("#custom_price_input").checked=!0,_.default.filter("number",e,t)},onLegalExternalLinkClick:P,onFormSubmit:function(e,t){e.preventDefault();var n=(0,s.getFormValues)(t),r=(0,a.parseURL)(t.action);"subscribe"===A.type&&function(e,t,n){var o=y.id,r=(0,l.submitBtn)(n),s=(0,m.getPaymentWindow)((0,l.getLang)("mobile_donut_payment_info_waiting"));u.default.setLoading(r,!0);var c=window.ajax.post(e.requestUri,t);(0,m.handleRequestAbortOnDestroy)(c),c.promise.then((function(e){var n=e.json;if(!e.skip){if(o!==y.id)throw new Error;u.default.setLoading(r,!1);var c=n.data[0],d=(0,a.makeUrl)(window.nav.path,{act:"donut_payment_check",hash:t.hash});(0,m.startPaymentWaiting)((0,i.default)({sessionIdCurrent:y.id,paymentURL:c,paymentWindow:s,getIsSuccess:function(){var e=window.ajax.post(d,{});return(0,m.handleRequestAbortOnDestroy)(e),e.promise.then((function(e){var t,n=e.json;if(!e.skip){if(o!==y.id)throw new Error;if(!n)throw new Error;return!!(null==n||null==(t=n.data)?void 0:t[0].status)&&(b({title:(0,l.getLang)("mobile_donut_payment_info_success"),description:n.data[0].text}),M(p.DonutActionEventScreen.RESULT_PAYMENT_SUCCESS_OK),A.successActionUrl&&(nav.hard_go(A.successActionUrl),A.successActionUrl=void 0),!0)}}))}},{onLoading:function(){k()},onResponse:function(){M(p.DonutActionEventScreen.RESULT_PAYMENT_SUCCESS_WAITING)},onCancel:function(){w(),M(p.DonutActionEventScreen.RESULT_PAYMENT_CANCEL)},onFailure:function(){w(),M(p.DonutActionEventScreen.RESULT_ERROR)},onTimeout:function(){b({title:(0,l.getLang)("mobile_donut_payment_info_success"),description:(0,l.getLang)("mobile_donut_payment_info_success_later_text"),type:"success"}),M(p.DonutActionEventScreen.RESULT_PAYMENT_SUCCESS_WAITING_TIMEOUT)}}))}})).catch((function(e){console.error(e),u.default.setLoading(r,!1),C({message:(0,l.getLang)("mobile_unknown_error")}),(0,m.closePaymentWindow)(s)}))}(r,n,t);"change"===A.type&&function(e,t,n){var r=y.id,s=(0,l.submitBtn)(n);u.default.setLoading(s,!0),c=(0,o.$)('[data-section-ref="donut_payment_form_error"]'),c&&(c.innerHTML="");var c;var d=(h=t,-1===Number(h.price)?Number(h.custom_price):Number(h.price)),_=(0,m.getPaymentWindow)((0,l.getLang)("mobile_donut_payment_info_waiting")),f=window.ajax.post(e.requestUri,t);var h;(0,m.handleRequestAbortOnDestroy)(f),f.promise.then((function(e){var t,n=e.json;if(!e.skip){var o=null==n||null==(t=n.data)?void 0:t[0];if(r!==y.id||!o||!Object.keys(o).length)throw new Error;if(u.default.setLoading(s,!1),null==o?void 0:o.error)return C({message:null==o?void 0:o.error}),void(0,m.closePaymentWindow)(_);o.paymentRequiredToComplete?function(e,t,n){var o=y.id,r=(0,a.makeUrl)(window.nav.path,{act:"donut_payment_change_check",hash:e.check_hash}),s=function(){E({description:e.successDescription}),M(p.DonutActionEventScreen.RESULT_CHANGE_SUCCESS_OK)};(0,m.startPaymentWaiting)((0,i.default)({sessionIdCurrent:y.id,paymentURL:e.paymentURL,paymentWindow:n,getIsSuccess:function(){var e=window.ajax.post(r,{});return(0,m.handleRequestAbortOnDestroy)(e),e.promise.then((function(e){var n,i,a=e.json;if(!e.skip){if(o!==y.id)throw new Error;if((null==a||null==(n=a.data)||null==(i=n[0])?void 0:i.amount)===t)return s(a),!0;throw new Error}}))}},(c=function(){w(),M(p.DonutActionEventScreen.RESULT_CHANGE_ERROR)},{onFailure:c,onCancel:c,onLoading:function(){k()},onResponse:function(){M(p.DonutActionEventScreen.RESULT_PAYMENT_SUCCESS_WAITING)},onTimeout:function(){b({title:(0,l.getLang)("mobile_donut_payment_change_timeout_error_title"),description:(0,l.getLang)("mobile_donut_payment_change_timeout_error_description"),continueButtonURL:A.backURL}),M(p.DonutActionEventScreen.RESULT_CHANGE_SUCCESS_WAITING_TIMEOUT)}})));var c}(o,d,_):(E({description:o.successDescription}),(0,m.closePaymentWindow)(_))}})).catch((function(e){console.error(e),u.default.setLoading(s,!1),C({message:(0,l.getLang)("mobile_unknown_error")}),(0,m.closePaymentWindow)(_)}))}(r,n,t)},onPriceRadioChange:function(e){I(-1===Number(e.value))}};function b(e){void 0===e&&(e={});var t=(0,o.$)('[data-section-ref="donut_payment_content"]');if(t){var n=e.type;try{t.innerHTML=r.default.html((0,h.DonutPaymentInfo)({icon:e.icon,layout:"info",type:n,title:e.title||(0,l.getLang)("mobile_donut_payment_info_error"),description:e.description||"",action_text:("success"===n||"error"===n)&&(0,l.getLang)("mobile_donut_payment_button"),action_url:e.continueButtonURL||window.nav.path}))}catch(e){console.error(e)}}}var k=function(){b({title:(0,l.getLang)("mobile_donut_payment_info_waiting"),description:(0,l.getLang)("mobile_donut_payment_info_waiting_text"),type:"loading",icon:{inner:[(0,v.default)({icon:(0,g.getLoading40Icon)()})],class:"SplashScreen__icon SplashScreen__icon--loading",tag:"div"}})};function C(e){var t=e.message,n=(0,d.default)({inner:[(0,c.default)({inner:[t],theme:"error"})],style:{small_paddings:!0}}),i=(0,o.$)('[data-section-ref="donut_payment_form_error"]');i&&(i.innerHTML=r.default.html(n))}function E(e){b({description:e.description,title:(0,l.getLang)("mobile_donut_payment_change_amount_changed_title"),continueButtonURL:A.backURL}),M(p.DonutActionEventScreen.RESULT_CHANGE_SUCCESS_OK)}function I(e){void 0===e&&(e=!1),(0,l.toggleClass)("DonutPayment__customAmount--visible",(0,o.$)('[data-section-ref="custom_price_input_container"]'),e)}function T(e,t,n){f.donutStats.logEventAction((0,i.default)({event_type:e,owner_id:A.ownerId,screen:t||p.DonutActionEventScreen.UNKNOWN,source:A.source},n))}function M(e,t){T(p.DonutActionEventType.PAYMENT_FORM,e,t)}function P(){T(p.DonutActionEventType.PAYMENT_FORM_CLICK_OFFER,p.DonutActionEventScreen.PAYMENT_START)}},83055:function(e,t,n){"use strict";n.d(t,{DonutPaymentInfo:function(){return i.DonutPayment_info}});var i=n(36536),o=n(26127);window.DonutPayment=o.DonutPaymentGlobals;i.default},52109:function(e,t,n){"use strict";n(39196)},75851:function(e,t,n){"use strict";var i=n(9046);window.GroupsMenu={},window.GroupsMenu._onClick=function(e,t,n,o,a){return(0,i.statlogsValueEvent)("groups_menu_item_click",e,t,n,o,a),!0}},25014:function(e,t,n){"use strict";var i=n(91687),o=n(35909);t.default=function(e){void 0===e&&(e={});var t=null;e.ok_button&&(t=(0,i.ModalMenuBtn)({url:e.proceed_url,class:"WarningModal__button",theme:"secondary",size:"large",inner:e.ok_button,onclick:["WarningModal.close","this","event"],attrs:{"data-id":e.id,"data-hash":e.hash,"data-gid":e.gid,"data-uid":e.user_id,"data-need-reload":e.need_reload_on_accept?1:0}}));return(0,i.default)({on_overlay_click:"return false;",class:"Popup_open",body:{class:"WarningModal",inner:[{class:"WarningModal__icon",inner:(0,o.Icon56HideOutline)()},{class:"WarningModal__title",inner:e.title},{class:"WarningModal__text",inner:e.text}]},items:[(0,i.ModalMenuBtn)({url:"/groups",class:"WarningModal__button",theme:"regular",size:"large",inner:e.back_button,onclick:["WarningModal.leave","this","event"],attrs:{"data-id":e.id,"data-hash":e.hash,"data-gid":e.gid,"data-uid":e.user_id}}),t]})}},92248:function(e,t,n){"use strict";n.d(t,{close:function(){return s},leave:function(){return r}});var i=n(1730),o=n(69756),a=n(86658);function r(e,t){t&&t.preventDefault(),o.default.close(e);var n=(0,i.$)("#m .header__back");n?n.click():window.history?window.history.back():window.location="/"}function s(e,t){t&&t.preventDefault(),o.default.close(e);var n=a.default.post("/groups",{_ajax:1,act:"hide_warning_notification",notification_id:e.dataset.id,group_id:e.dataset.gid,hash:e.dataset.hash});Number(e.dataset.needReload)&&n.promise.then((function(){return nav.reload()}))}},74814:function(e,t,n){"use strict";var i=n(25014),o=n(92248),a=n(9046);i.default;window.WarningModal=i.default,(0,a.extend)(i.default,{close:o.close,leave:o.leave})},32124:function(e,t,n){"use strict";n.d(t,{ConnectionType:function(){return i.ConnectionType}});var i=n(52934);window.Lite={ConnectionType:i.ConnectionType}},71490:function(e,t,n){"use strict";n.d(t,{BotsKeyboardRow:function(){return _}});var i=n(49751),o=n(86205),a=n(11393),r=n(85489),s=n(46950),l=n(81752),c=n(35909),u=n(16549),d=n(7808);function _(e,t,n,_,f,p){var m=0;return{class:"BotsKeyboard__row",inner:e.map((function(e){return function(e,t,n,_,f,p,m){var h,v=window.lang,g=e.action.type,A=r.default.class("BotsKeyboard__button",{primary:"primary"===e.color||"vkpay"===g,positive:"positive"===e.color,negative:"negative"===e.color}),y=["window.uMailWrite && uMailWrite._onKeyboardButtonClick","this","event",{action:(0,s.stringifyJSON)(e.action),authorId:t.author_id,inline:t.inline,msgId:n,subID:f}];h="vkpay"===g?[{class:"BotsKeyboard__buttonInner",inner:[a.default.wrap(v.mobile_mail_keyboard_label_vkpay),a.default.wrap("&nbsp;"),a.default.wrap("&nbsp;"),(0,o.default)((0,l.getVkPay16Icon)())]}]:"location"===g?[{class:"BotsKeyboard__buttonInner",inner:[{tag:"span",class:"BotsKeyboard__leadingIcon",inner:(0,c.Icon24Place)()},a.default.wrap("&nbsp;"),{class:"BotsKeyboard__buttonLabelWrapped",inner:[a.default.wrap(v.mobile_mail_keyboard_label_location)]}]}]:"open_app"===g?[{class:"BotsKeyboard__buttonInner",inner:[{tag:"span",class:"BotsKeyboard__leadingIcon",inner:(0,o.default)((0,u.getService24Icon)())},a.default.wrap("&nbsp;"),{class:"BotsKeyboard__buttonLabelWrapped",inner:[a.default.wrap(e.action.label)]}]}]:"open_link"===g?[{class:"BotsKeyboard__buttonInner",inner:[{class:"BotsKeyboard__buttonLabelWrapped",inner:[a.default.wrap(e.action.label)]},a.default.wrap("&nbsp;"),(0,o.default)((0,d.getOpenLink16Icon)())]}]:[a.default.wrap(e.action.label)];var w=!1,S="";f&&(S=f+"|");var b=""+S+p+","+m;_&&_[b]&&(w=!0);return(0,i.default)({class:A,isLoading:w,spinner:!0,on_click:y,use_native_onclick:!0,inner:h,theme:"none",size:"normal",type:"button",attrs:{"data-position":b}})}(e,t,n,_,f,p,m++)}))}}t.default=function(e){var t=e.keyboard,n=e.msgId,i=e.pressed||{},o=t.buttons,a=e.subID,r=0;return{class:"BotsKeyboard__main",inner:o.map((function(e){return _(e,t,n,i,a||null,r++)}))}}},84359:function(e,t,n){"use strict";n.d(t,{BotsKeyboardRow:function(){return i.BotsKeyboardRow}});var i=n(71490);t.default=i.default},73630:function(e,t,n){"use strict";n.d(t,{open:function(){return l}});var i=n(98330),o=n(11393),a=n(46950),r=n(49751),s=n(35909);function l(){i.default.open({body:o.default.html({inner:[{inner:[(0,s.Icon56DataStackLockOutline)()],class:"BusinessNotifyDialog__icon",tag:"div"},{inner:[(0,a.getLang)("mobile_mail_business_notify_info_box_title")],class:"BusinessNotifyDialog__title",tag:"div"},{inner:[o.default.wrap((0,a.getLang)("mobile_mail_business_notify_info_box_text"))],class:"BusinessNotifyDialog__text",tag:"div"}],class:"BusinessNotifyDialog",tag:"div"}),buttons:o.default.html((0,r.default)({inner:[(0,a.getLang)("mobile_mail_business_notify_info_box_button")],class:"mailDialog__button mailDialog__confirmButton BusinessNotifyDialog__button",onClick:"MailDialog.close"}))})}},60157:function(e,t,n){"use strict";n.d(t,{openBusinessNotifyDialog:function(){return i.open}});var i=n(73630)},49267:function(e,t,n){"use strict";var i=n(46950),o=n(86205),a=n(15527);t.default=function(){return{inner:[{inner:[(0,o.default)({icon:(0,a.getBomb24Icon)()})],class:"CasperHiddenMessages__buttonIcon","aria-hidden":"true",tag:"span"},{inner:[(0,i.getLang)("mobile_casper_chat_message_has_gone")],class:"CasperHiddenMessages__buttonText",tag:"span"}],class:"CasperHiddenMessages__button",onClick:["CasperHiddenMessages.clickHandler","this","event"],"aria-haspopup":"true","aria-expanded":"false","aria-controls":"mail-dialog",tag:"button"}}},44413:function(e,t,n){"use strict";var i=n(98330),o=n(11393),a=n(46950),r=n(22770),s=null,l={clickHandler:function(e){i.default.open({body:o.default.html({inner:[(0,a.getLang)("mobile_casper_message_modal_info")],class:"CasperHiddenMessages__paragraph",tag:"p"}),title:(0,a.getLang)("mobile_casper_message_modal_title"),class:"CasperHiddenMessages__dialog",buttons:o.default.html({inner:[{inner:[(0,a.getLang)("mobile_casper_message_modal_close")],tag:"span"}],class:"Btn Btn_theme_secondary Btn_size_small mailDialog__confirmButton",tag:"button"}),onConfirm:function(){s(),i.default.close()},onClose:function(){s(),i.default.close()}}),(s=(0,r.expandPopup)(e)).exitIntent=function(){i.default.close()}}};t.default=l},80674:function(e,t,n){"use strict";n.r(t);var i=n(49267),o=n(44413);window.CasperHiddenMessages=o.default,t.default=i.default},2128:function(e,t,n){"use strict";var i=n(86205),o=n(85489),a=n(46950),r=n(35909),s=n(25810);t.default=function(e){var t=e.durationInSeconds,n=e.isDefaultCasperTimerShown,l=t<=60;return{inner:[{inner:[(0,r.Icon16Bomb)()],class:o.default.class("CasperTimer__icon",{normal:!0}),"aria-hidden":"true",tag:"span"},{inner:[(0,i.default)({icon:(0,s.getBombActive16Icon)()})],class:o.default.class("CasperTimer__icon",{warning:!0}),"aria-hidden":"true",tag:"span"},{inner:[(0,a.formatDuration)(t)],class:"CasperTimer__timer",role:"timer","aria-live":"polite",tag:"span"}],class:o.default.class("CasperTimer",{active:t>0,hidden:!n,warning:l}),onClick:["CasperTimer.clickHandler","this","event"],"aria-haspopup":"true","aria-expanded":"false",title:(0,a.getLang)("mobile_casper_timer_title"),"data-left":t,tag:"button"}}},33696:function(e,t,n){"use strict";var i=n(1730),o=n(46950),a=n(24945),r=new(n(96835).Timers)({}),s="CasperTimer--hidden",l="CasperTimer__timer--opened",c="CasperTimer--itsGonnaBlow",u={init:function(e){var t=this;if((0,a.isMessageWithoutLocalId)(e))return!1;var n=(0,i.$)(".msg_id_"+e);if(!n)return!1;var u=(0,i.$)(".CasperTimer",n);if(!u)return!1;var d=this.getTimerElement(u);r.add((function(n){if(u.parentNode){var i=t.getLeftSeconds(u);(i-=n)<=0&&(u.classList.add(s),d.classList.remove(l),u.classList.remove(c),setTimeout((function(){u.hasOwnProperty("remove")?u.remove():u&&u.parentNode&&u.parentNode.removeChild(u)}),1e3),r.remove(e),i=0),t.setLeftSeconds(u,i),i>0&&i<=10&&u.classList.add(c),i>0&&i<=60&&(u.classList.remove(s),u.classList.add("CasperTimer--warning")),t.isOpened(u)&&(d.innerHTML=(0,o.formatDuration)(i))}else r.remove(e)}),{id:e})},getLeftSeconds:function(e){return parseInt(e.getAttribute("data-left"))},setLeftSeconds:function(e,t){e.setAttribute("data-left",t)},getTimerElement:function(e){if(!e)throw new Error("CasperTimer: element is not provided");return(0,i.$)(".CasperTimer__timer",e)},isOpened:function(e){return this.getTimerElement(e).classList.contains(l)},clickHandler:function(e,t){var n=this.getTimerElement(e);n.classList.toggle(l);var i=this.isOpened(e);e.setAttribute("aria-expanded",i),n.innerHTML=(0,o.formatDuration)(this.getLeftSeconds(e)),t.stopPropagation(),clearTimeout(e._autoCloseTimer),i&&(e._autoCloseTimer=setTimeout((function(){n&&n.classList.remove(l)}),4e3))}};t.default=u},7912:function(e,t,n){"use strict";n.r(t);var i=n(2128),o=n(33696);window.CasperTimer=o.default,t.default=i.default},27917:function(e,t,n){"use strict";n.d(t,{Convo__online:function(){return y},Convo__rightStatus:function(){return w},Convo__peerTags:function(){return S},Convo__unreadValue:function(){return b}});var i=n(13725),o=n(11393),a=n(62561),r=n(72592),s=n(60767),l=n(39423),c=n(80540),u=n(86205),d=n(30097),_=n(46950),f=n(23696),p=n(97786),m=n(35909),h=n(11539),v=(n(27348),n(27301));function g(){var e=(0,i.default)(['\n    <div class="','" ',">\n      ","\n      ",'\n      <a class="convo__body" href="','">\n        <div class="convo__row convo__row_title ','">\n          <div class="convo__title">',"</div>\n          ","\n          ","\n          ",'\n          <div class="convo__row_right">\n            ','\n            <div class="convo__date">',"</div>\n          </div>\n        </div>\n        ","\n      </a>\n    </div>\n  "]);return g=function(){return e},e}function A(){var e=(0,i.default)(['\n    <div class="convo__row convo__row_text">\n      <div class="convo__typing">','</div>\n      <div class="convo__text">','</div>\n      <div class="convo__row_right convo__unreadBox" ',">\n        ",'\n        <div class="convo__unreadOut"></div>\n        ','\n      </div>\n      <div class="convo__status">','</div>\n      <div class="convo__pin">',"</div>\n    </div>\n  "]);return A=function(){return e},e}function y(e){return"mobile"===e?o.default.html({inner:[{inner:[(0,u.default)({icon:(0,f.getOnlineMobileComposite16Icon)()})],class:"mlvi_default",tag:"div"},{inner:[(0,u.default)({icon:(0,p.getOnlineMobileCompositeMuted16Icon)()})],class:"mlvi_muted",tag:"div"}],class:"lvi mlvi convo__online convo__online_mobile",tag:"div"}):"desktop"===e?(0,r.default)({mix:a.default.class("convo__online",{desktop:!0})}):(0,r.default)({mix:"convo__online"})}function w(e){var t=window.lang;return e.pending?o.default.html({inner:[(0,m.Icon16Recent)()],class:"convo__pending",tag:"div"}):e.failed?'<div class="convo__failed">'+t.mobile_mail_send_error+"</div>":""}function S(e){var t=e.tags,n=e.tagsData,i=[];t&&n.peerTags&&(i=t.filter((function(e){return n.peerTags.indexOf(e.id)>-1})));var a,r=i.length;if(!r&&!n.fromAd)return"";if(n.fromAd&&!r)a={class:"convo__adTag",inner:[(0,_.getLang)("mobile_mail_ad_tag_no_access_text"),(0,u.default)((0,v.getAdTag10Icon)())]};else if(n.fromAd||1!==r){var s=window.lang,l=r+(n.fromAd?1:0);a={class:"convo__extraTag",inner:langNumeric(l,s.mobile_mail_peer_profile_extra_tags)}}else{var c=i[0];a={class:"convo__peerTag",inner:c.name,style:"background-color: "+c.color}}return o.default.html({class:"convo__peerTags",inner:a})}function b(e,t){var n=e;return t&&e<=0&&(n="empty"),n}t.default=function(e){var t,n,i=e.more,r="",f="",p=0,v=!1,k="",C=(0,_.isPinnedSortId)(e.majorSortId);i&&(r=i.text,f=i.date,p=i.unreadCount,v=i.muted,k=i.typing?(0,d.default)(i.typing):"",t=i.pending,n=i.failed,(t||n)&&(f=""));var E=a.default.class("clickable","convo",{id:e.id,short:!i,last:e.isLast,typing:!!k,important:e.important,unread:e.isLast&&(p>0||e.isMarkedUnread),unreadOut:e.isLast&&p<0,pinned:i&&C}),I=o.default.html((0,c.Avatar)({size:50,src:e.photos,mix:"convo__avatar",url:e.profileUrl,mode:(0,_.getAvatarMode)({id:e.id,name:e.title}),backgroundTheme:e.id,text:e.title,textLength:(0,_.getAvatarTextLength)(e.id)})),T=w({pending:t,failed:n}),M=y(e.online),P=o.default.html((0,l.default)({mix:"convo__star",icon:"star",blue:!0})),L=S(e.peerProfile),N=o.default.html((0,m.Icon16Pin)()),R=e.isLast?(0,s.default)({mix:"convo__unread",value:b(p,e.isMarkedUnread),gray:v}):"",x=e.url,B=a.default.onClick("Convo._onClick","event",x),D=e.isCasper?'<span class="convo__casper" title="'+(0,_.getLang)("mobile_casper_chat_title")+'">'+o.default.html((0,u.default)((0,h.getCasper16Icon)()))+"</span>":"",O=e.isDonutChat?'<span class="convo__casper">'+o.default.html((0,m.Icon12StarCircleFillYellow)())+"</span>":"",U=a.default.html(A(),k,r,T?"hidden":"","",R,T,N),H="";e.isWithoutMessage&&(U="",H="convo__row_centered");return a.default.html(g(),E,B,M,I,e.url,H,e.title,L,D,O,P,f,U)}},32370:function(e,t,n){"use strict";var i=n(1730),o=n(3226),a=n(9046),r=(n(62691),n(60767)),s=n(30097),l=n(27917),c=n(46950);function u(e,t){e.stopPropagation(),e.preventDefault(),l.default.onTap(t)}Object.assign(l.default,{onTap:(0,o.default)("url"),setOnline:function(e,t){(0,i.$$)(".convo_id_"+e+" .convo__online").forEach((function(e){e.outerHTML=(0,l.Convo__online)(t)}))},setLastMsg:function(e,t,n){var o=n.dateShort,a=n.pending,r=n.failed;(0,i.$$)(".convo_last.convo_id_"+e).forEach((function(e){e.$(".convo__text").innerHTML=t,e.$(".convo__status").innerHTML=(0,l.Convo__rightStatus)({pending:a,failed:r}),a||r?(e.$(".convo__date").innerText="",e.$(".convo__unreadBox").hidden=!0):(e.$(".convo__date").innerText=o,e.$(".convo__unreadBox").hidden=!1)}))},setTyping:function(e,t){(0,i.$$)(".convo_last.convo_id_"+e).forEach((function(e){var n=e.$(".convo__typing"),i=t.typing;if(t.typingCount&&(!0===i||(0,c.isArray)(i))){var o=n.$(".typing"),a=o&&q.parseClass("typing",o.className);o&&a.animation===t.animation?s.default.setTyping(o,t):(e.classList.add("convo_typing"),n.innerHTML=(0,s.default)(t))}else n.innerHTML="",e.classList.remove("convo_typing")}))},setUnreadCount:function(e,t,n){(0,i.$$)(".convo_last.convo_id_"+e).forEach((function(e){var i=e.$(".Oval");e.classList.toggle("convo_unread",t>0||n),e.classList.toggle("convo_unreadOut",t<0),r.default.setValue(i,(0,l.Convo__unreadValue)(t,n))}))},setImportant:function(e,t){(0,i.$$)(".convo_id_"+e).forEach((function(e){e.classList.toggle("convo_important",t)}))},updateAdTag:function(e,t){(0,i.$$)(".convo_id_"+e).forEach((function(e){var n=(0,i.$)("convo__peerTags",e);t.fromAd&&!n&&(n=(0,a.ceFromString)((0,l.Convo__peerTags)({tagsData:t})),after(n,(0,i.$)(".convo__title",e)))}))},updatePinned:function(e,t){(0,i.$$)(".convo_id_"+e).forEach((function(e){e.classList.toggle("convo_pinned",t)}))}}),l.default._onClick=u},83228:function(e,t,n){"use strict";n.r(t);var i=n(27917);n(32370);t.default=i.default,window.Convo=i.default,window.Convo__online=i.Convo__online},39292:function(e,t,n){"use strict";n.d(t,{ConvoListFindFriendsStub:function(){return s}});var i=n(80540),o=n(49751),a=n(46950),r=n(35909);function s(e){void 0===e&&(e={});var t,n,s=(0,a.makeUrl)("friends",{act:"import",from_section:"all"}),l=e.class||"";return{inner:[(t=e.recommendedFriends,n=t.length?t.map((function(e){var t=(0,a.getAvatarMode)({id:e.id,name:e.name});return{inner:[(0,i.Avatar)({src:e.photo,size:56,mode:t,backgroundTheme:e.id,text:e.name,textLength:(0,a.getAvatarTextLength)(e.id)})],class:"ConvoListFindFriendsStub__avatarWrapper",tag:"div"}})):(0,r.Icon56UsersOutline)(),{inner:[n],class:"ConvoListFindFriendsStub__avatarsStack",tag:"div"}),{inner:[(0,a.getLang)("mobile_mail_find_friends_stub_header")],class:"ConvoListFindFriendsStub__header",tag:"span"},{inner:[(0,a.getLang)("mobile_mail_find_friends_stub_text")],class:"ConvoListFindFriendsStub__text",tag:"span"},(0,o.default)({inner:[(0,a.getLang)("mobile_mail_find_friends_stub_button")],tag:"a",url:s})],class:l+" ConvoListFindFriendsStub",tag:"div"}}},45162:function(e,t,n){"use strict";n.d(t,{ConvoListFindFriendsStub:function(){return i.ConvoListFindFriendsStub}});var i=n(39292)},79219:function(e,t,n){"use strict";n.d(t,{GroupCallSnippet:function(){return a}});var i=n(46950),o=n(35909);function a(e){var t=e.data,n=t?{inner:[(0,i.getLang)("mobile_mail_snippet_groupcall_connect")],class:"GroupCallSnippet__link",tag:"div"}:{inner:[(0,i.getLang)("mobile_mail_snippet_groupcall_ended")],class:"GroupCallSnippet__ended",tag:"div"};return{inner:[{inner:[(0,o.Icon24Phone)()],class:"GroupCallSnippet__left",tag:"div"},{inner:[{inner:[(0,i.getLang)("mobile_mail_snippet_groupcall_title")],class:"GroupCallSnippet__title",tag:"div"},n],class:"GroupCallSnippet__main",tag:"div"}],class:"MailButton GroupCallSnippet",type:"button",onClick:t?["GroupCallSnippet.join",t]:"",tag:"button"}}},32511:function(e,t,n){"use strict";n.d(t,{GroupCallSnippet:function(){return o}});var i=n(39161),o={join:function(e){i.SAKIntegration.isIntegrated&&i.SAKIntegration.sendMessage("call_join",{callData:e,peerId:store.mail.cur.peerId})}}},29290:function(e,t,n){"use strict";n.r(t),n.d(t,{GroupCallSnippet:function(){return i.GroupCallSnippet},GroupCallSnippetSkin:function(){return o.GroupCallSnippet}});var i=n(32511),o=n(79219);window.GroupCallSnippet=i.GroupCallSnippet},97093:function(e,t,n){"use strict";var i=n(13725),o=n(62561),a=n(39423),r=n(11393);function s(){var e=(0,i.default)(['\n    <div class="','" ',">","</div>\n  "]);return s=function(){return e},e}function l(){var e=(0,i.default)(['\n    <button class="','" aria-label="','" ',"></button>\n  "]);return l=function(){return e},e}function c(){var e=(0,i.default)(['\n    <button class="Btn Btn_theme_small ','" ',">\n      ","\n    </button>\n  "]);return c=function(){return e},e}function u(){var e=(0,i.default)(['\n    <div class="','">\n\n      ','\n\n      <div class="mailActs__counter"></div>\n\n      <div class="mailActs__buttons">\n        <div class="mailActs__buttonsIn">\n          ',"\n          ",'\n        </div>\n        <div class="mailActs__chevron">\n          <div class="mailActs__chevronIn">\n            ',"\n            ","\n            ","\n            ","\n            ",'\n          </div>\n          <div class="mailActs__chevronMore">\n            <div class="mailActs__chevronMoreIcon" ','></div>\n            <div class="mailActs__chevronList">\n              ',"\n              ","\n              ","\n              ","\n              ","\n            </div>\n          </div>\n        </div>\n      </div>\n\n    </div>\n  "]);return u=function(){return e},e}function d(e){var t=window.lang,n=o.default.class("mailActs__button",{type:e}),i=o.default.onClick("MailActs._onButtonClick",e),a="reply"===e?t.mobile_mail_messages_actions_reply:t.mobile_mail_messages_actions_forward;return o.default.html(c(),n,i,a)}function _(e,t){var n,i=window.lang,a=o.default.class("mailActs__icon",{type:e}),r=o.default.onClick("MailActs._onButtonClick",e),s=t.isPinned?i.mobile_mail_messages_actions_unpin:i.mobile_mail_messages_actions_pin,c=t.isImportant?i.mobile_mail_messages_actions_important_off:i.mobile_mail_messages_actions_important;switch(e){case"edit":n=i.mobile_mail_messages_actions_edit;break;case"pin":n=s;break;case"important":n=c;break;case"remove":n=i.mobile_mail_messages_actions_delete;break;case"spam":n=i.mobile_mail_messages_actions_spam}return o.default.html(l(),a,n,r)}function f(e,t){var n,i=window.lang,a=o.default.class("mailActs__chevronListItem",{type:e}),r=o.default.onClick("MailActs._onButtonClick",e),l=t.isPinned?i.mobile_mail_messages_actions_unpin:i.mobile_mail_messages_actions_pin,c=t.isImportant?i.mobile_mail_messages_actions_important_off:i.mobile_mail_messages_actions_important;switch(e){case"edit":n=i.mobile_mail_messages_actions_edit;break;case"pin":n=l;break;case"important":n=c;break;case"remove":n=i.mobile_mail_messages_actions_delete;break;case"spam":n=i.mobile_mail_messages_actions_spam}return o.default.html(s(),a,r,n)}t.default=function(e){e||(e={});window.lang;var t=o.default.onClick("MailActs._onMoreClick"),n=r.default.html((0,a.default)({mix:"mailActs__close",icon:"close12",attrs:o.default.onClick("MailActs._onCloseClick")})),i=d("reply"),s=d("forward"),l=_("edit",e),c=_("pin",e),p=_("important",e),m=_("remove",e),h=_("spam",e),v=f("edit",e),g=f("pin",e),A=f("important",e),y=f("remove",e),w=f("spam",e),S=o.default.class("mailActs",{canPin:e.canPin,pinned:e.isPinned,important:e.isImportant,isChannel:e.isChannel,isEdu:e.isEdu});return o.default.html(u(),S,n,i,s,l,c,p,m,h,t,v,g,A,y,w)}},9307:function(e,t,n){"use strict";var i,o=n(62561),a=n(1730),r=n(3226),s=n(97093);function l(){store.mail.cur&&p()}function c(e){store.mail.cur&&function(e){var t=".mailActs__chevronMoreIcon",n=".mailActs__chevronList",i="mailActs_menuOpened",o=e.target,a=$(".mailActs");a&&a.classList.contains(i)&&!o.closest(n)&&!o.closest(t)&&a.classList.remove("mailActs_menuOpened")}(e)}function u(e){_({canEdit:e})}function d(e){$(".mailActs__button_type_forward").disabled=!e}function _(e){(0,a.$$)(".mailActs").forEach((function(t){var n=o.default.parseClass("mailActs",t.getAttribute("class"));t.setAttribute("class",o.default.class("mailActs",Object.assign({},n,e)))}))}function f(e){switch(e){case"edit":s.default.onEditClick();break;case"remove":s.default.onRemoveClick();break;case"important":s.default.onImportantClick();break;case"reply":s.default.onReplyClick();break;case"forward":s.default.onForwardClick();break;case"spam":s.default.onSpamClick();break;case"pin":s.default.onPinClick()}}function p(){var e="mailActs__icon_hidden",t="mailActs__chevronListItem_hidden",n=document.querySelector(".mailActs__chevron"),i=n.offsetWidth-1,o=n.querySelectorAll(".mailActs__chevronListItem"),a=n.querySelectorAll(".mailActs__icon");Array.prototype.forEach.call(a,(function(n,r){i<36*a.length?i-34>=36*(r+1)?(n.classList.remove(e),o[r].classList.add(t)):(n.classList.add(e),o[r].classList.remove(t)):(n.classList.remove(e),o[r].classList.add(t))})),_({cutted:i<36*a.length})}function m(){(0,a.$$)(".mailActs").forEach((function(e){return e.classList.toggle("mailActs_menuOpened")}))}Object.assign(s.default,((i={onCloseClick:(0,r.default)(),onRemoveClick:(0,r.default)(),onImportantClick:(0,r.default)(),onReplyClick:(0,r.default)(),onForwardClick:(0,r.default)(),onSpamClick:(0,r.default)(),onPinClick:(0,r.default)(),onMoreClick:(0,r.default)(),onEditClick:(0,r.default)(),setCount:function(e){var t=langNumeric(e,lang.mobile_mail_messages_selected).replace("{count}",e);(0,a.$$)(".mailActs__counter").forEach((function(e){return e.innerText=t})),1!=e&&u(!1);p()},setEditAvailable:u,setImportantAvailable:function(e){_({canImportant:e})},toggleQuickButtons:function(e){$(".mailActs__buttonsIn").hidden=!e},setForwardAvailable:d,setReplyAvailable:function(e){$(".mailActs__button_type_reply").disabled=!e}}).setForwardAvailable=d,i.togglePin=function(e){(0,a.$$)(".mailActs").forEach((function(t){return t.classList.toggle("mailActs_canPin",e)}))},i.setModifiers=_,i.setLabels=function(e){var t=window.lang,n=e.pinned?t.mobile_mail_messages_actions_unpin:t.mobile_mail_messages_actions_pin,i=e.important?t.mobile_mail_messages_actions_important_off:t.mobile_mail_messages_actions_important;$(".mailActs__icon_type_pin").setAttribute("aria-label",n),$(".mailActs__icon_type_important").setAttribute("aria-label",i),$(".mailActs__chevronListItem_type_pin").innerHTML=n,$(".mailActs__chevronListItem_type_important").innerHTML=i},i.update=p,i)),s.default._onButtonClick=f,s.default._onCloseClick=s.default.onCloseClick,s.default._onMoreClick=m,onBodyResize(l),document.addEventListener("click",c,{passive:!0})},11713:function(e,t,n){"use strict";n.r(t);var i=n(97093);n(9307);t.default=i.default,window.MailActs=i.default},12211:function(e,t,n){"use strict";n.d(t,{MailAvatar:function(){return l},renderOnline:function(){return c}});var i=n(86205),o=n(23696),a=n(97786),r=n(80540),s=n(46950);function l(e){void 0===e&&(e={});var t=e.class||"",n=(0,s.getAvatarMode)({id:e.id,name:e.name});return{inner:[(0,r.Avatar)({size:e.size,src:e.src,mode:n,backgroundTheme:e.id,text:e.name,textLength:(0,s.getAvatarTextLength)(e.id)}),c(e.online)],class:t+" MailAvatar",tag:"div"}}function c(e){return"mobile"===e?{inner:[{inner:[(0,i.default)({icon:(0,o.getOnlineMobileComposite16Icon)()})],class:"mlvi_default",tag:"div"},{inner:[(0,i.default)({icon:(0,a.getOnlineMobileCompositeMuted16Icon)()})],class:"mlvi_muted",tag:"div"}],class:"MailAvatar__online MailAvatar__online--mobile lvi mlvi",tag:"div"}:{class:"MailAvatar__online "+("desktop"===e?"MailAvatar__online--desktop":""),tag:"div"}}},62553:function(e,t,n){"use strict";n.d(t,{MailAvatar:function(){return i.MailAvatar},renderOnline:function(){return i.renderOnline}});var i=n(12211)},71183:function(e,t,n){"use strict";var i=n(13725),o=n(62561);function a(){var e=(0,i.default)(['\n    <button type="','" class="','" ',">\n      ","\n    </button>\n  "]);return a=function(){return e},e}function r(){var e=(0,i.default)(['\n      <a class="','" href=',' target="','" ',">\n        ","\n      </a>\n    "]);return r=function(){return e},e}t.default=function(e){var t=e.class?" "+e.class:"";if(t="MailButton"+t,"link"===e.type&&e.link){var n=e.link.href,i=e.link.target||"_blank";return o.default.html(r(),t,n,i,e.onClick,e.text)}var s=e.type;"button"===s&&"submit"===s||(s="button");return o.default.html(a(),s,t,e.onClick,e.text)}},89581:function(e,t,n){"use strict";n.r(t);var i=n(71183);t.default=i.default,window.MailButton=i.default},84506:function(e,t,n){"use strict";n.r(t),n.d(t,{showCaptcha:function(){return l},renderBody:function(){return c}});var i=n(11393),o=n(1730),a=n(24945),r=n(98330),s=n(81755);function l(e,t){r.default.open({body:c(e),title:lang.mobile_captcha_enter_code,confirmText:lang.mobile_captcha_send_btn,cancelText:lang.mobile_cancel,class:"MailCaptcha__dialog",onConfirm:function(n,i){var s,l=(0,o.$)('[name="'+e.key+'"]',i);l=l&&l.value||"",r.default.close(),(0,a.mailRequest)(e.location,Object.assign({},e.post,(s={},s[e.key]=l,s))).then((function(e){t(Promise.resolve(e))}),(function(e){t(Promise.reject(e))}))},onClose:function(){r.default.close(),t(null)}})}function c(e){return i.default.html({inner:[{class:"captcha_img",src:e.img,tag:"img"},{inner:[(0,s.default)({name:e.key})],class:"MailCaptcha__input",tag:"div"}],class:"MailCaptcha__box",tag:"div"})}},61680:function(e,t,n){"use strict";var i=n(84506);t.default=i},99266:function(e,t,n){"use strict";var i=n(13725),o=n(62561);function a(){var e=(0,i.default)(['\n    <div class="','" role="dialog" id="mail-dialog">\n      <div class="mailDialog__overlay" ','></div>\n      <div class="mailDialog__wrap">\n        <div class="mailDialog__content">\n          <div class="mailDialog__close" ',"></div>\n          ",'\n          <div class="mailDialog__body">','</div>\n          <div class="mailDialog__footer">\n            ',"\n          </div>\n        </div>\n      </div>\n    </div>\n  "]);return a=function(){return e},e}t.default=function(e){var t=e.onClose||o.default.onClick("MailDialog._onDialogClose"),n=o.default.class(e.class,"mailDialog",{}),i="";e.title&&(i='<div class="mailDialog__title">'+e.title+"</div>");var r="";r=e.buttons?e.buttons:'<div class="BtnStack">\n      <div class="Btn Btn_theme_regular mailDialog__button mailDialog__confirmButton" '+e.onConfirm+">"+e.confirmText+'</div>\n      <div class="Btn Btn_theme_secondary mailDialog__button mailDialog__closeButton" '+t+">"+e.cancelText+"</div>\n    </div>";return o.default.html(a(),n,t,t,i,e.body,r)}},47433:function(e,t,n){"use strict";var i,o=n(1730),a=n(9046),r=n(99266);function s(){var e=(0,o.$)(".messenger__dialog");i=null,e.innerHTML=""}Object.assign(r.default,{open:function(e){i={},"function"==typeof e.onConfirm&&(i.onConfirm=e.onConfirm,e.onConfirm="");"function"==typeof e.onClose&&(i.onClose=e.onClose,e.onClose="");var t=(0,o.$)(".messenger__dialog"),n=(0,r.default)(e),s=(0,a.ceFromString)(n);i.onConfirm&&((0,o.$)(".mailDialog__confirmButton",s).onclick=function(e){return i.onConfirm(e,t)});i.onClose&&(0,o.$$)(".mailDialog__overlay,.mailDialog__close,.mailDialog__closeButton",s).forEach((function(e){e.onclick=function(e){return i.onClose(e,t)}}));t.innerHTML="",t.appendChild(s)},close:s,_onDialogClose:s})},98330:function(e,t,n){"use strict";n.r(t);var i=n(99266);n(47433);t.default=i.default,window.MailDialog=i.default},93584:function(e,t,n){"use strict";var i=n(62561),o=n(39423),a=n(35909),r=n(46950);t.default=function(e){var t=window.lang,n=e.query;return Wd.html({class:[Bem.class("mailFilter",{hasQuery:!!n},"_"),e.mix],inner:[(0,a.Icon16SearchOutline)(),{class:"mailFilter__input",tag:"input",placeholder:(0,r.winToUtf)(t.mobile_search),value:n,oninput:["MailFilter._onInput","this"],attrs:i.default.onFocus("MailFilter._onFocus")},{class:"mailFilter__right",inner:[(0,o.default)({mix:"mailFilter__clear",icon:"close12",attrs:i.default.onMouseDown("MailFilter._onClearMouseDown","this")})]}]})}},48369:function(e,t,n){"use strict";var i=n(1730),o=n(3226),a=n(62691),r=n(93584),s=n(56399);function l(e){requestAnimationFrame((function(){var t=e.value;d(e.value),r.default.onChange(t)}))}function c(){s.onOpen("top")}function u(e){var t=e.closest(".mailFilter").$(".mailFilter__input"),n=document.activeElement===t;(a.default.ios?setTimeout:requestAnimationFrame)((function(){d(""),t.value="",n&&t.focus(),r.default.onClear(),r.default.onChange("")}))}function d(e){(0,i.$$)(".mailFilter").forEach((function(t){return t.classList.toggle("mailFilter_hasQuery",!!e)}))}Object.assign(r.default,{onChange:(0,o.default)("query"),onClear:(0,o.default)(),setQuery:function(e){var t=(0,i.$)(".mailFilter__input");t&&t.value!==e&&(t.value=e,r.default.onChange(e),d(e))},setQuerySilently:function(e){var t=(0,i.$)(".mailFilter__input");t&&t.value!==e&&(t.value=e,d(e))}}),r.default._onInput=l,r.default._onClearMouseDown=u,r.default._onFocus=c},1142:function(e,t,n){"use strict";n.r(t);var i=n(93584);n(48369);t.default=i.default,window.MailFilter=i.default},20083:function(e,t,n){"use strict";n.d(t,{MailHat:function(){return T},MailHat__Title:function(){return M},MailHat__icon:function(){return L},MailHat_main:function(){return C},MailHat_convo:function(){return E},MailHat_page:function(){return I},MailHat_getOnlineText:function(){return N},MailHat__actions:function(){return R}});var i=n(13725),o=n(11393),a=n(62561),r=n(39423),s=n(54440),l=n(80540),c=n(86205),u=n(46950),d=n(35909),_=n(1374),f=n(11539),p=n(23696),m=n(86754),h=n(91694),v=n(53043);function g(){var e=(0,i.default)(['\n    <div class="mailHat__convoDetails">\n      <div class="mailHat__convoDetailsText">',"</div>\n      ","\n    </div>\n  "]);return g=function(){return e},e}function A(){var e=(0,i.default)(["\n    ","\n      ",'\n      <div class="mailHat__convoBody">\n        <div class="mailHat__convoTitleWrapper">\n          <div class="','">',"</div>\n          ","\n          ","\n        </div>\n        ","\n      </div>\n    ","\n  "]);return A=function(){return e},e}function y(){var e=(0,i.default)(['\n    <div class="mailHat__title">\n      ',"\n    </div>\n  "]);return y=function(){return e},e}function w(){var e=(0,i.default)(['\n    <div class="mailHat__editingTitle">\n      ',"\n    </div>\n  "]);return w=function(){return e},e}function S(){var e=(0,i.default)(['\n    <div class="mailHat__desktopTitle">\n      ',"\n    </div>\n  "]);return S=function(){return e},e}function b(){var e=(0,i.default)(['\n    <div class="mailHat__forwardTitle">\n      ',"\n    </div>\n  "]);return b=function(){return e},e}function k(){var e=(0,i.default)(['\n    <div class="mailHat '," "," "," "," ",'">\n      <div class="mailHat__left">','</div>\n      <div class="mailHat__center">','</div>\n      <div class="mailHat__right">',"</div>\n    </div>\n  "]);return k=function(){return e},e}function C(e){var t=function(e,t,n,i,o,a,r){var l=window.lang;return(0,s.default)({mix:"mailHat__folder",triggerWrapperTag:"h1",items:[{name:"all",text:l.mobile_mail_tab_all,active:"all"===e,url:t.all},n?{name:"unrespond",text:l.mobile_mail_tab_unrespond,active:"unrespond"===e,url:t.unrespond}:"",{name:"unread",text:l.mobile_mail_tab_unread,active:"unread"===e,url:t.unread},{name:"important",text:l.mobile_mail_tab_important,active:"important"===e,count:i,url:t.important},o?{name:"ad_tag",text:l.mobile_mail_tab_ad_tag,active:"ad_tag"===e,url:t.adTag}:"",a?{name:"business_notify",text:l.mobile_mail_tab_business_notify,active:"business_notify"===e,url:t.businessNotify,count:r}:""]})}(e.folder,e.urls,e.withUnrespond,e.importantCount,e.withAdTag,e.withBusinessNotify,e.businessNotifyCount);return T({type:"main",left:""+o.default.html({class:"mailHat__cancelForward",inner:(0,c.default)((0,_.getBackOutline28Icon)()),onmousedown:["MailHat_main.onCancelForwardTap"]}),center:""+t+function(){var e=window.lang;return a.default.html(b(),e.mobile_mail_choose_recipient)}()+function(){var e=window.lang;return a.default.html(S(),e.mobile_mail_tab_messages)}(),right:""+o.default.html({href:e.urls.createChatUrl,class:"mailFilter__create",inner:(0,d.Icon28WriteSquareOutline)()}),forwarding:e.forwarding})}function E(e){var t,n=P(),i=o.default.html({class:"mailHat__cancelEditing",inner:(0,d.Icon28CancelOutline)(),onmousedown:["MailHat_convo.onCancelEditingTap"]}),r=function(e){var t=e.isContact,n=(e.peerProfile.tagsData,a.default.class("mailHat__convo",{mobile:e.mobile})),i=a.default.class("mailHat__convoTitle",{casper:e.isCasper}),r=o.default.html((0,l.Avatar)({mix:"mailHat__convoAvatar",src:e.photos,size:36,mode:(0,u.getAvatarMode)({id:e.id,name:e.title}),backgroundTheme:e.id,text:e.title,textLength:(0,u.getAvatarTextLength)(e.id)})),s=function(e){var t=window.lang,n=e.membersCount,i="",r="";if(e.isBusinessNotify)r=t.mobile_mail_tab_business_notify;else if(n>0)r=e.isChannel?langNumeric(n,t.mobile_mail_channel_N_members):langNumeric(n,t.mobile_mail_N_members);else{var s=e.onlinePlatform;r=N(e.isOnline,e.offlineText),"mobile"===s&&(i=o.default.html({class:a.default.class("mailHat__onlineIcon",{platform:"mobile",isOnline:e.isOnline}),inner:e.isOnline?(0,c.default)((0,p.getOnlineMobileComposite16Icon)()):(0,c.default)((0,m.getOnlineMobile12Gray200Icon)())}))}return a.default.html(g(),r,i)}(e),d=e.isCasper?'<span title="'+(0,u.getLang)("mobile_casper_chat_title")+'" class="mailHat__convoCasperIcon">'+o.default.html((0,c.default)((0,f.getCasper16Icon)()))+"</span>":"",_=e.isDonutChat?'<span title="'+(0,u.getLang)("mobile_donut_chat_title")+'" class="mailHat__convoCasperIcon">'+o.default.html((0,c.default)((0,h.getDonut12Icon)()))+"</span>":"",v=t?'<div class="'+n+'">':'<a class="'+n+'" href="'+e.url+'">',y=t?"</div>":"</a>";return a.default.html(A(),v,r,i,e.title,d,_,s,y)}(e),s=function(){var e=window.lang;return a.default.html(w(),e.mobile_mail_message_editing)}(),_=R(e.actions),y=_;(0,u.isSAKIntegration)()&&e.canCall&&(y=""+o.default.html({class:"mailHat__icon",inner:(0,d.Icon28VideocamOutline)(),onclick:["uMessenger.onCall"]})+_);return T({type:"convo",left:""+n+i,center:""+r+s,right:e.isBusinessNotify?o.default.html((t=e.id,{inner:[(0,c.default)({icon:(0,v.getSettingsOutline28Icon)()})],class:"mailHat__settings",onClick:"uMessenger.onBusinessNotifySettingsOpenClick("+t+")",tag:"div"})):y,hasPinnedMsg:e.hasPinnedMsg,editing:e.editing})}function I(e){return T({type:"page",left:""+P(),center:"",right:"",hasPinnedMsg:!1,editing:!1})}function T(e){var t=e.forwarding?"mailHat_forwarding":"",n=e.hasPinnedMsg?"mailHat_hasPinnedMsg":"",i="mailHat_type_"+e.type,o=(0,u.isEduIntegration)()?"mailHat_edu":"",r=e.editing?"mailHat_editing":"";return a.default.html(k(),i,t,n,r,o,e.left,e.center,e.right)}function M(e){return a.default.html(y(),e.title)}function P(){return o.default.html({tag:"button",type:"button","aria-label":(0,u.getLang)("mobile_back"),class:"mailHat__back",inner:(0,c.default)((0,_.getBackOutline28Icon)()),onclick:["MailHat_convo.onBackTap"]})}function L(e){return o.default.html((0,r.default)({mix:a.default.class("mailHat__icon",e.mix),icon:e.icon,attrs:e.attrs,url:e.url}))}function N(e,t){var n=window.lang;return e?n.mobile_mail_online:t}function R(e){return(0,s.default)({mix:"mailHat__actions",trigger_attrs:{"aria-label":(0,u.getLang)("mobile_mail_actions_label")},icon_html:o.default.html((0,d.Icon28MoreHorizontal)()),position:"topRight",items:e,isDisabled:0===e.length})}},57825:function(e,t,n){"use strict";var i=n(1730),o=n(62561),a=n(3226),r=n(54440),s=n(20083);function l(e){(0,i.$$)(".mailHat").forEach((function(t){var n=o.default.parseClass("mailHat",t.getAttribute("class"));t.setAttribute("class",o.default.class("mailHat",Object.assign({},n,e)))}))}Object.assign(s.MailHat_main,{onUnreadClick:(0,a.default)(),onBurgerClick:(0,a.default)(),onCancelForwardTap:(0,a.default)(),setFolder:function(e){(0,i.$$)(".mailHat__folder").forEach((function(t){r.default.setActive(t,e)}))},setImportantCount:function(e){(0,i.$$)(".mailHat__folder").forEach((function(t){r.default.setCount(t,"important",e)}))},setBusinessNotifyCount:function(e){(0,i.$$)(".mailHat__folder").forEach((function(t){r.default.setCount(t,"business_notify",e)}))},setForwarding:function(e){(0,i.$$)(".mailHat_type_main").forEach((function(t){return t.classList.toggle("mailHat_forwarding",e)}))},setModifiers:l}),Object.assign(s.MailHat_convo,{onBackTap:(0,a.default)(),onCancelEditingTap:(0,a.default)(),setOnline:function(e,t){var n=(0,s.MailHat_getOnlineText)(e,t);(0,i.$$)(".mailHat__convoDetailsText").forEach((function(e){return e.innerText=n}))},setMobile:function(e){(0,i.$$)(".mailHat__convo").forEach((function(t){return t.classList.toggle("mailHat__convo_mobile",e)}))},setHasPinnedMsg:function(e){(0,i.$$)(".mailHat_type_convo").forEach((function(t){return t.classList.toggle("mailHat_hasPinnedMsg",e)}))},setModifiers:l})},51106:function(e,t,n){"use strict";n.r(t),n.d(t,{MailHat:function(){return i.MailHat},MailHat__Title:function(){return i.MailHat__Title},MailHat__icon:function(){return i.MailHat__icon},MailHat_main:function(){return i.MailHat_main},MailHat_convo:function(){return i.MailHat_convo},MailHat_page:function(){return i.MailHat_page}});var i=n(20083);n(57825);window.MailHat_main=i.MailHat_main,window.MailHat_convo=i.MailHat_convo},80826:function(e,t,n){"use strict";n.d(t,{MailPreSendList__Msg:function(){return o}});n(11393);var i=n(41070);function o(e){var t=store.mail,n=t.members[e.authorId],o=e.peerId,a=t.peers[o],r=(0,i.Msg__authorName)(n,o,t.cur.userId);return(0,i.default)({id:e.id,text:e.text,important:e.isImportant,unread:e.isUnread,authorPhoto:n.avatar,authorName:r,authorUrl:n.url,date:e.date,removed:t.cur.msgRemoved[e.id],admin:e.adminName?{name:e.adminName,url:e.adminUrl}:null,edited:e.edited,channel:a.isChannel&&a.ownerId!==t.cur.viewerId,attaches:e.attaches,attachesHTML:e.attachesHTML,attachesLoading:e.attachesLoading,forwards:e.forwards,reply:e.reply,pending:e.pending,failed:e.failed,sendId:e.sendId,sticker:e.sticker,ts:e.ts,maxDepth:store.mail.cur.maxMsgDepth})}t.default=function(){store.mail.pendingMsgs;return{class:"MailPreSendList__box"}}},52786:function(e,t,n){"use strict";n.d(t,{setMsgs:function(){return s},addMsg:function(){return l},removeMsg:function(){return c},getMsg:function(){return u}});var i=n(1730),o=n(80826),a=n(41070);function r(){return(0,i.$)(".MailPreSendList__box")}function s(e){r().innerHTML=e.map((function(e){return(0,o.MailPreSendList__Msg)(e)})).join("")}function l(e){r().insertAdjacentHTML("beforeend",(0,o.MailPreSendList__Msg)(e)),MailScrap.peerGoToBottom(),e.attaches.audiomsg&&AudioMessagePlayer.redrawWaves()}function c(e){var t=a.default.getElem(e.sendId);t&&t.remove()}function u(e){return a.default.getElem(e.sendId)}},56353:function(e,t,n){"use strict";n.d(t,{setMsgs:function(){return o.setMsgs},addMsg:function(){return o.addMsg},removeMsg:function(){return o.removeMsg},getMsg:function(){return o.getMsg}});var i=n(80826),o=n(52786);t.default=i.default},46960:function(e,t,n){"use strict";n.d(t,{MailRecommendContacts:function(){return u}});var i=n(46950),o=n(86205),a=n(62553),r=n(41933),s=n(353),l=n(87123),c=n(48906);function u(e){void 0===e&&(e={});var t=0,n=e.items.map((function(e){return n=e,o=t++,r=(0,i.makeUrl)("mail",{act:"show",peer:n.peer_id,mvk_entrypoint:"list_all_suggestions"}),s=1===n.online&&(n.online_info.is_mobile?"mobile":"desktop"),l="MailRecommendContacts.onItemClick('"+r+"', "+o+", '"+n.track_code+"')",{inner:[(0,a.MailAvatar)({class:"MailRecommendContacts__itemAvatar",size:64,src:n.photo,online:s,id:n.id,name:n.name}),{inner:[n.name],class:"MailRecommendContacts__itemName",tag:"span"}],class:"MailRecommendContacts__item",href:r,onClick:l,"data-peer-id":n.peer_id,tag:"a"};var n,o,r,s,l})),u={search:{title:(0,i.getLang)("mobile_mail_recommend_block_action_find_friends"),icon:(0,r.getUserOutline24Icon)(),url:(0,i.makeUrl)("search"),isNewPage:!1},invite:{title:(0,i.getLang)("mobile_mail_recommend_block_action_invite"),icon:(0,s.getSmartphoneOutline24Icon)(),url:d(e.importServices,-2),isNewPage:!1},ok:{title:(0,i.getLang)("mobile_mail_recommend_block_action_import_ok"),icon:(0,l.getLogoOkColor24Icon)(),url:d(e.importServices,5),isNewPage:!0},google:{title:(0,i.getLang)("mobile_mail_recommend_block_action_import_gmail"),icon:(0,c.getLogoGoogleColor24Icon)(),url:d(e.importServices,6),isNewPage:!0}};return{inner:[n,["search","invite","ok","google"].map((function(e){return function(e){return{inner:[{inner:[(0,o.default)({icon:e.icon})],class:"MailRecommendContacts__itemIcon",tag:"div"},{inner:[e.title],class:"MailRecommendContacts__itemName",tag:"span"}],class:"MailRecommendContacts__item",href:e.url,target:e.isNewPage?"_blank":"_self",tag:"a"}}(u[e])}))],class:(e.class||"")+" MailRecommendContacts",tag:"div"}}function d(e,t){var n=e[t];return n?n.url:""}},95806:function(e,t,n){"use strict";n.d(t,{redrawOnline:function(){return r}});var i=n(62553),o=n(46960),a=n(69041);function r(e){var t=store.mail.cur.recommendContacts,n=$('.MailRecommendContacts__item[data-peer-id="'+e+'"]');if(n){var o,a,r,s=t.item_data[e],l=n.querySelector(".MailAvatar__online");if(s&&l)o=l,a=s.online_info,r=!!a&&(a.is_mobile?"mobile":"desktop"),o.outerHTML=Wd.html((0,i.renderOnline)(r))}}Object.assign(o.MailRecommendContacts,{onItemClick:function(e,t,n){a.ContactRecommendationCollector.logEvent({event_name:"open",track_code:n,position:Number(t)}),nav.go(e)}})},22911:function(e,t,n){"use strict";n.d(t,{MailRecommendContacts:function(){return i.MailRecommendContacts},redrawOnline:function(){return o.redrawOnline}});var i=n(46960),o=n(95806);window.MailRecommendContacts=i.MailRecommendContacts},77452:function(e,t,n){"use strict";n.d(t,{MailScrap_EmptyInner:function(){return T},MailScrap_Item:function(){return k},MailScrap_ItemsInner:function(){return b},MailScrap_class:function(){return L},MailScrap_FindFriendsStub:function(){return P}});var i=n(13725),o=n(62561),a=n(72592),r=n(27109),s=n(7812),l=n(50582),c=n(75526),u=n(56353),d=n(11393),_=n(46950),f=n(35909),p=n(45162),m=n(39606),h=n(93810);function v(){var e=(0,i.default)(['\n    <div class="mailScrap__systemMessage" ',">\n      ","\n    </div>\n  "]);return v=function(){return e},e}function g(){var e=(0,i.default)(['\n      <div class="mailScrap__empty mailScrap__empty_',' mailScrap_casper">\n        <div class="mailScrap__casperIcon" aria-hidden="true">\n          ','\n        </div>\n        <div class="mailScrap__casperText">\n          ',"\n        </div>\n      </div>\n  "]);return g=function(){return e},e}function A(){var e=(0,i.default)(['\n    <div class="mailEduScrap__empty">\n      <div class="mailScrap__icon">\n        ','\n      </div>\n      <div class="mailScrap__text mailEduScrap__text">\n        ','\n      </div>\n      <div class="mailEduScrap__action">\n        ',"\n      </div>\n    </div>\n  "]);return A=function(){return e},e}function y(){var e=(0,i.default)(["\n    ",'\n    <div class="mailScrap__empty mailScrap__empty_','">',"</div>\n  "]);return y=function(){return e},e}function w(){var e=(0,i.default)(['\n    <div class="','">\n      ',"\n    </div>\n  "]);return w=function(){return e},e}function S(){var e=(0,i.default)(['\n    <div class="','">\n      ',"\n      ","\n      ","\n      ","\n      ","\n      ","\n      ","\n      ","\n      ","\n    </div>\n  "]);return S=function(){return e},e}function b(e){for(var t=store.mail,n=t.cur,i=t.msgs,a=t.scraps[e],r=a.length,s=[],l=!1,c=0;c<r;c++){if(c>0&&"peer"===e&&!l){var u=i[a[c-1]],d=i[a[c]];if(d.isUnread&&!u.isUnread&&d.authorId!==n.viewerId){l=!0,s.push(k(e,a[c],!0));continue}}s.push(k(e,a[c]))}return o.default.list(s)}function k(e,t,n){void 0===n&&(n=!1);var i=store.mail,o=i.cur,a="";if("folder"===e)a="important"===o.folder?C(t):E(t);else if("search"===e)if("peers"===o.tab){var r=t;i.peers[r].isIncomingMR||(a=function(e){return(0,c.default)(e)}(r))}else{a=C(t)}else if("peer"===e){a=function(e,t){void 0===t&&(t=!1);return(0,l.default)({msgId:e,withDivider:t})}(t,n)}else if("mrs"===e){a=E(t)}return a}function C(e){var t=store.mail.msgs[e].peerId;return(0,c.default)(t,e)}function E(e){return(0,c.default)(e,"last")}function I(e){var t,n=o.default.class("mailScrap__loading",((t={})[e]=!0,t)),i=d.default.html((0,r.default)({mix:""}));return o.default.html(w(),n,i)}function T(e){if((0,_.isEduIntegration)())return function(e){var t=store.mail.cur,n="folder"===e,i="unread"===t.folder,a="important"===t.folder,r=window.lang,s={unread:r.mobile_mail_edu_messages_list_unread,important:r.mobile_mail_edu_messages_list_important}[t.folder]||r.mobile_mail_edu_chat_list_empty,l=i||a?d.default.html(SVGIcon((0,m.getMessageReadOutline56Icon)())):d.default.html(SVGIcon((0,h.getMessageOutline56Icon)())),c=!n||i||a?"":'<button class="mailEduScrap__link" onmousedown="uMessenger.createNewChat()">\n        '+r.mobile_mail_edu_create_chat+"\n      </button>";return o.default.html(A(),l,s,c)}(e);var t=window.lang,n=store.mail.cur,i="";switch(e){case"peer":i=t.mobile_mail_history_is_empty;break;case"mrs":i=t.mobile_mail_mrs_empty_info;break;case"folder":if(M("folder")){i="";break}i={all:t.mobile_mail_no_messages,important:t.mobile_mail_no_important,unread:t.mobile_mail_no_unreaded,unrespond:t.mobile_mail_sublist_empty,ad_tag:t.mobile_mail_sublist_empty,business_notify:t.mobile_mail_no_business_notify}[n.folder];break;case"search":"msgs"===n.tab&&(i=t.mobile_mail_not_found),"peers"===n.tab&&(i=t.mobile_mail_no_peers)}return i}function M(e){var t=store.mail,n=t.cur,i=t.scraps,o=(t.reached,!(t.cur.folder&&"all"!==t.cur.folder||"folder"!==e||n.communityParam)),a=i.folder.length<=1;return n.findFriendsUsers&&n.findFriendsUsers.length>=0&&!n.hasContacts&&o&&a}function P(e){if(!M(e))return null;var t=store.mail.cur;return(0,p.ConvoListFindFriendsStub)({recommendedFriends:t.findFriendsUsers})}function L(e){var t,n=store.mail,i=n.cur,a=n.reached,r=(0,_.isEduIntegration)(),s=function(e){var t=store.mail,n=t.cur,i=t.scraps,o=t.reached,a=!1;switch(e){case"peer":var r=n.peerId,s=t.rolls.peer[r];0===(s?s.length:0)&&o.peer.after[r]&&o.peer.before[r]&&(a=!0);break;case"mrs":0===i.mrs.length&&o.mrs&&(a=!0);break;case"folder":0===i.folder.length&&o.folder[n.folder]&&(a=!0);break;case"search":0===i.search.length&&o.search[n.tab][n.query]&&(a=!0)}return a}(e),l=r&&s,c=!0,u=!1,d=!1,f=!1;if("peer"===e){var p=i.peerId,m=n.scraps.peer,h=m.length,v=n.rolls.peer[p]||[];c=a.peer.before[p]&&m[0]===v[0],u=last(m)===last(v)&&a.peer.after[p],0===h&&(u=!0);var g=p?n.peers[p]:null;g&&(d=!!g.systemMessageCode,g.isChannel&&(f=g.ownerId!==i.viewerId))}else if("mrs"===e)u=a.mrs;else if("folder"===e)u=a.folder[i.folder];else if("search"===e){var A=i.tab;i.query;if("peers"===A){var y=n.scraps.search.length;u=a.search[i.tab][i.query]||y>0}else u=a.search[i.tab][i.query]}return o.default.class("mailScrap",((t={})[e]=!0,t.empty=s,t.systemMessage=d,t.reachedBefore=c,t.reachedAfter=u,t.tab="search"===e&&i.tab,t.isChannel=f,t.edu=l,t))}t.default=function(e){var t=e.scrap,n=e.isCasper,i="peer"===t,r=L(t),l=i?I("before"):"",c=I("after"),p=I("center"),m=function(e){var t,n=o.default.class("mailScrap__items",((t={})[e]=!0,t)),i=b(e);return(0,a.default)({mix:n,inner:i})}(t),h=n?"":function(e){var t=P(e),n=t?d.default.html({inner:[t],class:"mailScrap__findFriendsStub",tag:"div"}):"",i=T(e);return o.default.html(y(),n,e,i)}(t),A=n?function(e){var t=d.default.html((0,f.Icon56GhostOutline)()),n=(0,_.getLang)("mobile_casper_chat_no_messages");return o.default.html(g(),e,t,n)}(t):"",w=i?(0,s.default)():"",k=i?d.default.html((0,u.default)()):"",C=i?(E=store.mail.cur.notification||"",M=o.default.onClick("MailScrap.clearSystemMessage2"),o.default.html(v(),M,E)):"";var E,M;return o.default.html(S(),r,l,m,h,A,c,k,w,C,p)}},39730:function(e,t,n){"use strict";n(3226);var i=n(11393),o=n(55010),a=n(6103),r=(n(83228),n(77452)),s=n(64430),l=n.n(s);Object.assign(r.default,{updateClass:m,clearSystemMessage2:function(){remove(geByClass1("service_msg_box"))},onSystemMessageClick:function(){!function(){var e=store.mail,t=e.cur;e.peers[t.peerId].systemMessageCode=null,m("peer"),h()}()},resetPrevScraps:function(){c={folder:[],search:[],peer:[]}},redrawPeer:function(){p("peer",store.mail.scraps.peer),$$(".mailScrap_peer").forEach((function(e){return e.className=(0,r.MailScrap_class)("peer")}))},redrawFolder:function(e){var t=store.mail,n=t.cur,i=t.scraps;n.folder;p("folder",i.folder,e),$$(".mailScrap_folder").forEach((function(e){return e.className=(0,r.MailScrap_class)("folder")})),v("folder")},redrawEmpty:v,redrawSearch:function(){$$(".mailScrap__items_search").forEach((function(e){return e.innerHTML=(0,r.MailScrap_ItemsInner)("search")})),$$(".mailScrap_search").forEach((function(e){return e.className=(0,r.MailScrap_class)("search")})),$$(".mailScrap__empty_search").forEach((function(e){return e.innerHTML=(0,r.MailScrap_EmptyInner)("search")}))},redrawMRs:function(e){p("mrs",store.mail.scraps.mrs,e),$$(".mailScrap_mrs").forEach((function(e){return e.className=(0,r.MailScrap_class)("mrs")})),$$(".mailScrap__empty_mrs").forEach((function(e){return e.innerHTML=(0,r.MailScrap_EmptyInner)("mrs")}))},redrawSystemMessage:h,folderSetItems:function(e){$$(".mailScrap__items_folder").forEach((function(t){return t.innerHTML=f(e,!0)})),$$(".mailScrap_folder").forEach((function(e){return e.className=(0,r.MailScrap_class)("folder")})),$$(".mailScrap__empty_folder").forEach((function(e){return e.innerHTML=(0,r.MailScrap_EmptyInner)("folder")}))},folderAddItems:function(e){$$(".mailScrap__items_folder").forEach((function(t){return t.insertAdjacentHTML("beforeend",f(e))}))},folderCutItems:function(e){$$(".mailScrap_folder .mailScrap__items").forEach((function(t){[].slice.call(t.children).slice(e).forEach((function(e){return t.removeChild(e)}))}))},peerAddElemAfter:function(e,t){var n=$(".mailScrap__items_peer");if(!n)return;var i=ceFromString(d([e],!0));_(t,i),n.appendChild(t),l()(t,i),m("peer")},peerAddItemsBefore:function(e,t){void 0===t&&(t=!1);m("peer"),e=e.filter(unique).filter((function(e){return!$(".msg_id_"+e)}));var n=o.Messenger.getConvoBody();n.scrollHeight,n.scrollTop,n.offsetHeight;window._preventedCheckTop=!0,setTimeout((function(){return window._preventedCheckTop=!1}));var i='\n    <div class="load_before load_before_closed">\n      '+d(e,t)+"\n    </div>\n  ";return $$(".mailScrap__items_peer").forEach((function(e){return e.insertAdjacentHTML("afterbegin",i)})),void uMessenger.expandPeerBefore()},peerAddItemsAfter:function(e,t,n){void 0===t&&(t=!1);e=e.filter(unique).filter((function(e){return!$(".msg_id_"+e)})),$$(".mailScrap__items_peer").forEach((function(n){n.insertAdjacentHTML("beforeend",d(e,t))})),m("peer"),(0,a.resizePosters)()},peerReplaceItems:function(e){e.forEach((function(e){var t=$(".msg_id_"+e),n=ceFromString(d([e],!0));_(t,n),l()(t,n),CasperTimer.init(e)})),(0,a.resizePosters)()},peerSetItems:function(e){e=e.filter(unique),$$(".mailScrap__items_peer").forEach((function(t){return t.innerHTML=d(e)}))},peerGoToBottom:function(){var e=o.Messenger.getConvoBody();e.scrollTop=e.scrollHeight},removeDivider:u,checkDivider:function(){var e=last($(".mailScrap__items_peer").children);e&&e.classList.contains("msg__newMsgsDivider")&&u()}}),uVK.onReady((function(){if(store.mail&&store.mail.scraps){var e=store.mail.scraps;c.folder=e.folder.slice(),c.search=e.search.slice(),c.peer=e.peer.slice()}}));var c={folder:[],search:[],peer:[]};function u(){remove($(".msg__newMsgsDivider"))}function d(e,t){void 0===t&&(t=!1),e=e.filter(unique);var n,i=store.mail,o=i.cur,a=i.msgs,s=!!$(".msg__newMsgsDivider");return e.map((function(e,i){var l=a[e];return i>0&&!s&&!t&&!n.isUnread&&l.isUnread&&l.authorId!==o.viewerId?(n=l,s=!0,(0,r.MailScrap_Item)("peer",e,!0)):(n=l,(0,r.MailScrap_Item)("peer",e))})).join("")}function _(e,t){if(e&&t){var n=$(".pi_medias",e),i=$(".pi_medias",t);n&&i&&(i.isSameNode=n.isSameNode)}}function f(e,t){return void 0===t&&(t=!1),(e=e.filter(unique)).map((function(e){return $(".mailScrap__items_folder .convo_id_"+e)&&!t?"":(0,r.MailScrap_Item)("folder",e)})).join("")}function p(e,t,n){!function(e,t,n,i){void 0===i&&(i=null);var o=[];if(!e)return;i||(e.innerHTML="",i=[]);if(0===n.length)return void(e.innerHTML="");n.forEach((function(n,o){var a=i.indexOf(n);-1===a?(i.splice(o,0,n),domInsert(e,t(n),o)):a!==o&&(i.splice(a,1),i.splice(o,0,n),before(e.children[a],e.children[o]))})),i.forEach((function(t,i){-1===n.indexOf(t)&&o.push(e.children[i])})),o.forEach(remove)}($(".mailScrap__items_"+e),(function(t){return(0,r.MailScrap_Item)(e,t)}),t,n)}function m(e){$$(".mailScrap_"+e).forEach((function(t){return t.className=(0,r.MailScrap_class)(e)}))}function h(){$$(".mailScrap__systemMessage").forEach((function(e){e.innerHTML=store.mail.cur.notification||""}))}function v(e){$$(".mailScrap__empty_folder").forEach((function(t){return t.innerHTML=(0,r.MailScrap_EmptyInner)(e)})),function(e){var t=$(".mailScrap__findFriendsStub");t&&(t.innerHTML=i.default.html((0,r.MailScrap_FindFriendsStub)(e)))}(e)}},30112:function(e,t,n){"use strict";n.r(t);var i=n(77452);n(39730);t.default=i.default,window.MailScrap=i.default},78323:function(e,t,n){"use strict";var i=n(85489),o=n(9046),a=n(51571),r=n(49751),s=n(62691),l={onTemplateInput:function(e,t,n,o){var a=$("."+n),r=o-t.value.length;a.textContent=r,a.className=i.default.class(n,{error:r<=0},"_")},onButtonMouseDown:function(e,t){s.default.safari_mobile||e.preventDefault()},onButtonClick:function(e,t,n){var i=$(".MailTemplatePage__TextTextarea"),o=i.value,a=i.selectionStart,r=i.selectionEnd;i.value=o.slice(0,a)+n+o.slice(r);var s=a+n.length;i.selectionStart=i.selectionEnd=s},onSave:function(e,t,n,i,s){var l=$(".MailTemplatePage__NameInput .TextInput__native"),c=$(".MailTemplatePage__TextTextarea");r.default.setLoading(t,!0),(0,o.ajaxRequest)("/mail",{act:"save_template",name:l.value,text:c.value,hash:i,id:n},(function(e){if(e){if(e.error){var i=$(".MailTemplatePage__ErrorRow"),o=$(".MailTemplatePage__ErrorText");return r.default.setLoading(t,!1),i.hidden=!1,void(o.textContent=e.message)}if(store.mail.cur&&store.mail.cur.templates){var l=store.mail.cur.templates,c=n?l.findIndex((function(e){return e.id===n})):-1;-1!==c?l.splice(c,1,e.result):l.push(e.result)}a.default.go(s)}}),(function(){r.default.setLoading(t,!1)}))},onSubmit:function(e){e.preventDefault()}};window.MailTemplatePage=l},46693:function(e,t,n){"use strict";n(78323)},67165:function(e,t,n){"use strict";var i=n(11393),o=n(49751);t.default=function(e){var t=window.lang;return i.default.html({class:"MessageRequestBox",inner:[{class:"MessageRequestBox__info",inner:t.mobile_mail_mrs_confirm_info},{class:"MessageRequestBox__buttons",inner:[(0,o.default)({theme:"negative",size:"normal",type:"button",inner:t.mobile_mail_mrs_button_reject,attrs:q.onClick("MessageRequestBox.reject","event","this",e)}),(0,o.default)({theme:"secondary",size:"normal",type:"button",inner:t.mobile_mail_mrs_button_accept,attrs:q.onClick("MessageRequestBox.accept","event","this",e)})]}]})}},60713:function(e,t,n){"use strict";var i=n(67165),o=n(49751);Object.assign(i.default,{accept:function(e,t,n){o.default.setLoading(t,!0),ajaxRequest("/mail",{act:"mrs_accept",peer_id:n,hash:store.mail.hash.mrs},(function(e){e.error&&o.default.setLoading(t,!1)}),(function(){o.default.setLoading(t,!1)}))},reject:function(e,t,n){o.default.setLoading(t,!0),ajaxRequest("/mail",{act:"mrs_reject",peer_id:n,hash:store.mail.hash.mrs},(function(e){e.error&&o.default.setLoading(t,!1)}),(function(){o.default.setLoading(t,!1)}))}}),t.default=i.default},49272:function(e,t,n){"use strict";var i=n(60713);t.default=i.default,window.MessageRequestBox=i.default},94211:function(e,t,n){"use strict";n.r(t),n.d(t,{onConfirmReject:function(){return c},open:function(){return u},close:function(){return d},isMarkedAsSpam:function(){return f}});var i=n(13725),o=n(98330),a=n(3226),r=n(62561);function s(){var e=(0,i.default)(['\n    <div class="MessageRequestRejectDialog">\n      <div class="MessageRequestRejectDialog__title">','</div>\n      <div class="MessageRequestRejectDialog__text">','</div>\n      <div class="MessageRequestRejectDialog__checkbox">\n        <label class="MessageRequestRejectDialog__checkboxIn">\n          <input type="checkbox" class="','">\n          <span class="MessageRequestRejectDialog__label">',"</span>\n        </label>\n      </div>\n    </div>"]);return s=function(){return e},e}var l="MessageRequestRejectDialog__checkboxInput",c=(0,a.default)();function u(){o.default.open({body:_(),confirmText:lang.mobile_mail_mrs_button_reject,cancelText:lang.mobile_mail_mrs_button_cancel,onConfirm:r.default.onClick("MessageRequestRejectDialog.onConfirmReject"),onClose:r.default.onClick("MessageRequestRejectDialog.close")})}function d(){o.default.close()}function _(){var e=store.mail.members[store.mail.cur.peerId].firstNameGen,t=lang.mobile_mail_mrs_reject_confirmation.replace("{name}",e);return r.default.html(s(),lang.mobile_mail_mrs_reject_request,t,l,lang.mobile_mail_report_as_spam)}function f(){var e=$("."+l);return!!e&&e.checked}},27334:function(e,t,n){"use strict";var i=n(94211);t.default=i,window.MessageRequestRejectDialog=i},10293:function(e,t,n){"use strict";var i=n(11393),o=n(51106),a=n(30112),r=n(49751),s=n(62561),l=n(86205),c=n(1374);t.default=function(e){var t=window.lang,n=(0,o.MailHat)({type:"page",left:i.default.html({class:"mailHat__back",inner:(0,l.default)((0,c.getBackOutline28Icon)()),href:"/mail"}),center:(0,o.MailHat__Title)({title:t.mobile_mail_mrs_page_title})}),u=[{class:"MessageRequestsPage__content ScrollView",inner:[{class:"MessageRequestsPage__info",inner:t.mobile_mail_mrs_page_info},i.default.wrap((0,a.default)({scrap:"mrs"}))]},e.count?{class:"MessageRequestsPage__footer",inner:[(0,r.default)({theme:"negative",size:"large",type:"button",inner:t.mobile_mail_mrs_button_reject_all,attrs:s.default.onClick("MessageRequestsPage.rejectAll","event","this")})]}:null];return{class:"messenger__page MessageRequestsPage",inner:[{class:"messenger__header",inner:i.default.wrap(n)},{class:"messenger__content",inner:[{class:"messenger__body",inner:u}]}]}}},91001:function(e,t,n){"use strict";var i=n(10293),o=n(49751);Object.assign(i.default,{rejectAll:function(e,t){o.default.setLoading(t,!0),i.default.onRejectAll(t)},onRejectAll:befall()}),t.default=i.default},32904:function(e,t,n){"use strict";var i=n(91001);t.default=i.default,window.MessageRequestsPage=i.default},45019:function(e,t,n){"use strict";n.d(t,{Msg__restoreInner:function(){return F},Msg__reply:function(){return q},Msg__authorName:function(){return J},Msg__replyAttach:function(){return K},Msg__replyLink:function(){return Q},Msg__textPreview:function(){return W},Msg__attachPreview:function(){return G},Msg_makeReplyLink:function(){return j},Msg_makePinnedReplyLink:function(){return V},Msg_detailed:function(){return O}});var i=n(13725),o=n(62561),a=n(11393),r=n(39423),s=n(80540),l=n(89581),c=n(84359),u=n(64723),d=n(7912),_=n(80674),f=n(46950),p=n(35909),m=n(41824);function h(){var e=(0,i.default)(["\n    ","\n  "]);return h=function(){return e},e}function v(){var e=(0,i.default)(['\n    <div class="msg__keyboard">\n      ',"\n    </div>\n  "]);return v=function(){return e},e}function g(){var e=(0,i.default)(['\n    <a class="','"\n      href="','"\n      ',"\n      ",'\n      style="width: ',"px; height: ",'px;"\n    >\n      <img class="msg__stickerImg sticker_img" height="','" src="','">\n    </a>\n  ']);return g=function(){return e},e}function A(){var e=(0,i.default)(['\n      <div class="','"\n        ',"\n        ",'\n        style="width: ',"px; height: ",'px;"\n      >\n        <img class="msg__stickerImg sticker_img" height="','" src="','">\n      </div>\n    ']);return A=function(){return e},e}function y(){var e=(0,i.default)(['\n    <div class="msg__stickerWrap">\n      ',"\n    </div>\n  "]);return y=function(){return e},e}function w(){var e=(0,i.default)(['\n    <a href="','" class="msg__replyLink" ',">\n      ","\n    </a>\n  "]);return w=function(){return e},e}function S(){var e=(0,i.default)(['\n    <div class="msg__replyAttach">',"</div>\n  "]);return S=function(){return e},e}function b(){var e=(0,i.default)(['\n    <div class="msg__bodyPreview">\n      ',"\n      ","\n    </div>\n  "]);return b=function(){return e},e}function k(){var e=(0,i.default)(['\n    <div class="msg__reply">\n      ','\n      <div class="msg__replyInner">\n        <div class="msg__replyHead">\n          <div class="msg__replyHeadRow">\n            <div class="msg__replyName">','</div>\n            <div class="msg__replyDate">','</div>\n          </div>\n        </div>\n        <div class="msg__replyBody">\n          ',"\n        </div>\n      </div>\n    </div>\n  "]);return k=function(){return e},e}function C(){var e=(0,i.default)(['\n    <div class="msg__info msg__restoreText msg__restoreText_remove">\n      ','\n      <span class="msg__restoreText msg__infoLink" ',">\n        ",'\n      </span>\n    </div>\n    <div class="msg__info msg__restoreText msg__restoreText_spam">\n      ','\n      <span class="msg__restoreText msg__infoLink" ',">\n        ","\n      </span>\n    </div>\n  "]);return C=function(){return e},e}function E(){var e=(0,i.default)(['\n    <span class="msg__edited">\n      <span class="msg__editedMiddot">&middot;</span><span class="msg__editedText">',"</span>\n    </span>\n  "]);return E=function(){return e},e}function I(){var e=(0,i.default)(['\n    <div class="msg__admin">\n      (<a class="msg__adminLink" href="','">',"</a>)\n    </div>\n  "]);return I=function(){return e},e}function T(){var e=(0,i.default)(['\n    <div class="msg__actions">\n      ',"\n    </div>\n  "]);return T=function(){return e},e}function M(){var e=(0,i.default)(['\n    <div class="msg_item','">\n      <div class="mi_header">\n        ','\n        <a class="msg__author" href="','">','</a>\n        <div class="msg__date">',"</div>\n        ","\n      </div>\n      ","\n      ","\n      ","\n      ","\n    </div>\n  "]);return M=function(){return e},e}function P(){var e=(0,i.default)(['\n    <div class="msg__detailed">\n      <div class="msg__detailedHead">\n        ','\n        <div class="msg__detailedInfo">\n          <div class="msg__detailedRow">\n            <a class="msg__detailedAuthor" href="','">','</a>\n            <span class="msg__detailedPeer">','</span>\n          </div>\n          <div class="msg__detailedRow">\n            <div class="msg__date">','</div>\n          </div>\n        </div>\n      </div>\n      <div class="msg__content">\n        <div class="msg__text">\n          ',"\n        </div>\n        ","\n      </div>\n      ","\n    </div>\n  "]);return P=function(){return e},e}function L(){var e=(0,i.default)(['\n    <div class="msg_item _msg single_msg_item msg__text">\n      <div class="msg__giftMedia">',"</div>\n      ","\n    </div>\n  "]);return L=function(){return e},e}function N(){var e=(0,i.default)(['\n    <div class="msg_item _msg single_msg_item msg__text">\n      <div class="mi_cont">\n        <div class="mi_body">\n          ',"\n          ","\n          ","\n          ","\n        </div>\n      </div>\n    </div>\n  "]);return N=function(){return e},e}function R(){var e=(0,i.default)(["\n    ",'\n    <div class="msg__content">\n      <div class="msg__head">\n        <a class="msg__author" href="','">',"</a>\n        ","\n        ","\n        ","\n        ","\n        ","\n        ","\n        ","\n        ","\n        ","\n      </div>\n      ",'\n      <div class="msg__text">\n        ',"\n      </div>\n      ",'\n    </div>\n    <div class="msg__restore">\n      ',"\n    </div>\n  "]);return R=function(){return e},e}function x(){var e=(0,i.default)(['\n    <div class="','" ',">\n      ","\n      ","\n    </div>\n  "]);return x=function(){return e},e}function B(){var e=(0,i.default)(['\n      <div class="','" ',">\n        ","\n      </div>\n    "]);return B=function(){return e},e}function D(e){var t,n,i=window.lang,a=(0,f.mailWrapMention)(e.text),r=0;e.attachesHTML?t=e.attachesHTML:e.attaches.sticker&&e.sticker?(n=function(e,t,n,i,a,r,s){void 0===i&&(i=""),void 0===a&&(a=!0),void 0===r&&(r=""),void 0===s&&(s="");var l=Date.now(),c=Math.random(),u=""+l+c,d="msg__sticker",_="";s&&(d+=" sticker_animation",_='\n      data-animation-path="'+s+'"\n      data-uniq-id="'+u+'"\n      data-sticker-id="'+e+'"\n      data-loop-count="3"\n      ontouchstart="StickersAnimation.touchStartSticker(this);"\n      ontouchend="StickersAnimation.touchEndSticker(this);"\n    ');var p=o.default.onClick("Msg._onStickerClick","event","this",a,i);return(0,f.isSAKIntegration)()?o.default.html(A(),d,_,p,t,t,t,n):o.default.html(g(),d,r,p,_,t,t,t,n)}(e.sticker.id,e.sticker.height,e.sticker.url),t=o.default.html(y(),n)):ee(e)&&Object.keys(e.attaches).length&&(r+=1,t=Y(G(e),!e.failed&&1===r));var s,l=e.forwards;l.length&&(ee(e)&&Z(l)?(r+=1,s=Y(langNumeric(l.length,i.mobile_mail_N_forwards),!e.failed&&1===r)):s=(s=l.map((function(t){return U(t,e.id,e.maxDepth-1)}))).join(""));var c,u=e.reply;u&&(ee(e)&&(Z([u])||!function(e){var t=store.mail;return(0,f.isForwardedMessageId)(e)?!!t.replies[e]:!!t.pendingReplies[e]}(u))?(r+=1,c=Y(i.mobile_mail_in_reply_to,!e.failed&&1===r)):c=$(u,e.id,{isPinned:e.isPinned,chatId:e.chatId}));return t&&(t='<div class="mi_medias">'+t+"</div>"),s&&(s='<div class="mi_forwarded">'+s+"</div>"),a&&(a='<div class="mi_text">'+a+"</div>"),o.default.html(N(),c,a,t,s)}function O(e){var t=D(e),n=e.keyboard?z(e):"",i=e.template?X(e):"",r=a.default.html((0,s.Avatar)({mix:"msg__avatar",url:e.authorUrl,src:e.authorPhoto,size:40,mode:(0,f.getAvatarMode)({id:e.authorId,name:e.authorName}),backgroundTheme:e.authorId,text:e.authorName,textLength:(0,f.getAvatarTextLength)(e.authorId)})),l=function(e){var t=window.lang,n=store.mail,i=n.msgs[e.id],o=n.peers[i.peerId],a="";if((0,f.isChatPeer)(i.peerId)){var r='<a href="'+(0,f.wrapCommunityMailUrl)("/mail?act=show&peer="+i.peerId)+'">'+o.title+"</a>";a=t.mobile_mail_message_to_chat.replace("{chat}",r)}return a}(e);return o.default.html(P(),r,e.authorUrl,e.authorName,l,e.date,t,n,i)}function U(e,t,n){var i=window.lang,r=store.mail,l=r.forwards[e]||r.msgs[e];if(!l)return"";var c,u=r.members[l.authorId],d=l.peerId,_=(r.peers[d],J(u,d,r.cur.userId)),p=l.edited,m=u.avatar,h=u.url,v=_,g=l.date,A=(0,f.mailWrapMention)(l.text),y=l.attachesHTML,w=l.forwards,S=l.reply,b=a.default.html((0,s.Avatar)({mix:"mi_author_photo",src:m,size:36,mode:(0,f.getAvatarMode)({id:l.authorId,name:v}),backgroundTheme:l.authorId,text:v,textLength:(0,f.getAvatarTextLength)(l.authorId)})),k=p?H():"";if(n>0){for(var C=[],E=w.length,I=0;I<E;I++){var T=U(w[I],t,n-1);C.push(T)}c=C.join("")}else if(w.length){c='<a href="/mail?act=msg&id='+t+'" class="msg__fwdsLink">'+langNumeric(w.length,i.mobile_mail_N_forwards)+"</a>"}y&&(y='<div class="mi_medias">'+(y=y.replace(/%top_msg_id%/g,t))+"</div>"),c&&(c='<div class="mi_forwarded">'+c+"</div>"),A&&(A='<div class="mi_text">'+A+"</div>");var P=S?$(S,t,{}):"",L=!!l.attaches.gift?" msg__forwardGift":"";return o.default.html(M(),L,b,h,v,g,k,P,A,y,c)}function H(){var e=window.lang;return o.default.html(E(),e.mobile_mail_edited_short)}function F(e){var t=window.lang,n=o.default.onClick("Msg._onRestoreClick","event",e);return o.default.html(C(),t.mobile_msg_mail_message_deleted,n,t.mobile_restore,t.mobile_msg_mail_message_marked_as_spam,n,t.mobile_restore)}function V(e,t){var n="/mail?act=msg";return n=(0,f.concatValues)(n,"&id=pinned&chat="+e),t&&(n=(0,f.concatValues)(n,"&reply_id="+t+"&reply=true")),(0,f.wrapCommunityMailUrl)(n)}function j(e,t,n){var i="/mail?act=msg";return t?(i=(0,f.concatValues)(i,"&id="+t+"&reply=true"),n&&(i=(0,f.concatValues)(i,"&reply_id="+n))):i=(0,f.concatValues)(i,"&id="+e),(0,f.wrapCommunityMailUrl)(i)}function $(e,t,n){var i=store.mail.forwards[e]||store.mail.msgs[e],o=store.mail.replies[e]||store.mail.pendingReplies[e];return Q(q(i,J(store.mail.members[i.authorId],i.peerId,store.mail.cur.userId),o.preview_url),o.msg_id,t,e,n)}function q(e,t,n){var i="";i=e.isExpired?'<span class="msg__replyDisappeared">'+(0,f.getLang)("mobile_casper_chat_message_disappeared")+"</span>":e.body?W(e.body):K(e);var a="";return(e.attaches.photo||e.attaches.video||e.attaches.doc)&&(a=n?'<div class="msg__replyPreview"\n        style="background-image: url('+n+')"></div>':e.attaches.doc?'<div class="msg__replyPreview msg__replyPreview_icon">\n        <div class="msg__replyPreviewDoc"></div>\n      </div>':'<div class="msg__replyPreview msg__replyPreview_empty"></div>'),o.default.html(k(),a,t,e.date,i)}function W(e){return e=e.replace(/<br>/g,"\n"),e=(0,f.mailReplaceDomainMentions)(e,"@$3"),e=(0,f.mailReplaceMentions)(e,"$3"),e=(0,f.emojiToHTML)(e)}function G(e){var t,n=window.lang,i=Object.keys(e.attaches),o=i.length;if(o>1){for(var a=0,r=i.length,s=0;s<r;s++)a+=0|e.attaches[i[s]];t=langNumeric(a,n.mobile_mail_attachments)}else if(1===o){var l=i[0],c=e.attaches[l];if(1===c)switch(l){case"poll":t=n.mobile_mail_added_poll;break;case"article":t=n.global_article;break;case"artist":t=n.mobile_mail_added_artist;break;case"curator":t=n.mobile_mail_added_curator;break;case"photo":t=n.mobile_mail_added_photo;break;case"video":t=n.mobile_mail_added_video;break;case"audio":t=n.mobile_mail_added_audio;break;case"audio_playlist":t=n.mobile_mail_added_audio_playlist;break;case"money_transfer":t=n.mobile_mail_added_money_transfer;break;case"podcast":t=n.mobile_mail_added_podcast;break;case"money_request":t=n.mobile_mail_added_money_request;break;case"vkpay":t=n.mobile_mail_added_vkpay;break;case"story":t=n.mobile_mail_added_story;break;case"narrative":t=n.mobile_mail_added_narrative;break;case"graffiti":t=n.mobile_mail_added_graffiti;break;case"audiomsg":t=n.mobile_mail_added_audiomsg;break;case"doc":t=n.mobile_mail_added_doc;break;case"geo":case"map":t=n.mobile_mail_added_geo;break;case"wall":t=n.mobile_mail_added_wall;break;case"wall_reply":t=n.mobile_mail_added_wall_reply;break;case"gift":t=n.mobile_mail_added_gift;break;case"link":t=n.mobile_mail_added_link;break;case"sticker":t=n.mobile_mail_added_sticker;break;case"market":t=n.mobile_mail_added_market_item;break;case"call":case"group_call_in_progress":t=n.mobile_mail_added_call;break;case"donut_link":t=n.mobile_mail_added_donut_link}else if(c>1)switch(l){case"photo":t=langNumeric(c,n.mobile_mail_added_photos);break;case"video":t=langNumeric(c,n.mobile_mail_added_videos);break;case"audio":t=langNumeric(c,n.mobile_mail_added_audios);break;case"doc":t=langNumeric(c,n.mobile_mail_added_docs)}}var u=e.forwards&&e.forwards.length||e.hasReply;return!t&&u&&(t=e.hasReply?langNumeric(1,n.mobile_mail_messages):langNumeric(e.forwards.length,n.mobile_mail_N_forwards)),t||""}function Y(e,t){var n;return t&&(n='<div class="msg__loading">'+(n=a.default.html((0,u.default)({large:!0})))+"</div>"),o.default.html(b(),e,n)}function K(e){var t=G(e);return o.default.html(S(),t)}function Q(e,t,n,i,a){var r="";r=a.isPinned&&a.chatId?V(a.chatId,i):j(t,n,i);var s=o.default.onClick("Msg._onReplyClick","event",t,n,i);return o.default.html(w(),r,s,e)}function z(e){var t=te(e.id),n=a.default.render((0,c.default)({msgId:e.id,pressed:t,keyboard:e.keyboard}));return o.default.html(v(),n)}function X(e){switch(e.template.type){case"carousel":return function(e){for(var t=[],n=0;n<e.template.elements.length;n++){var i=e.template.elements[n];t[n]=(0,f.extend)(i,{pressed:te(e.id,"carousel"+n)})}var r=a.default.render((0,m.default)({msgId:e.id,authorId:e.authorId,elements:e.template.elements,pressed:t}));return o.default.html(h(),r)}(e)}return""}function J(e,t,n){return t>2e9?e.name:t>-2e9&&t<0?e.id===n?e.firstName:e.name:e.firstName}function Z(e){for(var t=store.mail.msgs,n=store.mail.members,i=store.mail.forwards,o=e.length,a=0;a<o;a++){var r=e[a];if((0,f.isForwardedMessageId)(r)){var s=i[r];if(!s)return!0;if(!s.authorId||!n[s.authorId])return!0}else{var l=t[r];if(!l)return!0;if(!l.authorId||!n[l.authorId])return!0}}return!1}function ee(e){return e.pending||e.failed||e.waiting}function te(e,t){void 0===t&&(t="");var n=window.store,i="";return t&&(i=t+"|"),n.mail&&n.mail.cur&&n.mail.cur.pressedButtons?n.mail.cur.pressedButtons.msgs[i+e]:{}}t.default=function(e){var t=e.id,n=e.removed,i=e.isExpired,c=i||e.service,u=function(e){var t=window.lang,n=e.isDefaultCasperTimerShown;if(e.service)return e.text;var i,c=a.default.html((0,s.Avatar)({mix:"msg__avatar",url:e.authorUrl,src:e.authorPhoto,size:40,mode:(0,f.getAvatarMode)({id:e.authorId,name:e.authorName}),backgroundTheme:e.authorId,text:e.authorName,textLength:(0,f.getAvatarTextLength)(e.authorId)})),u=a.default.html((0,r.default)({mix:"msg__check",icon:"check"})),_=a.default.html({class:"msg__star"}),m=!!e.attaches.gift,h=store.mail.msgs[e.id];h&&h.authorId===h.peerId&&(i=store.mail.peers[h.peerId]);var v=e.admin?(M=e.admin,o.default.html(I(),M.url,M.name)):"",g=e.removed?F(e.id):"",A=e.edited?H():"",y=e.pending||e.failed?"":'<div class="msg__date">'+e.date+"</div>",w=e.pending?a.default.html({inner:[(0,p.Icon16Recent)()],class:"msg__pending",tag:"div"}):"",S=e.failed?'<div class="msg__error">'+t.mobile_mail_send_error+"</div>":"",b=e.channel?function(e){var t=(0,l.default)({class:"msg__actionForward",onClick:o.default.onClick("Msg._onActionClick","event","forward",e)});return o.default.html(T(),t)}(e.id):"",k=m&&i?'<div class="msg__giftHead">'+langSex(i.sex,t.mobile_mail_sent_gift)+"</div>":"",C=(0,f.timestamp)(),E=null;var M;e.ttl&&(E=Math.round(e.ts+e.ttl-C));var P,N=E?a.default.render((0,d.default)({durationInSeconds:E,isDefaultCasperTimerShown:n})):"";P=m?function(e){var t=e.text,n=e.attachesHTML;t&&(t='<div class="msg__giftText">'+t+"</div>");return o.default.html(L(),n,t)}(e):D(e);var x=e.keyboard?z(e):"";return o.default.html(R(),c,e.authorUrl,e.authorName,k,y,w,S,A,v,N,u,_,b,P,x,g)}(e),m=!c&&!(!e.attaches||!e.attaches.gift),h=!(!e.attaches||!e.attaches.group_call_in_progress),v=o.default.class("msg",{id:t,service:c,unread:e.unread&&!e.failed,important:e.important,removed:!!n,spam:"spam"===n,pending:e.pending,failed:e.failed,gift:m,call:h,hasTemplate:!!e.template}),g="";c||h||(g=e.pending||e.failed?o.default.onClick("Msg._onPendingClick","event","this",t,e.sendId||"",!!e.failed):o.default.onClick("Msg._onClick","event","this",t));if(i){var A=a.default.render((0,_.default)());return o.default.html(B(),v,g,A)}var y=e.template?X(e):"";return o.default.html(x(),v,g,u,y)}},42620:function(e,t,n){"use strict";var i=n(1730),o=n(62561),a=n(3226),r=n(45019),s=n(35576),l=n(9046),c=need("Voting");Object.assign(r.default,{class:"msg",onClick:(0,a.default)(),onPendingClick:(0,a.default)(),onRestoreClick:(0,a.default)(),onReplyClick:(0,a.default)(),onForward:(0,a.default)(),onLoadAgain:(0,a.default)(),getElem:function(e){return(0,i.$)(".msg_id_"+e)},remove:function(e,t){void 0===t&&(t=!1);t?(0,i.$$)(".msg_id_"+e).forEach((function(e){return e.remove()})):m(e,!1)},spam:function(e){m(e,!0)},restore:function(e){(0,i.$$)(".msg_id_"+e).forEach((function(e){e.classList.remove("msg_removed"),e.classList.remove("msg_spam")}))},unselectAll:function(){(0,i.$$)(".msg_selected").forEach((function(e){return e.classList.remove("msg_selected")}))},getReplyDataFromHTML:function(e){var t=e&&r.default.getElem(e),n="";if(t){var o=(0,i.$)(".thumbs_map .thumb_map_img_as_div",t);return(n=o&&o.style.backgroundImage)&&(n=n.replace(/^url\((['"])?/,"").replace(/(['"])?\)$/,"")),{msg_id:e,parent_id:null,preview_url:n}}return null},toggleImportant:function(e,t){[].concat(e).forEach((function(e){var n=(0,i.$)(".msg_id_"+e);n&&n.classList.toggle("msg_important",t)}))},markAsRead:function(e){(0,i.$$)(".msg_id_"+e).forEach((function(e){return e.classList.remove("msg_unread")}))},getId:function(e){var t=o.default.parseClass(d,e.className);return Number(t.id)},getTextHtml:function(e){return e.$(_).innerHTML}}),r.default._onClick=h,r.default._onPendingClick=v,r.default._onTouchStart=A,r.default._onRestoreClick=p,r.default._onActionClick=y,r.default._onReplyClick=S,r.default._onStickerClick=b,r.default.onStickerTouchStart=k;var u,d="msg",_=".msg__text",f=!1;function p(e,t){e.stopPropagation(),t=parseInt(t,10),r.default.onRestoreClick(t)}function m(e,t){void 0===t&&(t=!1);var n=(0,r.Msg__restoreInner)(e);(0,i.$$)(".msg_id_"+e).forEach((function(e){e.$(".msg__restore").innerHTML=n,e.classList.remove("msg_selected"),e.classList.add("msg_removed"),e.classList.toggle("msg_spam",t)}))}function h(e,t,n){g(e.target,t,(function(){t.classList.toggle("msg_selected"),r.default.onClick(n)}))}function v(e,t,n,i,o){g(e.target,t,(function(){r.default.onPendingClick(n,i,o)}))}function g(e,t,n){for(var o,a,r=t.classList.contains("msg_pending")||t.classList.contains("msg_failed");e!==t;)if(r&&-1!==e.className.indexOf("msg__sticker"))e=e.parentElement;else{if("A"===e.tagName||"BUTTON"===e.tagName||e.getAttribute("onclick")||e.classList.contains("im_msg_audiomsg")||e.classList.contains("articleSnippet__block")||e.classList.contains("MailButton")||e.closest("."+c.cls))return;e=e.parentElement}f?f=!1:w()||t.classList.contains("msg_removed")||t.classList.contains("msg_spam")||store.mail.cur.editing||(null==(o=window.Speech)||null==(a=o.recorder)?void 0:a.isRecording)||(0,i.$)(".VoiceRecordControls")||n()}function A(){w()&&(f=!0)}function y(e,t,n){switch(t){case"forward":r.default.onForward(n)}}function w(){return window.getSelection().toString().length>0}function S(e,t,n,i){e.preventDefault(),r.default.onReplyClick(t,n,i)}function b(e,t,n,i){n&&(e.preventDefault(),i&&s.default.stickersClick(t,i))}function k(e,t){if(clearTimeout(u),!!t.getAttribute("data-animation-path")){var n=e.touches[0].clientX,i=e.touches[0].clientY;(0,l.addEvent)(t,"contextmenu",C),(0,l.addEvent)(t,"touchmove",o,{passive:!0}),(0,l.addEvent)(t,"touchend",a,{passive:!0}),(0,l.addEvent)(t,"touchcancel",a,{passive:!0}),u=setTimeout((function(){!function(e){StickersAnimation.loadAndPlaySticker(e)}(t),a()}),500)}function o(e){(Math.abs(e.touches[0].clientX-n)>=10||Math.abs(e.touches[0].clientY-i)>=10)&&a()}function a(){clearTimeout(u),(0,l.removeEvent)(t,"contextmenu",C),(0,l.removeEvent)(t,"touchmove",o,{passive:!0}),(0,l.removeEvent)(t,"touchend",a,{passive:!0}),(0,l.removeEvent)(t,"touchcancel",a,{passive:!0})}}function C(e){event.preventDefault(),event.stopPropagation()}},41070:function(e,t,n){"use strict";n.r(t),n.d(t,{Msg__restoreInner:function(){return i.Msg__restoreInner},Msg__reply:function(){return i.Msg__reply},Msg__authorName:function(){return i.Msg__authorName},Msg__replyAttach:function(){return i.Msg__replyAttach},Msg__replyLink:function(){return i.Msg__replyLink},Msg__textPreview:function(){return i.Msg__textPreview},Msg__attachPreview:function(){return i.Msg__attachPreview},Msg_makeReplyLink:function(){return i.Msg_makeReplyLink},Msg_makePinnedReplyLink:function(){return i.Msg_makePinnedReplyLink},Msg_detailed:function(){return i.Msg_detailed}});var i=n(45019);n(42620);t.default=i.default,window.Msg=i.default},52187:function(e,t,n){"use strict";n.r(t),n.d(t,{onConfirmDelete:function(){return u},open:function(){return d},close:function(){return _},isDeleteMessagesForAll:function(){return f}});var i=n(13725),o=n(62561),a=n(3226),r=n(98330);function s(){var e=(0,i.default)(["\n    ","\n    ","\n  "]);return s=function(){return e},e}var l="MsgDeleteDialog__checkboxInput",c=null,u=(0,a.default)();function d(e){r.default.open({body:p(e),confirmText:lang.mobile_mail_delete_popup_delete,cancelText:lang.mobile_mail_delete_popup_cancel,onConfirm:o.default.onClick("MsgDeleteDialog.onConfirmDelete"),onClose:o.default.onClick("MsgDeleteDialog.close")})}function _(){var e=$("."+l);e&&(c=e.checked,lsSet("delete_message_for_all_checked",c)),r.default.close()}function f(){var e=$("."+l);return!!e&&e.checked}function p(e){var t,n,i=e.isEditing,a=e.canDeleteForAll;if(i)t=lang.mobile_mail_dialog_msg_delete_for_all;else{var r=Object.keys(store.mail.cur.msgSelected).length;t=langNumeric(r,lang.mobile_mail_dialog_msg_delete_N)}if(!i&&a){var u=lang.mobile_mail_delete_for_all,d=function(){if("boolean"!=typeof c){var e=!!lsGet("delete_message_for_all_checked");c=e}return c}()?"checked":"";n='\n      <div class="MsgDeleteDialog__checkbox">\n        <label class="MsgDeleteDialog__checkboxIn">\n          <input type="checkbox" class="'+l+'" '+d+'>\n          <span class="MsgDeleteDialog__checkboxLabel">'+u+"</span>\n        </label>\n      </div>\n    "}return o.default.html(s(),t,n)}},4331:function(e,t,n){"use strict";n.r(t);var i=n(52187);t.default=i,window.MsgDeleteDialog=i},74070:function(e,t,n){"use strict";var i=n(84359),o=n(10729),a=n(46950),r=n(35909);t.default=function(e){void 0===e&&(e={});for(var t=e.elements,n=e.msgId,s={inline:!0,author_id:e.authorId||100},l=[],c=function(e){var o=t[e],r=o.pressed,c=o.buttons?o.buttons.map((function(t){return(0,i.BotsKeyboardRow)([t],s,n,r,"carousel"+e,e)})):null,u=o.title||o.description||c,d=(0,a.classNames)("MsgTemplateCard",{"MsgTemplateCard--full":!!u,"MsgTemplateCard--photo":!u}),_=o.action;_&&"open_photo"===_.type&&(_.photo_id=o.photo_id+"/mail"+n),l.push({inner:[o.photo_src?{inner:[{src:o.photo_src,alt:"",tag:"img"},{class:"MsgTemplateCard__imageShadow",tag:"div"}],class:"MsgTemplateCard__image",tag:"div"}:null,u?{inner:[o.title||o.description?{inner:[o.title?{inner:[Wd.wrap(o.title)],class:"MsgTemplateCard__title",tag:"span"}:null,o.description?{inner:[Wd.wrap(o.description)],class:"MsgTemplateCard__subtitle",tag:"span"}:null],class:"MsgTemplateCardContent__text",tag:"div"}:null,c?{inner:[c],class:"MsgTemplateCardContent__buttons",tag:"div"}:null],class:"MsgTemplateCardContent",tag:"div"}:null],class:d,onclick:_?"MsgTemplates.Carousel.handleElementAction(event, "+JSON.stringify(_)+")":"",tag:"div"})},u=0;u<t.length;u++)c(u);var d=(0,a.arrayLength)(t)>1;return{inner:[(0,o.default)({inner:[l],class:"Slider--right",onScroll:["MsgTemplates.Carousel.onScroll","event"],snapping:!0}),d?{inner:[{inner:[(0,r.Icon24ChevronRight)()],class:"MsgTemplate__button MsgTemplate__button--prev",onClick:["MsgTemplates.Carousel.moveSlider","this","prev"],tag:"button"},{inner:[(0,r.Icon24ChevronRight)()],class:"MsgTemplate__button MsgTemplate__button--next",onClick:["MsgTemplates.Carousel.moveSlider","this","next"],tag:"button"}],class:"MsgTemplate__buttons",tag:"div"}:null],class:"MsgTemplate MsgTemplate--carousel",tag:"div"}}},92797:function(e,t,n){"use strict";n.d(t,{handleElementAction:function(){return r},onScroll:function(){return s},moveSlider:function(){return l}});var i=n(2955),o=n(10729),a=n(1730);function r(e,t){if("open_link"===t.type){if("BUTTON"===e.target.tagName||e.target.closest(".MsgTemplateCardContent__buttons"))return;var n=(0,i.wrapAwayIfExternal)(t.link,!0);window.open(n)}else if("open_photo"===t.type){var o=(t.photo_id||"").split("/"),a=o[0],r=o[1];return photo.zopen(null,null,a,r,{})}}function s(e){var t=e.target.closest(".Slider"),n=(0,o.getElements)(t),i=(0,o.getCurrentElementIndex)(t,n);t.classList.toggle("Slider--left",0!==i),t.classList.toggle("Slider--right",i<n.length-1)}function l(e,t){var n=e.closest(".MsgTemplate--carousel"),i=(0,a.$)(".Slider",n);"next"===t?Slider.nextElem(i,!0,"left"):Slider.prevElem(i,!0,"left")}},41824:function(e,t,n){"use strict";n.d(t,{handleElementAction:function(){return o.handleElementAction},onScroll:function(){return o.onScroll},moveSlider:function(){return o.moveSlider}});var i=n(74070),o=n(92797);t.default=i.default},63943:function(e,t,n){"use strict";n.d(t,{PeerProfileTags:function(){return r},PeerProfileInfo:function(){return l},PeerProfileJoinDate:function(){return c}});var i=n(46950),o=n(86205),a=n(27301);function r(e){for(var t=e.fromAd?1:0,n=3-t,r=[],l=e.fromAd?{inner:[(0,o.default)({icon:(0,a.getAdTag10Icon)()}),{inner:[(0,i.getLang)("mobile_mail_ad_tag_no_access_text")],tag:"span"}],class:"PeerProfile__adTag",tag:"div"}:"",c=e.peerTags,u=0,d=0;d<c.length;d++)e.fromMessenger&&d>=n?u++:r.push(c[d]);var _=window.lang,f=r.length+t;return{inner:[{inner:[(0,i.getLang)("mobile_mail_peer_profile_tags_label")],class:"PeerProfile__blockLabel",tag:"div"},f>0?{inner:[l,s(r),u>0?{inner:["+"+langNumeric(u,_.mobile_mail_peer_profile_extra_tags)],href:e.urls.showPeerProfile,class:"PeerProfile__extraTag",tag:"a"}:"",e.fromMessenger?"":{inner:[(0,i.getLang)("mobile_mail_peer_profile_edit_tags_link")],href:e.urls.toggleTags,class:"PeerProfile__editTag",tag:"a"}],class:"PeerProfile__blockContent PeerProfile__tagsList",tag:"div"}:{inner:[{inner:[(0,i.getLang)("mobile_mail_peer_profile_add_tags_link")],href:e.urls.toggleTags,tag:"a"}],class:"PeerProfile__blockContent",tag:"div"}],class:"PeerProfile__block",tag:"div"}}function s(e){return[e.map((function(e){return{inner:[e.name],class:"PeerProfile__peerTag",style:"background-color: "+e.color,tag:"div"}}))]}function l(e){var t=e.city||e.age;return{inner:[{inner:[(0,i.getLang)("mobile_mail_peer_profile_info_label")],class:"PeerProfile__blockLabel",tag:"div"},{inner:[t?[e.city?{inner:[e.city],class:"PeerProfile__blockItem",tag:"span"}:"",e.age?{inner:[e.age],class:"PeerProfile__blockItem",tag:"span"}:""]:{inner:[(0,i.getLang)("mobile_mail_peer_profile_info_empty")],tag:"span"}],class:"PeerProfile__blockContent",tag:"div"}],class:"PeerProfile__block",tag:"div"}}function c(e){return{inner:[{inner:[(0,i.getLang)("mobile_mail_peer_profile_join_date_label")],class:"PeerProfile__blockLabel",tag:"div"},{inner:[e.joinDate?e.joinDate:(0,i.getLang)("mobile_mail_peer_profile_join_date_empty_text")],class:"PeerProfile__blockContent",tag:"div"}],class:"PeerProfile__block",tag:"div"}}t.default=function(e){var t=e.tagsData,n=[];e.tags&&t.peerTags&&(n=e.tags.filter((function(e){return t.peerTags.indexOf(e.id)>-1})));var o=r({fromAd:t.fromAd,peerTags:n,urls:e.data.urls}),a=l(e.data),s=(_=e.data,f=_.likesCount||_.repliesCount,{inner:[{inner:[(0,i.getLang)("mobile_mail_peer_profile_activity_label")],class:"PeerProfile__blockLabel",tag:"div"},{inner:[f?[_.likesCount?{inner:[_.likesCount],class:"PeerProfile__blockItem",tag:"span"}:"",_.repliesCount?{inner:[_.repliesCount],class:"PeerProfile__blockItem",tag:"span"}:""]:{inner:[(0,i.getLang)("mobile_mail_peer_profile_info_empty")],tag:"span"}],class:"PeerProfile__blockContent",tag:"div"}],class:"PeerProfile__block",tag:"div"}),u=function(e){return{inner:[{inner:[(0,i.getLang)("mobile_mail_peer_profile_note_label")],class:"PeerProfile__blockLabel",tag:"div"},{inner:[e.note?{inner:[e.note],tag:"span"}:"",{inner:[(0,i.getLang)(e.note?"mobile_mail_peer_profile_edit_note_link":"mobile_mail_peer_profile_add_note_link")],href:e.urls.editNote,class:e.note?"PeerProfile__editNoteLink":"PeerProfile__blockLink",tag:"a"}],class:"PeerProfile__blockContent",tag:"div"}],class:"PeerProfile__block",tag:"div"}}(e.data),d=c(e.data);var _,f;return[o,a,s,u,d]}},94399:function(e,t,n){"use strict";n(30506);var i=n(85489),o=n(1730),a=(n(46950),n(9046)),r=n(11393),s=n(63943),l=n(54784);Object.assign(s.default,{onMessengerBlockClick:function(e,t){if((0,a.gpeByClass)("PeerProfile__adTag",e.target))return;nav.go(t)},toggleTag:function(e,t,n,i){ajaxRequest("/mail",{act:"toggle_peer_profile_tag",tag_id:e,action:i.checked?"bind":"unbind",peer_id:t,hash:n})},onAddTagClick:function(e){var t=e.$btn,n=t.parentElement,i=(0,o.$$)(p,n),a=(0,o.$$)("."+w(),n);if(i.length-a.length>=20)return;var s=r.default.elem((0,l.ManageTagsField)({id:"",name:"",color:g(n),state:u,index:i.length}));n.insertBefore(s,t),y()},onRemoveTagClick:function(e){var t=e.parentElement,n=(0,o.$)(m,t),i=(0,o.$)(h,n);i.value===u?t.remove():((0,a.addClass)(w(),t),i.value=d,A());y()},onTagNameChange:function(e){var t=e.closest(".PeerProfileManageTags__field"),n=(0,o.$)(m,t),i=(0,o.$)(h,n);i.value!==u&&(i.value="changed");A()}});var c=["#4bb34b","#5c9ce6","#e64646","#792ec0","#63b9ba","#ffa000","#ffc107","#76787a","#9e8d6b","#45678f","#539b9c","#454647","#7a6c4f","#6bc76b","#5181b8","#ff5c5c","#a162de","#7ececf","#aaaeb3","#bbaa84"],u="new",d="deleted",_="HeaderBtn",f="PeerProfileManageTags__field",p="."+f,m=".PeerProfileManageTags__stateLabel",h=".TextInput__native",v="PeerProfileManageTags__addLink";function g(e){var t=(0,o.$$)(p,e),n=Array.from(t).reduce((function(e,t){var n=(0,o.$)(m,t);if((0,o.$)(h,n).value!==d){var i=(0,o.$)(".PeerProfileManageTags__colorLabel",t);e[(0,o.$)(h,i).value]=!0}return e}),{});return c.find((function(e){return!n[e]}))}function A(){var e=(0,o.$)(".HeaderBtn"),t=i.default.class(_,{hidden:!0}).replace("HeaderBtn ","");(0,a.removeClass)(t,e)}function y(){var e=(0,o.$)(".PeerProfileManageTags__addLink"),t=e.parentElement,n=(0,o.$$)(p,t),r=(0,o.$$)("."+w(),t),s=n.length-r.length,l=i.default.class(v,{hidden:!0}).replace(v+" ","");(0,a.toggleClass)(l,e,s>=20)}function w(){return i.default.class(f,{removed:!0}).replace(f+" ","")}},19938:function(e,t,n){"use strict";n.d(t,{PeerProfileTags:function(){return i.PeerProfileTags},PeerProfileInfo:function(){return i.PeerProfileInfo},PeerProfileJoinDate:function(){return i.PeerProfileJoinDate}});var i=n(63943);n(94399),i.default;window.PeerProfile=i.default},70914:function(e,t,n){"use strict";n.d(t,{ManageTagsField:function(){return c}});var i=n(85489),o=n(46950),a=n(49751),r=n(81755),s=n(35909);function l(e){return[e.map((function(e){return c(e)}))]}function c(e){var t=e.index+"_";return{inner:[(0,r.default)({name:"tags["+t+"id]",type:"hidden",value:e.id}),(0,r.default)({name:"tags["+t+"state]",type:"hidden",value:e.state||"",class:"PeerProfileManageTags__stateLabel"}),(0,r.default)({name:"tags["+t+"color]",type:"hidden",value:e.color,class:"PeerProfileManageTags__colorLabel"}),(0,r.default)({name:"tags["+t+"name]",class:"PeerProfileManageTags__label",placeholder:(0,o.getLang)("mobile_mail_peer_profile_manage_tags_placeholder"),value:e.name,maxlength:20,on_change:["PeerProfile.onTagNameChange","this"]}),{class:"PeerProfileManageTags__color",style:"background-color: "+e.color,tag:"span"},{inner:[(0,s.Icon24Cancel)()],class:"PeerProfileManageTags__remove",onClick:["PeerProfile.onRemoveTagClick","this"],tag:"div"}],class:"PeerProfileManageTags__field",tag:"div"}}t.default=function(e){var t=[],n=e.tags.length;if(n>0)for(var s=0;s<n;s++){var c=(0,o.extend)(e.tags[s],{index:s});t.push(c)}else t.push({id:"",name:"",color:"#4bb34b",state:"new",index:0});return{inner:[(0,r.default)({name:"hash",type:"hidden",value:e.data.hash}),(0,r.default)({name:"peer_id",type:"hidden",value:e.data.peerId}),l(t),(0,a.default)({inner:[(0,o.getLang)("mobile_mail_peer_profile_manage_tags_add_link")],theme:"link",class:i.default.class("PeerProfileManageTags__addLink",{hidden:n>=20}),onClick:"PeerProfile.onAddTagClick"})],id:"manage_tags_form",method:"POST",action:e.data.urls.saveTags,tag:"form"}}},54784:function(e,t,n){"use strict";n.d(t,{ManageTagsField:function(){return i.ManageTagsField}});var i=n(70914);i.default},76065:function(e,t,n){"use strict";n.d(t,{default:function(){return _},VoiceRecordControlsPanel:function(){return p}});var i=n(86205),o=n(46854),a=n(2067),r=n(49751),s=n(79241),l=n(46950),c=n(35909),u=n(32027),d=n(64723);function _(e){void 0===e&&(e={});var t=window.lang;return{inner:[p(e),f(e),"preview"!==e.state?{inner:[{inner:[{inner:[(0,c.Icon28Send)()],class:"VoiceRecordControls__circleSend",tag:"div"},{inner:[(0,i.default)({icon:(0,o.getMicrophone28Icon)()})],class:"VoiceRecordControls__circleMicrophone",tag:"div"},{inner:[(0,c.Icon28Delete)()],class:"VoiceRecordControls__circleCancel",tag:"div"}],class:"VoiceRecordControls__circle",tag:"div"},{class:"VoiceRecordControls__shadow",tag:"div"}],class:"VoiceRecordControls__float","aria-label":t.mobile_mail_voice_record_send_aria,tag:"button"}:null],class:(0,l.classNames)("VoiceRecordControls",{"VoiceRecordControls--locked":"locked"===e.state,"VoiceRecordControls--lock":"locked"===e.state,"VoiceRecordControls--show":"locked"===e.state}),tag:"div"}}function f(e){var t=window.lang;return"preview"===e.state?null:{inner:[{inner:[(0,c.Icon24Chevron)()],class:"VoiceRecordControls__lockChevron",tag:"div"},{inner:[(0,i.default)({icon:"locked"===e.state?(0,u.getStop20Icon)():(0,a.getUnlockOutline20Icon)()})],class:"VoiceRecordControls__lockIcon",tag:"div"}],class:"VoiceRecordControls__lock","aria-label":t.mobile_mail_voice_record_stop_aria,tag:"div"}}function p(e){void 0===e&&(e={});var t,n=window.lang;"preview"!==e.state?t=["locked"===e.state?(0,r.default)({inner:[n.mobile_cancel],class:"VoiceRecordControls__cancel VoiceRecordControls__cancel--button",theme:"tertiary",use_native_onclick:!0,onClick:"uMailWrite._cancelVoiceRecord()"}):{inner:[(0,c.Icon16Chevron)(),n.mobile_cancel],class:"VoiceRecordControls__cancel",tag:"span"},{inner:[{class:"VoiceRecordControls__marker",tag:"span"},{inner:[e.duration||"0:00"],class:"VoiceRecordControls__durationText",tag:"span"},{inner:[(0,d.default)({spinner:!0})],class:"VoiceRecordControls__spinner",tag:"div"}],class:"VoiceRecordControls__duration",tag:"span"}]:t=[{inner:[(0,c.Icon28CancelOutline)()],class:"VoiceRecordControls__cancel VoiceRecordControls__cancel--button",onClick:"uMailWrite._cancelVoiceRecord()","aria-label":n.mobile_mail_voice_record_cancel_aria,tag:"button"},{inner:[(0,s.VoiceMessagePlayer)({url:e.url,duration:e.audioMessagePreviewData.duration,wave:e.audioMessagePreviewData.waves.join(",")||"0"})],class:"VoiceRecordControls__player",tag:"div"},{inner:[(0,c.Icon28Send)()],class:"VoiceRecordControls__send","aria-label":n.mobile_mail_voice_record_send_aria,tag:"button"}];return{inner:[t],class:(0,l.classNames)("VoiceRecordControls__panel",{"VoiceRecordControls__panel--preview":"preview"===e.state}),tag:"div"}}},24122:function(e,t,n){"use strict";n.d(t,{VoiceRecordControls:function(){return i.default}});var i=n(76065)},75526:function(e,t,n){"use strict";n.r(t),n.d(t,{uConvo_getLastMsgId:function(){return i.uConvo_getLastMsgId}});var i=n(61412);n(37829);t.default=i.default,window.uConvo=i.default},61412:function(e,t,n){"use strict";n.d(t,{uConvo_getLastMsg:function(){return f},uConvo_getOnline:function(){return c},uConvo_getUnreadCount:function(){return u},uConvo_getTyping:function(){return p},uConvo_msgPreview:function(){return l},uConvo_getLastMsgId:function(){return _},uConvo_getPeer:function(){return d}});n(62561);var i=n(11393),o=(n(72592),n(83228)),a=n(46705),r=n(41070),s=n(46950);function l(e,t){void 0===t&&(t=!0);var n=window.lang,o=store.mail,a=!!e.attaches.call;if(e.isExpired){var l=(0,s.getLang)("mobile_mail_you")+": "+(0,s.getLang)("mobile_casper_chat_message_disappeared");return i.default.html({inner:[l],tag:"span"})}if(e.isService&&!a)return i.default.html({tag:"span",inner:[i.default.wrap(e.serviceText)]});var c=e.body?i.default.wrap((0,r.Msg__textPreview)(e.body)):function(e){return{tag:"span",class:"convo__msgAttach",inner:(0,r.Msg__attachPreview)(e)}}(e);if(!t)return i.default.html({inner:[c],tag:"span"});var u="";return e.authorId===o.cur.userId&&e.peerId!==o.cur.userId?u=n.mobile_mail_you:(0,s.isChatPeer)(e.peerId)&&e.authorId&&(u=(u=o.members[e.authorId].shortName).replace(/\.$/,"")),u&&(u+=": "),i.default.html({tag:"span",inner:[i.default.wrap(u),c]})}function c(e){return!!e.isOnline&&("desktop"===e.onlinePlatform?"desktop":"mobile")}function u(e){var t=d(e).countUnread;if(0===t){var n=store.mail,i=f(e);i&&i.isUnread&&i.authorId===n.cur.viewerId&&(t=-1)}return t}function d(e){return store.mail.peers[e]}function _(e){var t=store.mail,n=t.rolls.peer[e],i=t.presend&&t.presend.pending[e],o=t.presend&&t.presend.failed[e];if(i&&i.length)for(var a=i.length-1;a>=0;a--){var r=i[a];if(-1===r.indexOf("edit"))return r}if(o&&o.length)for(var s=o.length-1;s>=0;s--){var l=o[s];if(-1===l.indexOf("edit"))return l}return n&&n.length?last(n):null}function f(e){var t=store.mail.msgs,n=store.mail.presend,i=n&&n.msgs,o=_(e);return i&&i[o]?i[o]:o?t[o]:null}function p(e){var t,n,i=(0,a.uTyping_getPeerTyping)(e),o=i&&1===i.count&&i.users[0]===e;return i?("mixed"===i.type?(t="simple-dots",n="mixed"):"audio"===i.type?(t="audio",n="audio"):"text"===i.type&&(t="simple-dots",n=""),{typing:!!o||(0,a.uTyping_getNames)(i),typingCount:i.count,animation:t,text:n,dimmed:!1,compact:!0}):""}t.default=function(e,t,n){void 0===t&&(t=null);void 0===n&&(n={isWithoutMessage:!1});var i="last"===t,a=store.mail,r=a.peers[e],d=(0,s.isContactPeer)(e),_=r.url,m=null;if(t){var h;i||(_=_+"&msg="+t),(h=i?f(e):a.msgs[t])&&(m={text:l(h,!r.isBusinessNotify),date:h.dateShort,unreadCount:u(e),muted:r.isMuted,typing:p(e),pending:h.pending,failed:h.failed})}return(0,o.default)({id:e,url:_,photos:r.avatarImages,title:r.title,online:c(r),important:r.isImportant,profileUrl:r.profileUrl,isLast:i,peerProfile:{tagsData:r.peerProfileTagsData||{},tags:a.peerProfileTags||[]},isMarkedUnread:r.isMarkedUnread,more:m,isCasper:r.isCasper,isDonutChat:r.isDonutChat,isContact:d,name:r.title,majorSortId:r.majorSortId,isWithoutMessage:n.isWithoutMessage})}},37829:function(e,t,n){"use strict";n(3226);var i=n(83228),o=n(61412),a=n(46705),r=n(71372);Object.assign(o.default,{onTap:i.default.onTap,redrawOnline:function(e){var t=store.mail.peers[e];if(t){var n=(0,o.uConvo_getOnline)(t);i.default.setOnline(e,n)}},redrawUnread:function(e){if(!store.mail.peers[e])return;var t=(0,o.uConvo_getUnreadCount)(e),n=(0,o.uConvo_getPeer)(e).isMarkedUnread;i.default.setUnreadCount(e,t,n)},redrawLastMsg:function(e){var t=store.mail.peers[e],n=(0,o.uConvo_getLastMsg)(e);n&&i.default.setLastMsg(e,(0,o.uConvo_msgPreview)(n,!t.isBusinessNotify),{dateShort:n.dateShort,pending:n.pending,failed:n.failed})},redrawTyping:function(e){if(!store.mail.cur)return;var t=(0,a.uTyping_getPeerTyping)(e),n=t&&1===t.count&&t.users[0]===e,r=(0,o.uConvo_getTyping)(e,n);i.default.setTyping(e,r)},redrawImportant:function(e,t){i.default.setImportant(e,t)},updateAdTag:function(e){var t=store.mail.peers[e];i.default.updateAdTag(e,t.peerProfileTagsData)},redrawPinned:function(e){var t=store.mail.peers[e];if(t){var n=(0,r.isPinnedSortId)(t.majorSortId);i.default.updatePinned(e,n)}}})},7812:function(e,t,n){"use strict";n.r(t);var i=n(43263);n(82723);t.default=i.default,window.uCurConvoTyping=i.default},43263:function(e,t,n){"use strict";n.d(t,{uCurConvoTyping_getParams:function(){return a}});var i=n(30097),o=n(46705);function a(){var e,t,n=store.mail.cur.peerId,i=(0,o.uTyping_getPeerTyping)(n);return i&&("mixed"===i.type?(e="dots",t="mixed"):"audio"===i.type?(e="audio",t="audio"):"text"===i.type&&(e="dots",t="")),{id:"curConvo",typing:(0,o.uTyping_getNames)(i),typingCount:i?i.count:0,dimmed:!0,animation:e,text:t}}t.default=function(){return(0,i.default)(a())}},82723:function(e,t,n){"use strict";var i=n(30097),o=n(43263);Object.assign(o.default,{redraw:function(){if(!store.mail.cur.peerId)return;var e=i.default.getElem("curConvo"),t=(0,o.uCurConvoTyping_getParams)();q.parseClass("typing",e.className).animation===t.animation?i.default.setTyping(e,t):e.outerHTML=(0,i.default)(t)}})},97244:function(e,t,n){"use strict";var i=n(47666);n(55250);t.default=i.default,window.uMailHat=i.default},47666:function(e,t,n){"use strict";n.r(t),n.d(t,{uMailHat_getPeerActions:function(){return I}});var i=n(55787),o=n(51106),a=n(46950),r=n(87207),s=n(99530),l=n(49075),c=n(42842),u=n(43866),d=n(30301),_=n(39604),f=n(2435),p=n(82437),m=n(12852),h=n(14145),v=n(45855),g=n(42097),A=n(64977),y=n(70906),w=n(2965),S=n(83078),b=n(17775),k=n(5198);function C(e){return"/club"+-store.mail.peers[e].ownerId}function E(){var e=store.mail.cur;return e.schoolData&&e.schoolData.school&&(0,a.isEduIntegration)()?T("openSchoolGrade",null,'onmousedown="uMessenger.openSchoolGrade()"',!1,e.schoolData):""}function I(e){var t=store.mail,n=t.peers[e].actionUrls,i=t.peers[e].isChannel,o=!!Math.abs(t.cur.groupId),r=t.rolls.peer[e],s=!r||!r.length,l=[];if(!n)return l;var c=T("markAsUnread",null,'onmousedown="uMessenger.onMarkDialogAsUnreadClick()"'),u=s||!n.canPinDialog||o?"":T("pinConvo",null,'onmousedown="uMessenger.onPinDialogClick()"'),d=s||!n.canPinDialog||o?"":T("unpinConvo",null,'onmousedown="uMessenger.onUnpinDialogClick()"');return l=e>-2e9&&e<0?[!s&&T("showMedias",n.showMedia),c,u,d,!s&&T("deleteHistory",n.flushHistory),T("blockCommunity",n.blockCommunity),T("unblockCommunity",n.unblockCommunity),T("blockNotify",n.blockNotify)]:(0,a.isChatPeer)(e)?[T("chatInfo",n.chatInfo,"",i),T("chatAdd",n.addToChat,"",i),i&&(0,a.isEduIntegration)()?T("goToSchoolPage",C(e)):"",!i&&E(),(0,a.isSAKIntegration)()?"":T("inviteLink",n.inviteLink,"",i),!s&&T("showMedias",n.showMedia),n.unpinMsg?T("chatUnpinMsg",n.unpinMsg):"",n.unpinMsg?T("chatShowPinnedMsg",null,'onmousedown="uMessenger.onShowPinnedMsgClick()"'):"",n.unpinMsg?T("chatHidePinnedMsg",null,'onmousedown="uMessenger.onHidePinnedMsgClick()"'):"",c,u,d,!s&&T("chatDeleteHistory",n.flushHistory),T("chatReturn",n.returnToChat,"",i),T("chatLeave",n.leaveChat,"",i)]:o?[!s&&T("showMedias",n.showMedia),(0,a.isSAKIntegration)()?"":T("markAsAnswered",n.communityMarkAsAnswered),c,n.isDialogImportant?T("removeImportantMark",n.communityToggleImportant):T("markAsImportant",n.communityToggleImportant),(0,a.isSAKIntegration)()?"":n.isBlacklisted?T("unbanUser",n.userBan):T("banUser",n.userBan),!s&&T("deleteHistory",n.flushHistory)]:[!s&&T("showMedias",n.showMedia),c,u,d,!s&&T("deleteHistory",n.flushHistory)]}function T(e,t,n,i,o){void 0===n&&(n=""),void 0===i&&(i=!1),void 0===o&&(o={});var C=window.lang;if(!t&&!n)return null;var E=(0,a.isEduIntegration)(),I=E?C.mobile_mail_edu_chat_info:C.mobile_mail_chat_info,T=i?C.mobile_mail_channel_info:I,M=E?C.mobile_mail_edu_chat_return:C.mobile_mail_chat_return,P=E?C.mobile_mail_edu_leave_chat:C.mobile_mail_chat_leave,L=E?C.mobile_mail_edu_clean_chat:C.mobile_mail_delete_chat_history,N=o.grade?C.mobile_mail_edu_show_grade.replace("{grade}",""+o.grade.number+o.grade.liter):C.mobile_mail_edu_show_school,R=o.grade?(0,S.getUsers3Outline28Icon)():(0,w.getSchoolOutline28Icon)(),x={showMedias:[C.mobile_mail_show_medias,(0,r.getPictureOutline28Icon)()],deleteHistory:[C.mobile_mail_delete_history,(0,s.getDeleteOutline28Icon)()],blockCommunity:[C.mobile_mail_block_community,(0,l.getRemoveCircleOutline28Icon)()],blockNotify:[C.mobile_mail_block_community_notify,(0,l.getRemoveCircleOutline28Icon)()],unblockCommunity:[C.mobile_mail_unblock_community,(0,c.getAddCircleOutline28Icon)()],chatAdd:[i?C.mobile_mail_add_to_channel:C.mobile_mail_add_to_chat,(0,c.getAddCircleOutline28Icon)()],chatUnpinMsg:[C.mobile_mail_unpin_msg,(0,u.getUnpinOutline28Icon)(),"unpin"],chatShowPinnedMsg:[C.mobile_mail_pin_show,(0,d.getPinOutline28Icon)(),"showPinned"],chatHidePinnedMsg:[C.mobile_mail_pin_hide,(0,_.getHideOutline28Icon)(),"hidePinned"],chatInfo:[T,(0,f.getInfoOutline28Icon)()],openSchoolGrade:[N,R],chatDeleteHistory:[L,E?(0,k.getClearDataOutline28Icon)():(0,s.getDeleteOutline28Icon)()],chatReturn:[i?C.mobile_mail_return_to_channel:M,(0,p.getChevronLeftOutline28Icon)(),"returnToChat"],chatLeave:[i?C.mobile_mail_channel_leave:P,E?(0,b.getDoorArrowRightOutline28Icon)():(0,m.getCancelCircleOutline28Icon)(),"leaveChat"],removeChat:[C.mobile_mail_edu_remove_chat,(0,s.getDeleteOutline28Icon)()],markAsAnswered:[C.mobile_mail_mark_as_answered,(0,h.getDoubleMarkOutline28Icon)()],removeImportantMark:[C.mobile_mail_remove_important_mark,(0,v.getUnfavoriteOutline28Icon)()],markAsImportant:[C.mobile_mail_mark_as_important,(0,g.getFavoriteOutline28Icon)()],markAsUnread:[C.mobile_mail_mark_as_unread,(0,A.getMarkUnreadOutline28Icon)()],unbanUser:[C.mobile_settings_blacklist_unban_user,(0,c.getAddCircleOutline28Icon)()],banUser:[C.mobile_settings_blacklist_ban_user,(0,l.getRemoveCircleOutline28Icon)()],inviteLink:[i?C.mobile_mail_channel_invite_link:C.mobile_mail_invite_link,(0,y.getLinkOutline28Icon)()],pinConvo:[C.mobile_mail_pin_conversation,(0,d.getPinOutline28Icon)(),"pinConvo"],unpinConvo:[C.mobile_mail_unpin_conversation,(0,u.getUnpinOutline28Icon)(),"unpinConvo"],goToSchoolPage:[C.mobile_mail_edu_go_to_school_page,(0,w.getSchoolOutline28Icon)()]},B={text:x[e][0],icon:SVGIcon(x[e][1]),attrs:n,url:t};return x[e][2]&&(B.name=x[e][2]),B}t.default=function(){var e=store.mail.cur.peerId,t=store.mail.cur.page;if(e)return function(e){var t=store.mail,n=t.peers[e],i=(0,a.isChatPeer)(e),r=(0,a.isContactPeer)(e),s={id:e,title:n.title,photos:n.avatarImages,actions:I(e),editing:t.cur.editing,peerProfile:{isEnabled:t.flags.isPeerProfileEnabled,tagsData:n.peerProfileTagsData||{},tags:t.peerProfileTags||[]},canCall:!!n.canCall,isBusinessNotify:!!n.isBusinessNotify};if(i){var l=i?e-2e9:null;if(s.url="/mail?act=info&chat="+l,s.membersCount=n.countMembers,s.hasPinnedMsg=n.hasPinnedMsg,s.isChannel=n.isChannel,s.isCasper=n.isCasper,s.isDonutChat=n.isDonutChat,s.isChannel||n.isCommunityChat)s.url=C(e);else if(n.viewerId<0){var c=-n.viewerId;s.url="/mail?act=info&chat="+l+"&community="+c}}else s.url=n.profileUrl,s.isOnline=n.isOnline,s.onlinePlatform=n.onlinePlatform,s.offlineText=n.offlineText,s.isContact=r;return(0,o.MailHat_convo)(s)}(e);if(t)return function(e){return(0,o.MailHat_page)(e)}(t);return function(){var e=store.mail.cur,t=Math.abs(e.groupId),n=!!t,r=n?"&community="+t:"",s=n?"?community="+t:"",l=!(0,a.isSAKIntegration)()&&n;return(0,o.MailHat_main)({folder:e.folder,urls:{all:"/mail"+s,unrespond:"/mail?act=unrespond"+r,unread:"/mail?act=unread"+r,important:"/mail?act=important"+r,adTag:"/mail?act=ad_tag"+r,createChatUrl:"/mail?act=new_chat",businessNotify:"/mail?act=business_notify"},importantCount:e.countImportant,businessNotifyCount:e.countBusinessNotify,withUnrespond:n,withAdTag:l,withBusinessNotify:e.isBusinessNotifyEnabled,forwarding:!!e.forwardFromId,notifier:(0,i.default)()})}()}},55250:function(e,t,n){"use strict";var i,o=n(3226),a=n(51106),r=n(47666),s=n(70765),l=n(20083),c=n(46172);function u(){store.mail&&store.mail.cur&&(store.mail.cur.peerId&&d())}function d(){var e=store.mail.cur;(e?e.peerId:null)?i=setTimeout((function(){p(),d()}),3e4):_()}function _(){i&&clearTimeout(i)}function f(){$$(".mailHat").forEach((function(e){return e.outerHTML=(0,r.default)()}))}function p(){var e=window.lang,t=store.mail,n=t.cur,i=t.peers,o=n?n.peerId:null;if(o){var a=i[o];if(a.lastActionTime&&!a.isOnline){var r=n.timeShift,l=function(e,t){var n=window.lang,i="";e+=t;var o=parseInt(Date.now()/1e3)-e;if(o>7776e3)return"";if(o<60)i=n.mobile_profile_status_just_now;else if(o<3600){var a=intval(o/60);i=langWordNumeric(a,n.mobile_profile_status_word_mins_ago,n.mobile_profile_status_mins_ago)}else if(o<14400){var r=intval(o/3600);i=langWordNumeric(r,n.mobile_profile_status_word_hours_ago,n.mobile_profile_status_hours_ago)}else i=function(e){var t=1e3*e,n=new Date(t),i=new Date,o=window.lang;return n.getFullYear()!=i.getFullYear()&&n.getTime()<i.getTime()-1728e5||Math.abs(n.getTime()-i.getTime())>157248e5?langDate(t,o.mobile_mail_date,0,o.months_sm_of,!1):langDate(t,o.mobile_mail_short_date_time,0,o.months_sm_of,!1)}(e);return i}(a.lastActionTime,r);a.offlineText=l?langSex(a.sex,e.mobile_mail_last_activity_tip).replace("{time}",l):""}else a.canSeeOnline||(a.offlineText=(0,s.getLastSeenByStatus)(a.onlineStatus,a.sex));f()}}Object.assign(r.default,{onUnreadClick:(0,o.default)(),onBackClick:(0,o.default)(),onBackToDialogClick:(0,o.default)(),onCancelEditing:(0,o.default)(),setModifiers:a.MailHat_convo.setModifiers,redrawCounter:function(){var e=(0,c.getUnreadCount)();if(!nav.getQuery("community")){var t=geBySel1(".mmi_mail .mm_counter2");t&&(e>0?(t.innerText=e,attr(t,"style","display: inline")):hide(t))}navigator.setAppBadge&&navigator.setAppBadge(Math.max(0,Math.min(9999,e||0)));Tabbar.setCounter(Tabbar.TAB_ID_MESSAGES,e)},redrawOnline:p,redrawActions:function(){var e=store.mail.cur.peerId,t=(0,l.MailHat__actions)((0,r.uMailHat_getPeerActions)(e));$$(".mailHat__actions").forEach((function(e){return e.outerHTML=t}))},redraw:f,startStatusUpdate:d,cancelStatusUpdate:_,setBusinessNotifyCount:function(e){a.MailHat_main.setBusinessNotifyCount(e)}}),a.MailHat_main.onUnreadClick(r.default.onUnreadClick),a.MailHat_main.onBurgerClick(menu.open),a.MailHat_main.onCancelForwardTap(r.default.onBackToDialogClick),a.MailHat_convo.onBackTap(r.default.onBackClick),a.MailHat_convo.onCancelEditingTap(r.default.onCancelEditing),uVK.onReady(u)},69618:function(e,t,n){"use strict";n.r(t);var i=n(49701);n(75027);t.default=i.default,window.uMailWrite=i.default},49701:function(e,t,n){"use strict";n.d(t,{uMailWrite_Reply:function(){return P},uMailWrite_Attachments:function(){return L},uMailWrite_ToBottomInner:function(){return T}});var i=n(13725),o=n(62561),a=n(11393),r=n(72592),s=n(39423),l=n(60767),c=n(54440),u=n(49751),d=n(86205),_=n(41070),f=n(46950),p=n(35909),m=n(45818);function h(){var e=(0,i.default)(['\n    <input type="hidden" name="attached_messages" value="','" />\n  ']);return h=function(){return e},e}function v(){var e=(0,i.default)(['\n    <div class="uMailWrite__attachedMsgs">\n      ',"\n      ","\n      ",'\n      <div class="uMailWrite__attachedMsgsText">',"</div>\n    </div>\n  "]);return v=function(){return e},e}function g(){var e=(0,i.default)(['\n    <div class="',' _preventMenuOpen">\n      ',"\n      ","\n    </div>\n  "]);return g=function(){return e},e}function A(){var e=(0,i.default)(['\n    <div class="','">\n      ',"\n      ","\n      ","\n    </div>\n  "]);return A=function(){return e},e}function y(){var e=(0,i.default)(['\n    <div class="uMailWrite__templates">\n      <div class="uMailWrite__templatesHeader">\n        ','\n        <a class="uMailWrite__templatesAdd" href="','" ',">\n          ",'\n        </a>\n      </div>\n      <div class="uMailWrite__templatesBody ScrollView"></div>\n    </div>\n  ']);return y=function(){return e},e}function w(){var e=(0,i.default)(['\n    <div class="uMailWrite__buttonKeyboardIcon"></div>\n  ']);return w=function(){return e},e}function S(){var e=(0,i.default)(['\n    <div class="uMailWrite__keyboard ScrollView">\n\n    </div>\n  ']);return S=function(){return e},e}function b(){var e=(0,i.default)(['\n    <div class="uMailWrite__SVGIcon uMailWrite__SVGIcon_','"></div>\n  ']);return b=function(){return e},e}function k(){var e=(0,i.default)(['\n    <div class="uMailWrite__main">\n      <div class="uMailWrite__button uMailWrite__buttonAttach">','</div>\n      <div class="uMailWrite__button uMailWrite__buttonKeyboard" ',">",'</div>\n      <div class="uMailWrite__button uMailWrite__buttonStickers" ',">","",'</div>\n      <button class="','" type="submit" ',">\n        ","\n        ","\n        ","\n        ","\n        ","\n        ","\n        ","\n        ",'\n      </button>\n      <div class="uMailWrite__textareaContainer">\n        <textarea\n          class="uMailWrite__textarea"\n          name="message"\n          placeholder="','"\n          maxlength="4096"\n          ',"\n          ","\n          ","\n          ","\n          ","\n          ","\n          ",'\n        ></textarea>\n        <div class="uMailWrite__textareaGhost"></div>\n      </div>\n    </div>\n  ']);return k=function(){return e},e}function C(){var e=(0,i.default)(["\n    ","\n    ","\n  "]);return C=function(){return e},e}function E(){var e=(0,i.default)(['\n    <form\n      class="','"\n      method="POST"\n      action="/mail?act=send&to=',"&hash=","&from=dialog",'"\n      ','\n    >\n      <div class="uMailWrite__toBottom" ',">","</div>\n      ","\n      ","\n      ","\n      ","\n      ","\n      ","\n      ","\n    </form>\n  "]);return E=function(){return e},e}function I(){var e=(0,i.default)(['\n      <div class="uMailWrite uMailWrite_unableToWrite">\n        ','\n        <div class="uMailWrite__unableToWriteText">\n          ',"\n        </div>\n        ","\n      </div>\n    "]);return I=function(){return e},e}function T(){var e=store.mail,t=e.cur,n=e.peers,i=n[t.peerId]?n[t.peerId].countUnread:null,r=i?(0,l.default)({mix:"uMailWrite__toBottomValue",value:i}):"",c=a.default.html((0,s.default)({mix:"uMailWrite__toBottomIcon",icon:"arrowDown"}));return o.default.html(C(),r,c)}function M(e){return o.default.html(b(),e)}function P(e){var t=store.mail.cur,n=store.mail.members,i=t.peerId,a=t.msgReply[i],r=null;a&&(r=store.mail.forwards[a]||store.mail.msgs[a]);var s="",l="";if(r){var c=(0,_.Msg__authorName)(n[r.authorId],i,t.userId);s=(0,_.Msg__reply)(r,c,e),l='\n      <input type="hidden" name="attached_messages" value="'+a+'" />\n      <input type="hidden" name="has_reply" value="true" />\n    ',t.editing&&(l+='\n        <input type="hidden" name="mail_edit_attach_fwd" value="1" />\n      ')}var u=o.default.class("uMailWrite__reply",{visible:!!s}),d=MailButton({class:"uMailWrite__replyClose",onClick:o.default.onClick("uMailWrite.onReplyClose")});return o.default.html(A(),u,s,d,l)}function L(e){var t,n=store.mail,i=n.cur,r=n.peers[e].attachmentsHTML,l=o.default.class("uMailWrite__attachments",((t={})[e]=!0,t)),c=i.msgAttached[e]||[],u=c.length,d="";u>0&&(d=function(e,t){var n=window.lang,i=o.default.onClick("uMailWrite.onAttachedMsgsRemove"),r=a.default.html((0,s.default)({mix:"uMailWrite__attachedMsgsIcon",icon:"msgMini"})),l=a.default.html((0,s.default)({mix:"uMailWrite__attachedMsgsRemove",icon:"close9",attrs:i})),c=langNumeric(e,n.mobile_mail_messages),u=function(e){return o.default.html(h(),e)}(t);return o.default.html(v(),u,l,r,c)}(u,c.join(";")));return o.default.html(g(),l,d,r)}t.default=function(){var e=window.lang,t=store.mail,n=t.cur.peerId;if(!n)return'<form class="uMailWrite"></form>';var i=t.peers[n];if(i.unableToWrite){if(i.isChannel||i.isBusinessNotify)return"";var l=i.isUserNotDon,_=i.kickedMessage||e.mobile_msg_mail_privacy_error;l&&(_=e.mobile_msg_mail_not_don_error);var h=l?null:a.default.html((0,s.default)({mix:"uMailWrite__unableToWriteIcon",icon:"warning"})),v=l?a.default.html((0,u.default)({inner:[e.mobile_mail_donate],url:i.subscriptionUrl})):null;return o.default.html(I(),h,_,v)}var g=o.default.onSubmit("window.uMailWrite && uMailWrite._onSubmit","event","this"),A=o.default.onClick("window.uMailWrite && uMailWrite.onToBottomClick"),b=(H="",(0,r.default)({mix:"uMailWrite__popupStickers _preventMenuOpen",inner:H})),C=P(null),N=L(n),R=function(e){var t=window.lang,n=store.mail,i=n.cur,r=n.queue,l=o.default.onMouseDown("window.uMailWrite && uMailWrite._onStickersClick","event"),u=o.default.onMouseDown("window.uMailWrite && uMailWrite._onKeyboardClick","event"),_=n.peers[e],h=i.groupId,v=Math.abs(h),g=h?"&community="+v:"",A=!(0,f.isSAKIntegration)(),y=!(0,f.isSAKIntegration)()&&_.canSendGift,S=!(0,f.isSAKIntegration)()&&_.canSendGift,b=!(0,f.isSAKIntegration)(),C=(0,f.isSAKIntegration)(),E=(0,f.isSAKIntegration)(),I=!(0,f.isSAKIntegration)(),T=(0,c.default)({icon_html:a.default.html((0,p.Icon28AddCircleOutline)()),name:"uMailWrite_attachments",position:"bottomLeft",items:[{text:i.inlineUploadHTML.replace(/mail\d+/g,"mail"+e),icon:(0,p.Icon28PictureOutline)(),attrs:o.default.onClick("mediaUpload.onUnfoldItemClick","event","this")},I?{text:t.mobile_attachments_add_photo_vk,url:"/attachments?act=choose_photo&target=mail"+e+g,icon:(0,p.Icon28CameraOutline)()}:null,C?{text:t.mobile_attachments_add_device_video,icon:(0,p.Icon28VideoOutline)(),attrs:o.default.onClick("SAKIntegration.sendMessage","attach_video",{peerId:e})}:null,b?{text:t.mobile_attachments_add_video,url:"/attachments?act=choose_video&target=mail"+e+g,icon:(0,p.Icon28VideoOutline)()}:null,A?{text:t.mobile_attachments_add_audio,url:"/attachments?act=choose_audio&target=mail"+e+g,icon:(0,p.Icon28MusicOutline)()}:null,{text:t.mobile_attachments_add_doc,url:"/attachments?act=choose_doc&target=mail"+e+g,icon:(0,p.Icon28DocumentOutline)()},E?{text:t.mobile_attachments_add_device_document,icon:(0,p.Icon28DocumentOutline)(),attrs:o.default.onClick("SAKIntegration.sendMessage","attach_document",{peerId:e})}:null,y?{text:t.mobile_attachments_add_gift,url:"/gifts"+e+"?act=send&from=mail&ref=media_selector",icon:(0,p.Icon28GiftOutline)()}:null,S?{text:t.mobile_attachments_add_money,url:"/attachments?act=attach_money&target=mail"+e+g,icon:(0,p.Icon28MoneyTransferOutline)()}:null,_.canAttachPoll?{text:t.mobile_attachments_add_poll,url:"/attachments?act=attach_poll&target=mail"+e+g,icon:(0,d.default)((0,m.getPollOutline28Icon)()),mix:"uMailWrite__pollUnfoldItem"}:null]}),P=o.default.onKeyUp("window.uMailWrite && uMailWrite._onKeyUp"),L=o.default.onInput("window.uMailWrite && uMailWrite._onInput","event","this"),N=o.default.onKeyDown("window.uMailWrite && uMailWrite._onKeyDown","event","this"),R=o.default.onFocus("window.uMailWrite && uMailWrite._onFocus","event","this"),x=o.default.onBlur("window.uMailWrite && uMailWrite._onBlur","event","this"),B=o.default.onClick("window.uMailWrite && uMailWrite._onClick","event","this"),D=o.default.onTouchEnd("window.uMailWrite && uMailWrite._onSendTouchEnd","event","this"),O=a.default.html({class:"uMailWrite__buttonSendIcon Icon_send",inner:(0,p.Icon28Send)()}),U=a.default.html({class:"uMailWrite__buttonSendIcon Icon_send Icon_active",inner:(0,p.Icon28Send)()}),H=a.default.html({class:"uMailWrite__buttonVoiceIcon",inner:(0,p.Icon28VoiceOutline)()}),F=M("accept"),V=M("remove"),j=M("templates"),$=M("templatesActive"),q=a.default.html((0,s.default)({mix:"uMailWrite__buttonSendIcon",icon:"spinner"})),W=a.default.html({class:"uMailWrite__buttonStickersIcon Icon_sticker",inner:(0,p.Icon28SmileOutline)()}),G=a.default.html({class:"uMailWrite__buttonStickersIcon Icon_sticker Icon_active",inner:(0,p.Icon28SmileOutline)()}),Y=o.default.html(w()),K=_.attachmentsHTML.length,Q=i.msgAttached[i.peerId],z=Q&&Q.length,X=!!(r[i.peerId]||[]).length,J=o.default.class("uMailWrite__button","uMailWrite__buttonSend",{send:!0,sendActive:!!(K>150||z),loading:X});return o.default.html(k(),T,u,Y,l,W,G,J,D,O,U,H,q,F,V,j,$,t.mobile_mail_message_placeholder,R,P,L,N,R,x,B)}(n),x=o.default.html(S()),B=function(){var e=window.lang,t=a.default.html((0,s.default)({icon:"plus"})),n=store.mail.cur.peerId,i=store.mail.cur.communityParam,r="/mail?act=template&from="+n+i,l=o.default.onClick("uMailWrite.loadTemplatePage","event","this",r);return o.default.html(y(),e.mobile_mail_templates_panel_title,r,l,t)}(),D=i.isChannel&&(0,f.isEduIntegration)()?function(e){var t=window.lang,n=store.mail,i=n.cur,o=n.peers,r=n.members,s=o[e],l=(i.groupId?r[s.ownerId]:r[i.userId]).name;return a.default.html({inner:[a.default.wrap(t.mobile_mail_from.replace("{name}",'<a onclick="uMailWrite.onSwitcherClick(event, '+e+')">'+l+"</a>"))],class:"uMailWrite__switcher",tag:"div"})}(n):"",O=T(),U=o.default.class("uMailWrite",{canAttachMoney:!!i.canAttachMoney,canAttachPoll:!0});var H;return o.default.html(E(),U,n,i.hashSend,t.cur.communityParam,g,A,O,C,N,D,R,b,x,B)}},75027:function(e,t,n){"use strict";var i=n(46769),o=n(1730),a=n(3226),r=n(62561),s=n(11393),l=n(62691),c=n(30112),u=n(54440),d=n(92424),_=n(56353),f=n(41070),p=n(69756),m=n(61124),h=n(49751),v=n(29442),g=n(2955),A=n(28638),y=n(28708),w=n(56399),S=n(42516),b=n(43369),k=n(80610),C=n(35909),E=n(71372),I=n(80444),T=n(19270),M=n(49701),P=n(84359),L=n(79030),N=n(40997),R=n(24945),x=n(74521),B=n(86353),D=n(68627),O=n(9046),U=n(54412),H=n(94713),F=n(18613),V=n(82127),j=n(95343),$=n(62372),q=n(37425),W=n(73390),G=n(23691),Y=n(45029),K=n(20329);Object.assign(M.default,{onToBottomClick:(0,a.default)(),onAttachedMsgsRemove:(0,a.default)(),onReplyClose:(0,a.default)(),onMessage:(0,a.default)(),replyAsChange:(0,a.default)(),showToBottom:function(){if(ae)return;re&&(clearTimeout(re),re=null);addClass("uMailWrite__toBottom_visible",(0,o.$)(".uMailWrite__toBottom"))},hideToBottom:function(){clearTimeout(null),re=setTimeout((function(){removeClass("uMailWrite__toBottom_visible",(0,o.$)(".uMailWrite__toBottom"))}),100)},preventShowToBottom:function(){ae=!0,setTimeout((function(){ae=!1}),300)},openStickersPanel:be,redrawReply:Oe,uiRedrawAttachments:Ue,redrawToBottom:function(){(0,o.$$)(".uMailWrite__toBottom").forEach((function(e){return e.innerHTML=(0,M.uMailWrite_ToBottomInner)()}))},drawStickers:ye,setModifiers:function(e){(0,o.$$)(".uMailWrite").forEach((function(t){var n=r.default.parseClass("uMailWrite",t.getAttribute("class"));t.setAttribute("class",r.default.class("uMailWrite",Object.assign({},n,e)))}))},hideStickersPanel:Se,setText:ct,renderKeyboardIfNeeded:dt,openKeyboard:ft,init:function(){var e=store.mail,t=e.cur,n=e.msgs,i=e.pendingReplies,a=e.flags,r=t&&(0,k.getPeerDraft)(t.viewerId,t.peerId);"templates"===(0,k.getKeyboardType)()?Pe():dt();r&&!t.editing&&(r.text&&function(e){var t=document.createElement("textarea");t.innerHTML=e;var n=t.value;(0,o.$$)(".uMailWrite__textarea").forEach((function(e){return e.value=n}));var i=(0,o.$)(".uMailWrite__textareaGhost");i.innerText=n,"\n"===last(n)&&(i.innerHTML+="&nbsp;");fe()}(r.text),r.audioMessagePreviewData&&de().then((function(){store.mail.cur.peerId===t.peerId&&window.Speech.getRecordingBuffer(r.audioMessagePreviewData.bufferKey).then((function(e){if(e){var n=(0,v.random)();qe[n]={peerId:t.peerId},je(),X.previewBuffer=e,X.setAudioMessagePreviewData(r.audioMessagePreviewData),X.init(null,"preview",n)}})).catch((function(){}))})).catch((function(e){})));yt(),me(),r&&!t.editing&&Array.isArray(r.msgs)&&(t.msgAttached[t.peerId]=r.msgs);if(r&&!t.editing&&isFinite(r.reply)){var s=f.default.getReplyDataFromHTML(r.reply);s&&(t.msgReply[t.peerId]=r.reply,i[r.reply]=s)}Oe(),Ue(t.peerId),Object.keys(n).forEach((function(e){CasperTimer.init(e)})),(0,o.$$)(".uMailWrite__textarea").forEach((function(e){(0,S.setScrollView)(e,{topBanner:!1,overscrollY:!1})})),(0,o.$$)(".uMailWrite__attachments").forEach((function(e){(0,S.setScrollView)(e,{topBanner:!1,allowY:!1})})),a.areAudioMessagesEnabled&&F.default.getFlag(F.FLAG_SUPPORTS_AUDIO_MESSAGES)&&de().then((function(){ot();var e=(0,o.$)(".uMailWrite__buttonSend");(0,H.onLongpressOrClick)(e,150,Ge,Ye,{canStart:function(){return!!ot().canVoiceRecord},shouldPreventDefault:!0,ignoreMoveEvent:!0,ignoreMouseLongpress:!0})})).catch((function(){}));It()},reset:function(){(0,k.setKeyboardType)("")},loadTemplatePage:function(e,t,n){e.preventDefault(),uMessenger.loadMailPage(n)},onSwitcherClick:function(e,t){!function(e,t){e.preventDefault();var n=(0,p.default)({class:(0,Y.classNames)("uMailWrite__replyAsModalMenu",{"uMailWrite__replyAsModalMenu--mobile":store.mail.cur.isMobileView}),title:lang.mobile_mail_message_author,close:store.mail.cur.isMobileView,items:[{id:"mail_write_reply_as_users_list",inner:mt(t)}]}),i=(0,O.ceFromString)(s.default.html(n));p.default.open(i,!0)}(e,t)},onUserListItemClick:function(e,t,n){e.preventDefault(),p.default.close(t);var i=(0,o.$)(".uMailWrite__textarea");M.default.replyAsChange(n,i.value)},updateNewConvoStickersHint:It}),uVK.onReady(pe),M.default._onBlur=nt,M.default._onKeyUp=Qe,M.default._onKeyDown=Ze,M.default._onFocus=tt,M.default._onInput=ze,M.default._onSubmit=He,M.default._onClick=et,M.default._onAttachClick=Ne,M.default._onStickersClick=we,M.default._onKeyboardClick=ke,M.default._onKeyboardButtonClick=Ce,M.default._onDeleteTemplate=ht,M.default._onConfirmDeleteTemplate=vt,M.default._onSendTouchEnd=Ke,M.default._onRetryFailedMsg=St,M.default._onDeleteFailedMsg=bt,M.default._onCancelPendingMsg=kt,M.default._onConfirmSendGeo=Ee,M.default._cancelVoiceRecord=$e,M.default._resendAudioMessage=function(){},mediaUpload.onRemove(he),mediaUpload.onComplete(Ae),mediaUpload.onStart(ve),mediaUpload.onError(ge),post.onStickersTabSelected(Re),post.onStickerClick(xe),x.default.onStickerPanelUpdate(Be),N.onSent(At),N.onErrorMessage(Ct),f.default.onPendingClick(wt),u.default.onOpen("uMailWrite_attachments")(_e),M.default.onToBottomClick((function(){var e=(0,o.$)(".uMailWrite__toBottom_visible");e&&e.classList.remove("uMailWrite__toBottom_visible"),c.default.removeDivider()})),M.default.onReplyClose((function(){var e=store.mail.cur;e.msgReply[e.peerId]=null,(0,k.setPeerDraft)(e.viewerId,e.peerId,{reply:void 0},e.editing),e.editing||ajaxRequest("/mail",{act:"reply_cancel",peer_id:store.mail.cur.peerId,hash:store.mail.hash.reply}),Oe()})),M.default.onTemplateClick=function(e,t,n){var i;n&&(store.mail.cur.templates.some((function(e){if(e.id===n)return i=e,!0})),i&&ct((0,L.prepareTemplateText)(i.text)))},Mention.onOpen((function(){if(store.mail.cur){var e=store.mail.cur,t=e.peerMembers,n=e.peerId;t[n]||(t[n]=!0,ajaxRequest("/mail",{act:"get_members",peer_id:n},(function(e){Object.assign(store.mail.members,e);var t=Xe(n);Mention.update({items:t,defaultItems:t})}),(function(){t[n]=!1})))}}));var Q,z,X,J="uMailWrite__popupAttach_open",Z="uMailWrite__popupStickers_open",ee="uMailWrite__keyboard_open",te="uMailWrite__templates_open",ne="uMailWrite_canAttachPoll",ie=".uMailWrite",oe=".attachment_type_poll",ae=!1,re=null,se=[],le=!1,ce=(0,b.throttle)(ot,100),ue=(0,b.throttle)(it,1e3);function de(){return n.e(5992).then(n.bind(n,73127)).catch((function(e){return(0,O.statlogsValueEvent)("mvk_audio_messages_event",null,"chunk_error",e.name)}))}function _e(){function e(e,t){return e=e.replace(/&edit_msg_id=\d+/,"").replace(/=mailedit(-?\d+)/,"=mail$1"),store.mail.cur.editing&&(e=e.replace(/=mail(-?\d+)/,"=mailedit$1"),e+=t?"&edit_msg_id="+store.mail.cur.editing:""),e}(0,o.$$)("a.Unfold__item").forEach((function(t){var n=e(t.getAttribute("href"),!0);t.setAttribute("href",n)})),(0,o.$$)("input.inline_upload").forEach((function(t){t.setAttribute("data-upload-url",e(t.getAttribute("data-upload-url")))}))}function fe(){var e=(0,o.$)(".uMailWrite__textareaGhost").offsetHeight;(0,o.$$)(".uMailWrite__textarea").forEach((function(t){return setStyle(t,"height",e)})),(0,o.$$)(".uMailWrite__main").forEach((function(t){return setStyle(t,"height",e+8)})),(0,o.$$)(".uMailWrite__popupStickers .stickersHints").forEach((function(t){setStyle(t,"bottom",e+8+-5)})),ot()}function pe(){if("/mail"===location.pathname||0===location.pathname.indexOf("/write")){var e=store.mail.cur;if(e&&e.peerId){var t=geBySel(".uMailWrite__attachments .medias_thumb").length,n=geBySel(".uMailWrite__attachments .medias_row").length,i=(e.msgAttached[e.peerId]||[]).length?1:0;e.hasAttachments=t+n+i>0,(0,o.$$)(".uMailWrite__attachments").forEach((function(t){toggleClass("uMailWrite__attachments_hasAttachments",t,e.hasAttachments)})),function(){var e=(0,o.$)(".uMailWrite__buttonAttach");if(!e)return;var t=(n=(0,o.$)(".uMailWrite__attachments"),(n?n.$$(".thumb_item").length+n.$$(".medias_row").length-n.$$(".fwd_item").length:0)>=10);var n;e.classList.add("uMailWrite__button_disabled",t),t?e.addEventListener("mousedown",lt,!0):e.removeEventListener("mousedown",lt,!0)}()}}}function me(){var e=store.mail.cur;if(e&&e.peerId){if(!(0,R.isChatPeer)(e.peerId))return;se=Xe(e.peerId),Mention.init({defaultItems:se,items:se,appendTo:(0,O.geByClass1)("uMailWrite__main"),url:null,params:{},preferDomain:!0,afterInsert:function(t){var n=(0,o.$)(".uMailWrite__textareaGhost"),i=t.value;n.innerText=i,fe(),it(i,e.viewerId,e.peerId)}})}}function he(e){if(store.mail.cur){var t=store.mail,n=t.cur,i=t.peers,a=n.peerId;if(a&&(i[a].attachmentsHTML=geBySel1(".uMailWrite__attachments_"+a+" .cp_attached_wrap").outerHTML,Ue(a)),e.closest(oe))(0,o.$)(ie).classList.add(ne)}}function ve(){store.mail.cur&&(pe(),ot())}function ge(){if(store.mail.cur){var e=store.mail,t=e.cur,n=(e.peers,t.peerId);n&&(Ue(n),Messenger.scrollConvoToBottom())}}function Ae(){var e=store.mail,t=e.cur,n=e.peers;if(t){var i=t.peerId;i&&(n[i].attachmentsHTML=geBySel1(".uMailWrite__attachments_"+i+" .cp_attached_wrap").outerHTML,ot())}}function ye(){var e=store.mail.cur,t=(0,o.$)(".uMailWrite__popupStickers");e&&t&&!t.childElementCount&&(x.default.checkStickers(),t.innerHTML=x.default.getStickerPanel("mail"+e.peerId),t.innerHTML||(e.waitingStickerPanel=!0),(0,o.$$)(".sp_body",t).forEach((function(e){(0,S.setScrollView)(e,{topBanner:!1})})),(0,o.$$)(".scroller_wrap",t).forEach((function(e){(0,S.setScrollView)(e,{topBanner:!1,allowY:!1})})),post.stickersSelectTab(null,-1))}function we(e){var t=(0,o.$)(".uMailWrite__popupStickers"),n=hasClass(Z,t);e.preventDefault(),ye(),pt("stickers"),n?Se():be()}function Se(){"stickers"===(0,k.getKeyboardType)()&&(0,k.setKeyboardType)("");var e=(0,o.$)(".uMailWrite__popupStickers");removeClass(Z,e),at(!1);var t=(0,O.ge)("stickers_panel");t&&"block"===t.style.display&&(t.style.display="none"),domData(e,"need-update")&&(clog("[mail sticker panel] inject new sticker panel after close"),De(),domData(e,"need-update",null))}function be(){(0,k.setKeyboardType)("stickers");var e=(0,o.$)(".uMailWrite__popupStickers");addClass(Z,e),post.stickerPanelInit(),post.stickersInit(),at(!0);var t=store.mail.cur;e.classList.toggle("uMailWrite__popupStickers--canGift",t&&t.peerId&&(0,E.isUserPeer)(t.peerId)&&t.viewerId&&(0,E.isUserPeer)(t.viewerId))}function ke(e){var t=(0,o.$)(".uMailWrite__keyboard"),n=hasClass(ee,t);e.preventDefault(),pt("buttons"),n?Ie({store:!0}):Te({store:!0})}function Ce(e,t,n){var i=n.authorId,o=n.inline,a=n.msgId,s=n.subID,l=JSON.parse(n.action),c=l.type,u=l.payload,_=l.rawLabel,f=store.mail,p=f.cur,m=f.members,A=f.peers,y=f.msgs;if(store.mail.cur){t.stopPropagation();var w,S,b=m[i],C=(0,v.random)();if(a){var M=y[a];w=M.peerId,S=M.conversationMsgId}else w=p.peerId;var P,L=A[w],N=_||"";if(w>=2e9)if(b.domain)P="@"+b.domain+" "+N;else{var R=b.url.replace(/^\//,"");P="@"+R+" ("+b.firstName+") "+N}else P=N;var x=c,B=o?"inline":"normal";if("open_app"===x&&(x="app"),(0,O.statlogsValueEvent)("message_send_from_keyboard",0,p.viewerId,w,i,x,B),"vkpay"!==c)if("open_app"!==c)if("open_link"!==c)if("location"!==c){if("callback"===c)return h.default.setLoading(e,!0,"spinner"),void ajaxRequest("/mail",{act:"sendEvent",peer_id:w,author_id:i,message_id:a,conversation_message_id:S,payload:u,hash:L.hashSend},(function(t){var n=t.result.event_id;clog("waiting for "+n+" event callback"),(0,k.registerCallbackButtonEvent)(w,e,n,a,s)}),(function(){d.init({type:d.SNACKBAR_TYPE_ERROR,text:lang.mobile_unknown_error}),h.default.setLoading(e,!1)}));st({act:"send",to:w,from:"dialog",hash:L.hashSend,message:P,media:"",_af:p._af,random_id:C,payload:u}),o&&!p.peerId&&nav.go((0,I.makeUrl)("/mail",{act:"show",peer:w,community:nav.getQuery("community")}))}else{T.default.init()?(h.default.setLoading(e,!0,"blue"),T.default.getCurrentPosition((function(t){var n=t.coords,i=n.latitude,o=n.longitude;h.default.setLoading(e,!1),MailDialog.open({body:lang.mobile_mail_geo_send_question,confirmText:lang.mobile_mail_geo_send_confirm,cancelText:lang.mobile_cancel,onConfirm:r.default.onClick("uMailWrite._onConfirmSendGeo",i,o,u,P,w)})}),(function(){h.default.setLoading(e,!1),d.init({text:lang.mobile_mail_geo_not_available})}),{maximumAge:100,enableHighAccuracy:!0,timeout:1e4})):d.init({text:lang.mobile_mail_geo_not_available})}else{var D=l.link;w===j.VK_OFFICIAL_PEER_ID&&(0,E.isOnboardingFindFriendsLink)(D)&&$.customMetricsCollector.logEvent({experiment_id:1285,service:"messages",metric_name:"push_find_friends_button",metric_value:4,unit_id:p.viewerId,unit_type_id:1});var U=(0,g.wrapAwayIfExternal)(D,!0);nav.hard_go(U)}else{var H=l.app_id,F=l.hash,V=(0,I.makeUrl)("/app"+H,{from:nav.cur.slice(1)});nav.go(V+"#"+F)}else{var q=l.hash,W=(0,I.makeUrl)("/app6217559",{from:nav.cur.slice(1)});nav.go(W+"#"+q)}}}function Ee(e,t,n,i,o){var a=store.mail,r=a.cur,s=a.peers[o],l=(0,v.random)();st({act:"send",to:o,from:"dialog",hash:s.hashSend,message:i,media:"",_af:r._af,random_id:l,payload:n,attach1_type:"map",attach1:e+"_"+t}),MailDialog.close(),nav.go((0,I.makeUrl)("/mail",{act:"show",peer:o,community:nav.getQuery("community")}))}function Ie(e){"buttons"===(0,k.getKeyboardType)()&&(0,k.setKeyboardType)("");var t=(0,o.$)(".uMailWrite__keyboard");if(removeClass(ee,t),rt(!1),e&&e.store){var n=store.mail.cur.peerId,i=store.mail.peers[n];i&&i.keyboard&&(Q[n]=i.keyboard.chat_local_id,lsSet("mail_keyboard_hidden",Q))}}function Te(e){(0,k.setKeyboardType)("buttons");var t=(0,o.$)(".uMailWrite__keyboard"),n=e&&e.forceRender;addClass(ee,t),rt(!0);var i=(0,k.getKeyboardState)(store.mail.cur.peerId);!n&&!!i.rendered||function(){var e=store.mail,t=e.cur,n=e.peers,i=t.peerId&&n[t.peerId];if(!i||!i.keyboard||!i.keyboard.buttons)return;var a=s.default.render((0,P.default)({keyboard:i.keyboard,pressed:Et(t.peerId)})),r=(0,o.$)(".uMailWrite__keyboard");r.innerHTML=a,(0,S.setScrollView)(r,{topBanner:!1}),(0,k.getKeyboardState)(t.peerId).rendered=!0}(),e&&e.store&&Me()}function Me(){var e=store.mail.cur.peerId;(0,k.clearCallbackButtons)(e),Q&&(delete Q[e],lsSet("mail_keyboard_hidden",Q))}function Pe(){(0,k.setKeyboardType)("templates");var e=(0,o.$)(".uMailWrite__templates");addClass(te,e),ot(),_t()}function Le(){"templates"===(0,k.getKeyboardType)()&&(0,k.setKeyboardType)("");var e=(0,o.$)(".uMailWrite__templates");removeClass(te,e),ot()}function Ne(e){var t=(0,o.$)(".uMailWrite__popupAttach"),n=(0,o.$)(".uMailWrite__popupStickers");e.preventDefault(),e.stopPropagation(),hasClass(Z,n)&&removeClass(Z,n),hasClass(J,t)?removeClass(J,t):(addClass(J,t),addEvent(window,"click",(function e(n){removeClass(J,t),removeEvent(window,"click",e)})))}function Re(){store.mail.cur&&((0,O.geByClass1)("sp_body")&&(cur.scroller&&cur.scroller.destroy(),(0,O.geByClass1)("sp_body").scrollTop=0,removeClass("scroller_wrap",(0,O.geByClass1)("sp_cont")),geByClass("sp_page").forEach((function(e){return removeClass("scroller_page",e)}))))}function xe(e,t){if(store.mail.cur){var n=store.mail,i=n.cur,a=n.peers,r=((0,O.geByClass1)("uMailWrite"),(0,o.$)(".uMailWrite__popupStickers")),s=(0,v.random)(),l=0===t.indexOf("suggestion"),c={act:"send",to:i.peerId,from:"dialog",hash:a[i.peerId].hashSend,message:"",media:"sticker"+e,_af:i._af,random_id:s,sticker_referrer:t};post.addRecentSticker(!1,e,!1);var u=i.msgReply[i.peerId];if(u&&(c.attached_messages=u,c.has_reply=!0,(0,k.setPeerDraft)(i.viewerId,i.peerId,{reply:void 0}),ajaxRequest("/mail",{act:"reply_cancel",peer_id:store.mail.cur.peerId,hash:store.mail.hash.reply}),i.msgReply[i.peerId]=null),l){var d=(0,o.$)(".uMailWrite__textarea");d.value="",it("",i.viewerId,i.peerId),ze({},d)}return st(c),ot(),Oe(),(0,o.$)(".sp_tab_selected",r).classList.contains("sp_tab-1")&&setTimeout((function(){post.stickersSelectTab(!1,-1)})),!0}}function Be(){var e=(0,o.$)(".uMailWrite__popupStickers");if(!e)return!1;clog("[mail sticker panel] received panel update event");var t=e.classList.contains("uMailWrite__popupStickers_open"),n=!e.innerHTML;t&&!n?domData(e,"need-update",1):(clog("[mail sticker panel] redraw closed sticker panel"),n&&ye(),De(),le&&(le=!1,ye(),StickersHints.init({peerId:store.mail.cur.peerId}),StickersHints.showNewConvoHints()))}function De(){var e=store.mail.cur,t=(0,o.$)(".uMailWrite__popupStickers");if(!t)return!1;var n=(0,o.$)("#stickers_panel");if(!n)return!1;var i=(0,o.$)(".sp_tab_selected",n),a=Array.from(i.classList).reduce((function(e,t){if(t.startsWith("sp_tab")){var n=parseInt(t.split("sp_tab")[1]);isNaN(n)||(e=n)}return e}),0);return t.innerHTML=x.default.getStickerPanel("mail"+e.peerId),post.stickersSelectTab(!1,a),!0}function Oe(){var e=store.mail,t=e.cur,n=e.replies,i=t.msgReply[t.peerId],a="";if(t.editing){var r=n[i];r&&(a=r.preview_url)}else{var s=i&&f.default.getElem(i);if(s){var l=(0,o.$)(".thumbs_map .thumb_map_img_as_div",s);(a=l&&l.style.backgroundImage)&&(a=a.replace(/^url\((['"])?/,"").replace(/(['"])?\)$/,""))}}(0,o.$$)(".uMailWrite__reply").forEach((function(e){e.outerHTML=(0,M.uMailWrite_Reply)(a)}))}function Ue(e){(0,o.$$)(".uMailWrite__attachments_"+e).forEach((function(t){t.outerHTML=(0,M.uMailWrite_Attachments)(e)})),pe(),(0,o.$)(".uMailWrite__textarea")&&ot();var t=(0,o.$)(ie);if(t){var n=!!t.$(oe);t.classList.toggle(ne,!n)}}function He(e){if(e&&e.preventDefault(),!mediaUpload.checkUploading())return!1;var t,n=(0,o.$)(".uMailWrite__textarea"),i=store.mail,a=i.cur,r=i.peers,s=(0,v.random)(),u=store.mail.cur.editing,d=u&&store.mail.msgs[u],_=d?{act:"edit_message",id:u,peerId:d.peerId,hash:r[a.peerId].hashSend}:{act:"send",to:a.peerId,from:"dialog",hash:r[a.peerId].hashSend,_af:a._af,random_id:s,entrypoint:store.mail.cur.mvk_entrypoint||""};if(!ut())return d?MsgDeleteDialog.open({isEditing:!0}):a.groupId&&!(0,R.isChatPeer)(a.peerId)&&(t=(0,o.$)(".uMailWrite__templates"),pt("templates"),hasClass(te,t)?Le():Pe()),!1;each((0,O.geByClass1)("uMailWrite"),(function(e,t){return!(t.name&&!t.disabled)||("radio"===t.type&&!t.checked||("checkbox"===t.type&&!t.checked||("button"===t.type||("submit"===t.type||("image"===t.type||void(_[t.name]=t.value))))))})),u?(uMailHat.onCancelEditing(!0),st(_)):(st(_),store.mail.cur.mvk_entrypoint="",(0,k.popPeerAttachments)(a.peerId),n.value="",it("",a.viewerId,a.peerId),(0,k.setPeerDraft)(a.viewerId,a.peerId,{msgs:void 0,reply:void 0},a.editing),a.msgReply[a.peerId]&&!a.editing&&ajaxRequest("/mail",{act:"reply_cancel",peer_id:store.mail.cur.peerId,hash:store.mail.hash.reply}),a.msgAttached[a.peerId]=[],a.msgReply[a.peerId]=null,ze({},n)),c.default.onSystemMessageClick(),Ue(a.peerId),Oe(),StickersHints.actualizeVisibility(),y.isIOS?(n.focus(),setTimeout((function(){return n.focus()}))):l.default.msie_edge||(n.focus(),requestAnimationFrame((function(){return n.focus()})))}function Fe(e){var t=store.mail,n=t.cur,i=t.peers,o=n.peerId,a=i[o];a&&ajaxRequest("/mail",{_ajax:1,act:"typing",peer:o,hash:a.hashTyping,community:nav.getQuery("community"),type:e})}function Ve(e,t){var n=store.mail,i=n.cur,o=n.peers,r=i.peerId,s=o[r],l=qe[t];if(!l||l.peerId!==r)return window.clog("Recording peer id and target not same"),delete qe[t],void(0,O.statlogsValueEvent)("mvk_audio_messages_event",null,"abort","pid");function c(){(0,O.statlogsValueEvent)("mvk_audio_messages_event",null,"upload_fail"),mediaUpload.finishFakeUploading();var n=d.init({duration:3e4,type:SNACKBAR_TYPE_ERROR,text:window.getLang("mail_audio_message_upload_error"),action:{text:window.getLang("mobile_mail_audio_message_upload_retry"),onclick:"uMailWrite._resendAudioMessage()"}});M.default._resendAudioMessage=function(){(0,O.statlogsValueEvent)("mvk_audio_messages_event",null,"upload_retry"),window.Snackbar.close(n,!0),Ve(e,t)}}M.default._resendAudioMessage=function(){},uploadFile(i.audio_msg.upload_url,e,{onStart:function(){mediaUpload.startFakeUploading()},onComplete:function(e){(0,O.statlogsValueEvent)("mvk_audio_messages_event",null,"upload_complete"),ajaxRequest(i.audio_msg.done_url,JSON.parse(e.target.responseText),(function(e){if(e){mediaUpload.finishFakeUploading(),delete qe[t];var n=e.owner_id+"_"+e.id,o=(0,v.random)(),l=i.msgReply[i.peerId];st({act:"send",to:r,from:"dialog",hash:s.hashSend,message:"",media:"audiomsg",attach1:n,attach1_type:"doc",attached_messages:l,has_reply:!!l,_af:i._af,random_id:o}),i.msgReply[i.peerId]=null,Oe(),(0,a.onEmitOnce)(N.onMessage,(function(){uMessenger.cacheAudioMessageWaves()}))}else c()}),c)},onError:c})}function je(){var e=store.mail.cur;pt("text");var t=(0,o.$)(".messenger__layer_convo .messenger__content");X=new D.VoiceRecordControlsManager(e.viewerId+"_"+e.peerId,t),setStyle(t,{overflow:"visible"}),(0,a.onEmitOnce)(X.onDestroy,(function(){setStyle(t,{overflow:""}),X=null})),(0,a.onEmitOnce)(X.onPreviewProcessComplete,(function(e){var t=store.mail.cur,n=t&&(0,k.getPeerDraft)(t.viewerId,t.peerId);(0,k.setPeerDraft)(t.viewerId,t.peerId,(0,i.default)({},n,{audioMessagePreviewData:e}),t.editing)})),(0,a.onEmitOnce)(X.onSend,(function(e,t){Ve(e,t),X=null,AudioMessagePlayer.resumeGlobalMedia()}))}function $e(){X&&(X.clearCache(),X.cancel(!0))}var qe={};function We(e){var t=store.mail.cur,n=(0,o.$)(".uMailWrite__textarea");setStyle.transform(n,0),je();var i=window.Speech.startRecording();X.recorder=i,Promise.all([i.getAvailableMicrophones(),i.aquireMicrophone()]).then((function(e){if(0===e[0].length){var t=new Error;throw t.name="DevicesNotFoundError",t}})).catch((function(e){delete qe[s];var t="Error"===e.name?e.constructor.name||"Error":e.name;(0,O.statlogsValueEvent)("mvk_audio_messages_event",null,"aquire_error",t||"Empty");var i=null;switch(t){case"DevicesNotFoundError":case"NotFoundError":case"OverconstrainedError":case"NotReadableError":i=window.getLang("mail_audio_message_device_error");break;case"NotAllowedError":case"PermissionDeniedError":case"PermissionDismissedError":(0,V.showAlert)(window.getLang("mobile_mail_record_unavailable_title"),window.getLang("mobile_mail_record_unavailable_text"));break;default:i=window.getLang("mail_audio_message_unsupported_error")}i&&d.init({type:SNACKBAR_TYPE_ERROR,text:i}),AudioMessagePlayer.resumeGlobalMedia(),X.cancel(!0),X=null,setStyle.transform(n,1)})),(0,a.onEmitOnce)(X.onDestroy,(function(){delete qe[s],setStyle.transform(n,1),AudioMessagePlayer.resumeGlobalMedia(),window.Speech.onTypingEvent.off(r)})),AudioMessagePlayer.pauseGlobalMedia(),AudioMessagePlayer.detachPlayer();var r=function(){return Fe("audio")};window.Speech.onTypingEvent(r);var s=(0,v.random)();qe[s]={peerId:t.peerId},X.init(e,e?"moving":"locked",s)}function Ge(e){var t=e.event;t.target.closest(".Tooltip")||(0,o.$)(".uMailWrite__buttonSend").classList.contains("uMailWrite__buttonSend_canVoiceRecord")&&(0,O.getCw)()<U.DESKTOP_WIDTH&&We(t)}function Ye(e){var t;e.target.closest(".Tooltip")||(0,o.$)(".uMailWrite__buttonSend").classList.contains("uMailWrite__buttonSend_canVoiceRecord")&&((null==(t=X)?void 0:t.initialized)?X.lock():We())}function Ke(e){l.default.msie_edge&&(e.preventDefault(),He(e))}function Qe(){var e=Qe,t=e.typingData||(e.typingData={});if(!(0===(0,o.$)(".uMailWrite__textarea").value.length||store.mail.cur&&store.mail.cur.editing)){var n=Date.now(),i=store.mail.cur.peerId;i<=-2e9||t[i]&&n-t[i]<5e3||(t[i]=n,Fe("text"))}}function ze(e,t){var n=(0,o.$)(".uMailWrite__textareaGhost"),i=t.value;n.innerText=i,"\n"===last(i)&&(n.innerHTML+="&nbsp;");var a=store.mail.cur,r=n.offsetHeight;(0,o.$$)(".uMailWrite__textarea").forEach((function(e){return setStyle(e,"height",r)})),(0,o.$$)(".uMailWrite__main").forEach((function(e){return setStyle(e,"height",r+8)})),(0,o.$$)(".uMailWrite__popupStickers .stickersHints").forEach((function(e){setStyle(e,"bottom",r+8+-5)})),ce(),a&&ue(i,a.viewerId,a.peerId),Je(e,t,(function(){Mention.onKeyUp(e,t)}))}function Xe(e){var t=store.mail,n=t.peers,i=t.members,o=t.cur,a=n[e].memberIds||[],r=[],l=[];a.forEach((function(e,t){if(e!==o.viewerId){var n=i[e];if(n){var a=[n.id,n.name,n.url.replace("/","@"),n.avatar,n.url.replace("/",""),null,null,null,n.firstName,n.domain];r.push(a)}else{var s=["fake"+t,"...","@...",i[0].avatar,"",null,null,null,"...",null];l.push(s)}}}));var c=s.default.html((0,C.Icon20MentionOutline)()),u=[];return j.MASS_MENTION_ALIASES.online.forEach((function(e){var t=["online",lang.mobile_mail_mention_online,"@"+e,null,"",null,null,null,e,e,'<div class="MentionItem__img MentionItem__online">'+c+"</div>"];u.push(t)})),j.MASS_MENTION_ALIASES.all.forEach((function(e){var t=["all",lang.mobile_mail_mention_all,"@"+e,null,"",null,null,null,e,e,'<div class="MentionItem__img MentionItem__all">'+c+"</div>"];u.push(t)})),r.concat(l).concat(u)}function Je(e,t,n){se.length&&(!hasClass("Mention_inited",(0,O.geByClass1)("uMailWrite__main"))&&me(),n(e,t))}function Ze(e,t){Je(e,t,(function(){Mention.onKeyDown(e,t)})),(10==e.keyCode||13==e.keyCode&&(e.ctrlKey||e.metaKey))&&He()}function et(e,t){Je(e,t,(function(){Mention.onClick(e,t)}))}function tt(e,t){(0,k.setKeyboardType)("text");var n=function(){store.mail.cur&&(ye(),pt("text"),StickersHints.init({peerId:store.mail.cur.peerId}),Je(e,t,(function(){Mention.onFocus(e,t)})))};y.isIOS?n():requestAnimationFrame((function(){requestAnimationFrame((function(){n()}))})),w.onOpen("bottom")}function nt(e,t){if("text"===(0,k.getKeyboardType)()&&(0,k.setKeyboardType)(""),w.onClose(),ue._timer&&clearTimeout(ue._timer),store.mail&&store.mail.cur){var n=store.mail.cur,i=n.viewerId,o=n.peerId;it(t.value,i,o)}}function it(e,t,n){var i=store.mail.cur.editing;(0,k.setPeerDraft)(t,n,{text:e},i)}function ot(){var e=store.mail,t=e.cur,n=(e.queue,e.flags);if(t&&t.peerId){var i=!ut(),a=!mediaUpload.checkUploading(),s=!!t.editing,l={sendActive:!(i||s||a||u),loading:a,editAccept:s&&!i,editRemove:s&&i},c=n.templates&&!(s||!t.groupId||(0,R.isChatPeer)(t.peerId)||!i||l.loading||l.uploading);l.templates=c&&"templates"!==(0,k.getKeyboardType)(),l.templatesActive=c&&"templates"===(0,k.getKeyboardType)();var u=n.areAudioMessagesEnabled&&!a&&!c&&!s&&i&&!(!window.AudioContext&&!window.webkitAudioContext||!navigator.mediaDevices);l.showVoiceRecord=u,l.canVoiceRecord=u&&"Speech"in window;var d=!(l.sendActive||l.showVoiceRecord||l.loading||l.editAccept||l.editRemove||l.templates||l.templatesActive);l.disabled=d;var _=r.default.class("uMailWrite__button","uMailWrite__buttonSend",l);return(0,o.$$)(".uMailWrite__buttonSend").forEach((function(e){return e.className=_})),l}}function at(e){var t=r.default.class("uMailWrite__button","uMailWrite__buttonStickers",{active:e});(0,o.$$)(".uMailWrite__buttonStickers").forEach((function(e){return e.className=t}))}function rt(e){var t=r.default.class("uMailWrite__button","uMailWrite__buttonKeyboard",{active:e});(0,o.$$)(".uMailWrite__buttonKeyboard").forEach((function(e){return e.className=t}))}function st(e){if(store.mail.cur){var t=store.mail.cur,n=t.ref,i=t.refSource,o=e.to;if(i&&(e.ref_source=i,e.ref=n,store.mail.refSource=void 0,store.mail.ref=void 0),N.send(e),o){var a=store.mail.peers[o];if(a&&a.keyboard&&a.keyboard.one_time)a.keyboard=null,(0,k.getKeyboardState)(o).updateTime=Date.now(),dt()}ot()}}function lt(e){e.stopPropagation(),alert(lang.mobile_mail_attachments_limit)}function ct(e){var t=document.createElement("textarea");t.innerHTML=e;var n=t.value,i=(0,o.$$)(".uMailWrite__textarea");i.forEach((function(e){return e.value=n})),ze({},i[0])}function ut(){var e=(0,o.$)(".uMailWrite__textarea");return!!e&&(function(){var e=store.mail,t=e.cur;e.peers;return!!t&&t.hasAttachments}()||!!e.value.trim())}function dt(e){if((0,o.$)(".uMailWrite__keyboard")){var t,n=store.mail,i=n.cur,a=n.peers,s=i.peerId&&a[i.peerId];t=!(i.groupId||!s||s.closed||s.kicked)&&!(!s.keyboard||!s.keyboard.buttons.length);var l=(0,o.$)(".uMailWrite"),c=r.default.parseClass("uMailWrite",l.className);if(c.keyboard!==t&&(l.className=r.default.class("uMailWrite",Object.assign({},c,{keyboard:t}))),(0,k.getKeyboardState)(i.peerId).rendered=!1,t){Q||(Q=lsGet("mail_keyboard_hidden")||{});var u=s.keyboard,d=Q[i.peerId];e&&!0===e.update&&(0,k.clearCallbackButtons)(i.peerId);var _=!(0,k.getKeyboardType)()||"buttons"===(0,k.getKeyboardType)()||"text"===(0,k.getKeyboardType)(),f=!1;d&&(d==u.chat_local_id?_=!1:f=!0),_?ft("buttons",{store:f}):f&&Me()}else Ie()}}function _t(){var e=store.mail,t=e.cur,n=e.peers,i=t.peerId&&n[t.peerId];if(t.groupId&&i&&!i.closed&&!i.kicked){var a=(0,o.$)(".uMailWrite__templatesBody"),r=t.templates;if(a)return r?void function(e,t){e.innerHTML=(0,L.uMailWrite_TemplatesContent)(t)}(a,r):(function(e){e.innerHTML=(0,L.uMailWrite_TemplatesLoading)()}(a),z||(z=new Promise((function(e){ajaxRequest("/mail",{act:"get_templates"},(function(t){e(t)}),(function(t){e()}))}))),void z.then((function(e){z=null,store.mail&&store.mail.cur&&(store.mail.cur.templates=e),_t()})))}}function ft(e,t){switch(pt(e),e){case"stickers":be();break;case"buttons":Te(t);break;case"text":(n=(0,o.$)(".uMailWrite__textarea"))&&n.focus();break;case"templates":Pe()}var n}function pt(e){var t;"stickers"!==e&&Se(),"buttons"!==e&&Ie(),"text"!==e&&(t=(0,o.$)(".uMailWrite__textarea"))&&document.activeElement===t&&t.blur(),"templates"!==e&&Le()}function mt(e){var t=store.mail,n=t.cur,i=t.peers,o=t.members,a=i[e],r=o[n.userId],s=o[a.ownerId],l=!!n.groupId,c=[(0,q.ModalMenuUserListItem)({id:n.userId,name:lang.mobile_mail_you,class:l?"":"uMailWrite__modalMenuUserListItem_active",href:r.url,image:r.avatar||(0,G.getUser24Icon)(),onclick:"return uMailWrite.onUserListItemClick(event, this, "+parseInt(r.id)+")"}),(0,q.ModalMenuUserListItem)({id:a.ownerId,name:s.name,class:l?"uMailWrite__modalMenuUserListItem_active":"",href:s.url,image:s.avatar||(0,W.getUsers24Icon)(),onclick:"return uMailWrite.onUserListItemClick(event, this, "+parseInt(s.id)+")"})];return(0,q.default)({users:c})}function ht(e){var t=store.mail.cur.templates.find((function(t){return t.id===e}));if(t){var n=lang.mobile_mail_templates_delete_popup_text;n=n.replace("{name}",(0,A.emojiToHTML)(t.name)),MailDialog.open({body:n,confirmText:lang.mobile_mail_delete_popup_delete,cancelText:lang.mobile_mail_delete_popup_cancel,onConfirm:r.default.onClick("uMailWrite._onConfirmDeleteTemplate",e)})}}function vt(e){var t=store.mail.cur.templates,n=t.findIndex((function(t){return t.id===e}));if(-1!==n){var i=t[n],a=(0,o.$)(".uMailWrite__templatesRow"+i.id);i.deleting=!0,a.classList.add("uMailWrite__templatesRow_hidden"),ajaxRequest("/mail",{act:"delete_template",hash:store.mail.hash.templateDelete,id:e},(function(n){if(n.error)gt(e);else{var i=t.findIndex((function(t){return t.id===e}));t.splice(i,1),_t()}}),(function(){gt(e)}))}MailDialog.close()}function gt(e){var t=store.mail.cur.templates,n=(0,o.$)(".uMailWrite__templatesRow"+e),i=t.findIndex((function(t){return t.id===e})),a=t[i];a.deleting=!1,n.classList.remove("uMailWrite__templatesRow_hidden");var r=lang.mobile_mail_templates_delete_error;r=r.replace("{name}",a.name),d.init({text:r,action:{text:lang.mobile_mail_templates_toast_action_ok,callback:function(e,t){var n=t.id;d.close(n)}}})}function At(){c.default.clearSystemMessage2(),remove((0,O.geByClass1)("message__newMsgsDivider")),remove((0,O.geByClass1)("Unfold__item_returnToChat")),mediaUpload.refreshUploadState()}function yt(){var e=store.mail,t=e.cur,n=e.presend,i=e.pendingReplies,o=[],a=n.failed[t.peerId]||[],r=n.pending[t.peerId]||[];(a.length||r.length)&&(a.concat(r).map((function(e){var t=n.msgs[e];if(t)if(0===t.sendId.indexOf("edit"))M.default.onMessage(t);else{if(t.reply){var a=f.default.getReplyDataFromHTML(t.reply);a&&(i[t.reply]=a)}o.push(t)}})),_.setMsgs(o))}function wt(e,t,n){var i;n?i=[(0,p.ModalMenuBtn)({inner:lang.mobile_mail_presend_menu_retry,onclick:["uMailWrite._onRetryFailedMsg","this",t]}),(0,p.ModalMenuBtn)({inner:lang.mobile_mail_presend_menu_delete,onclick:["uMailWrite._onDeleteFailedMsg","this",t]})]:i=[(0,p.ModalMenuBtn)({inner:lang.mobile_mail_presend_menu_cancel,onclick:["uMailWrite._onCancelPendingMsg","this",t]})];var o=(0,p.default)({close:!0,closeText:lang.mobile_mail_presend_menu_close,items:i});m.default.open(s.default.elem(o),!0)}function St(e,t){p.default.close(e);var n=store.mail.presend.msgs[t];(0,k.removeFailedMsg)(n),N.retry(t,(function(e){var t=store.mail.cur.peerId,n=store.mail.peers[t];return e.data.hash=n.hashSend,e}))}function bt(e,t){p.default.close(e),N.remove(t)}function kt(e,t){p.default.close(e),N.remove(t)}function Ct(e){d.init({duration:0,text:e,action:{text:lang.mobile_mail_templates_toast_action_ok,callback:function(e,t){var n=t.id;d.close(n)}}})}function Et(e){return store.mail&&store.mail.cur&&store.mail.cur.pressedButtons?store.mail.cur.pressedButtons.peers[e]:{}}function It(e){if(void 0===e&&(e=!1),!(0,B.partConfigEnabled)("mail_new_conversation_stickers_hint"))return!1;(e||function(){var e=store.mail;return!!e&&(0,K.isNewPeer)(e.cur.peerId,e)}())&&(le=!0,x.default.checkStickers({force:!0,ignore_hash:!0}))}},79030:function(e,t,n){"use strict";n.d(t,{uMailWrite_TemplatesContent:function(){return c},uMailWrite_TemplatesLoading:function(){return d},prepareTemplateText:function(){return _}});var i=n(11393),o=n(62561),a=n(28638),r=n(54440),s=n(49751),l=n(64723);function c(e){var t=e.length,n=!t;return i.default.html([u(n),{class:"uMailWrite__templatesRows",attrs:{hidden:n},inner:e.map((function(e,n){return function(e,t,n){var s=t>0&&t===n-1,l=store.mail.cur.communityParam,c=store.mail.cur.peerId,u=e.name,d=e.text;u=(0,a.emojiToHTML)(u),d=_(d,!0);var f="_touched uMailWrite__templatesRow";f+=" uMailWrite__templatesRow"+e.id,e.deleting&&(f+=" uMailWrite__templatesRow_hidden");return{class:f,inner:[{class:"uMailWrite__templatesRowContent",attrs:{onclick:["uMailWrite.onTemplateClick","event","this",e.id]},inner:[{class:"uMailWrite__templatesRowName",inner:i.default.html(u)},{class:"uMailWrite__templatesRowText",inner:i.default.html(d)}]},{class:"uMailWrite__templatesRowMore",inner:[i.default.wrap((0,r.default)({mix:"",icon:"more",position:s?"bottomRight":"topRight",items:[{text:lang.mobile_mail_templates_action_edit,name:"edit",url:"/mail?act=template&id="+e.id+l+"&from="+c},{text:lang.mobile_mail_templates_action_delete,name:"delete",attrs:o.default.onMouseDown("uMailWrite._onDeleteTemplate",e.id)}]}))]}]}}(e,n,t)}))}])}function u(e){var t="/mail?act=template&from="+store.mail.cur.peerId+store.mail.cur.communityParam,n=o.default.onClick("uMailWrite.loadTemplatePage","event","this",t);return{class:"uMailWrite__templatesEmpty",attrs:{hidden:!e},inner:[{class:"uMailWrite__templatesEmptyInfo",inner:lang.mobile_mail_templates_empty_info},(0,s.default)({type:"button",theme:"small",attrs:n,inner:lang.mobile_mail_templates_empty_button})]}}function d(){return i.default.html((0,l.Loading)({mix:"uMailWrite__templatesLoading"}))}function _(e,t){void 0===t&&(t=!1);var n,i=store.mail.members,o=store.mail.cur,r=i[o.peerId],s=i[o.userId],l=i[o.groupId],c=r.raw_name.replace(r.firstName,"").trim(),u=s.raw_name.replace(s.firstName,"").trim();if((e=(e=(e=(e=(e=(e=(e=(e=e.replace(/<br>/g,"\n")).replace(/&lt;br&gt;/g,"\n")).replace(/\t/g,"\n")).replace(/{user name}/g,r.firstName)).replace(/{user surname}/g,c)).replace(/{admin name}/g,s.firstName)).replace(/{admin surname}/g,u)).replace(/{community}/g,l.name)).match(/{greeting}/g)){var d,_=(n=Date.now()+1e3*store.mail.cur.timeShift,new Date(n).getHours());d=_>=3&&_<12?lang.mobile_mail_templates_greeting_morning:_>=12&&_<17?lang.mobile_mail_templates_greeting_afternoon:_>=17&&_<=23?lang.mobile_mail_templates_greeting_evening:lang.mobile_mail_templates_greeting_night,e=e.replace(/{greeting}/g,d)}return t&&(e=(0,a.emojiToHTML)(e)),e}},55010:function(e,t,n){"use strict";n.r(t),n.d(t,{Messenger:function(){return i.Messenger}});var i=n(2754);n(71207),n(16226);t.default=i.default,window.uMessenger=i.default,window.Messenger=i.Messenger},2754:function(e,t,n){"use strict";n.d(t,{Messenger:function(){return L},Messenger_renderConvoLayer:function(){return N},Messenger_renderLoadingPage:function(){return R},uMessenger_class:function(){return U},uMessenger_getBanner:function(){return D},uMessenger_getPinnedMsg:function(){return B},uMessenger_renderMRsHint:function(){return F},uMessenger_renderBusinessNotifyHint:function(){return V},uMessenger_hasSelectedMsgs:function(){return H},uMessenger_renderPeerProfile:function(){return j},uMessenger_isRecommendContactsVisible:function(){return $},uMessenger_renderRecommendContacts:function(){return q}});var i=n(13725),o=n(62561),a=n(85489),r=n(11393),s=n(72592),l=n(27109),c=n(87712),u=n(1142),d=n(30112),_=n(89581),f=n(69618),p=n(11713),m=n(97244),h=n(51106),v=n(49272),g=n(19938),A=n(46950),y=n(35909),w=n(22911);function S(){var e=(0,i.default)(['\n    <a href="/mail?act=business_notify" class="messenger__businessNotifyHintBox _touched">\n      ',"\n    </a>\n  "]);return S=function(){return e},e}function b(){var e=(0,i.default)(['\n    <a href="/mail?act=mrs" class="messenger__mrsHintBox _touched">\n      ',"\n    </a>\n  "]);return b=function(){return e},e}function k(){var e=(0,i.default)(["\n    ",'\n    <div class="messenger__banner_content">\n      <div class="messenger__banner_text" ',">\n        ",'\n      </div>\n      <div class="messenger__banner_buttons">\n        ',"\n      </div>\n    </div>\n    ","\n  "]);return k=function(){return e},e}function C(){var e=(0,i.default)(['\n      <div class="messenger__banner_icon">\n        <img class="messenger__banner_icon_img" src="','">\n      </div>\n    ']);return C=function(){return e},e}function E(){var e=(0,i.default)(['\n    <div class="messenger__spinner">\n      ',"\n    </div>\n  "]);return E=function(){return e},e}function I(){var e=(0,i.default)(['\n    <div class="messenger__header">\n      ',"\n    </div>\n    ","\n  "]);return I=function(){return e},e}function T(){var e=(0,i.default)(['\n    <div class="messenger__convoListNotice">\n      ',"\n    </div>\n  "]);return T=function(){return e},e}function M(){var e=(0,i.default)(['\n    <div class="messenger__header">\n      ','\n    </div>\n    <div class="messenger__content">\n      <div class="','">','</div>\n      <div class="messenger__pinned">','</div>\n      <div class="messenger__peerProfile">',"</div>\n      ",'\n      <div class="','">\n        <div class="messenger__mrbox">','</div>\n        <div class="messenger__write">','</div>\n        <div class="messenger__acts">',"</div>\n      </div>\n    </div>\n  "]);return M=function(){return e},e}function P(){var e=(0,i.default)(['\n    <div class="','">\n      <div class="messenger__layer messenger__layer_main">\n        <div class="messenger__header">','</div>\n        <div class="messenger__content">\n          ','\n        </div>\n      </div>\n      <div class="messenger__layer messenger__layer_convo">\n        ','\n      </div>\n      <div class="messenger__layer messenger__layer_page">','</div>\n      <div class="messenger__dialog"></div>\n    </div>\n  ']);return P=function(){return e},e}function L(e){var t=window.lang.mobile_mail_search_only_messages,n=(0,u.default)({query:e.query,createUrl:e.createChatUrl}),i=e.mrs?F(e.mrs):"",a=e.businessNotify?V(e.businessNotify):"",r=o.default.onClick("Messenger._onSearchMsgsClick"),l=q(),d=(0,c.default)({mix:"messenger__body",attrs:o.default.onScroll("Messenger._onMainScroll","this"),inner:[(0,s.default)({mix:"messenger__filter",inner:n}),(0,s.default)({mix:o.default.class("messenger__recommendContacts",{hidden:!l}),inner:l}),(0,s.default)({mix:o.default.class("messenger__mrsHint",{hidden:!e.mrs}),inner:i}),(0,s.default)({mix:o.default.class("messenger__businessNotifyHint",{hidden:!e.businessNotify}),inner:a}),(0,s.default)({mix:"messenger__searchMsgs",attrs:r,inner:t}),(0,s.default)({mix:"messenger__loadable",inner:[(0,s.default)({mix:"messenger__folderList",inner:e.scrapFolder}),(0,s.default)({mix:"messenger__searchList",inner:e.scrapSearch}),x()]})]});return o.default.html(P(),e.mix,e.mailHat,d,e.convo,e.page)}function N(){var e=store.mail,t=e.cur,n=e.peers[t.peerId],i=(0,m.default)(),a=B(),r=D(),l=(0,f.default)(),u=n&&n.canPin,_=(0,p.default)({canPin:u,isChannel:n.isChannel,isEdu:(0,A.isEduIntegration)()}),h=n.isCasper,g=(0,d.default)({scrap:"peer",isCasper:h}),y=n.isIncomingMR&&!t.isImportantMREnabled?(0,v.default)(t.peerId):"",w=n.isRejectedMR?function(){var e=window.lang;return o.default.html(T(),e.mobile_mail_mrs_rejected_info)}():"",S=t.peerId>0&&t.peerId<2e9,b=e.flags.isPeerProfileEnabled&&S?j({tags:e.peerProfileTags,tagsData:n.peerProfileTagsData,data:n.peerProfileData}):"",k=(0,c.default)({mix:"messenger__body",attrs:o.default.onScroll("Messenger._onConvoScroll","this"),inner:[(0,s.default)({mix:"messenger__spacer"}),(0,s.default)({mix:"messenger__convoList",inner:[g,w]}),x()]}),C="messenger__banner";r&&(C+=" messenger__bannerVisible");var E=o.default.class("messenger__footer",{actionsOpen:H(),isIncomingMR:n.isIncomingMR&&!t.isImportantMREnabled});return o.default.html(M(),i,C,r,a,b,k,E,y,l,_)}function R(e){var t=(0,h.MailHat_page)(),n=(0,c.default)({mix:"messenger__body",inner:[x()]});return o.default.html(I(),t,n)}function x(){var e=r.default.html((0,l.default)({mix:""}));return o.default.html(E(),e)}function B(){var e=store.mail,t=e.cur.peerId;return t&&e.peers[t].pinnedMsg}function D(){var e=store.mail,t=e.cur.peerId,n=t&&e.peers[t],i=n&&n.banner;if((0,A.isSAKIntegration)()||!i)return"";var a="";i.icon&&(a=o.default.html(C(),i.icon));for(var r=i.buttons,s=r.length,l=[],c=0;c<s;c++)l.push(O(r[c],c));l=o.default.list(l);var u=(0,_.default)({class:"messenger__banner_close",onClick:o.default.onClick("uMessenger.onBannerButtonClick","event")}),d=o.default.onClick("uMessenger.onBannerTextClick","event");return o.default.html(k(),a,d,i.text,l,u)}function O(e,t){var n={};"secondary"===e.layout?n.secondary=!0:"tertiary"===e.layout?n.tertiary=!0:n.primary=!0;var i,a=o.default.class("messenger__banner_button",n),r=e.type;return"gifts_link"===e.type&&(r="link",i="_self"),(0,_.default)({class:a,text:e.text,type:"link"===r?"link":"button",link:"link"===r?{href:e.link,target:i}:null,onClick:o.default.onClick("uMessenger.onBannerButtonClick","event",t)})}function U(){var e,t,n=store.mail.cur;t=n.page?"view_page":n.peerId?"view_dialog":n.query&&"msgs"===n.tab?"view_searchMsgs":n.query?"view_searchPeers":"folder_"+n.folder;var i=n.peerId?store.mail.peers[n.peerId]:null,a=(0,A.isVKPayIntegration)();return o.default.class("e","messenger",{isIncomingMR:!!i&&i.isIncomingMR,isRejectedMR:!!i&&i.isRejectedMR},"uMessenger",((e={})[t]=!0,e.community=!!n.groupId,e.sak_vkpay=a,e))}function H(){var e=store.mail.cur.msgSelected;return Object.keys(e).length>0}function F(e){var t=window.lang,n=langNumeric(e,t.mobile_mail_mrs_request_count);return o.default.html(b(),n)}function V(e){var t=window.lang,n=langNumeric(e,t.mobile_mail_business_notify_count);return o.default.html(S(),n)}function j(e){var t=e.tags,n=e.tagsData,i=e.data;if(!i)return"";var o=[];t&&n.peerTags&&(o=t.filter((function(e){return n.peerTags.indexOf(e.id)>-1})));var s,l=o.length;return s=n.fromAd||l?(0,g.PeerProfileTags)({fromAd:n.fromAd,peerTags:o,fromMessenger:!0,urls:e.data.urls}):i.city||i.age?(0,g.PeerProfileInfo)(i):(0,g.PeerProfileJoinDate)(i),r.default.html({class:"PeerProfile__wrapper",inner:[{class:a.default.class("PeerProfile",{messenger:!0}),inner:s},{class:"PeerProfile__link",inner:(0,y.Icon24ChevronCompactRight)()}],onClick:["PeerProfile.onMessengerBlockClick","event",i.urls.showPeerProfile]})}function $(){var e=store.mail.cur,t=!(e.folder&&"all"!==e.folder||e.query||e.forwardFromId);return e.isRecommendationListEnabled&&t&&!e.communityParam}function q(){var e=store.mail.cur;if(!$())return"";var t=e.recommendContacts.items.map((function(t){return e.recommendContacts.item_data[t]}));return r.default.html((0,w.MailRecommendContacts)({items:t,importServices:e.importContactsServices}))}t.default=function(e){void 0===e&&(e={});var t=store.mail.cur,n=t.query,i=(0,d.default)({scrap:"folder"}),o=(0,d.default)({scrap:"search"}),a=e.page,r="all"!==t.folder||t.query||t.forwardFromId?0:t.countMR,s="all"!==t.folder||t.query||t.forwardFromId?0:t.countBusinessNotify;return L({mix:U(),mailHat:(0,m.default)(),convo:N(),page:a,mrs:r,businessNotify:s,query:n,createChatUrl:"/mail?act=new_chat",scrapFolder:i,scrapSearch:o})}},71207:function(e,t,n){"use strict";var i=n(3226),o=n(62691),a=n(11713),r=n(1142),s=n(2754),l=n(42516),c=n(71372);function u(){(0,l.cleanScrollView)(s.Messenger.getConvoBody()),removeEvent(s.Messenger.getConvoBody(),"touchstart",d,{passive:!0})}function d(e){var t=e.target.closest(".msg__sticker");t&&Msg.onStickerTouchStart(e,t),(t||e.target.closest(".msg"))&&Msg._onTouchStart()}function _(e,t){$$(".messenger__layer_"+e).forEach((function(e){e.classList.toggle("messenger__layer_loading",t)}))}function f(e){return $(".messenger__layer_"+e+" .messenger__body")}function p(e){s.Messenger.onMainScroll(e)}function m(e){s.Messenger.onConvoScroll(e),e._isScrolling=!0,function(e){void 0===e&&(e=null);return!window._preventedCheckTop&&(e&&function(e){return e.scrollHeight&&e.scrollTop<=2.5*window.innerHeight}(e))}(e)&&s.Messenger.onConvoAtTop(),function(e){void 0===e&&(e=null);return e&&function(e){return e.scrollHeight&&e.scrollHeight-e.scrollTop-e.offsetHeight<=1.5*window.innerHeight}(e)}(e)&&s.Messenger.onConvoAtBottom(),e._scrollingTimer&&clearTimeout(e._scrollingTimer),e._scrollingTimer=setTimeout((function(){e._isScrolling=!1}),100)}function h(){var e,t;if(null==(e=window.Speech)||null==(t=e.recorder)?void 0:t.isRecording)setTimeout(h,2e3);else{var n,i,o=s.Messenger.getConvoBody();if(o)o.prevHeight&&o.prevHeight!==o.offsetHeight&&(n=o,i=o.scrollBottom,n.scrollTop=n.scrollHeight-n.offsetHeight-i),o.prevHeight=o.offsetHeight,o.scrollBottom=function(e){return e.scrollHeight-e.scrollTop-e.offsetHeight}(o),v&&requestAnimationFrame(h)}}Object.assign(s.Messenger,{scrollMainBodyToTop:function(){$(".messenger__layer_main .messenger__body").scrollTop=0},onMainScroll:(0,i.default)("scrollElem"),onQueryChange:r.default.onChange,onQueryClear:r.default.onClear,onSearchMsgsClick:(0,i.default)(),setQuery:r.default.setQuery,setQuerySilently:r.default.setQuerySilently,getMainBody:function(e){return f("main")},setMainLoading:function(e){return _("main",e)},onConvoAtTop:(0,i.default)(),onConvoAtBottom:(0,i.default)(),onConvoScroll:(0,i.default)("scrollElem"),setConvoLoading:function(e){return _("convo",e)},getConvoBody:function(){return f("convo")},scrollConvoToBottom:function(){var e=s.Messenger.getConvoBody();e&&(e.scrollTop=e.scrollHeight)},redrawConvoLayer:function(){var e=(0,s.Messenger_renderConvoLayer)();u(),$$(".messenger__layer_convo").forEach((function(t){t.innerHTML=e}))},cleanConvoBody:u,setupConvoBody:function(){(0,l.setScrollView)(s.Messenger.getConvoBody(),{topBanner:!1}),addEvent(s.Messenger.getConvoBody(),"touchstart",d,{passive:!0})},getPageLayer:function(){return $(".messenger__layer_page")},renderMessengerPeerProfile:function(e){$(".messenger__peerProfile").innerHTML=(0,s.uMessenger_renderPeerProfile)(e)}}),s.Messenger._onMainScroll=p,s.Messenger._onConvoScroll=m,s.Messenger._onSearchMsgsClick=s.Messenger.onSearchMsgsClick;var v=!1;if(s.default.startPolling=function(){v=!0,h()},s.default.stopPolling=function(){v=!1},Object.assign(s.default,{redraw:function(){$$(".uMessenger").forEach((function(e){return e.outerHTML=(0,s.default)()}))},redrawView:function(){$$(".uMessenger").forEach((function(e){return e.className=(0,s.uMessenger_class)()}));var e=store.mail,t=e.cur,n=e.peers;t.peerId&&(w(),y(),a.default.togglePin(n[t.peerId].canPin));AudioMessagePlayer.redrawWaves(),S(),b(),k()},redrawMailActions:function(){var e=(0,s.uMessenger_hasSelectedMsgs)();$$(".messenger__layer_convo").forEach((function(t){t.$(".messenger__footer").classList.toggle("messenger__footer_actionsOpen",e),a.default.update();var n=store.mail,i=n.cur,o=n.peers;if(!i.peerId||!o[i.peerId].isIncomingMR){var r=t.$(".messenger__write").offsetHeight,s=t.$(".messenger__acts").offsetHeight-r,l=t.$(".messenger__body");requestAnimationFrame((function(){!l._fixed&&s&&(l.style.paddingBottom=s+"px",l._fixed=!0),s<=0&&(l.style.paddingBottom=0,l._fixed=!1)}))}}))},redrawPinnedMsg:y,setPinnedVisibility:function(e){var t=store.mail,n=t.peers,i=t.cur,o=n[i.peerId].hasPinnedMsg;$$(".messenger").forEach((function(t){t.classList.toggle("messenger_pinnedVisible",o&&e),t.classList.toggle("messenger_pinnedHidden",o&&!e)}))},redrawBanner:function(){var e=(0,s.uMessenger_getBanner)();$$(".messenger__banner").forEach((function(t){t.innerHTML=e,t.classList.toggle("messenger__bannerVisible",!!e)}))},redrawMRsHint:S,redrawBusinessNotifyHint:b,redrawRecommendContacts:k,expandPeerBefore:function(){if(!$(".load_before_closed"))return;var e=s.Messenger.getConvoBody();if(o.default.safari_mobile){var t=function(){var t=$$(".load_before_closed"),n=e.scrollHeight-e.scrollTop-e.offsetHeight;setStyle(e,"overflow","hidden"),t.forEach((function(e){return e.classList.remove("load_before_closed")}));var i=e.scrollHeight-n-e.offsetHeight;setStyle(e,"overflow","auto"),e.scrollTop=i,AudioMessagePlayer.redrawWaves()};e.isScrolling?(A&&clearInterval(A),A=setInterval((function(){e.isScrolling||(clearInterval(A),t())}),10)):t()}else if(e.scrollTop<=184){var n=$$(".load_before_closed"),i=e.scrollHeight-e.scrollTop-e.offsetHeight;n.forEach((function(e){return e.classList.remove("load_before_closed")}));var a=e.scrollHeight-i-e.offsetHeight;e.scrollTop=a,AudioMessagePlayer.redrawWaves()}},pinActionToggle:w,scrollToMsg:function(e,t,n){void 0===t&&(t=!1),void 0===n&&(n=!0);var i=Msg.getElem(e);if(!i)return!1;var o=s.Messenger.getConvoBody();if($(".mailScrap__loading_before"),t)o.scrollTop=i.offsetTop-.18*o.offsetHeight;else{var a=$(".typing_id_curConvo").offsetHeight;o.scrollTop=i.offsetTop-.5*(o.offsetHeight+2)+(i.offsetHeight+a)/2,i.offsetHeight>o.offsetHeight&&(o.scrollTop=i.offsetTop)}return n&&(addClass("msg_highlight",i),setTimeout((function(){removeClass("msg_highlight",i)}),1500)),!0},loadMailPage:(0,i.default)()}),o.default.safari_mobile){var g=null;s.Messenger.onConvoScroll((function(e){e.isScrolling=!0,g&&clearTimeout(g),g=setTimeout((function(){return e.isScrolling=!1}),50)}))}var A=null;function y(){var e=store.mail,t=e.peers,n=e.cur,i=(0,s.uMessenger_getPinnedMsg)(),o=t[n.peerId].hasPinnedMsg;$(".messenger__pinned").innerHTML=i,MailHat_convo.setHasPinnedMsg(o)}function w(){var e=store.mail,t=e.peers,n=e.cur;if(n.peerId){var i=t[n.peerId].majorSortId,o=(0,c.isPinnedSortId)(i);$$(".messenger").forEach((function(e){e.classList.toggle("messenger_pinnedDialog",o)}))}}function S(){var e=store.mail.cur,t=e.countMR,n=t&&"all"===e.folder&&!e.query&&!e.forwardFromId,i=$(".messenger__mrsHint");if(n){var o=t?(0,s.uMessenger_renderMRsHint)(t):"";i.innerHTML=o}i.classList.toggle("messenger__mrsHint_hidden",!n)}function b(){var e=store.mail.cur,t=e.countBusinessNotify,n=e.isBusinessNotifyEnabled&&t&&"all"===e.folder&&!e.query&&!e.forwardFromId,i=$(".messenger__businessNotifyHint");if(n){var o=t?(0,s.uMessenger_renderBusinessNotifyHint)(t):"";i.innerHTML=o}i.classList.toggle("messenger__businessNotifyHint_hidden",!n)}function k(){var e=(0,s.uMessenger_isRecommendContactsVisible)(),t=$(".messenger__recommendContacts");e&&(t.innerHTML=(0,s.uMessenger_renderRecommendContacts)()),t.classList.toggle("messenger__recommendContacts_hidden",!e)}},16226:function(e,t,n){"use strict";var i=n(62691),o=n(85969),a=n(11393),r=n(41070),s=n(11713),l=n(4331),c=n(27334),u=n(60157),d=n(61680),_=n(92424),f=n(74521),p=n(19383),m=n(1730),h=n(75526),v=n(69618),g=n(97244),A=n(22911),y=(n(46693),n(32904)),w=n(7812),S=n(46705),b=n(30112),k=n(56353),C=n(2754),E=n(54412),I=n(28638),T=n(80610),M=n(24945),P=n(28708),L=n(42516),N=n(56399),R=n(93954),x=n(40997),B=n(49825),D=n(49066),O=n(43369),U=n(39161),H=n(6103),F=n(2955),V=n(61124),j=n(49751),$=n(80444),q=n(59219),W=n(48388),G=n(33713),Y=(n(46950),n(9046)),K=n(46172),Q=n(20329),z=n(62372),X=n(95343),J=n(1659),Z=n(49771),ee=n(36471),te=n(78466),ne=(n(51106),n(98330),n(62561),!1);uVK.onReady(We),C.Messenger.onQueryChange(Ke),C.Messenger.onQueryClear(Qe),h.default.onTap(we),g.default.onUnreadClick(le),g.default.onBackClick(ht),g.default.onBackToDialogClick(vt),g.default.onCancelEditing(dn),v.default.onAttachedMsgsRemove(ye),v.default.onToBottomClick(ct),v.default.onMessage(pe),v.default.replyAsChange(qn),x.onMessage(fe),x.onStopped(me),x.onMessageRemove(he),x.onCaptcha(Rn),r.default.onClick(Vt),r.default.onRestoreClick(qt),r.default.onReplyClick(Gt),r.default.onForward(Kt),Voting.onHtmlUpdate(pn),C.Messenger.onMainScroll(lt),C.Messenger.onConvoScroll(ut),C.Messenger.onSearchMsgsClick(Ye),C.Messenger.onConvoScroll(C.default.expandPeerBefore),C.Messenger.onConvoAtTop(at),C.Messenger.onConvoAtBottom(rt),s.default.onCloseClick(Lt),s.default.onRemoveClick(Nt),s.default.onImportantClick(Ot),s.default.onReplyClick(Ht),s.default.onForwardClick(Ft),s.default.onSpamClick(Dt),s.default.onPinClick(Mt),s.default.onEditClick(Pt),l.default.onConfirmDelete(xt),PinnedMsg.onHideClick(Jt),y.default.onRejectAll(wn),c.default.onConfirmReject(Sn),im.onNewMsg(ve),im.onEditMsg(Ae),im.onMultiTyping(At),im.onRecordingAudio(wt),im.onOnlineChange(St),im.onMsgReadByMe(bt),im.onMsgReadByOther(kt),im.onMsgImportantRemove(be),im.onMsgImportantAdd(Se),im.onMsgRemove(ke),im.onMsgListen(Ce),im.onConvoMinorIdChanged(Ie),im.onConvoMajorIdChanged(Ee),im.onPeerKeyboard(Me),im.onPeerBanner(Ue),im.onPeerConvert(He),im.onPeerAdmin(Fe),im.onMsgRequestChange(Ve),im.onCallInProgress(je),im.onDialogImportant(Pe),im.onDialogMarkedUnread(Ne),im.onDialogAdTag(Le),im.onUnreadCount(Re),im.onIncomingCall(xe),im.onKeyboardCallback(Oe),im.onResync(Be),im.onIsNewChange(De),B.onUnidle(In),AudioMessagePlayer.events.on("listened",Tn),AudioMessagePlayer.events.on("transcription_toggle",Nn),nav.onPopState(Ct),nav.onBeforeGo(Et),nav.onBeforeGo2(It),page.onChange(Tt),uVK.onReady(rn),page.onChange(rn),uVK.onReady(sn),page.onChange(sn),uVK.onReady(ln),page.onChange(ln),page.onChange(_e),page.onChange(fn),uVK.onReady(_e),uVK.onReady(zt),uVK.onReady(fn),uVK.onOrientationChange(de),C.default.loadMailPage(mn),C.default.onShowPinnedMsgClick=Xt,C.default.onHidePinnedMsgClick=Jt,C.default.onMarkDialogAsUnreadClick=Zt,C.default.onPinDialogClick=en,C.default.onUnpinDialogClick=tn,C.default.onBusinessNotifySettingsOpenClick=nn,C.default.onBannerButtonClick=on,C.default.onBannerTextClick=an,C.default.onCall=Vn,C.default.goToMsg=Wt,C.default.openSchoolGrade=vn,C.default.createNewChat=gn,C.default.cacheAudioMessageWaves=$t;var ie=!1,oe=0,ae=[],re=[],se=(0,O.throttle)((function(){if(!ae.length)return;var e=store.mail,t=e.members,n=e.cur,i=ae,o=re;ae=[],re=[],(0,Y.ajaxRequest)("/mail",{act:"get_members",members:i},(function(e){Object.assign(t,e),o.forEach((function(e){e===n.peerId&&w.default.redraw(),h.default.redrawTyping(e)}))}))}),3e3);function le(){C.Messenger.scrollMainBodyToTop()}function ce(){(0,L.preventDocumentScroll)();var e=C.Messenger.getMainBody();e&&(0,L.setScrollView)(e);var t=(0,m.$)(".leftMenu__searchItems");t&&(0,L.setScrollView)(t,{topBanner:!1,overscrollY:!1})}function ue(){(0,L.preventDocumentScroll)({topBanner:!1}),C.Messenger.setupConvoBody()}function de(){i.default.safari_mobile&&document.activeElement.blur()}function _e(){var e=nav.getQuery("msg")||nav.getQuery("id")||nav.getQuery("edit_msg_id");e?requestAnimationFrame((function(){C.default.scrollToMsg(e)})):requestAnimationFrame(C.Messenger.scrollConvoToBottom)}function fe(e){var t=store.mail.cur;(0,T.addPendingMsg)(e),t.peerId&&(0===e.sendId.indexOf("edit")?ft(e):(k.removeMsg(e),k.addMsg(e),Cn()),AudioMessagePlayer.redrawWaves())}function pe(e){store.mail.cur.peerId&&0===e.sendId.indexOf("edit")&&ft(e)}function me(){(0,T.failAllPendingMsgs)();var e=store.mail,t=e.cur,n=e.presend;if(t)if(t.peerId){if(n.failed[t.peerId]){var i=[];n.failed[t.peerId].map((function(e){var t=n.msgs[e];t&&(0===t.sendId.indexOf("edit")?ft(t):i.push(t))})),k.setMsgs(i)}}else Object.keys(n.failed).forEach((function(e){h.default.redrawLastMsg(e)}))}function he(e){var t=store.mail.presend.msgs[e];t&&((0,T.removePendingMsg)(t),(0,T.removeFailedMsg)(t),0===e.indexOf("edit")?store.mail.cur.peerId&&b.default.peerReplaceItems([t.id]):(store.mail.cur.peerId&&k.removeMsg(t),Cn()))}function ve(e,t){_t(e,t)}function Ae(e){_t(e)}function ye(){var e=store.mail,t=e.cur;e.peers;(0,T.setPeerDraft)(t.viewerId,t.peerId,{msgs:void 0},t.editing),t.msgAttached[t.peerId]=[],v.default.uiRedrawAttachments(t.peerId)}function we(e){var t=store.mail,n=(t.cur,t.rolls),i=t.msgs;if(n){var o=Number(qs2obj(e.split("?")[1]).peer);i[last(n.peer[o]||[])];return Ge(e)}}function Se(e){var t=store.mail,n=t.cur,i=t.msgs,o=t.scraps,a=t.rolls,s=i[e];if(s&&(s.isImportant=!0,a.folder.important=a.folder.important.concat(e).filter(unique).sort(desc),r.default.toggleImportant(e,!0),"important"===n.folder)){var l=o.folder.slice();o.folder=o.folder.concat(e).filter(unique).sort(desc),b.default.redrawFolder(l)}}function be(e,t){void 0===t&&(t=!0);var n=store.mail,i=n.cur,a=n.msgs,s=n.scraps,l=n.rolls,c=a[e];if(c&&(c.isImportant=!t,(0,o.arrayRemove)(l.folder.important,e),r.default.toggleImportant(e,!1),"important"===i.folder)){var u=s.folder.slice();(0,o.arrayRemove)(s.folder,e),b.default.redrawFolder(u)}}function ke(e,t){void 0===t&&(t=Promise.resolve());var n=store.mail,i=n.cur,a=n.msgs,l=n.scraps,c=n.rolls,u=n.peers,d=a[e];if(U.SAKIntegration.isIntegrated&&U.SAKIntegration.sendMessage("remove_msg",{msg:d}),d&&!i.msgRemoved[e]){delete a[e],(0,o.arrayRemove)(c.peer[d.peerId],e),i.peerId===d.peerId&&((0,o.arrayRemove)(l.peer,e),r.default.remove(e,!0),i.msgSelected[e]&&(delete i.msgSelected[e],s.default.setCount(Object.keys(i.msgSelected).length),C.default.redrawMailActions()),l.peer.length?b.default.checkDivider():b.default.redrawPeer()),d.isImportant&&i.countImportant--;var _=u[d.peerId];_.groupCall&&_.groupCall.msgId===e&&(_.groupCall=void 0);var f=_.isIncomingMR,p=_.isRejectedMR;d.isUnread&&d.authorId!==i.viewerId&&(_.countUnread=_.countUnread-1,f||p||_.countUnread<=0&&(0,K.addToUnreadCount)(-1,_.isMuted),v.default.redrawToBottom(),g.default.redrawCounter()),c.peer[d.peerId].length?Te(d.peerId,e):(i.peerId===d.peerId&&g.default.redrawActions(),t.then((function(){(0,Y.ajaxRequest)("/mail",{act:"get_last_msg",peer_id:d.peerId,user_id:i.userId},(function(t,n){n&&(storeMethods.injectMail(t),c.peer[d.peerId].push(n)),Te(d.peerId,e)}),(function(){Te(d.peerId,e)}))})))}}function Ce(e){var t=store.mail.msgs,n=t&&t[e];if(n){n.listened=!0,n.attachesHTML=n.attachesHTML.replace(/class="(im_msg_audiomsg(?:\w?\s?)*)"/g,'class="im_msg_audiomsg im_msg_audiomsg_listened"');var i=$$('.audio-msg-track[data-msg="'+e+'"]');i&&i.forEach((function(e){e.closest(".im_msg_audiomsg").classList.add("im_msg_audiomsg_listened")}))}}function Ee(e,t){var n=t.majorSortId,i=store.mail,o=i.peers,a=i.cur,r=i.scraps,s=i.rolls,l=o[e];if(l){l.majorSortId=n,a.peerId===e&&C.default.pinActionToggle();var c=a.folder,u="all"===c||"unread"===c&&l.countUnread;n&&u&&(s.folder[c]=s.folder[c].concat(e).filter(unique).sort(Qt),r.folder=r.folder.concat(e).filter(unique).sort(Qt),b.default.redrawFolder()),n||Te(e,void 0)}else n&&(0,Y.ajaxRequest)("/mail",{act:"get_dialog",peer_id:e},(function(t){storeMethods.injectMail(t);var i=t.peers[e],o=Object.keys(t.msgs)[0];i.isCasper&&!o||!i||((0,T.addPeer)(e,{msgs:[o]}),Ee(e,{majorSortId:n}))}))}function Ie(e,t){var n=t.minorSortId,i=store.mail,o=i.peers,a=i.scraps,r=i.cur;if(o[e].minorSortId=n,!r.peerId){var s=a.folder.slice();a.folder=a.folder.sort(Qt),b.default.redrawFolder(s)}}function Te(e,t){var n=store.mail,i=n.cur,a=(n.msgs,n.scraps),r=n.rolls,s=n.peers,l=s[e],c=l.isIncomingMR,u=l.isRejectedMR;r.peer[e].length||(c||u?(0,o.arrayRemove)(r.mrs,e):((0,o.arrayRemove)(r.folder.all,e),(0,o.arrayRemove)(r.folder.unread,e),(0,o.arrayRemove)(r.folder.unrespond,e)),"mrs"===i.page?(0,o.arrayRemove)(a.mrs,e):"important"!==i.folder&&(0,o.arrayRemove)(a.folder,e)),r.peer[e]=r.peer[e].filter(unique).sort(asc),c||u?r.mrs=r.mrs.filter(unique).sort(Qt):(0===l.countUnread&&(r.folder.unread=r.folder.unread.filter((function(t){return t!==e}))),r.folder.all=r.folder.all.filter(unique).sort(Qt),r.folder.unread=r.folder.unread.filter(unique).sort(Qt),i.groupId&&(r.folder.unrespond=r.folder.unrespond.filter(unique).sort(Qt))),"mrs"===i.page?(a.mrs=a.mrs.filter(unique).sort(Qt),b.default.redrawMRs()):"important"===i.folder?((0,o.arrayRemove)(a.folder,t),b.default.redrawFolder()):"all"===i.folder||"business_notify"===i.folder?(a.folder=a.folder.filter(unique).sort(Qt),b.default.redrawFolder()):"unread"===i.folder?(0===s[e].countUnread&&(0,o.arrayRemove)(a.folder,e),a.folder=a.folder.filter(unique).sort(Qt),b.default.redrawFolder()):"unrespond"===i.folder&&(a.folder=a.folder.filter(unique).sort(Qt),b.default.redrawFolder())}function Me(e){var t=store.mail,n=t.peers,i=t.cur;if(n[e]){var o=(0,T.getKeyboardState)(e);if(!(Date.now()-o.updateTime<=500)){var a=o.updateTime;(0,Y.ajaxRequest)("/mail",{act:"get_peers",peer_ids:[e]},(function(t){a===o.updateTime&&(storeMethods.injectMail(t),e==i.peerId&&v.default.renderKeyboardIfNeeded({update:!0}))}))}}}function Pe(e,t){var n=store.mail.peers[e];n&&(n.isImportant=t),h.default.redrawImportant(e,t)}function Le(e){(0,Y.ajaxRequest)("/mail",{act:"get_peers",peer_ids:[e]},(function(t){storeMethods.injectMail(t),h.default.updateAdTag(e)}))}function Ne(e,t){var n=store.mail,i=n.rolls,o=n.peers,a=n.scraps,r=n.cur,s=o[e];if(s){s.isMarkedUnread=t;var l=function(n){return t?n.concat(e):n.filter((function(t){return t!==e}))};if(i.folder.unread=l(i.folder.unread).filter(unique).sort(Qt),"unread"===r.folder){var c=a.folder.slice();a.folder=l(a.folder).filter(unique).sort(Qt),b.default.redrawFolder(c)}h.default.redrawUnread(e)}}function Re(e){var t,n=e.showOnlyNotMuted?e.countNotMuted:e.count;nav.getQuery("community")||(t=n,setNotify(t),menu.refreshSingleCounter(E.COUNTERS_POS_MESSAGES,t)),(0,K.setUnreadCountFromEvent)(e),g.default.redrawCounter(),g.default.setBusinessNotifyCount(e.businessNotifyUnread),C.default.redrawBusinessNotifyHint(),Hn(n),navigator.setAppBadge&&navigator.setAppBadge(n)}function xe(e){U.SAKIntegration.isIntegrated&&U.SAKIntegration.sendMessage("incoming_call",e)}function Be(){im.pause(),qe((function(){im.resume()}))}function De(e,t){(0,Q.setIsNewPeer)(e,t,store.mail)}function Oe(e,t,n,i){void 0===i&&(i={}),function(e,t,n){void 0===n&&(n={});if(store.mail&&store.mail.cur&&"msg"!==store.mail.cur.page&&store.mail.cur.peerId!==e)return;switch(n.type){case"show_snackbar":if(n.text){var i=store.mail.members[t],o=(store.mail.peers[e],!1);e>2e9&&i&&(o=i.avatar),Snackbar.init({position:_.SNACKBAR_POSITION_MAIL,text:(0,I.emojiToHTML)(htsc(n.text)),avatar:o,avatar_position:"left"})}break;case"open_app":var r=makeUrl("/app"+n.app_id,{from:nav.cur.slice(1)});nav.hard_go(r+"#"+n.hash);break;case"open_link":var s=(0,F.wrapAwayIfExternal)(n.link,!0),l=store.mail.members[t],c=(0,$.parseURL)(n.link),u=c.host||c.hostname||s;u.startsWith("xn--")&&(u=p.default.toUnicode(u));var d=a.default.elem((0,V.default)({scrollable:!0,header:{title:lang.mobile_mail_callback_popup_title},content:[a.default.wrap(lang.mobile_mail_callback_popup_text.replace("{name}",l.name).replace("{domain}",u)),{class:"Popup__buttons",inner:(0,q.BtnStack)({inner:[(0,j.default)({inner:[lang.mobile_open],on_click:"Popup.close(this);",use_native_onclick:!0,theme:"regular",url:s,open_in_new_tab:!0}),(0,j.default)({inner:[lang.mobile_cancel],on_click:"Popup.close(this);",use_native_onclick:!0,theme:"secondary"})]})}]}));V.default.open(d,!0)}}(t,n,i),(0,T.stopCallbackButtonWaiting)(e)}function Ue(e){Date.now()-oe<=500||(0,Y.ajaxRequest)("/mail",{act:"get_peers",peer_ids:[e]},(function(t){var n=store.mail.cur;storeMethods.injectMail(t),e==n.peerId&&C.default.redrawBanner()}))}function He(e,t){im.pause(),(0,Y.ajaxRequest)("/mail",{act:"get_peers",peer_ids:[t]},(function(n){(0,T.replacePeer)(e,t),storeMethods.injectMail(n);var i=store.mail.cur;e===i.peerId?(b.default.redrawFolder(),t===i.peerId?Ze(t):Ge("/mail?act=show&peer="+t,{replace:!0})):i.folder&&b.default.redrawFolder(),im.resume()}))}function Fe(e,t,n){var i=store.mail,a=i.cur,r=i.peers;if(a){var s=r[e];s&&(t===a.userId&&(s.isAdmin=n),n&&!(0,o.arrayContains)(s.adminIds,t)?s.adminIds.push(t):!n&&(0,o.arrayContains)(s.adminIds,t)&&(0,o.arrayRemove)(s.adminIds,t))}}function Ve(e,t){var n=store.mail,i=n.cur,a=n.rolls,r=n.scraps;i&&("created"!==t&&ne||("created"===t&&ne&&(ne=!1),"created"===t?$e(e,(function(t,n){(0,T.removePeer)(e),storeMethods.injectMail(t),i.countMR=n,store.mail.mrs&&(a.mrs=a.mrs.concat(e).filter(unique).sort(Qt)),i.folder&&(b.default.redrawFolder(),C.default.redrawMRsHint(),C.default.redrawBusinessNotifyHint()),i.peerId===e&&Ze(e)})):"canceled"===t||"rejected"===t?$e(e,(function(t,n){(0,T.removePeer)(e),storeMethods.injectMail(t),i.countMR=n,store.mail.mrs&&(0,o.arrayRemove)(a.mrs,e),i.folder&&(b.default.redrawFolder(),C.default.redrawMRsHint(),C.default.redrawBusinessNotifyHint()),i.peerId===e?Ze(e):"mrs"===i.page&&((0,o.arrayRemove)(r.mrs,e),b.default.redrawMRs())})):"accepted"===t&&$e(e,(function(t,n){(0,T.addPeer)(e),storeMethods.injectMail(t),i.countMR=n,store.mail.mrs&&(0,o.arrayRemove)(a.mrs,e),i.folder&&(b.default.redrawFolder(),C.default.redrawMRsHint(),C.default.redrawBusinessNotifyHint()),i.peerId===e?Ze(e):"mrs"===i.page&&((0,o.arrayRemove)(r.mrs,e),b.default.redrawMRs())}))))}function je(e,t){var n=store.mail.peers[e];if(t){var i=n&&n.groupCall,o=i&&i.updateTime||0,a=Date.now()-o<=500;i&&a||(0,Y.ajaxRequest)("/mail",{act:"get_peers",peer_ids:[e]},(function(e){storeMethods.injectMail(e)}))}else n&&(n.groupCall=void 0)}function $e(e,t){im.pause(),(0,Y.ajaxRequest)("/mail",{act:"mrs_get_peer",peer_id:e},(function(e,n){t(e,n),im.resume()}))}function qe(e){var t=store.mail,n=t.cur,i=t.msgs,o=t.scraps,a=t.rolls;a.folder[n.folder]=[],o.folder=[],C.Messenger.setMainLoading(!0),(0,Y.ajaxRequest)("/mail",{act:"all"===n.folder?null:n.folder,offset:0},(function(t,r){if(store.mail.cur){storeMethods.injectMail(t),"all"!==n.folder&&"unread"!==n.folder&&"business_notify"!==n.folder||Object.keys(t.msgs).forEach((function(e){e=toInt(e);var n=t.msgs[e].peerId;a.peer[n]=(a.peer[n]||[]).concat(e).filter((function(e){return!!i[e]})).filter(unique).sort(asc)}));var s="important"===n.folder,l=s?desc:Qt,c=Object.keys(s?t.msgs:t.peers).map(toInt).sort(l).filter((function(e){return-1===o.folder.indexOf(e)})),u=[].concat(c).filter(unique).sort(l);a.folder[n.folder]=u,o.folder=first(20,u),store.mail.reached.folder[n.folder]=r,b.default.redrawFolder(),C.default.redrawRecommendContacts(),C.default.redrawMRsHint(),C.default.redrawBusinessNotifyHint(),g.default.redraw(),C.Messenger.setMainLoading(!1),e&&e()}}))}function We(){"/mail"!==location.pathname&&0!==location.pathname.indexOf("/write")||hn()}function Ge(e,t){void 0===t&&(t={});var n=ze(e);return e=makeUrl(e),n&&location.pathname+location.search!==e&&nav.go(e,!1,{push_only:!0,replace:!0===t.replace}),n}function Ye(){Ge("/mail?q="+store.mail.cur.query+"&tab=messages")}function Ke(e){var t=Ke;if(t.timer&&clearTimeout(t.timer),store.mail.cur){var n=store.mail.cur,i=!n.query;if(e){var o="msgs"===n.tab?"&tab=messages":"",a=makeUrl("/mail?q="+e+o);ze(a),i?Ge(a):t.timer=setTimeout((function(){Ge(a,{replace:!0})}),300)}else Ge("/mail",{replace:!0})}}function Qe(){C.Messenger.setMainLoading(!1),C.Messenger.setConvoLoading(!1),Ke.clearTimer(),Ge("/mail",{replace:!0})}function ze(e){var t=(e=makeUrl(e)).split("?"),n=t[0],i=qs2obj(t[1]),o=store.mail,r=o.cur,s=o.scraps,l=o.peers;if(r){var c=i.act,u=i.peer,d=i.chat,_=i.email,f=i.m,p=toInt(i.msg)||toInt(i.id)||null,m="messages"===i.tab?"msgs":"peers",h=i.q||"",v=+i.community||0;if(Et())return Fn(n,i,e),!0;if(!(0,M.isNewMailPage)(n,i))return clog("[mail nav] Exit Mail"),void An();if((r.groupId?-r.groupId:0)===v){Fn(n,i,e),p&&(ie=!0),b.default.clearSystemMessage2();var g=u?toInt(u):d?toInt(d)+2e9:_?-toInt(_)-2e9:null,A="unread"===c||"important"===c||"unrespond"===c||"ad_tag"===c||"business_notify"===c?c:"all",w=function(e){switch(e){case"template":case"mrs":case"msg":return!0}return!1}(c),S=!w&&!!r.page,k=r.query!==h||r.tab!==m;r.page;if(function(){var e=store.mail.cur;if(e.peerId||e.page||e.query)return!1;return!0}()&&(0,T.saveFolderScroll)(r.folder,C.Messenger.getMainBody().scrollTop),S&&(r.page=null),k&&g&&("peers"===r.tab?store.mail.cur.mvk_entrypoint="conversations_search":"msgs"===r.tab&&(store.mail.cur.mvk_entrypoint="message_search")),r.peerId&&!g&&h)clog("[mail nav] Peer back to Search"),r.query=h,r.peerId=null,r.tab=m,et(),C.Messenger.setQuery(h),ot();else if(k&&r.peerId===g)r.query=h,r.tab=m,s.search=[],r.tab!==m&&(store.mail.reached.search.msgs={}),C.default.redrawView(),C.Messenger.setQuery(h),b.default.redrawSearch(),h?(clog("[mail nav] Search update"),ot()):(clog("[mail nav] Search exit"),function(){var e=store.mail,t=e.cur,n=e.scraps;t.query="",t.tab="peers",n.search=[],C.default.redrawView(),b.default.redrawSearch(),C.Messenger.setQuery("")}(),0===s.folder.length&&it());else if(w)clog("[mail nav] Enter Page: "+c),r.page=c,r.peerId&&(r.peerId=null,et()),r.backUrl=yn({peerId:g}),C.default.redrawView(),function(e){var t=store.mail.cur,n=C.Messenger.getPageLayer();"mrs"===t.page&&store.mail.mrs?(store.mail.scraps.mrs=store.mail.rolls.mrs.concat(),n.classList.toggle("messenger__layer_loading",!1),n.innerHTML=a.default.html((0,y.default)({count:t.countMR}))):(n.classList.toggle("messenger__layer_loading",!0),n.innerHTML=(0,C.Messenger_renderLoadingPage)(),(0,Y.ajaxRequest)(e,{},(function(e,t){t&&storeMethods.injectMail(t),n.classList.toggle("messenger__layer_loading",!1),n.innerHTML=e})))}(e);else{if(r.peerId&&r.peerId===g)return!0;r.peerId!==g||S&&g?g?(clog("[mail nav] Enter Dialog"),r.backUrl=yn({peerId:g}),Ze(g,p),l[g].isIncomingMR&&Z.messagingActionItemStatCollector.logEvent(g,ee.MessagingActionType.OPEN_MR)):(clog("[mail nav] Exit Dialog"),et(),Xe(A),it()):g&&f?(clog("[mail nav] Peer System Msg"),store.mail.peers[g].systemMessageCode=toInt(f),b.default.updateClass("peer"),b.default.redrawSystemMessage(),C.Messenger.scrollConvoToBottom()):(r.folder!==A||S&&A)&&(clog("[mail nav] Enter Folder"),Xe(A),it(),b.default.redrawEmpty("folder"))}return!0}}}function Xe(e,t){void 0===t&&(t={restoreScroll:!0});var n=store.mail,i=n.cur,o=n.scraps,a=n.rolls;i.folder=e,Je()?qe():(t.restoreScroll?o.folder=(a.folder[e]||[]).concat():o.folder=first(20,a.folder[e]),b.default.folderSetItems(o.folder),C.default.redrawView(),g.default.redraw()),(0,J.updateCounters)(location.href,document.referrer),t.restoreScroll?C.Messenger.getMainBody().scrollTop=(0,T.restoreFolderScroll)(e):C.Messenger.getMainBody().scrollTop=0}function Je(){var e=store.mail,t=e.rolls,n=e.cur,i=e.msgs,o=e.peers,a=t.folder[n.folder];return!a||("important"===n.folder?a.some((function(e){return!i[e]})):!("business_notify"!==n.folder||!a.some((function(e){var n=o[e],i=t.peer[e],a=i&&i.length;return n&&a&&n.minorSortId!==i[a-1]})))||a.some((function(e){return!(t.peer[e]&&t.peer[e].length>0)})))}function Ze(e,t){var n=store.mail,i=n.cur,a=n.msgs,r=n.peers,s=n.scraps,l=n.rolls,c=n.reached;if(Ln={},r[e]){var u=l.peer[e]||[];if(t||!(r[e].countUnread>1)||r[e].isIncomingMR||r[e].isRejectedMR){i.peerId=e,s.peer=[],zt(),t?(s.peer=[t],l.peer[e]=[],c.peer.before[e]=!1,c.peer.after[e]=!1):(s.peer=last(20,u),p()),store.mail.reached.peer.after[e]=!0,b.default.updateClass("peer"),C.default.redrawView(),C.Messenger.redrawConvoLayer(),rn(),g.default.startStatusUpdate(),f.default.checkStickers(),b.default.peerSetItems(s.peer),ue(),x.ready().then((function(){v.default.init()})),t||tt(e);var d=r[e];t&&(b.default.updateClass("peer"),C.default.scrollToMsg(t)),t?at(t):at(),(0,H.resizePosters)(),(0,J.updateCounters)(location.href,document.referrer),requestAnimationFrame((function(){t||(C.Messenger.scrollConvoToBottom(),x.ready().then((function(){C.Messenger.scrollConvoToBottom()}))),AudioMessagePlayer.redrawWaves(),requestAnimationFrame((function(){t||C.Messenger.scrollConvoToBottom()}))})),$n(e,store.mail.cur.viewerId),d.banner&&"birthday"===d.banner.name&&statlogsValueEvent("gifts_im_birthday_banner","view",e)}else{C.Messenger.setConvoLoading(!0),window._preventedCheckTop=!0,ie=!0,i.peerId=e,s.peer=[],zt(),h.default.redrawUnread(e),C.default.redrawView(),C.Messenger.redrawConvoLayer(),rn(),g.default.startStatusUpdate(),p(),b.default.peerSetItems([]),ue(),x.ready().then((function(){v.default.init()}));var _={act:"show",peer_id:e,msg:"unread",reply_msg_id:i.msgReply[i.peerId]};(0,Y.ajaxRequest)("/mail",_,(function(t,n,i){if(store.mail.cur){var r=t.rolls.peer[e];if(storeMethods.injectMail(t),c.peer.after[e]=n,c.peer.before[e]=i,u=l.peer[e]||[],((0,o.arrayIntersects)(r,u)||n&&0===u.length)&&(l.peer[e]=u.concat(r).filter(unique).sort(asc)),store.mail.cur.peerId===e){v.default.preventShowToBottom(),s.peer=r.slice(),geByClass1("mailScrap__items_peer").innerHTML="",b.default.updateClass("peer"),b.default.peerSetItems(r),AudioMessagePlayer.redrawWaves(),tt(e),$n(e,store.mail.cur.viewerId);var d=r.find((function(e){return a[e].isUnread}));C.default.scrollToMsg(d,!0,!1),requestAnimationFrame((function(){window._preventedCheckTop=!1,ie=!1,C.Messenger.setConvoLoading(!1)}))}}}))}}else(0,Y.ajaxRequest)("/mail",{act:"get_peers",peer_ids:[e]},(function(n){storeMethods.injectMail(n),r[e]?Ze(e,t):window.location.reload()}));function p(){i.forwardFromId&&(Ut(),i.forwardFromId=null)}}function et(e){void 0===e&&(e={});var t=store.mail,n=t.cur,i=t.scraps;g.default.cancelStatusUpdate(),dn(),n.peerId=null,n.mvk_entrypoint="",i.peer=[],zt(),n.hasAttachments=!1,e.keepSelected||(n.msgSelected={}),C.default.redrawView(),g.default.redraw(),v.default.reset(),C.Messenger.cleanConvoBody(),ce(),requestAnimationFrame((function(){s.default.setCount(0),C.default.redrawMailActions(),w.default.redraw(),requestAnimationFrame((function(){b.default.peerSetItems(i.peer)}))}))}function tt(e){B.addAction("read_dialog"+e,(function(){!function(e){var t=store.mail.peers;if(!t)return;var n=t[e];if(n&&(n.isIncomingMR||n.isRejectedMR))return;!n||n.countUnread>0||n.isMarkedUnread?(0,Y.ajaxRequest)("/mail",{act:"read_dialog",peer_id:e,mark_conversation_as_read:n.isMarkedUnread,hash:n.hashRead},(function(){bt(null,e)})):setTimeout((function(){bt(null,e)}),500)}(e)}))}function nt(e,t){B.addAction("read_dialog"+t,(function(){!function(e,t){var n=store.mail.peers;if(!n)return;bt(null,t),(0,Y.ajaxRequest)("/mail",{act:"read_message",msg_id:e,peer_id:t,hash:n[t].hashRead},(function(){}))}(e,t)}))}function it(){var e=it,t=e.locked||(e.locked={}),n=store.mail,i=n.cur,o=n.scraps,a=n.rolls,r=n.reached,s=i.folder,l=o.folder,c=a.folder[s]||[],u="folder_"+s,d=r.folder[s]&&last(l)===last(c);if(C.Messenger.setMainLoading(0===l.length&&!d),!t[u]&&!d){var _="important"===s,f=Je(),p=_?desc:Qt,m=[];if(0===l.length)m=first(20,c);else{var h=c.indexOf(last(l));m=h>=0?c.slice(h+1,h+20+1):[]}if(m.length&&!f){var v=l.concat(m).filter(unique).sort(p);o.folder=v,b.default.folderAddItems(m)}else{t[u]=!0;var A="all"===s?null:s,y=f||l.length<20?0:l.length;(0,Y.ajaxRequest)("/mail",{act:A,offset:y},(function(e,n){if(store.mail.cur){storeMethods.injectMail(e),Object.keys(e.peers).forEach((function(e){store.mail.reached.peer.after[e]=!0})),"all"!==s&&"unread"!==s&&"business_notify"!==s||Object.keys(e.msgs).forEach((function(t){t=toInt(t);var n=e.msgs[t].peerId;a.peer[n]=(a.peer[n]||[]).concat(t).filter(unique).sort(asc)}));var d=Object.keys(_?e.msgs:e.peers).map(toInt).sort(p).filter((function(e){return-1===l.indexOf(e)})),m=c.concat(d).filter(unique).sort(p);a.folder[s]=m,n&&(r.folder[s]=n),t[u]=!1,i.folder===s&&(o.folder=m,b.default.updateClass("folder"),y>0?b.default.folderAddItems(d):b.default.redrawFolder(),C.Messenger.setMainLoading(!1),f&&(b.default.folderSetItems(o.folder),C.default.redrawView(),g.default.redraw()))}}))}}}function ot(){var e=ot,t=e.locked||(e.locked={}),n=store.mail,i=n.cur,o=n.scraps,a=n.rolls,r=n.reached,s=i.tab,l=i.query,c="search_msgs_"+s+"_"+l,u=o.search,d=a.search[s][l]||[],_=r.search[s][l]&&last(u)===last(d);if(C.Messenger.setMainLoading(0===u.length&&!_),!t[c]&&!_){var f=[];if("peers"===s&&(d.length||(d=function(){var e=store.mail,t=e.cur,n=e.peers,i=(e.rolls,Object.keys(n).map(toInt)),o=QuickSearch.getQueryREs(t.query),a=[];return o.forEach((function(e){i.forEach((function(t){n[t].title.match(e)&&a.push(t)}))})),a.filter(unique).sort(Qt)}()),d.length))if(0===u.length)f=first(20,d);else{var p=d.indexOf(u);f=p>=0?d.slice(p+1,p+41):[]}if(f.length&&(o.search=u.concat(f).filter(unique).sort(Qt),b.default.redrawSearch(),b.default.updateClass("search"),C.Messenger.setMainLoading(!1)),!f.length||"peers"===s){var m="msgs"===s?{act:"search",q:l,offset:o.search.length,messages:1}:{act:"search",q:l};e.timer&&clearTimeout(e.timer),e.timer=setTimeout((function(){t[c]=!0,(0,Y.ajaxRequest)("/mail",m,(function(e,n){if(store.mail.cur){t[c]=!1,storeMethods.injectMail(e);var u=Object.keys("peers"===s?e.peers:e.msgs).map(toInt),_="peers"===s?Qt:desc,f=d.concat(u).filter(unique).sort(_);a.search[s][l]=f,n&&(r.search[s][l]=n),i.tab===s&&i.query===l&&(C.Messenger.setMainLoading(!1),o.search=o.search.concat(u).filter(unique).sort(_),b.default.redrawSearch(),b.default.updateClass("search"))}}))}),300)}}}function at(e){if(!(0,m.$)(".load_before_closed")){var t=at,n=t.locked||(t.locked={}),i=store.mail,a=i.cur,r=i.scraps,s=i.rolls,l=i.reached,c=i.flags,u=i.peerProfileTags,d=i.peers;if(a){var _=a.peerId,f=r.peer,p=s.peer[_]||[],h="peer_before_"+_,A=l.peer.before[_]&&f[0]===p[0],y=a.msgReply[_],w=!!d[_].actionUrls;if(C.Messenger.setConvoLoading(f.length<1&&!A),!(n[h]||A&&w)){var S=C.Messenger.getConvoBody(),k=!(0,o.arrayIntersects)(f,p),E=first(f),I=E?p.indexOf(E):-1,T=0===f.length?last(10,p):I>=0?p.slice(I-20,I):[];if(T.length&&!e){if(S.scrollTop>6e3&&!k)return;if(window._preventedCheckTop)return;var P=r.peer.slice(),L=f.concat(T).filter(unique).sort(asc);r.peer=L,b.default.peerAddItemsBefore(T.filter((function(e){return-1===P.indexOf(e)}))),AudioMessagePlayer.redrawWaves(),b.default.updateClass("peer"),C.Messenger.setConvoLoading(!1)}else{if(!_)return;var N={act:"show",peer_id:_,msg:f[0],direction:e?"around":"before",reply_msg_id:y},R=f[0];n[h]=!0,(0,Y.ajaxRequest)("/mail",N,(function(t,i,a){if(store.mail.cur){e&&setTimeout((function(){ie=!1}),10);var d=store.mail.peers[_],m=t.peers[_];c.isPeerProfileEnabled&&(0,M.isUser)(_)&&(d.peerProfileData=m.peerProfileData,C.Messenger.renderMessengerPeerProfile({tags:u,tagsData:m.peerProfileTagsData,data:m.peerProfileData})),n[h]=!1,d.actionUrls=m.actionUrls;var A=(0,Q.isNewPeer)(_,t);t.peers=[],storeMethods.injectMail(t),(0,Q.setIsNewPeer)(_,A,store.mail);var y=Object.keys(t.msgs).map(toInt).filter((function(e){return-1===f.indexOf(e)})),w=f.concat(y).filter(unique).sort(asc);if(a&&(l.peer.before[_]=!0),i&&(l.peer.after[_]=!0),p=s.peer[_]||[],((0,o.arrayIntersects)(w,p)||a&&0===p.length)&&(s.peer[_]=(s.peer[_]||[]).concat(w).filter(unique).sort(asc)),store.mail.cur.peerId===_){if(v.default.preventShowToBottom(),S.scrollTop>6e3&&!k)return;var E=r.peer.slice();r.peer=w,b.default.updateClass("peer"),R?(b.default.peerAddItemsBefore(y.filter((function(e){return-1===E.indexOf(e)&&e<R})),!0),b.default.peerAddItemsAfter(y.filter((function(e){return-1===E.indexOf(e)&&e>R})),!0)):b.default.peerAddItemsBefore(y,!0),e&&(C.default.scrollToMsg(e),C.Messenger.setConvoLoading(!1)),AudioMessagePlayer.redrawWaves(),y.forEach((function(e){CasperTimer.init(e)})),C.Messenger.setConvoLoading(!1),null!=t.flags.stickersAutoplay&&StickersSettings.setAutoplay(t.flags.stickersAutoplay),C.default.expandPeerBefore(),setTimeout(C.default.expandPeerBefore,100),e&&Ut(),g.default.redrawActions(),v.default.redrawReply(),A&&v.default.updateNewConvoStickersHint(!0)}}}))}}}}}function rt(){var e=rt,t=e.locked||(e.locked={}),n=store.mail,i=n.cur,a=n.scraps,r=n.rolls,s=n.reached;if(!ie&&i){var l=i.peerId,c=a.peer,u=r.peer[l]||[],d="peer_after_"+l;if(!(t[d]||s.peer.after[l]&&last(c)===last(u))){var _=C.Messenger.getConvoBody(),f=!(0,o.arrayIntersects)(c,u),p=function(){return _.scrollHeight-_.scrollTop-_.offsetHeight},m=last(c),h=m?u.indexOf(m):-1,g=h>=0?u.slice(h+1,h+21):[];if(!g.length||nav.getQuery("msg")||nav.getQuery("id")){if(!l)return;var A={act:"show",peer_id:l,msg:last(c),direction:"after"};t[d]=!0,(0,Y.ajaxRequest)("/mail",A,(function(e,n){if(store.mail.cur){t[d]=!1;var i=(0,Q.isNewPeer)(l,e);e.peers=[],storeMethods.injectMail(e),(0,Q.setIsNewPeer)(l,i,store.mail);var _=Object.keys(e.msgs).map(toInt).filter((function(e){return-1===c.indexOf(e)})).sort(asc),m=c.concat(_).filter(unique).sort(asc);if(n&&(s.peer.after[l]=n),u=r.peer[l]||[],((0,o.arrayIntersects)(m,u)||n&&0===u.length)&&(r.peer[l]=(r.peer[l]||[]).concat(m).filter(unique).sort(asc)),store.mail.cur.peerId===l){if(p()>6e3&&!f)return;n&&b.default.updateClass("peer"),a.peer=m,b.default.updateClass("peer"),b.default.peerAddItemsAfter(_),AudioMessagePlayer.redrawWaves(),i&&v.default.updateNewConvoStickersHint(!0)}}}))}else{if(p()>6e3&&!f)return;var y=c.concat(g).filter(unique).sort(asc);a.peer=y,b.default.peerAddItemsAfter(g),b.default.updateClass("peer"),AudioMessagePlayer.redrawWaves()}}}}Ke.clearTimer=function(){var e=Ke;e.timer&&(clearTimeout(e.timer),e.timer=null)};var st=!1;function lt(e){var t=store.mail,n=t.cur,i=t.scraps,o=t.rolls,a=t.reached,r=e.scrollTop,s=e.scrollHeight,l=e.offsetHeight;if(n){var c=n.folder,u=i.folder,d=o.folder[c],_=!(a.folder[c]&&last(u)===last(d))&&l+20>=s;if(!n.query&&r<=20&&i.folder.length&&!_){if(st){st=!1;i.folder.slice();i.folder=first(20,o.folder[n.folder]),b.default.folderCutItems(20)}}else(r>20||_)&&(st=!0,s-r-l<window.innerHeight&&(n.query?ot():c&&it()))}}function ct(){var e=store.mail,t=e.cur,n=e.scraps,i=e.rolls,o=e.reached,a=n.peer,r=i.peer[t.peerId]||[];if(r.length&&last(a)===last(r)&&o.peer.after[t.peerId])C.Messenger.scrollConvoToBottom(),v.default.hideToBottom(),b.default.updateClass("peer");else{var s=t.peerId,l={act:"show",peer_id:s};(0,Y.ajaxRequest)("/mail",l,(function(e,t){if(store.mail.cur){var a=e.rolls.peer[s];i.peer[s]=a.slice(),storeMethods.injectMail(e),o.peer.after[s]=!0,store.mail.cur.peerId===s&&(v.default.preventShowToBottom(),n.peer=a.slice(),geByClass1("mailScrap__items_peer").innerHTML="",b.default.peerAddItemsBefore(a),b.default.updateClass("peer"),C.Messenger.scrollConvoToBottom(),AudioMessagePlayer.redrawWaves())}}))}}function ut(e){var t=ut;t.timer||(t.timer=setTimeout((function(){t.timer=null,function(e){var t=store.mail,n=t.cur,i=t.scraps,o=t.msgs,a=t.peers;if(!n)return;var s=i.peer.find((function(e){return o[e]&&o[e].isUnread&&o[e].authorId!==n.viewerId})),l=e.scrollTop,c=e.scrollHeight-l-e.offsetHeight;if(s){var u=r.default.getElem(s);c-(e.scrollHeight-u.offsetTop)<=100&&tt(n.peerId)}e._prevScroll||(e._prevScroll=0),c<300&&(0,m.$)(".mailScrap_reachedAfter")?v.default.hideToBottom():l>e._prevScroll-5||n.peerId&&a[n.peerId].countUnread?v.default.showToBottom():v.default.hideToBottom();e._prevScroll=l}(e)}),50))}function dt(e){for(var t=0,n=e.attaches.length;t<n;t++){if("sticker"===e.attaches[t].type)return!1}var i=store.mail.cur;return i.userId===e.peerId&&!i.groupId||e.isOut}function _t(e,t){var n,i=e.peerId,o=e.id,a=e.authorId,r=e.attaches,s=e.adminId,l=e.isService,c=e.isStealth,u=e.isOut,d=e.keyboard,_=e.ttl,f=e.ts,p=e.text,m=store.mail,h=m.peers,v=m.members,A=m.cur,y=m.rolls,w=h[i]&&h[i].pinnedMsgId===o,S=(0,M.getMsgSendId)(e),b=(0,T.getPendingMsg)(S,i),E=!(!b&&!e.replaced),I=A.peerId===i&&!y.peer[i].length;if(U.SAKIntegration.isIntegrated&&U.SAKIntegration.sendMessage("add_msg",{peerId:i,attaches:r,title:h[i]?h[i].title:""}),b)R.mark(S,"opt_to_lp"),n=function(e){return!!e.length}(r);else{var P=!!h[i],L=l||r.length||w||e.hasTemplate,N=!v[a]||s&&!v[s];n=P?L||N:!c}if(b){var B=function(e){var t=store.mail.cur;if((0,T.removePendingMsg)(e),x.remove(e.sendId,"silent"),t.peerId&&-1===e.sendId.indexOf("edit"))return k.getMsg(e)}(b),O=Object.assign({},b,{id:o,failed:!1,pending:!1,waiting:!0,sendId:void 0,canEdit:dt(e),ts:f,ttl:_,text:pt(p)});if(storeMethods.injectMsg(O),ft(O,{existingElem:B},t),I&&g.default.redrawActions(),!n)return void R.clean(S)}if(!d||!d.inline){if((d||n)&&!u&&!e.edited)(0,T.getKeyboardState)(i).updateTime=Date.now();!d||n||u||e.edited||function(e){var t=e.peerId,n=e.authorId,i=e.msgId,o=e.keyboard,a=store.mail.peers[t];(0,T.clearCallbackButtons)(t),a&&(a.keyboard=(0,M.prepareKeyboard)({keyboard:o,authorId:n,msgId:i}))}({peerId:i,authorId:a,msgId:o,keyboard:d})}if(!b&&!n){var H=function(e){var t,n=e.peerId,i=e.id,o=e.authorId,a=e.isOut,r=e.text,s=e.ts,l=e.flags,c=e.adminId,u=e.isService,d=e.ttl,_=e.isExpired,f=store.mail,p=f.cur,m=f.peers,h=f.msgs,v=f.members,g=m[n],A=(0,M.formatTime)(s,p.timeShift),y=h[i],w="";r&&(w=r.replace(/<br>/g,"\n").replace(M.MENTION_DOMAIN_REGEXP,"@$3").replace(M.MENTION_REGEXP,"@$1 ($3)"));t=e.replaced?!!y&&y.edited:!!e.edited;var S=r,b=pt(r,l),k=e.keyboard;k=k&&k.inline?(0,M.prepareKeyboard)({keyboard:k,authorId:o,msgId:i}):null;var C=a?i>g.outReadUpToId:i>g.inReadUpToId,E={id:i,peerId:n,authorId:o,ts:s,date:A,dateShort:A,text:b,textInput:w,body:S,isUnread:C,edited:t,canEdit:dt(e),isOut:a,isService:u,keyboard:k,attaches:{},forwards:[],hasReply:!!e.hasReply,ttl:d,isExpired:Boolean(_)};c&&(E.adminName=c===p.userId?lang.mobile_mail_you:v[c].name,E.adminUrl=v[c].url);return E}(e);return storeMethods.injectMsg(H),ft(H,{isReplace:E},t),void(I&&g.default.redrawActions())}im.pause(),D.loadMessage({msgId:o,forcePinned:w,onTryError:function(e){var t=e.type;S&&(R.error(S,"server_load_attach",t),R.clean(S))},onResult:function(e){var n=e[0],a=e[1];(S&&(R.mark(S,"attach"),R.clean(S)),store.mail.cur)&&(storeMethods.injectMail(n),a&&function(e,t){var n=t.unpin,i=t.pinned,o=store.mail,a=o.cur,r=o.peers;if(n){r[e].pinnedMsg="",r[e].hasPinnedMsg=!1;var s=cn();delete s[e],un(s),a.peerId===e&&(C.default.redrawPinnedMsg(),rn())}else i&&(r[e].pinnedMsg=i,r[e].hasPinnedMsg=!0,a.peerId===e&&(C.default.redrawPinnedMsg(),rn()))}(i,a),ft(n.msgs[o],{isServerMsg:!0,isReplace:E},t),I&&g.default.redrawActions(),im.resume())}})}function ft(e,t,n){var i=void 0===t?{}:t,a=i.isServerMsg,s=i.isReplace,l=i.existingElem,c=store.mail,u=c.cur,d=c.peers,_=c.rolls,p=c.scraps,A=c.reached,y=e.peerId,k=e.authorId,E=e.isOut,I=e.id,M=!E,P=d[y]&&0===d[y].countUnread&&M,L=s||!!e.edited,N=d[y],R=N.isIncomingMR,x=N.isRejectedMR,B=N.isBusinessNotify,D=C.Messenger.getConvoBody(),O=!1;e.isUnread&&(O=u.viewerId===y||u.peerId===y&&M&&D.scrollHeight-D.scrollTop-D.offsetHeight<400&&!!(0,m.$)(".mailScrap_reachedAfter")),O&&M&&!R&&!x&&nt(I,y);var U=d[y];if(n&&U&&(U.minorSortId=n),e.groupCall&&U&&U.groupCall&&(U.groupCall.updateTime=Date.now()),!L){var H=last(_.peer[y]||[]);_.peer[y]=(_.peer[y]||[]).concat(I).filter(unique).sort(asc),R||x||B||(_.folder.all=_.folder.all.concat(y).filter(unique).sort(Qt),A.peer.after[y]||(A.peer.after[y]=!0,A.peer.before[y]=!1));var F=d[y];if(M&&(y===u.peerId&&v.default.renderKeyboardIfNeeded({update:!0}),e.isUnread&&(R||x||B||(_.folder.unread=_.folder.unread.concat(y).filter(unique).sort(Qt)),a||(F.countUnread||(F.countUnread=0),F.countUnread+=1)),y===u.peerId&&v.default.redrawToBottom()),!R&&!x&&!B)if(P&&((0,K.addToUnreadCount)(1,F.isMuted),g.default.redrawCounter()),u.groupId&&(M?_.folder.unrespond=_.folder.unrespond.concat(y).filter(unique).sort(Qt):(0,o.arrayRemove)(_.folder.unrespond,y)),"all"===u.folder||"business_notify"===u.folder){var V=p.folder.slice();p.folder=p.folder.concat(y).filter(unique).sort(Qt),b.default.redrawFolder(V)}else if("unread"===u.folder&&k!==u.viewerId){var j=p.folder.slice();p.folder=p.folder.concat(y).filter(unique).sort(Qt),b.default.redrawFolder(j)}else if("unrespond"===u.folder){var $=p.folder.slice();M?p.folder=p.folder.concat(y).filter(unique).sort(Qt):(0,o.arrayRemove)(p.folder,y),b.default.redrawFolder($)}if(B&&"business_notify"===u.folder){var q=p.folder.slice();p.folder=p.folder.concat(y).filter(unique).sort(Qt),b.default.redrawFolder(q)}if(R&&(_.mrs=_.mrs.concat(y).filter(unique).sort(Qt),"mrs"===u.page)){var W=p.mrs.slice();p.mrs=p.mrs.concat(y).filter(unique).sort(Qt),b.default.redrawMRs(W)}if(u.peerId!==y||!(0,o.arrayIntersects)(p.peer,_.peer[y])&&0!==p.peer.length||last(p.peer)!==H)l&&l.remove();else{p.peer=p.peer.concat(I).filter(unique).sort(asc);var G=mt((function(){l?b.default.peerAddElemAfter(I,l):b.default.peerAddItemsAfter([I])}));M&&!G&&v.default.showToBottom(),k===u.viewerId&&b.default.removeDivider()}var Y=(0,S.uTyping_getPeerTyping)(y);Y&&Y.users.length&&((0,T.removePeerTypingUser)(y,k),y===u.peerId&&w.default.redraw(),h.default.redrawTyping(y))}var Q=I===(0,h.uConvo_getLastMsgId)(y);L&&((0,T.clearCallbackButtons)(y,I),Q?mt((function(){return b.default.peerReplaceItems([I])})):b.default.peerReplaceItems([I]),Object.keys(Ln).filter((function(e){return!!Ln[e]})).forEach((function(e){AudioMessagePlayer.toggleTranscription(null,(0,m.$)(".audio-msg-track__transcriptionButton",r.default.getElem(e)),!0)}))),Q&&(h.default.redrawLastMsg(y),h.default.redrawUnread(y),StickersAnimation.checkSettingsAndLoad(e.id)),CasperTimer.init(e.id),y===u.peerId&&$t(),e.attaches&&e.attaches.gift&&f.default.checkStickers({force:!0,ignore_hash:!0})}function pt(e,t){return void 0===t&&(t=0),e=(0,M.wrapLinks)(e,t),e=(0,M.wrapMention)(e),e=(0,I.emojiToHTML)(e)}function mt(e){var t=C.Messenger.getConvoBody(),n=t.scrollTop+t.offsetHeight>=t.scrollHeight-2;e();var i=t.scrollHeight-t.scrollTop-t.offsetHeight<400;return n&&C.Messenger.scrollConvoToBottom(),i}function ht(){if(store.mail.cur){var e=store.mail.cur.backUrl;if(store.mail.cur.backUrl=null,ce(),e)history.back();else Ge(function(){var e=store.mail.cur;return"mrs"===e.page?"/mail":"template"===e.page?"/mail?act=show&peer="+nav.getQuery("from"):(e.tab||e.peerId,"/mail")}(),{replace:!0})}}function vt(){var e=store.mail.cur,t=e.msgSelected,n=e.forwardFromId;e.forwardFromId=null,Object.keys(t).forEach((function(e){delete t[e]})),r.default.unselectAll(),C.default.redrawMailActions(),n&&Ze(n)}var gt={};function At(e,t,n){var i=store.mail,o=i.cur,a=i.peers,r=a?a[e]:null;if(r&&!r.isIncomingMR&&!r.isRejectedMR){var s=(0,T.filterPeerTypingUser)({type:"text",users:t,count:n},o.viewerId);(0,T.setPeerTyping)(e,s);var l=gt[e];l&&clearTimeout(l),s.count&&s.users.length&&(gt[e]=setTimeout((function(){gt[e]=null,At(e,[],0)}),7e3),kn(s.users,e)),e===o.peerId&&w.default.redraw(),h.default.redrawTyping(e)}}var yt={};function wt(e,t,n){var i=store.mail,o=i.cur,a=i.peers;if(a?a[e]:null){var r=(0,T.filterPeerTypingUser)({type:"audio",users:t,count:n},o.viewerId);(0,T.setPeerTyping)(e,r);var s=yt[e];s&&clearTimeout(s),r.count&&r.users.length&&(yt[e]=setTimeout((function(){yt[e]=null,wt(e,[],0)}),7e3),kn(r.users,e)),e===o.peerId&&w.default.redraw(),h.default.redrawTyping(e)}}function St(e){var t=e.userId,n=e.isOnline,i=e.onlinePlatform,o=e.lastActionTime,a=store.mail,r=a.cur,s=a.peers[t];if(s&&s.canSeeOnline&&(s.isOnline=n,e.isOnline&&(s.onlinePlatform=i),o&&(s.lastActionTime=o),h.default.redrawOnline(t),r.peerId===t&&g.default.redrawOnline()),r.recommendContacts&&r.recommendContacts.item_data[t]){var l=r.recommendContacts.item_data[t];l.online=n?1:0,l.online_info.is_online=n,l.online_info.is_mobile="mobile"===i,(0,A.redrawOnline)(t)}}function bt(e,t){var n=store.mail,i=n.cur,a=n.peers,s=n.msgs,l=n.scraps,c=n.rolls;if(i){var u=i.peerId===t?l.peer:[],d=c.peer[t]||[],_=a[t];if(d.concat(u).forEach((function(t){var n=s[t];n&&t<=e&&n.authorId!==i.viewerId&&(delete n.isUnread,r.default.markAsRead(t))})),_&&(_.inReadUpToId=e,_.countUnread&&((0,K.addToUnreadCount)(-1,_.isMuted),_.countUnread=0)),(0,o.arrayRemove)(c.folder.unread,t),"unread"===i.folder){var f=l.folder.slice();(0,o.arrayRemove)(l.folder,t),b.default.redrawFolder(f)}g.default.redrawCounter(),v.default.redrawToBottom(),h.default.redrawUnread(t)}}function kt(e,t){var n=store.mail,i=n.cur,o=n.msgs,a=n.peers,s=n.rolls,l=n.scraps,c=s.peer[t]||[],u=o[e],d=a[t];if(d&&(d.outReadUpToId=e),u)for(var _=c.indexOf(e);_>=0;){var f=o[c[_]];f.authorId===i.viewerId&&f.id<=e&&(delete f.isUnread,r.default.markAsRead(f.id)),_--}else last(c)&&e<=last(c)&&c.forEach((function(t){var n=o[t];n.authorId===i.viewerId&&n.id<=e&&(delete n.isUnread,r.default.markAsRead(n.id))}));i.peerId===t&&l.peer.forEach((function(t){var n=o[t];n.authorId===i.viewerId&&n.id<=e&&(delete n.isUnread,r.default.markAsRead(n.id))})),h.default.redrawUnread(t)}function Ct(){var e;if(Et())return!0;var t=store.mail.cur;if(t&&(t.backUrl=null),t&&t.forwardFromId)return vt(),!0;i.default.safari_mobile&&document.activeElement.blur();var n=qs2obj(location.search.slice(1)).act;if(!(0,m.$)(".uMessenger")&&"/mail"===location.pathname&&"show_medias"!==n)return nav.go(location,null,{no_push:!0,need_restore:!1}),!0;var o=new RegExp(/z=photo/).test(location.search);if((0,m.$)(".uMessenger")&&!o&&!ge("z_photoview")&&!ge("StoriesView")&&!(null==(e=(0,te.getMediaView)())?void 0:e.mediaViewManager.opened)){var a=ze(location.pathname+location.search);return a&&nav.go(location.pathname+location.search,null,{no_push:!0,push_only:!0}),a}}function Et(){var e=Et;if(mediaUpload.isUploading)return e.noAlert||alert(unescapeAttr(lang.mobile_mail_wait_until_uploaded)),e.noAlert=!0,setTimeout((function(){e.noAlert=!1}),10),!0}function It(e,t,n,i){void 0===i&&(i={});var o=store.mail.cur;if(U.SAKIntegration.isIntegrated&&!t._sak_embed_force){if(!U.SAKIntegration.isNewMail)return jn(t),U.SAKIntegration.sendMessage("nav",{isNewMail:(0,M.isNewMailPage)(e,t),path:e,query:t,url:n}),!0;if(!(0,M.isNewMailPage)(e,t))return jn(t),U.SAKIntegration.sendMessage("nav",{isNewMail:!1,path:e,query:t,url:n}),o||setTimeout((function(){location.reload()})),!0}if(!("/mail"===n&&o&&o.groupId||i.replace))return!t.m&&geByClass1("uMessenger")?Ge(n):void 0}function Tt(){window.isNewMail&&(store.mail.cur?(0,M.isNewMailPage)(location.pathname,location.search)?hn():An():Ke.clearTimer())}function Mt(){var e=store.mail,t=e.cur,n=(e.msgs,e.peers),i=e.hash,o=t.msgSelected,a=toInt(Object.keys(o)[0]),s=n[t.peerId];t.hasAttachments=!1,t.msgSelected={},s.pinnedMsgId=a,s.hasPinnedMsg=!0,r.default.unselectAll(),C.default.redrawMailActions(),(0,Y.ajaxRequest)("/mail?act=pin",{hash:i.pin,chat:nav.getQuery("chat")||store.mail.cur.peerId-2e9,msg:a,_ajax:1})}function Pt(){var e,t=store.mail,n=t.cur,i=t.msgs,o=(t.peers,t.hash),a=(t.replies,t.pendingReplies,n.msgSelected),r=toInt(Object.keys(a)[0]),s=n.peerId,l=(0,T.getPeerDraft)(n.viewerId,n.peerId),c=i[r],u=function(e){c.hasReply||l&&l.editing&&l.editing.id==r&&l.msgs&&(n.msgAttached[s]=l.msgs),c.hasReply?n.msgReply[s]=c.reply:n.msgReply[s]=null,v.default.redrawReply(),v.default.onAttachedMsgsRemove(),v.default.uiRedrawAttachments(s),v.default.setModifiers({editing:!0}),g.default.setModifiers({editing:!0}),C.default.redrawMailActions(),Lt(),v.default.setText(e)};if(n.editing==r)return e=l&&l.editing&&l.editing.id==r?l.editing.text||"":c.textInput,void u(e);n.editing=r,_n(),(0,Y.ajaxRequest)("/mail?act=edit_message_start",{hash:o.edit,edit_msg_id:r,peerId:s,_ajax:1},(function(e,t){(0,T.pushPeerAttachments)(n.peerId,e),u(t)}))}function Lt(){var e=store.mail.cur.msgSelected;Object.keys(e).forEach((function(t){delete e[t]})),r.default.unselectAll(),s.default.setCount(0),C.default.redrawMailActions()}function Nt(){var e=store.mail,t=(e.msgs,e.cur),n=Object.keys(t.msgSelected).every(Rt);1!==Object.keys(t.msgSelected).length||n?l.default.open({canDeleteForAll:n}):Bt()}function Rt(e){var t=store.mail,n=t.msgs,i=(t.cur,t.peers),o=vk.id,a=n[e],r=nav.getQuery().community,s=i[a.peerId];return!!a&&(a.authorId!==o&&a.authorId!==-r?s.isAdmin&&-1===s.adminIds.indexOf(a.authorId):!(a.peerId===o&&!r)&&(333!==a.peerId&&(!(Date.now()/1e3-a.ts>86400)&&!(s.kicked||s.closed||s.unableToWrite||s.kickedMessage))))}function xt(){var e=store.mail.cur.editing;e?(!function(e){var t=store.mail,n=t.cur,i=(t.hash,t.msgs,t.peers),o=n.peerId,a=(0,Y.ajaxRequest)("/mail",{act:"delete_for_all",peer:o,ids:e+"",hash:i[o].hashRemove},(function(){})).promise;ke(e,a),C.default.redrawMailActions()}(e),dn(!0)):Bt(!1,l.default.isDeleteMessagesForAll()),l.default.close()}function Bt(e,t){void 0===e&&(e=!1),void 0===t&&(t=!1);var n=store.mail,i=n.cur,o=n.peers,a=i.peerId,s=i.msgRemoved,l=i.msgSelected,c=Object.keys(l),u=window.AudioMessagePlayer.getAttachedTrackPlayer(),d=0;if(u){var _=u.closest(".msg");d=_?r.default.getId(_):0}var f=(0,Y.ajaxRequest)("/mail",{act:t?"delete_for_all":e?"spam":"delete",peer:a,ids:c.join(","),hash:o[a].hashRemove},(function(){})).promise;c.forEach((function(n){(n=+n)===d&&window.AudioMessagePlayer.detachPlayer(),delete l[n],t?ke(n,f):(s[n]=!e||"spam",e?r.default.spam(n):r.default.remove(n))})),C.default.redrawMailActions()}function Dt(){Bt(!0)}function Ot(){var e=store.mail,t=e.cur,n=e.hash,i=e.msgs,o=t.msgSelected,a=Object.keys(o),s=a.some((function(e){return!i[e].isImportant}))?1:0;a.forEach((function(e){delete o[e],i[e].isImportant!=!!s&&(s?t.countImportant++:t.countImportant--),i[e].isImportant=!!s,r.default.toggleImportant([e],!!s)})),(0,Y.ajaxRequest)("/mail",{act:"mark_important",ids:a,hash:n.important,val:s},(function(){})),r.default.unselectAll(),C.default.redrawMailActions()}function Ut(){var e=store.mail.cur,t=e.peerId,n=Object.keys(e.msgSelected).map(toInt);e.msgAttached[t]=n,(0,T.setPeerDraft)(e.viewerId,e.peerId,{msgs:n,reply:void 0},e.editing),e.msgReply[t]&&!e.editing&&(0,Y.ajaxRequest)("/mail",{act:"reply_cancel",peer_id:store.mail.cur.peerId,hash:store.mail.hash.reply}),e.msgReply[t]=null,e.msgSelected={},r.default.unselectAll(),s.default.setCount(0),v.default.redrawReply(),v.default.uiRedrawAttachments(t),C.default.redrawMailActions()}function Ht(){var e=store.mail,t=e.cur,n=e.flags,i=e.pendingReplies,o=t.peerId;if(!(0,M.isContactPeer)(o)){if(!n.replies)return Ut();var a=toInt(Object.keys(t.msgSelected)[0]);t.msgReply[o]=a,i[a]=r.default.getReplyDataFromHTML(a),(0,T.setPeerDraft)(t.viewerId,t.peerId,{reply:a,msgs:void 0},t.editing),(0,Y.ajaxRequest)("/mail",{act:"reply_start",hash:store.mail.hash.reply,peer_id:store.mail.cur.peerId,msg_id:a}),t.msgAttached[o]=[],t.msgSelected={},r.default.unselectAll(),s.default.setCount(0),v.default.redrawReply(),v.default.uiRedrawAttachments(o),C.default.redrawMailActions(),v.default.openKeyboard("text")}}function Ft(){var e=store.mail.cur;if(e){var t=e.msgSelected,n=Object.keys(t);(0,M.isContactPeer)(e.peerId)||jt(n)&&(e.forwardFromId=e.peerId,e.query="",e.tab="peers",C.Messenger.setQuerySilently(""),et({keepSelected:!0}),Xe("all",{restoreScroll:!1}),it())}}function Vt(e){if(store.mail.cur){var t=store.mail,n=t.cur,i=t.peers,o=t.msgs,a=t.flags,r=n.msgRemoved,l=n.msgSelected,c=i[n.peerId];if(v.default.hideStickersPanel(),!r[e]){l[e]?delete l[e]:l[e]=!0;var u=Object.keys(l),d=u.length,_=1===d&&u[0]==i[n.peerId].pinnedMsgId,f=u.reduce((function(e,t){return e&&o[t].isImportant}),!0),p=u.some((function(e){return o[e].ttl}));s.default.setCount(d),s.default.setModifiers({pinned:_,important:f}),s.default.setLabels({pinned:_,important:f}),(0,M.isContactPeer)(n.peerId)?s.default.toggleQuickButtons(!1):s.default.toggleQuickButtons(!0),a.replies&&(1!==d||c.isIncomingMR?s.default.setReplyAvailable(!1):s.default.setReplyAvailable(!0));var m=toInt(Object.keys(l)[0]),h=1==d&&o[m];if(s.default.setEditAvailable(h&&h.canEdit&&!c.unableToWrite),s.default.setImportantAvailable(d>0&&n.viewerId>0),s.default.setForwardAvailable(jt(u)),c.canPin&&function(e){var t=store.mail.msgs[e];if(!t)return!1;return!t.noPin}(m)){var g=toInt(Object.keys(l)[0]);s.default.togglePin(1===d&&g!==c.pinnedMsgId)}else s.default.togglePin(!1);s.default.setForwardAvailable(!0),p&&(s.default.setImportantAvailable(!1),s.default.togglePin(!1),s.default.setForwardAvailable(!1)),C.default.redrawMailActions()}}}function jt(e){var t=store.mail.msgs;return 0===e.filter((function(e){return t[e]&&t[e].noForward})).length}function $t(){var e=store.mail.msgs;AudioMessagePlayer.redrawWaves(),Array.from($$(".im_msg_audiomsg")).map((function(e){return e.closest(".msg")})).forEach((function(t){var n,i=r.default.getId(t),o=e[i];if(t.classList.contains("msg_pending")&&(null==(n=o.attaches)?void 0:n.audiomsg)){var a=(0,m.$)(".pi_medias",t);a.isSameNode=function(){return!0},o&&(o.attachesHTML=a.outerHTML)}}))}function qt(e){var t=store.mail,n=t.cur,i=t.hash,o=t.msgs[e],a="spam"===n.msgRemoved[e]?"nospam":"restore";delete n.msgRemoved[e],r.default.restore(e),(0,Y.ajaxRequest)("/mail",{act:a,id:e,hash:i.restore},(function(){})),o.isImportant&&(n.countImportant++,Se(e)),b.default.redrawFolder()}function Wt(e){var t=store&&store.mail&&store.mail.cur;if(t&&e){var n=store.mail.msgs[e],i=!n;if((!n||n.peerId&&n.peerId===t.peerId)&&!t.msgRemoved[e])C.default.scrollToMsg(e)||(i=!0),i&&(0,Y.ajaxRequest)("/mail",{act:"get_msgs",msgs:[e]},(function(t){storeMethods.injectMail(t);var n=store.mail,i=n.msgs,o=n.cur;o.peerId&&i[e]&&!i[e].isDeletedForAll&&Ze(o.peerId,e)}))}}function Gt(e,t,n){var i=store&&store.mail&&store.mail.cur;if(i&&e){var o=store.mail.forwards[n];if(o.peerId&&o.peerId===i.peerId&&!i.msgRemoved[e])C.default.scrollToMsg(e)||(0,Y.ajaxRequest)("/mail",{act:"get_msgs",msgs:[e]},(function(i){storeMethods.injectMail(i);var o=store.mail,a=o.msgs,r=o.cur;r.peerId&&(!a[e]||a[e].isDeletedForAll?Yt(e,t,n):Ze(r.peerId,e))}));else Yt(e,t,n)}else Yt(e,t,n)}function Yt(e,t,n){var i=nav.getQuery();t&&"show"===i.act&&(i.msg=t,nav.go(location.pathname+obj2qs(i),!1,{replace:!0,push_only:!0}));var o=(0,M.isMessageWithoutLocalId)(t)?(0,r.Msg_makePinnedReplyLink)(i.chat,n):(0,r.Msg_makeReplyLink)(e,t,n);nav.go(o,null,{force:!0})}function Kt(e){var t,n=store.mail.cur;n&&jt([e])&&(n.msgSelected=((t={})[e]=!0,t),statlogsValueEvent("messages_channel_forward_click",0),Ft())}function Qt(e,t){var n=store.mail,i=n.rolls,o=n.presend,a=n.msgs,r=n.peers,s=i.peer[t]||[0],l=En(o.pending[e],(function(e){return-1===e.indexOf("edit")})),c=En(o.pending[t],(function(e){return-1===e.indexOf("edit")})),u=last(s),d=l&&o.msgs[l].ts||0,_=c&&o.msgs[c].ts||0;if(_||(_=u&&a[u].ts||0),d)return _-d;var f=r[e]&&r[e].majorSortId||0,p=r[t]&&r[t].majorSortId||0,m=r[e]&&r[e].minorSortId||0,h=r[t]&&r[t].minorSortId||0;return f!==p?p-f:h-m}function zt(){if(store.mail.cur){var e=!!store.mail.cur.peerId;$$(".vk__page_mail").forEach((function(t){return t.classList.toggle("messenger_noPullToRefresh",e)})),document.documentElement.classList.toggle("_messenger_noPullToRefresh",e)}}function Xt(){var e=store.mail.cur.peerId,t=(0,m.$)(".pinnedMsg");if(t){Number(t.dataset.id);var n=cn();delete n[e],un(n),rn()}}function Jt(){var e=store.mail.cur.peerId,t=(0,m.$)(".pinnedMsg");if(t){var n=Number(t.dataset.id),i=cn();i[e]=n,un(i),rn()}}function Zt(){var e=store.mail.cur.peerId,t=store.mail.hash;Ne(e,!0),(0,Y.ajaxRequest)("/mail",{act:"mark_dialog_as_unread",peer_id:e,hash:t.markDialogAsUnread},(function(t){t.error&&Ne(e,!1)})),ht()}function en(){var e=store.mail.cur.peerId,t=store.mail.hash;(0,Y.ajaxRequest)("/mail",{act:"pin_convo",peer_id:e,hash:t.pinDialog})}function tn(){var e=store.mail.cur.peerId,t=store.mail.hash;(0,Y.ajaxRequest)("/mail",{act:"unpin_convo",peer_id:e,hash:t.unpinDialog})}function nn(e){nav.go("/settings?act=business_notify&peer_id="+e)}function on(e,t){var n,i=store.mail,o=i.cur,a=i.peers[o.peerId],r=a.banner;if(void 0!==t){if(n=a.banner&&a.banner.buttons[t],"birthday"===r.name&&"gifts_link"===n.type&&statlogsValueEvent("gifts_im_birthday_banner","click",o.peerId),"message_request_banner"===r.name&&"reject_mr"===n.type)return void c.default.open();if("business_notify_banner"===r.name&&"business_notify"===n.type)return void(0,u.openBusinessNotifyDialog)()}(0,Y.ajaxRequest)("/mail",{act:"banner_callback",hash:a.hashBanner,peer_id:o.peerId,callback_data:n&&n.callback_data}),oe=Date.now(),a.banner=null,C.default.redrawBanner()}function an(e){var t=(0,m.$)(".messenger__banner_content");t&&t.classList.toggle("messenger__banner_contentExpanded")}function rn(){var e=store.mail,t=e.cur;e.peers;if(t){var n=t.peerId;if(n){var i=(0,m.$)(".pinnedMsg"),o=cn()[n],a=i?intval(i.dataset.id):null;C.default.setPinnedVisibility(a&&o!==a)}}}function sn(){var e=store.mail.cur;e&&e.peerId&&C.default.pinActionToggle()}function ln(){if(store.mail.cur&&store.mail.cur.peerId){var e=(0,m.$)(".pinnedMsg");if(e)if(!Number(e.dataset.id)){var t=store.mail.cur.peerId,n=cn();delete n[t],un(n)}}}function cn(){return lsGet("messenger.pinHidden")||{}}function un(e){lsSet("messenger.pinHidden",e)}function dn(e){var t=store.mail.cur;if(t&&t.editing){t.editing=!1,_n(),!0!==e&&(0,Y.ajaxRequest)("/mail?act=edit_message_cancel",{peerId:t.peerId}),(0,T.popPeerAttachments)(t.peerId),(0,T.setPeerDraft)(t.viewerId,t.peerId,{});var n=(0,T.getPeerDraft)(t.viewerId,t.peerId);t.msgAttached[t.peerId]=n.msgs||[],t.msgReply[t.peerId]=n.reply||null,v.default.setText(n&&n.text||""),v.default.setModifiers({editing:!1}),g.default.setModifiers({editing:!1}),v.default.uiRedrawAttachments(t.peerId),v.default.redrawReply();var i=C.Messenger.getConvoBody();i.scrollTop+i.offsetHeight>=i.scrollHeight-2&&C.Messenger.scrollConvoToBottom()}}function _n(){var e=nav.getQuery();store.mail.cur.editing?e.edit_msg_id=store.mail.cur.editing||void 0:delete e.edit_msg_id,nav.go(location.pathname+obj2qs(e),!1,{replace:!0,push_only:!0})}function fn(){if(store.mail.msgs){var e=+nav.getQuery("edit_msg_id");e&&store.mail.msgs[e]&&(store.mail.cur.msgSelected[e]=!0,Pt())}}function pn(e){var t=e.closest("."+r.default.class);if(t){var n=r.default.getId(t);store.mail.msgs[n].textFull=r.default.getTextHtml(t)}}function mn(e){Ge(e)}function hn(){if(store.mail.cur){if((store.mail.cur||store.mail.page)&&!store.mail.cur.peerId){ce();var e=C.Messenger.getMainBody();e&&lt(e)}store.mail.cur.peerId&&ue();var t,n,i=(0,W.getTimeFromStart)()-ajax.navStart;if((0,G.isNumber)(i)&&i>=50)statlogsValueEvent("mvk_mail_loading_time",i,store.mail.cur.folder,null==(t=store.mail.rolls.folder.all)?void 0:t.length);x.ready().then(bn).then((function(){Cn(),store.mail.cur.peerId&&(v.default.init(),bt(null,store.mail.cur.peerId)),nav.getQuery("msg")||nav.getQuery("id")||C.Messenger.scrollConvoToBottom()})),im.on(),B.start(),n=qs2obj(location.search.slice(1)),store.mail.cur.mvk_entrypoint=n.mvk_entrypoint||"notifications"===n.from&&"notifications"||"",C.default.startPolling(),addEvent(window,"resize",H.resizePosters),navigator.setAppBadge&&navigator.setAppBadge((0,K.getUnreadCount)()),N.onOpenCallback(xn),N.onCloseCallback(Bn),U.SAKIntegration.onMessage.on("embed",On),Hn((0,K.getUnreadCount)()),$n(store.mail.cur.peerId,store.mail.cur.viewerId),store.mail.cur.peerId&&store.mail.peers[store.mail.cur.peerId].isIncomingMR&&Z.messagingActionItemStatCollector.logEvent(store.mail.cur.peerId,ee.MessagingActionType.OPEN_MR)}}function vn(){U.SAKIntegration.sendMessage("open_school_grade",store.mail.cur.schoolData)}function gn(){U.SAKIntegration.sendMessage("new_chat")}function An(){if(U.SAKIntegration.onMessage.off("embed",On),store.mail.cur){if(N.onOpenCallback(xn),N.onCloseCallback(Bn),!document.body.classList.contains("vk__page_mail"))return im.off(),B.stop(),void storeMethods.resetMail();(0,L.restoreDocumentScroll)(),C.Messenger.cleanConvoBody(),im.off(),B.stop(),C.default.stopPolling(),g.default.cancelStatusUpdate(),b.default.resetPrevScraps(),storeMethods.resetMail()}}function yn(e){var t=e.peerId,n=store.mail.cur,i=null;if("mrs"===n.page)i="/mail?act=mrs";else if("template"===n.page)i="/mail?act=template";else if("msg"===n.page)i="/mail?act=show=peer="+t;else if(n.forwardFromId&&n.forwardFromId!==t)i="/mail?act=show&peer="+n.forwardFromId;else if(n.query){var o="msgs"===n.tab?"&tab=messages":"";i="/mail?q="+n.query+o}else if(n.peerId)i="/mail?act=show&peer="+n.peerId;else if(n.folder&&!n.forwardFromId){var a="";"all"!==n.folder&&(a="?act="+n.folder),i="/mail"+a}return i}function wn(){var e=store.mail.cur.countMR,t=store.mail.rolls.mrs;store.mail.cur.countMR=0,ne=!0,store.mail.rolls.mrs=[],t.forEach((function(e){(0,T.removePeer)(e)})),(0,Y.ajaxRequest)("/mail",{act:"mrs_reject",all:!0,hash:store.mail.hash.mrs},(function(n){if(n.error)return store.mail.cur.countMR=e,store.mail.rolls.mrs=t,ne=!1,void y.default.cancelRejeectLoading();C.default.redrawView(),Ge("/mail")}),(function(){store.mail.cur.countMR=e,store.mail.rolls.mrs=t,ne=!1,y.default.cancelRejeectLoading()}))}function Sn(){var e=c.default.isMarkedAsSpam();(0,Y.ajaxRequest)("/mail",{act:"mrs_reject",peer_id:store.mail.cur.peerId,is_spam:Number(e),hash:store.mail.hash.mrs},(function(e){e.error||(c.default.close(),C.default.redrawView(),Ge("/mail"))}))}function bn(){store.mail.cur&&(0,T.queueToPresendMsgs)(x.getItems())}function kn(e,t){var n=store.mail.members;(e=e.filter((function(e){return!n[e]}))).length&&(ae=ae.concat(e),re.push(t),se())}function Cn(){var e=store.mail,t=e.rolls,n=e.scraps,i=e.cur;t.folder.all=t.folder.all.filter(unique).sort(Qt),"all"===i.folder&&(n.folder=n.folder.filter(unique).sort(Qt),b.default.redrawFolder())}function En(e,t){if(!e||!e.length)return null;for(var n=e.length-1;n>=0;n--)if(t(e[n],n))return e[n];return null}function In(){im.abortWaiting()}function Tn(e){var t=+e.getAttribute("data-msg"),n=e.closest(".im_msg_audiomsg");if(t&&!(0,M.isForwardedMessageId)(t)&&store.mail.cur&&!(null==n?void 0:n.classList.contains("im_msg_audiomsg_listened"))){var i=store.mail.msgs[t],o=i&&store.mail.peers[i.peerId];o&&!i.listened&&i.authorId!==store.mail.cur.viewerId&&i.peerId===store.mail.cur.peerId&&(0,M.mailRequest)("/mail",{act:"listen_audiomsg",msg_id:t,hash:o.hashRead})}}var Mn,Pn,Ln={};function Nn(e,t){var n=Nn,i=store.mail.cur.peerId,o=+t.getAttribute("data-msg"),a=store.mail.msgs[o],r=store.mail.hash.recognize,s=n.locked||(n.locked={});Ln[o]=e;var l,c=t.closest(".im_msg_audiomsg");l=c?c.id.replace("audmsg",""):-1,statlogsValueEvent("audio_message_transcript",null,e,i,parseInt(a.conversationMsgId),l);var u=(0,m.$)(".audio-msg-track__transcriptionText",c),d="done"===a.transcript_state&&(null==u?void 0:u.classList.contains("audio-msg-track__transcriptionText--recognized"));e&&d&&Tn(t),e&&"uninitialized"===a.transcript_state&&!s[o]&&(s[o]=!0,(0,M.mailRequest)("/mail",{act:"recognise_audiomessage",msg_id:o,hash:r}))}function Rn(e,t){d.default.showCaptcha(e,t)}function xn(){Mn&&clearTimeout(Mn),Mn=setTimeout((function(){return addClass((0,m.$)(".messenger__layer_convo"),Dn())}),200)}function Bn(){Mn&&clearTimeout(Mn),Mn=setTimeout((function(){return removeClass((0,m.$)(".messenger__layer_convo"),Dn())}),200)}function Dn(){return Pn||(Pn="messenger__layer_convo--iosKeyboard",P.isIPad&&P.isIOSChrome&&P.iosMajor>=11&&(Pn="messenger__layer_convo--iosKeyboardChrome"),Pn)}function On(e,t){var n;("nav"===e&&t.url&&(Ge(t.url)||nav.go(t.url)),"send_school_grade"===e&&(store.mail.cur.schoolData=t,g.default.redraw()),"reload_current_chat"===e)&&Ze(store.mail.cur.peerId);"redraw_counter"===e&&function(e){var t=store.mail.cur,n=store.mail.peers[t.peerId];if(!n)return;e&&(store.mail.peers[t.peerId]=Object.assign(n,e));Un(t.peerId,n.isMuted),(0,Y.ajaxRequest)("/mail",{act:"get_peers",peer_ids:[t.peerId]},(function(e){storeMethods.injectMail(e),C.default.redrawView(),Un(t.peerId,n.isMuted)}))}(t),"resync_folder"===e&&qe((function(){g.default.redraw()})),"set_message_text"===e&&v.default.setText(t.text),"is_mobile_view"===e&&(n=t.isMobileView,store.mail.cur.isMobileView=n)}function Un(e,t){$$(".convo_id_"+e).forEach((function(e){e.$(".Oval").classList.toggle("Oval_type_minor",t)}))}function Hn(e){if(U.SAKIntegration.isIntegrated){var t=Boolean(nav.getQuery("community"));U.SAKIntegration.sendMessage("message_unread_counter",{isCommunity:t,count:e})}}function Fn(e,t,n){U.SAKIntegration.isIntegrated&&(jn(t),U.SAKIntegration.sendMessage("nav_info",{isNewMail:!0,path:e,query:t,url:n}))}function Vn(){var e=store.mail.cur;if(e){var t=e.peerId,n=(0,M.isChatPeer)(t),i=store.mail.peers[t];i&&(i.groupCall?U.SAKIntegration.sendMessage("call_join",{callData:i.groupCall.data,peerId:t}):U.SAKIntegration.sendMessage("call",{isGroup:n,peerId:t,peer:i}))}}function jn(e){e&&(delete e._sak_embed_force,delete e._sak_embed_at,delete e._sak_embed_origin,delete e._sak_embed_name,delete e.forced_color_scheme_mode)}function $n(e,t){e===X.VK_OFFICIAL_PEER_ID&&z.customMetricsCollector.logEvent({experiment_id:1285,service:"messages",metric_name:"open_vk_service_chat",metric_value:4,unit_id:t,unit_type_id:1})}function qn(e,t){U.SAKIntegration.isIntegrated&&U.SAKIntegration.sendMessage("reply_as",{id:e,msg:t})}},50582:function(e,t,n){"use strict";n.r(t);var i=n(79296);t.default=i.default,window.uMsg=i.default},79296:function(e,t,n){"use strict";var i=n(13725),o=n(62561),a=n(41070),r=n(46950);function s(){var e=(0,i.default)(['\n    <div class="msg__newMsgsDivider">\n      <span class="msg__newMsgDividerText">',"</span>\n    </div>\n  "]);return s=function(){return e},e}function l(){var e=(0,i.default)(["\n    ","\n    ","\n  "]);return l=function(){return e},e}t.default=function(e){var t=e.msgId,n=e.withDivider?function(){var e=window.lang;return o.default.html(s(),e.mobile_mail_new_msgs)}():"",i=store.mail,c=(0,r.isForwardedMessageId)(t)?i.forwards[t]:i.msgs[t];if(!c)return null;var u,d=c.authorId,_=i.members[d],f=c.peerId,p=i.peers[f];if(!e.detailed){var m=store.mail.presend,h=(m=m&&m.msgs)&&m["edit"+t];h&&(c=h)}p&&(p.isIncomingMR||p.isRejectedMR)&&(n="");if(c.isService)u=(0,a.default)({id:t,text:c.service,service:!0,unread:c.isUnread});else{var v=(0,a.Msg__authorName)(_,f,i.cur.userId),g={id:t,text:c.text,important:c.isImportant,unread:c.isUnread,authorId:d,authorPhoto:_.avatar,authorName:v,authorUrl:_.url,date:c.date,removed:i.cur.msgRemoved[t],admin:c.adminName?{name:c.adminName,url:c.adminUrl}:null,edited:c.edited,channel:p.isChannel&&p.ownerId!==i.cur.viewerId,attaches:c.attaches,attachesHTML:c.attachesHTML,attachesLoading:c.attachesLoading,forwards:c.forwards,reply:c.reply,pending:c.pending,waiting:c.waiting,failed:c.failed,sendId:c.sendId,sticker:c.sticker,keyboard:c.keyboard,maxDepth:e.detailed?i.cur.maxDetailedMsgDepth:i.cur.maxMsgDepth,ttl:c.ttl,ts:c.ts,isExpired:c.isExpired,template:c.template,isDefaultCasperTimerShown:!p.isCasper,isPinned:e.isPinned,chatId:e.chatId};u=e.detailed?(0,a.Msg_detailed)(g):(0,a.default)(g)}return o.default.html(l(),n,u)}},46705:function(e,t,n){"use strict";n.d(t,{uTyping_getPeerTyping:function(){return i.uTyping_getPeerTyping},uTyping_getNames:function(){return i.uTyping_getNames}});var i=n(74829)},74829:function(e,t,n){"use strict";n.d(t,{uTyping_getPeerTyping:function(){return i},uTyping_getNames:function(){return o}});n(30097);function i(e){var t=store.mail.cur.typings[e];return t?t.mixed||t.audio||t.text:null}function o(e){if(!e)return[];for(var t=store.mail.members,n=e.users,i=n.length,o=[],a=0;a<i;a++){var r=t[n[a]];if(r){var s=1===i?r.name:r.shortName;o.push(s)}}return o}},91609:function(e,t,n){"use strict";n.d(t,{CartOrderInfo:function(){return o}});var i=n(94163);function o(e){void 0===e&&(e={});var t={inner:[e.icon],class:"SplashScreen__icon",tag:"div"};return(0,i.default)({icon_raw:t,title:e.title,text:e.description,action_text:e.actionText,action_url:e.actionUrl})}},13234:function(e,t,n){"use strict";n.d(t,{CartOrderInfo:function(){return i.CartOrderInfo}});var i=n(91609)},71196:function(e,t,n){"use strict";n(85489),n(54463),n(91033),n(60767),n(86205),n(58107),n(46950),n(34590),n(39196)},16320:function(e,t,n){"use strict";n(71196);var i=n(38036),o=n(63269);window.MainMenu={showMenuItems:i.showMenuItems},o.default.getRouter().addRoute(/^\/menu([\?#].*)?$/,i.rebuildNotifications)},81411:function(e,t,n){"use strict";n.d(t,{CarouselBlock:function(){return u}});var i=n(11393),o=n(86205),a=n(56745),r=n(9710),s=n(82970),l=n(66967),c=n(97788);function u(e){void 0===e&&(e={});var t={cashback:(0,a.getVkpayOfferCashback48Icon)(),discount:(0,r.getVkpayOfferDiscount48Icon)(),installment:(0,s.getVkpayOfferInstallment48Icon)(),reason:(0,l.getVkpayOfferReason48Icon)(),card:(0,c.getVkpayOfferVirtualCard48Icon)()};return{inner:[{inner:[(0,o.default)({icon:t[e.icon]})],class:"CarouselBlock__icon",tag:"div"},i.default.wrap(e.text)],class:"CarouselBlock",tag:"div"}}},79679:function(e,t,n){"use strict";n.d(t,{CarouselBlock:function(){return i.CarouselBlock}});var i=n(81411)},42655:function(e,t,n){"use strict";n(91540),n(80908),n(86205),n(65387),n(49751),n(91687),n(10729),n(79679)},1506:function(e,t,n){"use strict";n.d(t,{handleShowDetails:function(){return o},handleCloseDetails:function(){return a}});var i=n(91687);function o(){return i.default.open(document.getElementById("money_transfer_receipt_details")),window.cur.detailsModalMenuOpened=!0,!1}function a(e){i.default.close(e),delete window.cur.detailsModalMenuOpened}},38247:function(e,t,n){"use strict";n(42655);var i=n(1506);window.MoneyTransferReceipt={_onShowDetails:i.handleShowDetails,_onCloseDetails:i.handleCloseDetails}},87625:function(e,t,n){"use strict";var i=n(10729),o=n(88611),a=n(46950),r=n(85489),s=n(49751),l=n(35909);t.default=function(e){void 0===e&&(e={});var t=r.default.class("NarrativesBlock",{empty:e.isEmpty,collapsed:e.isCollapsed}),n=(0,a.getNumShort)(e.hiddenNarrativesCount),c=(0,a.makeUrl)("narratives",{owner_id:e.ownerId}),u=(0,a.makeUrl)("narratives",{act:"create",owner_id:e.ownerId});return e.isEmpty?{inner:[{inner:[{inner:[{inner:[(0,a.getLang)("mobile_narratives_block_title")],class:"slim_header_label",tag:"span"},{inner:[(0,l.Icon24ChevronRight)()],class:"slim_header_rl",tag:"span"}],class:"slim_header slim_header_black",tag:"div"}],class:"NarrativesBlock__header link_header",onClick:["NarrativesBlock.onToggle","event"],tag:"div"},{inner:[(0,s.default)({inner:[(0,a.getLang)("mobile_narratives_block_create_narrative_label")],theme:"none",url:u,onClick:"return NarrativesBlock.onCreateNarrativeClick("+e.ownerId+", this, event);",use_native_onclick:!0,class:"NarrativesBlock__createBtn",icon:(0,l.Icon24NarrativeOutline)()}),{inner:[(0,a.getLang)("mobile_narratives_block_empty_description")],class:"NarrativesBlock__emptyPlaceholder",tag:"p"}],class:"NarrativesBlock__content",tag:"div"}],class:t,tag:"div"}:{inner:[{inner:[{inner:[{inner:[(0,a.getLang)("mobile_narratives_block_title")],class:"slim_header_label",tag:"span"},{inner:[e.narrativesTotalCount],class:"slim_header_cnt",tag:"span"},{inner:[(0,l.Icon24ChevronRight)()],class:"slim_header_rl",tag:"span"}],class:"slim_header slim_header_black",tag:"div"}],class:"NarrativesBlock__header link_header",href:c,onClick:"return NarrativesBlock.onHeaderClick("+e.ownerId+", this, event);",rel:"noopener",tag:"a"},(0,i.default)({inner:[e.isCreateBlockVisible?{inner:[{inner:[(0,l.Icon24Add)()],class:"NarrativesBlockItem__cover",tag:"div"},{inner:[(0,a.getLang)("mobile_narratives_block_create_narrative_label")],class:"NarrativesBlockItem__title",tag:"div"}],class:"NarrativesBlockItem NarrativesBlockItem--create",href:u,onClick:"return NarrativesBlock.onCreateNarrativeClick("+e.ownerId+", this, event);",tag:"a"}:null,e.narratives.map((function(e){return(0,o.default)(e)})),e.isMoreBlockVisible?{inner:[{inner:["+",n],class:"NarrativesBlockItem__cover",tag:"div"},{inner:[(0,a.getLang)("mobile_narratives_block_more_narratives_label")],class:"NarrativesBlockItem__title",tag:"div"}],class:"NarrativesBlockItem NarrativesBlockItem--more",href:c,onClick:"return NarrativesBlock.onShowMoreClick("+e.ownerId+", this, event);",tag:"a"}:null],mix:"NarrativesBlock__content"})],class:t,tag:"div"}}},86149:function(e,t,n){"use strict";var i=n(87625);n(15e3);window.NarrativesBlock=i.default;i.default},17522:function(e,t){"use strict";t.default=function(e){void 0===e&&(e={});var t=e.storiesCount?"window.showNarrative("+e.ownerId+", "+e.id+", 0, 'narratives"+e.ownerId+"'); return false;":null;return{inner:[{inner:[{class:"NarrativesBlockItem__coverImage",style:"background-image: url('"+e.coverUrl+"')",tag:"div"}],class:"NarrativesBlockItem__cover",tag:"div"},{inner:[e.title],class:"NarrativesBlockItem__title",tag:"div"}],class:"NarrativesBlockItem",onClick:t,tag:"div"}}},88611:function(e,t,n){"use strict";var i=n(17522);t.default=i.default},59257:function(e,t,n){"use strict";var i=n(46950),o=n(85489),a=n(35909);t.default=function(e){void 0===e&&(e={});var t=e.narrative,n=e.disablePreview||!t.storiesCount||e.onClick?null:e.onCoverClick||"window.showNarrative("+t.ownerId+", "+t.id+", 0); return false;",r=0===t.storiesCount,s=o.default.class("NarrativesListItem",{draft:r,previewDisabled:e.disablePreview}),l=(0,i.getLangNumeric)(t.storiesCount,(0,i.getLang)("mobile_narratives_stories_count","raw"));return e.isOwnerNameVisible&&(l=t.ownerName),{inner:[{inner:[r?(0,a.Icon24NarrativeActiveOutline)():{class:"NarrativesListItem__coverImage",style:"background-image: url("+t.coverUrl+");",tag:"div"}],class:"NarrativesListItem__cover",onClick:n,tag:"div"},{inner:[{inner:[(0,i.winToUtf)(t.title)],class:"NarrativesListItem__name",tag:"div"},{inner:[r?{inner:[(0,i.getLang)("mobile_narratives_no_stories"),"\n               · \n              ",(0,i.getLang)("mobile_narratives_draft")],tag:"span"}:l],class:"NarrativesListItem__storiesCount",tag:"div"}],class:"NarrativesListItem__description",tag:"div"}],class:s,onClick:e.onClick,tag:"div"}}},58942:function(e,t,n){"use strict";var i=n(59257);t.default=i.default},13797:function(e,t,n){"use strict";var i=n(95916),o=n(69756),a=n(49751),r=n(28495),s=n(28054),l=n(80444);t.default=function(e){var t=window.lang,n=(e.albums||[]).map((function(e){var t=(0,l.makeUrl)(e.url,{act:"add"});return(0,r.default)({onClick:["AddPhotoModal.go",t,"this"],album:e})}));return{inner:[(0,i.default)({inner:[t.mobile_photos_choose_album_modal_title],onClose:"AddPhotoModal.close(this)"}),n.length?(0,o.ModalMenuContent)({inner:[e.link.createAlbum?(0,a.default)({inner:[t.mobile_photos_choose_album_modal_create_album],class:"AddPhotoModal__createAlbum",theme:"secondary",stretch:!0,onClick:["AddPhotoModal.go",e.link.createAlbum]}):null,{inner:[n],class:"ScrollView",tag:"div"}],class:"AddPhotoModal__content"}):(0,s.default)({separator:!0,separator_desktop:!0,text:t.mobile_photos_choose_album_modal_empty_text,more_type:"primary",more_text:e.link.createAlbum?t.mobile_photos_placeholder_album_action:null,more_url:e.link.createAlbum,more_onclick:["AddPhotoModal.go",e.link.createAlbum]})],class:"AddPhotoModal",tag:"div"}}},68620:function(e,t,n){"use strict";n.d(t,{open:function(){return s},close:function(){return l},go:function(){return c}});var i=n(91687),o=n(13797),a=n(46950),r="AddPhotoModal";function s(){var e=(0,a.getState)("upload_albums"),t=(0,a.getState)("AddPhotoModal"),n=(0,i.default)({on_overlay_click:"AddPhotoModal.close(this)",class:r,attached:!0,body:(0,o.default)({link:{createAlbum:t.owner_id>0&&"/photos?act=select_album"},albums:e})});return i.default.open(Wd.elem(n),!0,"",{expandable:!0})}function l(e){var t=e.closest("."+r);i.default.close(t)}function c(e,t){void 0===t&&(t=null),nav.go(e),t&&t.hasOwnProperty("$btn")?l(t.$btn):l(t)}},37505:function(e,t,n){"use strict";var i=n(68620);window.AddPhotoModal={open:i.open,close:i.close,go:i.go}},10284:function(e,t,n){"use strict";var i=n(1730);window.PostAttachVideoLink={},PostAttachVideoLink._onInit=u,PostAttachVideoLink._onPlayClick=_,PostAttachVideoLink._onReplayClick=_,PostAttachVideoLink._onSoundClick=d,PostAttachVideoLink._onVideoClick=f,PostAttachVideoLink._onVideoPlay=function(e){return p(e.target,"play")},PostAttachVideoLink._onVideoPause=function(e){return p(e.target,"pause")},PostAttachVideoLink._onVideoEnded=function(e){return p(e.target,"end")};var o="PostAttachVideoLink_muted",a=function(e){return"PostAttachVideoLink_state_"+e},r=".PostAttachVideoLink",s=".PostAttachVideoLink__video",l=window.MutationObserver,c=null;function u(){l&&!c&&(c=new l(m)).observe(document.body,{childList:!0,subtree:!0})}function d(e){var t=e.closest(r),n=(0,i.$)(s,t);n.muted=!n.muted,t.classList.toggle(o,n.muted)}function _(e){var t=e.closest(r);(0,i.$)(s,t).play()}function f(e){e.paused||e.pause()}function p(e,t){var n=e.closest(r);n.classList.remove(a("play")),n.classList.remove(a("pause")),n.classList.remove(a("end")),n.classList.add(a(t))}function m(e){e.forEach((function(e){e.removedNodes.forEach((function(e){e.nodeType===HTMLElement.ELEMENT_NODE&&(0,i.$$)(s,e).forEach((function(e){e.src="",e.load()}))}))})),(0,i.$)(s)||(c.disconnect(),c=null)}},31407:function(e,t,n){"use strict";var i=n(11393);t.default=function(e,t){void 0===t&&(t={});return{inner:[i.default.wrap(e)],class:"CoronaStatus__tooltip CoronaStatus__tooltip--type"+t.id,onclick:["CoronaStatus.open",t],tag:"span"}}},98338:function(e,t,n){"use strict";n.d(t,{open:function(){return c},sendStat:function(){return l}});var i,o=n(69756),a=n(46950),r=n(11393),s=n(9046);function l(){(0,s.statlogsValueEvent)("corona_status_stat","open_app")}function c(e){void 0===e&&(e={}),(0,s.cancelEvent)(),(0,s.statlogsValueEvent)("corona_status_stat","show_tooltip");var t=r.default.elem((0,o.default)({class:"CoronaStatus",items:[(0,o.ModalMenuHeaderCloseButton)(),(0,o.ModalMenuIcon)({inner:{class:"CoronaStatus__icon CoronaStatus__icon--type"+e.id}}),(0,o.ModalMenuTitle)({inner:r.default.wrap(e.title)}),(0,o.ModalMenuBody)({inner:r.default.wrap(e.text)}),(0,o.ModalMenuBtn)({url:"/covid19#utm_source=vk&utm_medium=cpc&utm_campaign=status_tooltip_mvk",theme:"regular",size:"large",isBtn:!0,inner:(0,a.getLang)("mobile_special_covid_status_modal_go_button"),onclick:"window.CoronaStatus.sendStat()"})]}));i=o.default.open(t,!0)}window.page.onChange((function(){i&&o.default.close(i)}))},8833:function(e,t,n){"use strict";var i=n(31407),o=n(98338),a=n(46950);i.default;window.CoronaStatus=i.default,(0,a.extend)(i.default,{open:o.open,sendStat:o.sendStat})},60065:function(e,t,n){"use strict";n.d(t,{ImageStatusParticipants:function(){return a},ImageStatusIcon:function(){return r},ImageStatusTerms:function(){return s},ImageStatusBackground:function(){return l},ImageStatusPreloader:function(){return c}});var i=n(11393),o=n(27109);n(85489);function a(e){void 0===e&&(e={});var t=e,n=t.images,i=t.text,o=t.addition;return{inner:[{inner:[n.map((function(e){return{inner:[{src:e,class:"ImageStatus__participantImage",tag:"img"}],class:"ImageStatus__participantWrapper",tag:"div"}})),o?{inner:[{inner:["+"+o],class:"ImageStatus__participantAddition",tag:"div"}],class:"ImageStatus__participantWrapper",tag:"div"}:""],class:"ImageStatus__participantsWrapper",tag:"div"},{inner:[i],class:"ImageStatus__participantsText",tag:"div"}],class:"ImageStatus__participants",tag:"div"}}function r(e){void 0===e&&(e={});var t=e,n=t.url,i=t.type,o=t.url_x2;if(!n)return"";var a="";return o&&(a=o+" 2x"),{inner:[{inner:[{src:n,srcSet:a,class:"ImageStatus__image ImageStatus__image--"+i,tag:"img"}],class:"ImageStatus__imageFrame",tag:"div"}],class:"ImageStatus__imageWrapper",tag:"div"}}function s(e){void 0===e&&(e={});var t=e.terms;return t?{inner:[i.default.wrap(t)],class:"ImageStatus__terms",tag:"div"}:""}function l(e){var t=e.backgrounds,n=void 0===t?{}:t,i=e.themeKey,o="";return n[i]&&n[i]&&(o=n[i]),o?{class:"ImageStatus__background",style:'background-image: url("'+o+'")',tag:"div"}:""}function c(){return{class:"ImageStatus__preload",inner:(0,o.default)()}}},51801:function(e,t,n){"use strict";n.d(t,{open:function(){return f},sendStat:function(){return p},removeStatus:function(){return m}});var i,o=n(69756),a=n(60065),r=n(11393),s=n(1730),l=n(9046),c=n(29804),u=n(24961),d=n(49751),_=n(86658);function f(e){void 0===e&&(e={}),(0,l.cancelEvent)();var t=e,n=t.user_id,d=t.special_id,_=r.default.elem((0,o.default)({class:"ImageStatus",items:[(0,a.ImageStatusPreloader)()]}));i=o.default.open(_,!0,"image_status");var f=(0,s.$)(".Popup__content",i);window.ajax.post("/special_event",{act:d?"special_event":"image_status",user_id:n},{onDone:function(e){var t,n=e.status_id,i=e.color,s=void 0===i?{}:i,l=e.backgrounds,_=void 0===l?{}:l;t=c.colorScheme.isDarkScheme()?"dark":"light";var p=[(0,o.ModalMenuHeaderCloseButton)(),(0,a.ImageStatusBackground)({backgrounds:_,themeKey:t}),(0,a.ImageStatusIcon)(e.image),(0,o.ModalMenuTitle)({inner:r.default.wrap(e.title)})];e.description&&p.push((0,o.ModalMenuBody)({inner:r.default.wrap(e.description)})),e.participants&&p.push((0,a.ImageStatusParticipants)(e.participants)),(e.buttons||[]).forEach((function(e){p.push((0,o.ModalMenuBtn)({url:e.url,theme:e.type,size:"large",isBtn:!0,inner:e.title,onclick:e.onclick||(d?"window.SpecialEvent && window.SpecialEvent.sendStats('popup_action');":"ImageStatus.sendStat("+n+");"),attrs:{target:e.target||"_blank"}}))})),p.push((0,a.ImageStatusTerms)(e)),Array.from(f.childNodes).forEach((function(e){f.removeChild(e)})),s[t]&&(f.style.backgroundColor="#"+s[t]),f.append(r.default.elem({class:"ImageStatus__inner",inner:p})),d&&window.SpecialEvent?window.SpecialEvent.sendStats("popup_showed"):(0,u.saveStatlogEvents)({name:"image_status",value:n,keys:["show_popup"]})},onFail:function(){o.default.close(i)}})}function p(e){e&&(0,u.saveStatlogEvents)({name:"image_status",value:e,keys:["popup_action"]})}function m(e,t,n){return e.preventDefault(),_.default.post("/special_event?act=image_status_remove&hash="+n),d.default.setLoading(t,!0),!1}window.page.onChange((function(){i&&o.default.close(i)}))},19503:function(e,t,n){"use strict";var i=n(51801);window.ImageStatus={open:i.open,sendStat:i.sendStat,removeStatus:i.removeStatus}},38220:function(e,t,n){"use strict";var i=n(9046);window.LovinaPromotion={click:function(e,t){var n=t?e?"https://trk.mail.ru/c/e3goc2":"https://trk.mail.ru/c/levhn2":"https://trk.mail.ru/c/i01uk8";(0,i.statlogsValueEvent)("lovina_promotion",t?1:0),window.nav.hard_go(n)}}},33675:function(e,t,n){"use strict";n(85489),n(11393),n(46950),n(35909),n(39628),n(86205),n(49751)},97946:function(e,t,n){"use strict";n(33675);var i=n(91402);window.IPadBanner=i.IPadBanner0},57170:function(e,t,n){"use strict";var i=n(86205),o=n(46950),a=n(49751),r=n(11393),s=n(11770),l=n(35909);t.default=function(e){var t=(0,o.getLang)("mobile_promo_vkconnect_agreement");return t=(t=t.replace("{link1}",'<a href="'+e.terms_url+'" target="_blank" class="PromoVKConnect__agreementLink">').replace("{/link1}","</a>")).replace("{link2}",'<a href="'+e.privacy_url+'" target="_blank" class="PromoVKConnect__agreementLink">').replace("{/link2}","</a>"),t=r.default.wrap(t),{inner:[{inner:[(0,i.default)({icon:(0,s.getVkconnectLogoIcon)()}),{inner:[(0,l.Icon28HelpOutline)()],href:e.learn_more_url,target:"_blank",class:"PromoVKConnect__help",tag:"a"}],class:"PromoVKConnect__header",tag:"div"},{inner:[(0,o.getLang)("mobile_promo_vkconnect_title")],class:"PromoVKConnect__title",tag:"h1"},{inner:[{inner:[{inner:[(0,l.Icon28MagicWandOutline)()],class:"PromoVKConnect__listIcon",tag:"div"},(0,o.getLang)("mobile_promo_vkconnect_list1")],class:"PromoVKConnect__listItem",tag:"li"},{inner:[{inner:[(0,l.Icon28UserCircleOutline)()],class:"PromoVKConnect__listIcon",tag:"div"},(0,o.getLang)("mobile_promo_vkconnect_list2")],class:"PromoVKConnect__listItem",tag:"li"},{inner:[{inner:[(0,l.Icon28CheckShieldOutline)()],class:"PromoVKConnect__listIcon",tag:"div"},(0,o.getLang)("mobile_promo_vkconnect_list3")],class:"PromoVKConnect__listItem",tag:"li"}],class:"PromoVKConnect__list",tag:"ul"},{inner:[(0,a.default)({inner:[(0,o.getLang)("mobile_promo_vkconnect_button")],size:"large",class:"PromoVKConnect__button",onClick:["PromoVKConnect.accept","event","this",e.hash],use_native_onclick:!0}),{inner:[t],class:"PromoVKConnect__agreement",tag:"div"}],class:"PromoVKConnect__footer",tag:"div"}],class:"PromoVKConnect ScrollView",tag:"div"}}},89691:function(e,t,n){"use strict";var i=n(91687),o=n(49751),a=n(26237),r=n(57170),s=n(1730),l=n(86658),c=n(46950),u={init:function(e){var t=this;window.onDOMReady((function(){return t.open(e)}))},open:function(e){var t=(0,i.default)({on_overlay_click:[],class:"PromoVKConnectModal",attached:!0,body:(0,r.default)(e)});i.default.open(Wd.elem(t),!0,"",{swipeDown:!1})},accept:function(e,t,n){var a=this;e.preventDefault(),o.default.setLoading(t,!0,"white"),l.default.post("/",{act:"vkconnect_accept",hash:n},{onDone:function(){a.showTooltip(),i.default.close()},onFail:function(){a.showTooltip(),i.default.close()}})},showTooltip:function(){var e=(0,s.$)(".BottomMenu__cell:nth-child(5) .BottomMenu__icon"),t=Wd.elem((0,a.default)({pos:"top_right",theme:"accent",inner:(0,c.getLang)("mobile_promo_vkconnect_tooltip")}));e.appendChild(t)}};t.default=u},48738:function(e,t,n){"use strict";var i=n(89691);window.PromoVKConnect=i.default},49539:function(e,t,n){"use strict";var i=n(51571),o=n(22682),a=n(5606),r=n(1730),s=n(86353),l=!1,c={start:function(e,t,n){if("%page_id%"!==e&&!l){var s;switch(l=!0,n&&"%page_path%"!==n?n:i.default.cur){case"/feed":s=o.default.TAB_ID_FEED;break;case"/feed?section=recommended":s=o.default.TAB_ID_RECOMMEND;break;case"/mail":s=o.default.TAB_ID_MESSAGES;break;case"/feed?section=notifications":s=o.default.TAB_ID_NOTIFICATION}s&&window.innerWidth<882?o.default.drawSkeletonLoader((0,r.$)(".layout__basis"),s):(o.default.drawLoader((0,r.$)(".layout__basis")),(0,a.alLoadingFix)()),setTimeout((function(){var o={headers:{"X-AppShell-Start-Id":e,"X-AppShell-Start":t},zProcess:function(){}};window.ajax.onNavDone(c.onStarted),n&&"%page_path%"!==n?i.default.go(n,{push_only:!0,replace:!0},o):i.default.go(i.default.cur,null,o)}))}},onStarted:function(){window.ajax.onNavDone.off(c.onStarted),(0,s.calculateTimeOffsets)()}};t.default=c},27018:function(e,t,n){"use strict";var i=n(49539);i.default;window.AppShell=i.default},76378:function(e,t,n){"use strict";var i=n(51571),o=n(49751);t.default={reload:function(e){o.default.setDisabled(e,!0),!1===navigator.onLine?setTimeout((function(){o.default.setDisabled(e,!1)}),500):i.default.reload()}}},91145:function(e,t,n){"use strict";var i=n(76378);window.OfflinePage=i.default;i.default},80815:function(e,t,n){"use strict";var i=n(1730),o=".AppPasswordsPopup";window.AppPasswords=new function(){this.showPopup=function(){return Popup.open((0,i.$)(o))},this.hidePopup=function(){return Popup.close((0,i.$)(o))}}},59123:function(e,t,n){"use strict";n(80908),n(3061),n(46950),n(54463),n(91033)},52255:function(e,t,n){"use strict";var i,o,a=n(53006),r=n(1730),s=n(29804),l=n(86658),c=function(){function e(e){var t=e.selector,n=e.className;this.element=(0,r.$)(t),this.className=n}var t=e.prototype;return t.show=function(){this.element.classList.add(this.className)},t.hide=function(){this.element.classList.remove(this.className)},e}(),u=function(e){function t(){return e.call(this,{selector:".Appearance__fixedSchemes",className:"Appearance__fixedSchemes--active"})||this}return(0,a.default)(t,e),t}(c),d=function(e){function t(){return e.call(this,{selector:".Appearance__autoSwitcher",className:"Appearance__autoSwitcher--active"})||this}return(0,a.default)(t,e),t}(c);function _(e){var t=e.mode;s.ColorScheme.isSchemesAutoSwitchingSupported()?o.show():i.show(),t===s.ColorSchemeMode.Auto&&s.ColorScheme.isSchemesAutoSwitchingSupported()?i.hide():i.show();var n=(0,r.$)("[name='mode'][value='"+t+"']");n&&(n.checked=!0)}function f(e,t){var n={mode:t,_ajax:1};l.default.post(e,n),s.colorScheme.setMode(t),_({mode:t})}window.Appearance={init:function(){if(s.ColorScheme.isSchemesSupported()){i=new u,o=new d;var e=s.colorScheme.getMode();s.ColorScheme.isSchemesAutoSwitchingSupported()||e!==s.ColorSchemeMode.Auto||(e=s.ColorSchemeMode.Light),_({mode:e})}},switchOnChange:function(e,t){var n=t.checked,i=s.colorScheme.isDarkScheme()?s.ColorSchemeMode.Dark:s.ColorSchemeMode.Light;f(e,n?s.ColorSchemeMode.Auto:i)},radioOnChange:function(e,t){f(e,t.value)}}},97518:function(e,t,n){"use strict";n(59123),n(52255)},2162:function(e,t,n){"use strict";var i=n(1730),o=n(9046),a=window.Popup,r=window.Btn;window.AuthCheck={},AuthCheck._onDropConfirmationClick=d,AuthCheck._onResetSessionSubmit=_,AuthCheck._onCurBrowserDropClick=f;var s=function(e){return".AuthCheck__popup_index_"+e},l=function(e){return'.AuthCheck__dropConfirmation[data-index="'+e+'"]'},c=".AuthCheck__dropConfirmationSubmit",u="AuthCheck__dropConfirmation_success";function d(e){var t=(0,i.$)(s(e));a.open(t)}function _(e,t){e.preventDefault();var n=e.target,s=(0,i.$)('iframe[name="'+e.target.target+'"]'),d=n.$(c);n.submit(),r.setLoading(d,!0),(0,o.addEvent)(s,"load",(function(){(0,i.$)(l(t)).classList.toggle(u),a.close(),r.setLoading(d,!1)}))}function f(e){var t=e.$btn;r.setLoading(t,!0),window.ajax.click(t,{onDone:function(){(0,i.$)(l("0")).classList.toggle(u),a.close(),r.setLoading(t,!1)}})}},53198:function(e,t,n){"use strict";var i=n(1730);window.AuthCheckIntro={},AuthCheckIntro._onMount=a;var o=".AuthCheckIntro";function a(){var e=(0,i.$)(o),t=new Scroller(e,{byPage:!0,ignoreMouseWheel:!0,noAutoScroll:!0});t.init(),cur.destroy.push((function(){return t.destroy()}))}},47613:function(e,t,n){"use strict";n(3061)},69285:function(){window.FaceRecognitionSwitch={onChange:function(e,t){window.ajax.post(e,{checked:t.checked,_ajax:1})}}},35243:function(e,t,n){"use strict";n(47613),n(69285)},7316:function(e,t,n){"use strict";n(46950),n(85489),n(80908),n(11393),n(35909)},72265:function(e,t,n){"use strict";var i=n(91687),o=n(69756),a=n(11393),r=n(46950);window.LoginHistory={_onSubmit:function(e,t,n){var i=geByClass1("LoginHistory__iframe");preventEvent(e),t.submit(),addEvent(i,"load",(function(){return nav.go(n,null,{isForm:!0})}))},showResetSessionModal:function(e,t,n){var s=(0,i.default)({close:!0,items:[(0,o.ModalMenuBtn)({class:"ai_add",inner:(0,r.getLang)("mobile_settings_activity_session_reset_title"),onclick:"LoginHistory.resetSession('"+e+"', '"+t+"', '"+n+"');Popup.close(this);"})]});return i.default.open(a.default.elem(s),!0),!1},resetSession:function(e,t,n){window.ajax.post(e,{reset_data:t,hash:n})}}},96872:function(e,t,n){"use strict";n(7316),n(72265)},47919:function(e,t,n){"use strict";var i=n(1730);window.ReservedCodes={},ReservedCodes._onShowRestCodesClick=r;var o=".ReservedCodes",a="ReservedCodes_restCodesShown";function r(){(0,i.$)(o).classList.toggle(a)}},90191:function(e,t,n){"use strict";var i=n(1730);window.Settings={_privacy:{}},Settings._privacy.onRadioChange=u;var o=function(e){return'.Settings__privacyPad[data-privacy="'+e+'"]'},a=".Settings__privacySubmitRow",r=".Settings__privacyForm",s=".Settings__privacySelectForbiddenLink",l="Settings__privacyPad_visible",c="Settings__privacySubmitRow_visible";function u(e,t){if("none"===e)d("allowed",!1),d("forbidden",!1),_(!0);else if("allowed"===e)d("allowed",!0),d("forbidden",!1),_(!1);else if("forbidden"===e){d("allowed",!1),d("forbidden",!0),_(!0);var n=(0,i.$)(r),o=(0,i.$)(s),a=t.name,l=t.value,c=n.getAttribute("action")+"&"+a+"="+l+"&forbid";o.setAttribute("href",c)}}function d(e,t){(0,i.$)(o(e)).classList.toggle(l,t)}function _(e){(0,i.$)(a).classList.toggle(c,e)}},38949:function(e,t,n){"use strict";var i=n(9046),o=n(51571);window.SettingsMenu={onClick:function(e,t){return void 0===t&&(t=!1),(0,i.statlogsValueEvent)("settings_menu_click",e),t?o.default.hard_go(e):o.default.go(e),!1}}},9389:function(e,t,n){"use strict";var i=n(54463),o=n(91033),a=n(86205),r=n(80908),s=n(93817),l=n(11012),c=n(99126);t.default=function(e){void 0===e&&(e={});var t=window.lang,n=e.subscriptions||[];return{inner:[(0,r.default)({hideOnDesktop:!0}),(0,i.default)({inner:[(0,i.default)({inner:[(0,o.default)({inner:[t.mobile_settings_offer_music],url:e.music_href,style:{with_border:!0},icon_class:"Row__icon--44",icon:{inner:[(0,a.default)({icon:(0,l.getMusicOutline28WhiteIcon)()})],class:"Subscriptions__icon Subscriptions__icon--music",tag:"div"}})]}),(0,i.default)({inner:[n.map((function(e){var t={inner:[e.subtitle,e.subtitleAppendix?{inner:[e.subtitleAppendix],tag:"div"}:""],tag:"div"};return(0,o.default)({inner:[(0,s.default)({img:e.img,title:e.title,subtitle:t,verified:e.verified,url:e.href,actions:{inner:[(0,a.default)({icon:(0,c.getMoreHorizontal24Gray300Icon)()})],onclick:"Subscriptions.editSubscription(this, "+e.actions+")",class:"OwnerRow__button",tag:"div"}})],style:{no_padding_top:!0}})}))],title:t.mobile_settings_subscriptions_communities,noShadow:!0})]})],class:"Subscriptions",tag:"div"}}},69825:function(e,t,n){"use strict";n.d(t,{editSubscription:function(){return o}});var i=n(89359);function o(e,t){if(t.context_actions){var n=Wd.html(t.context_actions.map((function(e){return(0,i.ContextMenuItem)({title:e.title,href:e.href})}))),o=Wd.elem((0,i.ContextMenu)({list:n}));o.parentNode.id="container",i.ContextMenu.open(o,"#container",{appendToBody:!0})}}},94227:function(e,t,n){"use strict";var i=n(9389),o=n(69825);window.Subscriptions={editSubscription:o.editSubscription};i.default},44075:function(e,t,n){"use strict";n(2597)},2597:function(e,t,n){"use strict";var i=n(9046),o=n(51571),a=n(86658);window.uCloseProfileSwitcher={},window.uCloseProfileSwitcher._onConfirmClick=s;var r=null;function s(e,t){var n=t.checked;o.default.clear();var s={is_closed:n?"1":"0",_ajax:1};a.default.post(e,s,{onDone:function(){o.default.reload();var e=window.cur;r=(0,i.scrollTop)(),e.destroy.push(l)}})}function l(){(0,i.scrollTop)(r),requestAnimationFrame((function(){(0,i.scrollTop)(r),requestAnimationFrame((function(){(0,i.scrollTop)(r)}))}))}},8948:function(e,t,n){"use strict";n.d(t,{StickersKeyboardPackHeader:function(){return o}});var i=n(35909);function o(e){var t=e.title?{inner:[e.title],class:"StickersKeyboardPackHeader__title",tag:"div"}:null,n=e.canGift&&e.target?{inner:[(0,i.Icon24GiftOutline)()],class:"StickersKeyboardPackHeader__gift",href:"/attachments?act=stickers_gift&stickers_id="+e.packId+"&ref=stickers_keyboard&target="+e.target,tag:"a"}:null;return t||n?{inner:[{inner:[t],class:"StickersKeyboardPackHeader__main",tag:"div"},{inner:[n],class:"StickersKeyboardPackHeader__aside",tag:"div"}],class:"StickersKeyboardPackHeader",tag:"div"}:null}},86713:function(e,t,n){"use strict";n.d(t,{StoriesArchive:function(){return u}});var i=n(54463),o=n(78881),a=n(85489),r=n(49751),s=n(46950),l=n(27109),c=n(35909);function u(e){void 0===e&&(e={});var t=e.stories&&0===e.stories.length,n=e.selectedStories&&e.selectedStories.length,u=0===n,d=a.default.class("StoriesArchive",{editable:e.isEdit}),_=["StoriesArchive__stories",e.isLoading?"_si_container_loading":null];return t?(0,i.default)({inner:[{inner:[(0,c.Icon56ArchiveOutline)()],class:"StoriesArchiveEmpty__icon",tag:"div"},{inner:[(0,s.getLang)("mobile_stories_archive_empty_label")],class:"StoriesArchiveEmpty__label",tag:"div"}],mix:"StoriesArchive StoriesArchiveEmpty"}):(0,i.default)({inner:[{inner:[e.stories.map((function(t){var n=(0,s.arraySomeEqual)(e.selectedStories,"id",t.id);return(0,o.default)({isSelectable:e.isEdit,isSelected:n,story:t,onStoryThumbCheck:e.onStoryThumbCheck})}))],class:_,ref:e.storiesArchiveStoriesWrapperRef,tag:"div"},e.isLoading?(0,l.default)({mix:"StoriesArchive__spinner"}):null,e.isEdit?{inner:[{inner:[u?(0,s.getLang)("mobile_stories_archive_select_at_least_one"):(0,s.getLangNumeric)(n,(0,s.getLang)("mobile_stories_archive_selected_stories_title","raw")),u?null:{inner:[(0,c.Icon12Cancel)()],class:"StoriesArchiveActions__resetSelectedIcon",onClick:e.onResetSelectedStoriesClick,tag:"div"}],class:"StoriesArchiveActions__selected",tag:"div"},{inner:[(0,r.default)({inner:[(0,s.getLang)("mobile_stories_archive_remove")],class:"StoriesArchiveActions__btn StoriesArchiveActions__btn--delete",theme:"secondary",onClick:e.onDeleteStoriesActionClick,disabled:!e.selectedStories.length||e.isCreateNarrativeActionLoading,isLoading:e.isDeleteActionLoading,icon:(0,c.Icon24DeleteOutline)()}),(0,r.default)({inner:[(0,s.getLang)("mobile_stories_archive_to_narrative")],class:"StoriesArchiveActions__btn StoriesArchiveActions__btn--narrative",theme:"secondary",onClick:e.onCreateNarrativeActionClick,disabled:!e.selectedStories.length||e.isDeleteActionLoading,isLoading:e.isCreateNarrativeActionLoading,icon:(0,c.Icon24NarrativeOutline)()})],class:"StoriesArchiveActions__buttons",tag:"div"}],class:"StoriesArchiveActions",ref:e.storiesArchiveActionsRef,tag:"div"}:null],mix:d,ref:e.storiesArchiveRef})}},5277:function(e,t,n){"use strict";n.d(t,{StoriesArchive:function(){return i.StoriesArchive}});var i=n(86713)},11056:function(e,t,n){"use strict";n.d(t,{Story:function(){return S}});var i=n(11393),o=n(80444),a=n(3226),r=n(85489),s=n(93168),l=n(62691),c=n(65287),u=n(49751),d=n(86205),_=n(9046),f=n(46950),p=n(38383),m=n(18253),h=n(46170),v=n(33091),g=n(72018),A=n(28859),y=n(35909),w=n(97398),S=function(){function e(e,t,n){var i=this;this.onLoadStory=function(){if(i.loaded=!0,i.clickable_stickers){var e,t=null==(e=i.authorElem)?void 0:e.querySelector(".Story");t&&i.renderStickersLayer.call(i,t)}if(i._loadingStartTime){i.loadingTime=Date.now()-i._loadingStartTime,window.Stories._sendViewerStartTime(i.raw_id,i.loadingTime),i._loadingStartTime=0;var n=i.isMetaStory?"group_feed_view":"view_story";window.Stories.sendAnalyticsEvent(n,{preloading_duration:i.loadingTime})}i.isMetaStory||i.isOneTime||window.Stories.markSeenStory()},this.onLoadImg=function(){window.Stories.hideLoading(),i.setStartTime(),i.onVideoData({paused:i.paused,authorIndex:i.state.authorIndex,storyIndex:i.state.storyIndex})},this.handleRecommendationsScroll=function(){window.event.stopPropagation&&window.event.stopPropagation(),window.event.stopImmediatePropagation&&window.event.stopImmediatePropagation();var e=document.querySelector(".MetaStory__recommendations"),t=document.querySelector(".MetaStory__recommendations-inner");if(t&&e){var n,o=Math.min(t.scrollTop/(i.scrollOffset/100),70)/100;if((0,_.setStyle)(e,{backgroundColor:"rgba(0, 0, 0, "+o+")"}),t.scrollTop?(null==e||e.classList.add("scroll"),window.Stories.pauseStory()):(window.Stories.playStory(),(0,_.removeClass)(e,"scroll")),i.isGroupsMetaStory)if(i.blockHeaderEl||(i.blockHeaderEl=document.querySelector(".Story__gridTitle")),t.scrollTop>i.metaStoryGridMarginTop)(0,_.removeClass)(i.blockHeaderEl,"Story__gridTitle--hide");else null==(n=i.blockHeaderEl)||n.classList.add("Story__gridTitle--hide")}};var o=e.items[n],r=e.narrative,l=e.author;this.store=window.Stories.getStore(),this.state={authorIndex:t,storyIndex:n},this.date=o.date,this.preview=o.preview_url,this.type=o.type,this.photo_url=o.photo_url,this.video_url=o.video_url,this.first_frame=o.first_frame,this.loaded=!1,this.narrative=r,this.isNarrative=!!r,this.videoSupport=!!window.HTMLVideoElement,this.views=o.views,this.replies=o.replies,this.link=o.link,this.unread=o.unread,this.raw_id=o.raw_id,this.is_expired=o.is_expired,this.isPrivate=o.is_private,this.isDeleted=o.is_deleted,this.isAds=o.isAds,this.isPromo=o.isPromo,this.promoCaption=o.promoCaption,this.track_code=o.track_code,this.can_comment=o.can_comment,this.canLike=o.canLike,this.can_share=o.can_share,this.can_remove=o.can_remove,this.can_report=!o.can_manage,this.can_ask=o.can_ask,this.can_ask_anonymous=o.can_ask_anonymous,this.canPause="video"!==this.type,this.seeking=!1,this.progress=0,this.needShowEmptyStats=o.needShowEmptyStats,this.canAddToNarrative=o.canAddToNarrative,this.isPartOfNarrative=o.isPartOfNarrative,this.isNewQuestions=o.isNewQuestions,this.isLiked=o.isLiked,this.authorName=l.name,this.name=this.narrative?this.narrative.title:l.name,this.authorId=l.id,this.firstName=l.firstName,this.avatar=this.narrative?this.narrative.coverUrl:l.photo,this.href=l.href,this.prometheus=l.verify.includes("page_top_author"),this.verified=l.verify.includes("page_verified"),this.authorIcon=(this.prometheus||this.verified)&&!this.isNarrative,this.content=null,this.paused=!0,this.stats=o.stats,this.app=o.app,this.isMetaStory=!!o.is_groups_meta_story||!!o.is_apps_meta_story,this.isGroupsMetaStory=!!o.is_groups_meta_story,this.isAppsMetaStory=!!o.is_apps_meta_story,this.isOneTime=o.isOneTime&&l.id!==window.vk.id,this.isOneTimeSeen=o.isOneTimeSeen,this.seenProgress=this.isOneTime?o.seenProgress:null,this.onAutoPlay=(0,a.default)(),this.onDestroy=(0,a.default)(),this.onVideoBuffering=(0,a.default)(),this.onVideoData=(0,a.default)(),this.onVideoPlayEvent=(0,a.default)(),this.onVideoPauseEvent=(0,a.default)(),this.onVideoEndedEvent=(0,a.default)(),this.onMute=(0,a.default)(),this.onUnMute=(0,a.default)(),this.duration=8e3,this.clickable_stickers=o.clickable_stickers,this.stickers=[],this.StoryMenu=new s.default(Object.assign(o,{canReport:this.can_report,narrative:r,canBookmark:Boolean(null==r?void 0:r.bookmarkHash),isBookmarked:Boolean(null==r?void 0:r.isBookmarked)})),this.needMenu=this.StoryMenu.needMenu(),this.storyMenuHTML=this.StoryMenu.render()}var t=e.prototype;return t.update=function(e){var t=window.Stories.getCurrentStoryIndex(),n=window.Stories.getCurrentAuthorIndex();this.state.authorIndex===n&&this.state.storyIndex===t?(this.loadContent(e),window.Stories.setHistory(this.raw_id)):(this.destroy(),(0,_.val)(e,""))},t.setStartTime=function(){this.seenProgress&&(this.startTime=+(this.seenProgress/100*this.getDuration()).toFixed(1))},t.getStartTime=function(){return this.startTime||0},t.getProgressPercentByLeftTime=function(e){return 100-Math.min(Math.max(e,0)/this.getDuration()*100,100)||0},t.getDuration=function(){return this.duration},t.isPaused=function(){return this.video.paused},t.mute=function(e){void 0===e&&(e=!1),this.video.muted=!0,this.onMute(e)},t.unMute=function(){this.video.muted=!1,this.onUnMute()},t.isMuted=function(){var e;return null==(e=this.video)?void 0:e.muted},t.getPreview=function(){return this.preview},t.hasLink=function(){return!!this.link},t.getLinkUrl=function(){var e=this.link.url,t=window.Stories.getFrom(!1);return o.default.make(e,{from:t})},t.cantSee=function(){return this.isPrivate||this.is_expired||this.isOneTimeSeen||this.isDeleted},t.loadContent=function(e){var t=this,n=window.lang;if(this.authorElem=window.Stories.getCurrentAuthorEl(),this.cantSee()){var o;window.Stories.hideLoading();var a="";this.is_expired?a=i.default.wrap(n.mobile_stories_error_expired):this.isDeleted?a=i.default.wrap(n.mobile_stories_error_deleted):this.isPrivate&&(a=i.default.wrap(n.mobile_stories_error_private));var r={className:"Story__contentError",inner:this.isOneTimeSeen?[(0,d.default)((0,h.getBombOutline56Icon)()),{tag:"span",className:"Story__contentErrorText Story__contentErrorText--oneTimeSeen",inner:a}]:a};null==(o=this.authorElem)||o.classList.add(c.ERROR_CLASS),(0,_.val)(e,i.default.html(r)),window.Stories.restoreAudio()}else if("photo"===this.type){this.isMetaStory||window.Stories.showLoading(),this.img=new Image,this.img.addEventListener("load",this.onLoadImg),this.img.addEventListener("load",this.onLoadStory),this.img.src=this.photo_url;var s={style:"background-image: url("+this.photo_url+")",className:"Story__content_image"};if(this.isGroupsMetaStory){(0,_.val)(e,""),e&&e.parentNode.insertAdjacentHTML("beforeend",i.default.html(this.renderGroupsMetaStory()));var l=document.querySelector(".MetaStory__recommendations-inner");["scroll","touchmove"].forEach((function(e){l&&l.addEventListener(e,t.handleRecommendationsScroll)})),window.Stories.hideLoading()}else if(this.isAppsMetaStory){(0,_.val)(e,""),e&&e.parentNode.insertAdjacentHTML("beforeend",i.default.html(this.renderAppsMetaStory()));var u=document.querySelector(".MetaStory__recommendations-inner");["scroll","touchmove"].forEach((function(e){u&&u.addEventListener(e,t.handleRecommendationsScroll)})),window.Stories.hideLoading()}else(0,_.val)(e,i.default.html(s));window.Stories.restoreAudio()}else if("video"===this.type)if(this.videoSupport&&window.Stories.isAutoplaySupport())window.Stories.showLoading(),this.video=(0,_.ce)("video",{src:this.video_url,className:"Story__content_video"}),this.video.setAttribute("playsinline","playsinline"),this.video.setAttribute("webkit-playsinline","webkit-playsinline"),window.Stories.isMuted&&this.mute(),this.video.setAttribute("x-yandex-pip","false"),this.video.setAttribute("disablePictureInPicture","true"),this.onCanPlayBind=this.onCanPlay.bind(this),this.onVideoWaitingBind=this.onVideoBuffer.bind(this),this.onVideoLoadedDataBind=this.onVideoLoadedData.bind(this),this.onVideoFirstDataLoadedBind=this.onVideoFirstDataLoaded.bind(this),this.onVideoPlayBind=this.onVideoPlay.bind(this),this.onVideoPlayingBind=this.onVideoPlay.bind(this),this.onVideoPauseBind=this.onVideoPause.bind(this),this.onVideoEndedBind=this.onVideoEnded.bind(this),this.onLoadStory=this.onLoadStory.bind(this),this.onVideoSeekingBind=this.onVideoSeeking.bind(this),this.onVideoSeekedBind=this.onVideoSeeked.bind(this),this.video.addEventListener("ended",this.onVideoEndedBind),this.video.addEventListener("play",this.onVideoPlayBind),this.video.addEventListener("pause",this.onVideoPauseBind),this.video.addEventListener("canplaythrough",this.onCanPlayBind),this.video.addEventListener("waiting",this.onVideoWaitingBind),this.video.addEventListener("loadedmetadata",this.onVideoLoadedDataBind),this.video.addEventListener("loadeddata",this.onVideoFirstDataLoadedBind),this.video.addEventListener("canplaythrough",this.onLoadStory),this.video.addEventListener("playing",this.onVideoPlayingBind),this.video.addEventListener("seeking",this.onVideoSeekingBind),this.video.addEventListener("seeked",this.onVideoSeekedBind),(0,_.append)(this.video,e),this.video.load(),window.Stories.restoreAudio(),window.Stories.pauseAudio();else{var f=window.Stories.getAuthorElems()[this.state.authorIndex];this.renderError(f,e,n.mobile_stories_inline_video_error)}},t.isLoaded=function(){return this.loaded},t.onVideoSeeking=function(){this.seeking=!0,window.Stories.showLoading(),this.onVideoBuffer()},t.onVideoSeeked=function(){this.seeking=!1,this.onVideoPlay()},t.markSeen=function(){this.store.authors[this.state.authorIndex].items[this.state.storyIndex].unread=!1},t.pause=function(){!this.paused&&this.canPause&&(this.paused=!0,this.video&&!this.video.paused&&this.video.pause())},t.play=function(){var e=this;return new Promise((function(t,n){if(e.paused&&(e.paused=!1,e.video)){var i=e.video.play();i?i.then(t).catch((function(){e.mute(),e.video.play().then(t).catch(n)})):n()}}))},t.onVideoEnded=function(){this.onVideoEndedEvent()},t.onVideoPlay=function(){this.buffering=!1,window.Stories.hideLoading(),this.onVideoPlayEvent()},t.onVideoPause=function(){this.onVideoPauseEvent()},t.onVideoBuffer=function(){this.buffering=!0,window.Stories.showLoading(),this.onVideoBuffering()},t.onVideoLoadedData=function(){if(0===this.video.duration){this.duration=16e3}else this.duration=1e3*this.video.duration+100;this.setStartTime(),this.onVideoData({paused:this.paused,authorIndex:this.state.authorIndex,storyIndex:this.state.storyIndex})},t.onVideoFirstDataLoaded=function(){var e=+(this.getStartTime()/1e3).toFixed(1);this.video.currentTime<e&&(this.video.currentTime=e)},t.onCanPlay=function(){window.Stories.hideLoading(),this.onAutoPlay({paused:this.paused,authorIndex:this.state.authorIndex,storyIndex:this.state.storyIndex}),this.store.isStopped&&this.video.pause()},t.getType=function(){return this.type},t.getVideoState=function(){return this.video?this.video.readyState:0},t.getVideo=function(){if(this.video)return this.video},t.renderError=function(e,t,n){var o=this,a={className:"Story__content_expired",inner:i.default.wrap(n)};(0,_.val)(t,i.default.html(a)),window.Stories.hideLoading(),this.type="broken",null==e||e.classList.add(c.ERROR_CLASS),requestAnimationFrame((function(){o.onVideoData({paused:o.paused,authorIndex:o.state.authorIndex,storyIndex:o.state.storyIndex})}))},t.hasSticker=function(e){var t=(this.clickable_stickers||{}).stickers;return!(!t||!(0,f.isArray)(t))&&t.some((function(t){return t.type===e}))},t.getSticker=function(e){var t=(this.clickable_stickers||{}).stickers;return!(!t||!(0,f.isArray)(t))&&t.find((function(t){return t.type===e}))},t.render=function(){var e,t,n=window,o=n.lang,a=n.winToUtf;window.addEventListener("resize",this._onResizeHandle.bind(this));var s=l.isTouch?"ontouchstart":"onmousedown",c=l.isTouch?"ontouchend":"onmouseup";this._onLoadingStart();var u=this.date;return this.isPromo?u=this.promoCaption:this.isAds?u=o.mobile_stories_is_promo_title:this.narrative&&(u=this.authorName+" · "+this.date),i.default.html({className:"Story",inner:[{className:"Story__header",inner:[{className:"Story__table",inner:[this.isGroupsMetaStory?null:{className:"Story__cell Story__cell_header",inner:[{className:"Story__table Story__link al_empty",href:this.href,onclick:"return Stories.clickAuthor();","data-skiponclick":1,inner:[{className:"Story__cell Story__cell_avatar",inner:{className:"Story__avatar",src:this.avatar,tag:"img"}},{className:"Story__cell Story__cell_title",inner:[{className:"Story__title",inner:[{className:"Story__name",inner:a(this.name)},this.authorIcon?{className:"Story__verified",inner:{className:r.default.class("Story__icon",{verified:this.verified,prometheus:this.prometheus},"_")}}:null]},{className:"Story__date",inner:u}]}]}]},this.isGroupsMetaStory?{className:"Story__cell Story__gridTitle Story__gridTitle--hide",inner:o.mobile_stories_groups_grid_title}:null,this.renderAddToNarrativeIcon(),{className:"Story__cell"+(this.isMetaStory?"":" Story__cell_close"),onclick:"return Stories.clickClose();",inner:{className:"Story__close"+(this.isMetaStory?" Story__close--grid":""),inner:{className:"Story__icon Story__icon_close"}}}]}]},this.renderStoryFooter(),this.can_comment?{className:"Story__form Story__form_comment",inner:[(e={className:"Story__formOverlay"},e[s]="cancelEvent(event);",e[c]="cancelEvent(event);",e.ontouchmove="cancelEvent(event);",e),{className:"Story__formPopout",ontouchmove:"cancelEvent(event);",onmousedown:"event.stopPropagation();",ontouchend:"event.stopPropagation();",inner:[{className:"Story__formHeader",inner:this.narrative?o.mobile_stories_comment_narrative_title:o.mobile_stories_comment_title},{className:"Story__formBody",inner:{className:"Story__formTextarea Story__commentTextarea",tag:"textarea",placeholder:o.mobile_stories_comment_textarea,oninput:"Stories.onInputComment(this);"}},{className:"Story__formFooter",inner:[{className:"Story__formSend Story__commentSend",onclick:"Stories.sendComment();",inner:o.mobile_stories_comment_ok},{className:"Story__formCancel",inner:o.mobile_stories_comment_cancel,onclick:"Stories.hideComment();"}]}]}]}:null,this.can_ask?this.renderAskForm():null,(t={className:"Story__overlay"},t[s]="cancelEvent(event);",t[c]="cancelEvent(event); Stories.hideMenu();",t.ontouchmove="cancelEvent(event);",t),this.clickable_stickers?{className:"Story__stickers"}:null,{className:"Story__body",style:"background-image: url("+this.preview+")"}]})},t.renderAddToNarrativeIcon=function(){if(!this.canAddToNarrative||this.narrative)return!1;var e=r.default.class("Story__toNarrative",{active:this.isPartOfNarrative});return{inner:[{inner:[this.isPartOfNarrative?(0,y.Icon24NarrativeActiveOutline)():(0,y.Icon24NarrativeOutline)(),window.helpHints.canShow(w.AvailableHelpHints.ACCOUNT_HINT_NARRATIVES_ADD_TOOLTIP)?(0,p.default)({inner:[(0,f.getLang)("mobile_stories_add_stories_to_narrative_hint_text")],"tooltip-id":w.AvailableHelpHints.ACCOUNT_HINT_NARRATIVES_ADD_TOOLTIP,onboarding:!0,pos:"bottom_right"}):null],class:e,tag:"div"}],class:"Story__cell",onClick:"return Stories.manageStoryInNarratives();",tag:"div"}},t.renderStoryFooterStatsReplies=function(){return{className:"Story__replies Story__cell",onclick:'Stories.showViews("'+this.raw_id+'")',inner:[{className:"Story__cell",inner:{className:"Story__icon Story__icon_replies Story__repliesIcon"}},{className:"Story__cell Story__repliesText",inner:this.replies}]}},t.renderStoryFooterStatsViews=function(){return{className:"Story__views Story__cell",onclick:"Stories."+(this.needShowEmptyStats?"showEmptyStats":"showViews")+'("'+this.raw_id+'")',inner:[{className:"Story__cell",inner:{className:"Story__icon Story__icon_views Story__viewsIcon"}},this.views?{className:"Story__cell Story__viewsText",inner:this.views}:null]}},t.renderStoryFooterStats=function(){return{className:r.default.class("Story__cell",{empty:Boolean(this.link)&&!this.replies&&!this.views,hidden:!(this.replies||this.views||this.link||this.needShowEmptyStats),stats:!0},"_"),inner:this.replies||this.views||this.needShowEmptyStats?{className:r.default.class("Story__stats",{new_questions:this.isNewQuestions,new_hint:!this.isNewQuestions&&this.needShowEmptyStats},"_"),inner:[this.replies?this.renderStoryFooterStatsReplies():null,this.views||this.needShowEmptyStats?this.renderStoryFooterStatsViews():null]}:null}},t.renderStoryFooterComments=function(){return{className:"Story__cell Story__cell_comment",inner:{className:"Story__commentButton",inner:{className:"Story__commentButtonText",inner:window.lang.mobile_stories_comment_placeholder},onclick:"Stories.showComment();"}}},t.renderStoryFooterMoreLink=function(){return{className:"Story__cell Story__cell_moreLink",inner:{className:"Story__moreLink",inner:[{className:"Story__moreLinkText",inner:(0,f.winToUtf)(this.link.text)},"video"!==this.type?{className:"Story__icon Story__icon_topArrow"}:null],href:this.getLinkUrl(),onclick:"Stories.openCustomButton(event, this); return;","data-skiponclick":1}}},t.renderStoryFooterShare=function(){return{className:"Story__cell Story__cell_share",inner:{className:"Story__share",onclick:'Stories.share("'+(this.narrative?this.narrative.ownerId+"_"+this.narrative.id:this.raw_id)+'", '+!!this.narrative+");",inner:{className:"Story__icon Story__icon_share","data-skiponclick":1}}}},t.renderStoryFooterVerticalButtons=function(e){return{className:"Story__verticalButtons",inner:[e?{className:"Story__verticalButton Story__app "+(e.hasNewInteractions?"has_new":""),onclick:"Stories.clickToApp();",inner:(0,y.Icon48Services)()}:null,this.canLike?{className:"Story__verticalButton Story__like"+(this.isLiked?" Story__like--set":""),onclick:"Stories.toggleLikeForCurrentStory(this)",inner:(0,d.default)(this.isLiked?(0,g.getLikeShadow48Icon)():(0,A.getLikeOutlineShadow48Icon)())}:null]}},t.renderStoryFooter=function(){var e=this.getSticker(c.StickerTypes.app);return{className:"Story__footer",inner:this.isMetaStory||this.is_expired?null:{className:"Story__table",inner:[this.renderStoryFooterStats(),this.link&&this.link.text?this.renderStoryFooterMoreLink():this.can_comment?this.renderStoryFooterComments():null,this.can_share?this.renderStoryFooterShare():null,this.needMenu?{className:"Story__cell Story__cell_menu",inner:i.default.wrap(this.storyMenuHTML)}:null,e||this.canLike?this.renderStoryFooterVerticalButtons(e):null]}}},t.renderAskForm=function(){var e,t=window.lang,n=l.isTouch?"ontouchstart":"onmousedown",i=l.isTouch?"ontouchend":"onmouseup";return{className:"Story__form Story__form_question",onClick:"Stories.toggleQuestionTooltip(event, true);",inner:[(e={className:"Story__formOverlay"},e[n]="cancelEvent(event);",e[i]="Stories.toggleQuestionTooltip(event, true);",e.ontouchmove="cancelEvent(event);",e),{className:"Story__formPopout",ontouchmove:"cancelEvent(event);",onmousedown:"event.stopPropagation();",ontouchend:"event.stopPropagation();",inner:[{className:"Story__formHeader",inner:{className:"Story__formHeaderInner",inner:[{tag:"button",className:"Btn Btn_theme_none Story__formHeaderBtn Story__questionSelect",inner:t.mobile_stories_ask_question_author_only,onclick:"Stories.changeAskAnonymous(event);","data-selected":1},{className:"QuestionSupport Icon Icon_menu_support",onclick:"Stories.toggleQuestionTooltip(event);",inner:{className:"QuestionSupport__tooltip"}}]}},{className:"Story__formBody",inner:{className:"Story__formTextarea Story__questionTextarea",tag:"textarea",placeholder:t.mobile_stories_ask_question_placeholder,oninput:"Stories.onInputQuestion(this);",maxlength:80}},{className:"Story__formFooter",inner:[(0,u.default)({className:"Story__questionSend",theme:"regular",inner:t.mobile_stories_ask_question_ok,on_click:["Stories.sendQuestion"],disabled:!0}),(0,u.default)({className:"Story__questionSend",theme:"link",inner:t.mobile_stories_ask_question_cancel,on_click:["Stories.hideAskQuestion"]})]}]}]}},t._getStickerStyle=function(e,t){var n=this.clickable_stickers,i=n.original_width,o=n.original_height,a=e.top,r=e.left,s=e.width,l=e.height,c=e.rotate,u=(0,_.getSize)(t),d=u[0],f=u[1],p=d,m=f;return f/d>1.77?p=i*f/o:m=o*d/i,"\n      top: "+(a*m-(m-f)/2)+"px;\n      left: "+(r*p-(p-d)/2)+"px;\n      width: "+s*p+"px;\n      height: "+l*m+"px;\n      transform: rotate("+c+"deg);\n    "},t.renderStickersLayer=function(e){var t,n,o=this,a=e.querySelector(".Story__stickers");if(a){var r=((0,_.isObject)(this.clickable_stickers)?this.clickable_stickers:{}).stickers,s=l.isTouch?"ontouchstart":"onmousedown",u=l.isTouch?"ontouchend":"onmouseup";a&&(a.innerHTML=""),a.appendChild(i.default.elem(((t={className:"Story__stickersDisableArea Story__stickersDisableArea--left"})[s]="Stories.onTouchStart(event);",t[u]="Stories.onTouchEnd(event, true);",t.ontouchcancel="Stories.onTouchEnd(event, true);",t))),a.appendChild(i.default.elem(((n={className:"Story__stickersDisableArea Story__stickersDisableArea--right"})[s]="Stories.onTouchStart(event);",n[u]="Stories.onTouchEnd(event);",n.ontouchcancel="Stories.onTouchEnd(event);",n))),r.forEach((function(t){var n,r=t.id,l=t.type,d=t.style;if([c.StickerTypes.hashtag,c.StickerTypes.mention,c.StickerTypes.question,c.StickerTypes.place,c.StickerTypes.music,c.StickerTypes.storyReply,c.StickerTypes.owner,c.StickerTypes.link,c.StickerTypes.marketItem,c.StickerTypes.post,c.StickerTypes.poll,c.StickerTypes.app,c.StickerTypes.sticker,c.StickerTypes.situationalTheme].includes(l)){var f=i.default.elem(((n={className:"Story__sticker"})[s]="Stories.onTouchStart(event);",n[u]="Stories.onTouchEnd(event);",n.ontouchcancel="Stories.onTouchEnd(event);",n.style=""+o._getStickerStyle(t,e),n));switch((0,_.domData)(f,"id",r),(0,_.domData)(f,"type",l),d&&(0,_.domData)(f,"style",d),l){case c.StickerTypes.hashtag:(0,_.domData)(f,"hashtag",t.hashtag);break;case c.StickerTypes.mention:(0,_.domData)(f,"mentioned_photo_url",t.mentionedPhotoUrl),(0,_.domData)(f,"mentioned_owner_href",t.mentionedOwnerHref),(0,_.domData)(f,"mentioned_text",t.mentionedText);break;case c.StickerTypes.question:(0,_.domData)(f,"question",t.question);break;case c.StickerTypes.place:if(o.store.list==="place"+t.placeId)return;(0,_.domData)(f,"place_id",t.placeId);break;case c.StickerTypes.music:var p=window.Stories.getCurrentStory(),m=t.audioId,h=t.audioData,v=t.audioRestriction;if(v)o.getVideo()&&p.needMute&&o.mute(!0),a.appendChild(i.default.elem({className:"StoryRestriction",inner:{className:"StoryRestriction__inner",inner:[{className:"StoryRestriction__title",inner:v.title},v.buttonUrl?{className:"StoryRestriction__link",href:v.buttonUrl,inner:v.buttonText}:null]}})),(0,_.domData)(f,"disabled",1);null==f||f.classList.add("audio_item"),null==f||f.classList.add("audio_item_"+m),(0,_.domData)(f,"id",m),(0,_.domData)(f,"audio",h);try{(0,_.domData)(f,"track-code",JSON.parse(h).track_code)}catch(e){}f.setAttribute("id","audio"+m);break;case c.StickerTypes.storyReply:(0,_.domData)(f,"owner-id",t.ownerId),(0,_.domData)(f,"story-id",t.storyId),(0,_.domData)(f,"is-expired",t.isExpired),(0,_.domData)(f,"link",t.link);break;case c.StickerTypes.owner:(0,_.domData)(f,"owner-id",t.ownerId),(0,_.domData)(f,"link",t.link);break;case c.StickerTypes.link:(0,_.domData)(f,"link",t.link),(0,_.domData)(f,"tooltip-text",t.tooltipText);break;case c.StickerTypes.marketItem:(0,_.domData)(f,"photoUrl",t.photoUrl),(0,_.domData)(f,"link",t.link),t.isRestricted&&(0,_.domData)(f,"isRestricted","isRestricted");break;case c.StickerTypes.post:(0,_.domData)(f,"post-owner-id",t.postOwnerId),(0,_.domData)(f,"post-id",t.postId);break;case c.StickerTypes.poll:(0,_.domData)(f,"pollId",t.pollId),(0,_.domData)(f,"pollOwnerId",t.pollOwnerId);break;case c.StickerTypes.app:(0,_.domData)(f,"app-id",t.appId),(0,_.domData)(f,"app-ref",t.appRef),(0,_.domData)(f,"app-hash",t.appHash);break;case c.StickerTypes.sticker:(0,_.domData)(f,"link","/stickers?stickers_id="+t.stickerPackId),(0,_.domData)(f,"tooltip-text",t.tooltipText);break;case c.StickerTypes.situationalTheme:(0,_.domData)(f,"situational-app-id",t.situationalAppId),(0,_.domData)(f,"situational-theme-id",t.situationalThemeId)}a.appendChild(f),o.stickers.push(f)}}))}},t._onResizeHandle=function(){var e,t=this,n=null==(e=this.authorElem)?void 0:e.querySelector(".Story"),i=((0,_.isObject)(this.clickable_stickers)?this.clickable_stickers:{}).stickers;(0,f.isArray)(i)&&i.forEach((function(e,i){t.stickers[i]&&(0,_.setStyle)(t.stickers[i],t._getStickerStyle(e,n))}))},t._createStickerLink=function(e,t){void 0===t&&(t={});var n=(0,_.intval)((0,_.domData)(e,"disabled")),o=window.lang;if(t.type&&!n){var a,r,s="a",l=!0,u="Stories__tooltipLink",p=function(){},h={type:t.type,style:(0,_.domData)(e,"style")};switch(t.type){case c.StickerTypes.hashtag:var g=(0,_.domData)(e,"hashtag")||"",A=g.replace("#","%23");a="/feed?section=search&q="+A,r=o.mobile_stories_show_hashtag_link,h.text=g;break;case c.StickerTypes.mention:var y=(0,_.domData)(e,"mentioned_photo_url"),w=(0,_.domData)(e,"mentioned_owner_href"),S=(0,_.domData)(e,"mentioned_text");u+=" Stories__tooltipLink--mention",a=w,r=i.default.html([{className:"StoriesTooltipMention",inner:[{className:"StoriesTooltipMention__avatar",style:"background-image: url("+y+")"},{className:"StoriesTooltipMention__text",inner:S}]}]);break;case c.StickerTypes.place:var b=(0,_.domData)(e,"place_id"),k=window.Stories.getFrom();a="/place"+b,r=o.mobile_stories_go_to_place,this.store.list.includes("place")?l=!0:(a+="?from="+k,p=function(){s="div",l=!1,window.Stories._hideTooltips(!0),window.Stories.showLoading(),nav.go(a)});break;case c.StickerTypes.music:s="div",r=o.mobile_stories_music_more,p=function(){var t=(0,_.domData)(e,"id"),n=(0,_.domData)(e,"audio");window.Stories.openMusicStickerActions(t,n)};break;case c.StickerTypes.storyReply:case c.StickerTypes.owner:var C=(0,_.domData)(e,"owner-id"),E=(0,_.domData)(e,"story-id"),I=(0,_.domData)(e,"is-expired");if(t.type===c.StickerTypes.owner||I)r=C>0?o.mobile_stories_go_to_profile:o.mobile_stories_go_to_group,a=(0,_.domData)(e,"link");else{var T=C+"_"+E,M="story"+T+"/"+T;s="div",r=o.mobile_stories_go_to_story,p=function(){window.Stories.openReplies(M)}}break;case c.StickerTypes.link:r=(0,_.domData)(e,"tooltip-text"),a=(0,_.domData)(e,"link");break;case c.StickerTypes.marketItem:var P=(0,_.domData)(e,"photoUrl"),L=!!(0,_.domData)(e,"isRestricted");L&&(p=function(e){e.preventDefault(),window.AlertBox((0,f.getLang)("mobile_stories_market_access_error_text"),(0,f.getLang)("mobile_stories_market_access_error_title"))}),r=i.default.html([P&&!L?{className:"Stories__marketItemThumb",tag:"img",src:P}:{className:"Stories__marketItemThumb Stories__marketItemThumb--stub",inner:(0,d.default)((0,v.getItemStubIcon)())},{className:"Stories__marketItemText",tag:"span",inner:(0,f.getLang)("mobile_stories_market_item_more")}]),a=(0,_.domData)(e,"link");break;case c.StickerTypes.post:var N=(0,_.domData)(e,"post-owner-id"),R=(0,_.domData)(e,"post-id");r=o.mobile_stories_go_to_post,a="/wall"+N+"_"+R;break;case c.StickerTypes.sticker:r=(0,_.domData)(e,"tooltip-text"),a=(0,_.domData)(e,"link")}return(0,_.ce)(s,{href:"a"===s?a:null,target:l?"_blank":null,innerHTML:r+i.default.html({inner:[(0,d.default)({icon:(0,m.getGotoArrow8Icon)()})],class:"Stories__tooltipLinkIcon",tag:"span"}),className:u,onclick:function(e){p&&p(e),[c.StickerTypes.hashtag,c.StickerTypes.mention,c.StickerTypes.place,c.StickerTypes.storyReply,c.StickerTypes.post,c.StickerTypes.link,c.StickerTypes.sticker,c.StickerTypes.situationalTheme].includes(t.type)&&window.Stories.sendAnalyticsEvent("click_to_tooltip",{clickable_sticker:{id:t.id,type:c.StickerTypeLabel[t.type]}})}})}},t._onLoadingStart=function(){this._loadingStartTime=new Date},t.renderAppsMetaStory=function(){var e="apps",t=window.lang;window.store.stories.apps||(window.store.stories.apps=window.Stories._forceSetStore(this.raw_id+"/"+e,e,window.store.storiesLists.apps));var n=window.store.stories.apps&&window.store.stories.apps.authors,i=Math.max(document.documentElement.clientHeight,window.innerHeight||0),o=[];return n&&(this.coverItems=n,this.coverCount=this.coverItems?this.coverItems.length:0,this.coverRowsCount=Math.ceil(this.coverCount/3),this.scrollOffset=0,this.metaStoryGridMarginTop=40.8*i/100,this.coverItems.forEach((function(e){var t=e.items.filter((function(e){return e.unread})),n=!!t.length,i=e.items[0],a=e.id?"{ id: '"+e.id+"' }":"{}";n&&(i=t[0]);var r={tag:"span",className:"GridStoryPreview",style:"background-image: url("+i.preview_url+")",onclick:'Stories.openNarrative("'+i.raw_id+"/"+'apps", '+a+")",inner:[{className:"GridStoryPreview__inner",style:"background-image: url("+i.small_preview+")",inner:[{tag:"a",href:e.author.href,attrs:{"data-author-id":e.author.id},className:"GridStoryPreview__author"+(n?" GridStoryPreview__author--unread":""),style:"background-image: url("+e.author.photo+")"},{tag:"span",className:"GridStoryPreview__title",innerHTML:e.author.name}]}]};o.push(r)}))),{className:"MetaStory MetaStory--apps",inner:[{className:"MetaStory__infoWrapper",inner:[{className:"MetaStory__info",inner:[{tag:"a",href:this.app.url,target:"_blank",className:"MetaStory__appWrapper",inner:[{className:"MetaStory__appIcon",style:"background-image: url("+this.app.photoUrl+")"},{className:"MetaStory__appName",innerHTML:this.app.name},{className:"MetaStory__separator"},{tag:"span",className:"MetaStory__appLink",innerHTML:t.mobile_stories_go_to_app}]}]}]},o.length?{className:"MetaStory__recommendations",inner:[{className:"MetaStory__recommendations-inner",inner:[{className:"MetaStory__recommendations-items",inner:o}]}]}:null]}},t.renderGroupsMetaStory=function(){var e="groups",t=window.lang;window.store.stories[e]||(window.store.stories[e]=window.Stories._forceSetStore(this.raw_id+"/"+e,e,window.store.storiesLists[e]));var n=window.store.stories[e]&&window.store.stories[e].authors,i=Math.max(document.documentElement.clientHeight,window.innerHeight||0),o=[];return n&&(this.coverItems=n,this.coverCount=this.coverItems?this.coverItems.length:0,this.coverRowsCount=Math.ceil(this.coverCount/3),this.scrollOffset=0,this.metaStoryGridMarginTop=40.8*i/100,this.coverItems.forEach((function(t){var n=t.items.filter((function(e){return e.unread})),i=!!n.length,a=t.items[0],r=t.id?"{ id: '"+t.id+"' }":"{}";i&&(a=n[0]);var s={tag:"span",className:"GridStoryPreview",style:"background-image: url("+a.preview_url+")",onclick:'Stories.openNarrative("'+a.raw_id+"/"+e+'", '+r+")",inner:[{className:"GridStoryPreview__inner",style:"background-image: url("+a.small_preview+")",inner:[{tag:"a",href:t.author.href,attrs:{"data-author-id":t.author.id},className:"GridStoryPreview__author"+(i?" GridStoryPreview__author--unread":""),style:"background-image: url("+t.author.photo+")"},{tag:"span",className:"GridStoryPreview__title",innerHTML:t.author.name}]}]};o.push(s)}))),{className:"MetaStory MetaStory--groups",inner:[{className:"MetaStory__infoWrapper",inner:[{className:"MetaStory__info",inner:[{className:"MetaStory__infoTitle",inner:t.mobile_stories_groups_grid_title},{className:"MetaStory__infoDescription",inner:t.mobile_stories_groups_grid_text}]}]},o.length?{className:"MetaStory__recommendations",inner:[{className:"MetaStory__recommendations-inner",inner:[{className:"MetaStory__recommendations-items",inner:o}]}]}:null]}},t.pauseAudio=function(){window.Stories.pauseAudio()},t.destroy=function(){this.img&&this.img.removeEventListener("load",this.onLoadImg),this.video&&(this.video.removeEventListener("ended",this.onVideoEndedBind),this.video.removeEventListener("play",this.onVideoPlayBind),this.video.removeEventListener("pause",this.onVideoPauseBind),this.video.removeEventListener("canplaythrough",this.onCanPlayBind),this.video.removeEventListener("waiting",this.onVideoWaitingBind),this.video.removeEventListener("loadedmetadata",this.onVideoLoadedDataBind),this.video.removeEventListener("playing",this.onVideoPlayingBind),this.video.removeEventListener("seeking",this.onVideoSeekingBind),this.video.removeEventListener("seeked",this.onVideoSeekedBind),this.video.src="",this.video.load()),this.onDestroy(),this.onAutoPlay.off(),this.onDestroy.off(),this.onVideoBuffering.off(),this.onVideoData.off(),this.onVideoPlayEvent.off(),this.onVideoPauseEvent.off(),this.onVideoEndedEvent.off(),this.onMute.off(),this.onUnMute.off(),window.Stories._hideTooltips()},e}()},77858:function(e,t,n){"use strict";n.d(t,{default:function(){return s}});var i=n(86205),o=n(11393),a=n(1374),r=n(55404),s=function(){function e(e){this.store=window.Stories.getStore(),this.extendedStats=this.store.extendedStats[e]}var t=e.prototype;return t.render=function(){var e=this,t=window.lang;return o.default.elem({inner:[{inner:[{inner:[{inner:[{inner:[t.mobile_stories_extended_stats_title],class:"StoryExtendedStats__title",tag:"div"}],class:"StoryExtendedStats__cell",tag:"div"}],class:"StoryExtendedStats__table",tag:"div"},{inner:[(0,i.default)({icon:(0,a.getBackOutline28Icon)()})],class:"StoryExtendedStats__back Btn Btn_theme_none",onClick:"Stories.hideExtendedStats();",tag:"button"}],class:"StoryExtendedStats__header",tag:"div"},{inner:[{inner:[this.extendedStats.achievement?{inner:[{inner:[(0,i.default)({icon:(0,r.getStatisticGrow28Icon)()})],class:"StoryExtendedStatsAchievement__before",tag:"div"},{inner:[{inner:[this.extendedStats.achievement],class:"StoryExtendedStatsAchievement__label",tag:"div"},{inner:[this.extendedStats.achievementSubtitle],class:"StoryExtendedStatsAchievement__subtitle",tag:"div"}],class:"StoryExtendedStatsAchievement__content",tag:"div"}],class:"StoryExtendedStatsAchievement StoryViewsSeparator",tag:"div"}:null,this.extendedStats.categories.map((function(t){return e.renderCategory(t)}))],class:"StoryExtendedStats__inner",onTouchMove:"event.stopPropagation();",tag:"div"}],class:"StoryExtendedStats__body",tag:"div"}],class:"StoryExtendedStats",tag:"div"})},t.renderCategory=function(e){var t=this;return{inner:[{inner:[e.title],class:"StoryExtendedStatsCategory__title",tag:"div"},{inner:[e.lines.map((function(e){return t.renderCategoryLine(e)}))],class:"StoryExtendedStatsCategory__lines",tag:"div"}],class:"StoryExtendedStatsCategory StoryViewsSeparator",tag:"div"}},t.renderCategoryLine=function(e){return{inner:[{inner:[e.name],class:"StoryExtendedStatsCategoryLine__name",tag:"div"},{inner:[e.counter],class:"StoryExtendedStatsCategoryLine__counter",tag:"div"}],class:"StoryExtendedStatsCategoryLine",tag:"div"}},e}()},93168:function(e,t,n){"use strict";n.d(t,{default:function(){return r}});var i=n(46950),o=n(86353),a=n(12813),r=function(){function e(e){this.store=window.Stories.getStore(),this.data=e,this.rawId=e.raw_id,this.canRemove=e.can_remove,this.canReport=e.canReport,this.canBookmark=e.canBookmark,this.canMarkNotInterested=e.canMarkNotInterested,this.isAds=e.isAds,this.trackCode=e.track_code,this.isBookmarked=e.isBookmarked,this.narrative=e.narrative,this.isNarrative=!!e.narrative,this.canAddToNarrative=e.canAddToNarrative&&!this.isNarrative,this.canEditNarrative=this.isNarrative&&e.canAddToNarrative,this.canRemoveFromNarrative=this.isNarrative&&e.canAddToNarrative,this.isPartOfNarrative=e.isPartOfNarrative,this.reportUrl=this.getReportUrl(),this.hideUrl=this.getHideUrl()}var t=e.prototype;return t.needMenu=function(){return this.canRemove||this.canReport||this.canBookmark||this.canMarkNotInterested||this.canAddToNarrative||this.canEditNarrative||this.canRemoveFromNarrative},t.getHideUrl=function(){var e=window.Stories.getHistoryURL(this.rawId),t=window.Stories.getFrom();return this.isAds&&(0,o.partConfigEnabled)("ads_new_reports_mvk_histories")?"/reports?act=hide_ad&object="+e+"&refrom="+t+"&track_code="+this.trackCode:""},t.getReportUrl=function(){var e=this.isNarrative?"narrative"+this.narrative.rawId:window.Stories.getHistoryURL(this.rawId),t=window.Stories.getFrom();return this.isAds&&(0,o.partConfigEnabled)("ads_new_reports_mvk_histories")?"/reports?act=add_ad&object="+e+"&refrom="+t+"&track_code="+this.trackCode:(0,a.getStoryReportUrl)({type:this.isNarrative?"narrative":"story",rawId:this.isNarrative?this.narrative.rawId:this.rawId,refrom:t})},t.render=function(){return Wd.html({inner:[{inner:[{class:"Story__icon Story__icon_menu",tag:"div"}],class:"StoryMenu__trigger",onClick:"Stories.showMenu();",tag:"div"},{inner:[this.canAddToNarrative?{inner:[{inner:[(0,i.getLang)("mobile_stories_menu_add_to_narrative")],class:"Btn Btn_theme_none StoryMenu__button",onClick:"Stories.manageStoryInNarratives();",tag:"button"}],class:"StoryMenu__row",tag:"div"}:null,this.canEditNarrative?{inner:[{inner:[(0,i.getLang)("mobile_stories_menu_edit_narrative")],class:"Btn Btn_theme_none StoryMenu__button",onClick:"return Stories.editCurrentNarrative(event);",tag:"button"}],class:"StoryMenu__row",tag:"div"}:null,this.canBookmark?{inner:[{inner:[this.isBookmarked?(0,i.getLang)("mobile_stories_menu_bookmarked_title"):(0,i.getLang)("mobile_stories_menu_bookmark_title")],class:"Btn Btn_theme_none StoryMenu__button",onClick:"Stories.toggleBookmark(this);",tag:"button"}],class:"StoryMenu__row",tag:"div"}:null,this.canRemoveFromNarrative?{inner:[{inner:[(0,i.getLang)("mobile_stories_menu_remove_from_narrative")],class:"Btn Btn_theme_none StoryMenu__button",onClick:"Stories.removeCurrentStoryFromNarrative();",tag:"button"}],class:"StoryMenu__row",tag:"div"}:null,this.canRemove?{inner:[{inner:[this.isNarrative?(0,i.getLang)("mobile_stories_menu_remove_narrative_title"):(0,i.getLang)("mobile_stories_menu_remove_title")],class:"Btn Btn_theme_none StoryMenu__button",onClick:"Stories.removeCurrentStory();",tag:"button"}],class:"StoryMenu__row",tag:"div"}:null,this.canReport?{inner:[{inner:[(0,i.getLang)("mobile_stories_menu_report_title")],class:"Btn Btn_theme_none StoryMenu__button",href:this.reportUrl,onClick:"return nav.go(this, event);",tag:"a"}],class:"StoryMenu__row",tag:"div"}:null,this.canMarkNotInterested?{inner:[{inner:[(0,i.getLang)("mobile_stories_menu_not_interested_title")],class:"Btn Btn_theme_none StoryMenu__button",onClick:"Stories.markCurrentStoryNotInterested('"+this.hideUrl+"');",tag:"button"}],class:"StoryMenu__row",tag:"div"}:null],class:"StoryMenu__container",tag:"div"}],class:"StoryMenu",tag:"div"})},e}()},28600:function(e,t,n){"use strict";var i=n(46950),o=n(11393),a=n(49751),r=n(83718),s=n(27109),l=n(35909);t.default=function(e){var t="width: "+e.artboardWidth+"px; height: "+e.artboardHeight+"px",n=e.background_type===r.StoryPublisherBackgroundType.IMAGE?{class:"StoryPublisher__canvasLayer",width:"1080",height:"1920",style:t,tag:"canvas"}:{inner:[{src:e.src,tag:"source"}],class:"StoryPublisher__video",preload:"metadata",controls:!0,controlsList:"nodownload",onContextMenu:"cancelEvent(); return false;",tag:"video"},c=o.default.wrap((0,i.getLang)("mobile_apps_story_publisher_description").replace("{service_name}",e.miniAppName));return{inner:[{inner:[(0,a.default)({inner:[(0,l.Icon28CancelOutline)()],theme:"header",class:"StoryPublisher__headerButton",onClick:"StoryPublisher.closePopup()",use_native_onclick:!0,is_icon:!0})],class:"StoryPublisher__header",tag:"div"},{inner:[(0,s.default)({mix:"al_loading StoryPublisher__spinner",type:"pageLoader",isFixed:!0}),{inner:[n],class:"StoryPublisher__canvas",style:t,tag:"div"},{inner:[c],class:"StoryPublisher__description",tag:"div"},(0,a.default)({inner:[o.default.wrap((0,i.getLang)("mobile_apps_story_publisher_publish_btn_text"))],onClick:"StoryPublisher.save(this)",use_native_onclick:!0})],class:"StoryPublisher__content",tag:"div"}],class:"Popup StoryPublisher",tag:"div"}}},67395:function(e,t,n){"use strict";var i=n(28600);n(1934);window.StoryPublisher=i.default;i.default},21965:function(e,t,n){"use strict";n.d(t,{default:function(){return a}});var i=n(11393),o=n(85489),a=function(){function e(e){this.store=window.Stories.getStore(),this.questions=this.store.questions[e]||[]}return e.prototype.render=function(){var e=window.lang;return i.default.elem({class:o.default.class("Questions"),inner:[{class:"Questions__header",inner:[{class:"Questions__table",inner:[{class:"Questions__cell",inner:{class:"Questions__title",inner:e.mobile_stories_question_title}}]},{class:"Questions__close",onclick:"Stories.hideQuestions();"}]},{class:"Questions__body",inner:[{class:"Questions__inner",ontouchmove:"event.stopPropagation();",inner:this.questions.map((function(t){return{class:"Question","data-id":t.id,inner:[{class:"Question__content",inner:[{href:t.author.link,class:"Question__author",inner:t.isAnonymous?e.mobile_stories_question_anonymous:t.author.name},{class:o.default.class("Question__text",{small:t.text.length>40},"_"),inner:t.text}]},{class:o.default.class("Question__actions",{published:t.isPublished},"_"),inner:e.mobile_stories_question_actions,onclick:["Stories.openQuestionActions",t.id]}]}}))}]}]})},e}()},8903:function(e,t,n){"use strict";var i=n(46950),o=n(85489),a=n(35909);t.default=function(e){void 0===e&&(e={});var t=o.default.class("StoryThumb",{draggable:e.isDraggable}),n=o.default.class("StoryThumb__checkbox",{checked:e.isSelected}),r=e.story||{},s=e.onClick?e.onClick:r.isUnavailable?null:["Stories.init",r.rawId+"/"+r.listId];e.isSelectable&&!r.isUnavailable&&(s=[e.onStoryThumbCheck,"event",e.story]);var l=(0,i.getDayNumberFromUnixtime)(r.time),c=(0,i.getLang)("months_sm_of","raw")[(0,i.getMonthNumberFromUnixtime)(r.time)];return{inner:[e.isDateHidden?null:{inner:[{inner:[l],class:"StoryThumbDate__day",tag:"div"},{inner:[c],class:"StoryThumbDate__month",tag:"div"}],class:"StoryThumbDate",tag:"div"},e.isSelectable?{inner:[{inner:[(0,a.Icon24CheckCircleOn)()],class:"StoryThumb__checkboxCheckedIcon",tag:"div"},{inner:[(0,a.Icon24CheckCircleOff)()],class:"StoryThumb__checkboxUncheckedIcon",tag:"div"}],class:n,onClick:[e.onStoryThumbCheck,"event",e.story],tag:"div"}:null,r.isUnavailable?{inner:[{inner:[(0,a.Icon24Error)()],class:"StoryThumbUnavailable__icon",tag:"div"},{inner:[(0,i.getLang)("mobile_stories_archive_unavailable_label")],class:"StoryThumbUnavailable__label",tag:"div"}],class:"StoryThumbUnavailable",tag:"div"}:null],class:t,onClick:s,style:r.isUnavailable?null:"background-image: url("+r.preview+")","data-time":r.time,"data-story-id":r.id,tag:"div"}}},78881:function(e,t,n){"use strict";n.d(t,{fixStoryThumbHeaders:function(){return r}});var i=n(8903),o=n(1730),a=n(9046);function r(e){if(!e)return!1;var t={},n=(0,o.$$)(".StoryThumb[data-time]",e);n&&n.length&&n.forEach((function(e,i){var o=(0,a.geByClass1)("StoryThumbDate",e);if(o){var r=n[i-1],s=r&&1e3*r.getAttribute("data-time"),l=s&&new Date(s),c=l&&l.toDateString(),u=1e3*e.getAttribute("data-time"),d=new Date(u).toDateString(),_=c===d;t[d]&&t[d]!==u&&_?(0,a.setStyle)(o,"display","none"):(t[d]=u,(0,a.setStyle)(o,"display","block"))}}))}t.default=i.default},36162:function(e,t,n){"use strict";n.d(t,{default:function(){return _}});var i=n(11393),o=n(86205),a=n(39423),r=n(75095),s=n(46950),l=n(85489),c=n(62501),u=n(35909),d=n(86353),_=function(){function e(e){var t=window.lang;this.store=window.Stories.getStore(),this.viewers=this.store.viewers[e]||[],this.viewersState=this.store.viewersState[e]||[],this.questions=this.store.questions[e]||[],this.replies=this.store.replies[e]||[],this.poll=this.store.polls[e],this.extendedStats=this.store.extendedStats[e];var n=this.viewersState,i=n.count,o=n.repliesCountText,a=n.authorCountText,r=n.hiddenReason,l=n.privacyHint;this.raw_id=e,this.count=i,this.countText=(0,s.langNumeric)(this.count,t.mobile_stories_views_title),this.hiddenReason=r,this.repliesCountText=o,this.repliesAuthorCountText=a,this.privacyHint=l||{},this.questions.length||this.privacyHint.showEmptyStatsPrivacyHint||this.extendedStats?this.title=t.mobile_stories_views_title_interactions:this.count&&this.replies.length?this.title=t.mobile_stories_views_title_replies_and_views:this.count?this.title=this.countText:this.replies.length&&(this.title=t.mobile_stories_views_title_replies)}var t=e.prototype;return t.render=function(){var e=this,t=window,n=t.winToUtf,o=t.lang,s=this.store.questions[this.raw_id]||[],c=this.needShowOnlyHiddenViewersInfo(),_=this.viewersState.privacyHint||{},f="/settings?act=privacy&privacy_edit=stories";return(0,d.partConfigEnabled)("mvk_vkui_privacy")&&(f="/vkui/privacy/?hl=stories"),i.default.html({class:l.default.class("Views",{short:!(this.viewers.length||!this.replies.length||this.hiddenReason)},"_"),inner:[{class:"Views__overlay",onclick:"Stories.hideViews();"},{class:"Views__header",inner:[{class:"Views__table",inner:[{class:"Views__cell",inner:{class:"Views__title",inner:this.title}}]},{class:"Views__close",onclick:"Stories.hideViews();"}]},{class:"Views__body ScrollView"+(c?" Views__body--centerAlign":""),onscroll:'Stories.onScrollViews(this, "'+this.raw_id+'")',ontouchmove:"event.stopPropagation();",inner:[this.extendedStats?this.renderExtendedStatsBanner():null,_.showEmptyStatsPrivacyHint?{class:"ViewsEmptyStatsBlock",inner:[{class:"ViewsEmptyStatsBlock__icon",inner:(0,u.Icon56HideOutline)()},{class:"ViewsEmptyStatsBlock__text",inner:o.mobile_stories_feedback_empty_stats_hint},{class:"ViewsEmptyStatsBlock__link",inner:{tag:"a",class:"link",inner:o.mobile_stories_go_to_privacy_settings,href:f,onclick:["Stories.goToSettingsFromPrivacyHint",this.raw_id,"this","event"]}}]}:null,_.showPrivacyHint?{class:"ViewsPrivacyHint",inner:(0,r.default)({subheader:o.mobile_stories_feedback_privacy_hint,asideMode:"dismiss",before:(0,u.Icon28LockOutline)(),actions:{tag:"a",class:"link",inner:o.mobile_stories_go_to_settings,href:f,onclick:["Stories.goToSettingsFromPrivacyHint",this.raw_id,"this","event"]},onDismiss:["Stories.hidePrivacyHint",this.raw_id]})}:null,this.replies.length?{class:"Views__replies StoryViewsSeparator",inner:[{class:"Views__table Views__repliesHeader",inner:[{class:"Views__cell Views__repliesCount",inner:this.repliesCountText},this.repliesAuthorCountText?{class:"Views__cell Views__repliesAuthorCount",inner:this.repliesAuthorCountText}:null]},{class:"Views__repliesBody",onscroll:'Stories.onRepliesScroll(event, "'+this.raw_id+'")',inner:{class:"Views__repliesScroll",inner:this.replies.map((function(t){return{class:"Views__reply "+(t.has_new?"Views__reply_new":""),onclick:'Stories.openReplies("'+t.owner_id+"/"+t.list+'", "'+e.raw_id+'");',inner:[{class:"Views__replyAvatarWrap",inner:{class:"Views__replyAvatar",src:t.photo_owners_data[0].owner_photo_url,tag:"img"}},{class:"Views__replyName",inner:t.name?n(t.name):o.mobile_stories_reply_you}]}}))}}]}:null,this.poll?{class:"Views__poll StoryViewsSeparator",inner:[{class:"Views__pollHeader",inner:o.mobile_wall_poll_head_title},{class:"Views__pollBody",inner:{class:"StoryFeedbackPoll"+("default"===this.poll.background.type?" StoryFeedbackPoll--default":""),inner:[this.getBackgroundElementForPoll(this.poll),{class:"StoryFeedbackPoll__question",inner:this.poll.question},{class:"StoryFeedbackPoll__countVoters",inner:this.poll.votersCountText},{class:"StoryFeedbackPoll__showResult",onclick:"Stories.openPoll("+this.poll.ownerId+", "+this.poll.pollId+", "+this.raw_id+")",inner:o.mobile_voting_show_result}]}}]}:null,s.length?{class:"Views__questions StoryViewsSeparator",inner:[{class:"Views__table Views__questionsHeader",inner:[{class:"Views__cell Views__questionsTitle",inner:o.mobile_stories_question_title},{class:"Views__cell Views__questionsLink",inner:o.mobile_stories_question_show_all,onclick:'Stories.showQuestions("'+this.raw_id+'")'}]},{class:"Views__questionsBody",inner:{class:"Views__questionsScroll",inner:s.slice(0,10).map((function(e){return{class:"Question","data-id":e.id,inner:[{class:"Question__content",inner:[{href:e.author.link,class:"Question__author",inner:e.isAnonymous?o.mobile_stories_question_anonymous:e.author.name,onClick:"Stories.sendAnalyticsEvent('question_go_to_author', { questionId: "+e.id+" });"},{class:l.default.class("Question__text",{small:e.text.length>40},"_"),inner:e.text}]},{class:l.default.class("Question__actions",{published:e.isPublished},"_"),inner:o.mobile_stories_question_actions,onclick:["Stories.openQuestionActions",e.id]}]}}))}}]}:null,{class:"Views__viewers",inner:[this.count&&(s.length||this.replies.length||this.extendedStats)?{class:"Views__viewersHeader",inner:this.countText}:null,{class:"Views__viewersBody",inner:[this.viewers.map((function(e){return{class:"Views__viewer",href:e.href,inner:{class:"Views__table",inner:[{class:"Views__cell Views__cell_avatar",inner:{class:"Views__avatar",inner:[{class:"Views__avatarPhoto",src:e.photo,tag:"img"},e.isLiked?(0,a.default)({mix:"Views__avatarBadgeIcon",icon:"notify_mini_like"}):null]}},{class:"Views__cell Views__cell_name",inner:{class:"Views__name",inner:e.name}}]}}})),this.hiddenReason?{class:"Views__viewersHiddenReason",inner:[{class:"Views__viewersHiddenReasonIcon",inner:(0,u.Icon56HideOutline)()},{class:"Views__viewersHiddenReasonText",inner:this.hiddenReason}]}:null]}]},this.viewersState.nextFrom?{class:"Views__viewersLoader",onclick:'Stories.loadViews("'+this.raw_id+'")'}:null]}]})},t.renderExtendedStatsBanner=function(){var e=window.lang;return{inner:[{inner:[(0,o.default)({icon:(0,c.getStatistic28Icon)()})],class:"ViewsExtendedStatsBanner__before",tag:"div"},{inner:[{inner:[e.mobile_stories_feedback_extended_stats],class:"ViewsExtendedStatsBanner__title",tag:"div"},{inner:[this.extendedStats.preview],class:"ViewsExtendedStatsBanner__subtitle",tag:"div"}],class:"ViewsExtendedStatsBanner__content",tag:"div"},{inner:[(0,u.Icon16Chevron)()],class:"ViewsExtendedStatsBanner__after",tag:"div"}],class:"ViewsExtendedStatsBanner StoryViewsSeparator",onClick:["Stories.showExtendedStats",this.raw_id],tag:"button"}},t.needShowOnlyHiddenViewersInfo=function(){var e=this.store.questions[this.raw_id]||[];return this.count&&this.hiddenReason&&!this.viewers.length&&!this.replies.length&&!e.length&&!this.poll&&!this.extendedStats},t.getBackgroundElementForPoll=function(e){var t=e.background,n=null,i="";if("photo"===t.type)n={class:"StoryFeedbackPoll__photo",style:"background-image: url("+t.photoUrl+")"},i="background: #"+t.backgroundColor;else if("gradient"===t.type){i="background: linear-gradient("+(t.angle-90)+"deg, "+t.points.map((function(e){return"#"+e.color+" "+Math.round(100*e.position)+"%"})).join(", ")+")"}return{class:"StoryFeedbackPoll__background",style:i,inner:n}},e}()},48934:function(e,t,n){"use strict";n.d(t,{close:function(){return s},restore:function(){return l},onTextliveOpen:function(){return c}});var i=n(1730),o=n(38383),a=n(9046),r=n(97398);function s(e){return function(){var e=window.lang;if(!window.helpHints.canShow(r.AvailableHelpHints.ACCOUNT_HINT_TEXTLIVE_HIDE))return;var t=(0,i.$)(".BottomMenu__cell:nth-child(4) .BottomMenu__icon"),n=Wd.elem((0,o.default)({pos:"top_right",theme:"accent",inner:e.mobile_textlive_notifications_tooltip,onboarding:!0,"tooltip-id":r.AvailableHelpHints.ACCOUNT_HINT_TEXTLIVE_HIDE}));t.appendChild(n)}(),ajax.click(e,window.Comment)}function l(e){return ajax.click(e,window.Comment)}function c(){(0,a.statlogsValueEvent)("textlive_banner_action",null,"open")}},60578:function(e,t,n){"use strict";var i=n(48934);window.TextliveFeedBanner={close:i.close,restore:i.restore,onTextliveOpen:i.onTextliveOpen}},88444:function(e,t,n){"use strict";var i=n(86205),o=n(54421),a=n(21632),r=n(57382),s=n(18555),l=n(54195),c=n(506),u=n(10384),d=n(95197),_=n(76513),f=n(95846),p=n(59361);t.default=function(e){var t;switch(e.iconFilename+(e.canPreview?"":"_grey")+"_44"){case"delete_outline_44":t=(0,o.getDeleteOutline44Icon)();break;case"delete_outline_grey_44":t=(0,a.getDeleteOutlineGrey44Icon)();break;case"do_not_disturb_outline_44":t=(0,r.getDoNotDisturbOutline44Icon)();break;case"do_not_disturb_outline_grey_44":t=(0,s.getDoNotDisturbOutlineGrey44Icon)();break;case"hide_outline_44":t=(0,l.getHideOutline44Icon)();break;case"info_outline_44":t=(0,c.getInfoOutline44Icon)();break;case"info_outline_grey_44":t=(0,u.getInfoOutlineGrey44Icon)();break;case"lock_outline_44":t=(0,d.getLockOutline44Icon)();break;case"lock_outline_grey_44":t=(0,_.getLockOutlineGrey44Icon)();break;case"recent_outline_44":t=(0,f.getRecentOutline44Icon)();break;case"recent_outline_grey_44":t=(0,p.getRecentOutlineGrey44Icon)()}var n=[{class:"VideoRestriction__boxWrap",inner:[{class:"VideoRestriction__box",inner:[(0,i.default)(t),{class:"VideoRestriction__title",inner:e.title},{class:"VideoRestriction__text",inner:e.text}]}]}];e.thumb&&n.push({class:"VideoRestriction__thumb",style:"background-image: url("+e.thumb+"); height: 100%; width: 100%;"});e.canPlay&&e.button&&n[0].inner[0].inner.push({class:"VideoRestriction__button",inner:e.button.text,onclick:["VideoRestriction.hideDisclaimerAndPlay"]});return n}},49239:function(e,t,n){"use strict";var i=n(1730),o=n(9046),a=function(){function e(){}return e.hideDisclaimerAndPlay=function(){var e=(0,i.$)(".vv_inline_video");(0,i.$)(".VideoRestriction__boxWrap").remove(),(0,i.$)(".VideoRestriction__thumb").remove(),(0,i.$)(".VideoRestriction").replaceWith((0,i.$)(".VideoRestriction").firstChild),(0,i.$)(".VideoPage__video--short")?((0,o.show)((0,i.$)(".ShortVideo")),(0,i.$)(".ShortVideo__overlay").click()):(e.setAttribute("controls","controls"),e.play());var t=(0,i.$)(".VideoPage__video").parentNode.id||"video";window.ajax.post("/"+t+"?act=agree_disclaimer",{},{onDone:function(e){}})},e}();t.default=a},60279:function(e,t,n){"use strict";var i=n(49239);i.default;window.VideoRestriction=i.default},36182:function(e,t,n){"use strict";var i=n(85489);function o(e){return l({"background-color":e.color})}function a(e){var t,n=[],i=e.points.length;for(t=0;t<i;t++){var o=e.points[t];n.push(o.color+" "+o.percent+"%")}return l({background:"linear-gradient("+(e.angle-90)+"deg, "+(n=n.join(", "))+")"})}function r(e){return l({"background-image":"url('"+e.image+"')","background-position":"top center","background-size":e.width+"px "+e.height+"px"})}function s(e){var t=e.bcg,n=t.photo,i=t.color;return{class:"VotingBcg__photoBox",style:l({height:e.photoHeight+"px"}),inner:[{class:"VotingBcg__photoImage",style:l({"background-image":"url('"+n+"')"})},{class:"VotingBcg__photoGradient",style:l({background:"linear-gradient(to bottom, rgba(255, 255, 255, 0), "+i+")"})}]}}function l(e){var t,n=[],i=Object.keys(e),o=i.length;for(t=0;t<o;t++){var a=i[t],r=e[a];n.push(a+": "+r+";")}return n.join(" ")}t.default=function(e){var t=e.bcg,n=t.type;return{class:i.default.class("VotingBcg",{type:n},"_"),style:"photo"===n?o(t):"gradient"===n?a(t):"tile"===n?r(t):null,inner:"photo"===n?s(e):null}}},28735:function(e,t,n){"use strict";var i=n(36182);t.default=i.default,window.VotingBcg=i.default},78329:function(e,t,n){"use strict";var i=n(85489),o=n(28735);t.default=function(e,t){return{tag:"label",class:i.default.class("VotingForm__bcg",{light:"default"===t.type},"_"),inner:[{class:"VotingForm__bcgPreview",inner:[(0,o.default)({bcg:t,photoHeight:48}),{class:i.default.class("VotingForm__bcgTextGhost",{0:!0},"_")},{class:i.default.class("VotingForm__bcgTextGhost",{1:!0},"_")},{class:i.default.class("VotingForm__bcgTextGhost",{2:!0},"_")},{class:i.default.class("VotingForm__bcgTextGhost",{3:!0},"_")},{class:i.default.class("VotingForm__bcgTextGhost",{4:!0},"_")},{class:i.default.class("VotingForm__bcgTextGhost",{5:!0},"_")}]},{tag:"input",class:"VotingForm__bcgRadio",type:"radio",name:e,checked:t.checked?"checked":null,value:t.id},{class:"VotingForm__bcgControl"}]}}},93570:function(e,t,n){"use strict";var i=n(39423),o=n(81755);t.default=function(e){return{class:"VotingForm__option","data-created":e.is_created?"1":"0",inner:[(0,o.default)({class:"VotingForm__optionInput",name:e.name,value:e.value,on_key_down:"VotingForm._onOptionKeyDown"}),{class:"VotingForm__optionRemove",onclick:["VotingForm._onOptionRemoveClick","this"],inner:(0,i.default)({icon:"close16"})}]}}},18903:function(e,t,n){"use strict";var i=n(1730),o=n(9046),a=n(78329),r=n(93570),s=(0,o.need)("Slider");window.VotingForm={},VotingForm._onInit=S,VotingForm._onAddOptionClick=w,VotingForm._onExpireChange=k,VotingForm._onOptionRemoveClick=C,VotingForm._onTitleKeyDown=g,VotingForm._onTitleInput=A,VotingForm._onOptionKeyDown=y,mediaUpload.onComplete(T),mediaUpload.onStart(M),mediaUpload.onError(P);var l="VotingForm_uploading",c="VotingForm_withExpire",u="VotingForm_maxOptions",d=".VotingForm",_=".VotingForm_maxOptions",f=".VotingForm__option",p=".VotingForm__options",m=".VotingForm__upload",h=".VotingForm__bcg",v=".VotingForm__bcgRadio:checked";function g(e){13===e.keyCode&&e.preventDefault()}function A(e){var t=+(0,o.attr)(e,"maxlength"),n=(0,i.$)(".VotingForm__count");t-e.value.length<=20?n.innerHTML=e.value.length+"/"+t:n.innerHTML=""}function y(e){if(g(e),13===e.keyCode){if(!(0,i.$)(_))if((0,i.$)(".VotingForm__option:last-child input")===document.activeElement)return b(),void(0,i.$)(".VotingForm__option:last-child input").focus();if(document.activeElement){var t=document.activeElement.closest(".VotingForm__option"),n=t.nextElementSibling&&t.nextElementSibling.$("input");n&&(n.focus(),n.selectionStart=n.value.length,n.selectionEnd=n.value.length)}}else if(8===e.keyCode){if(1===(0,i.$$)(".VotingForm__option").length)return;var o=e.target;o.value||setTimeout((function(){var e=o.closest(".VotingForm__option"),t=e.previousElementSibling;if(e.outerHTML="",I(),t){var n=t.$("input");n.focus(),n.selectionStart=n.value.length,n.selectionEnd=n.value.length}}))}}function w(){b(),(0,i.$)(".VotingForm__option:last-child input").focus()}function S(){var e=(0,i.$)(v).closest(h);s.scrollToElem(e)}function b(){var e=(0,i.$)(p),t=(0,r.default)({});e.insertAdjacentHTML("beforeend",Wd.html(t)),E(),I()}function k(e){var t=e.$control,n=e.checked;t.closest(d).classList.toggle(c,n)}function C(e){e.closest(f).outerHTML="",E(),I()}function E(){Array.from((0,i.$$)('.VotingForm__option[data-created="0"] input')).forEach((function(e,t){e.setAttribute("name","answers["+t+"]")}))}function I(){var e=(0,i.$)(d),t=Number(e.getAttribute("data-max-options")),n=(0,i.$$)(f).length;e.classList.toggle(u,n===t)}function T(e){if((0,i.$)(d)){var t=(0,i.$)(m),n=Wd.html((0,a.default)("poll_background_id",{id:"photo_"+e.photo_id,type:"photo",photo:e.src,color:e.color,checked:!0}));t.insertAdjacentHTML("beforebegin",n),L()}}function M(){var e=(0,i.$)(m);e&&e.classList.add(l)}function P(e){var t=(0,i.$)(d);if(t){var n=t.getAttribute("data-upload-error-msg");L(),alert(n)}}function L(){var e=(0,i.$)(d);(0,i.$)(m).outerHTML=e.getAttribute("data-upload-html")}},23992:function(e,t,n){"use strict";n(18903)},36386:function(e,t,n){"use strict";var i=n(1730);window.VotingStatsFilters={},VotingStatsFilters._onCountryChange=r;var o=".VotingStatsFilters__section_country",a=".VotingStatsFilters__section_city";function r(e){var t=e.$option,n=(0,i.$)(o),r=(0,i.$)(a),s=t.getAttribute("data-city-section-html");r&&(r.outerHTML=""),s&&n.insertAdjacentHTML("afterend",s)}},68871:function(e,t,n){"use strict";var i=n(9046),o=n(46950),a=n(17656),r=n(81755),s=n(49751),l=n(1730);function c(e,t){var n=(0,i.ge)("select-copyright"),a=(0,l.$)('input[name="copyright"]'),r=(0,l.$)(".create_post__source-option"),s=(0,l.$)(".Btn__text",r);e?(n.style.display="inline-block",n.onclick=function(n){return window.posting.openCopyright(n,!0,t,encodeURIComponent(e))},r.onclick=function(n){return window.posting.openCopyright(n,!0,t,encodeURIComponent(e))},s.innerHTML=(0,o.getLang)("mobile_wall_post_copyright_edit_button")):(r.onclick=function(n){return window.posting.openCopyright(n,!1,t,encodeURIComponent(e))},(0,i.setStyle)(r,"display","table"),s.innerHTML=(0,o.getLang)("mobile_wall_post_copyright_add_button"),(0,i.hide)(n)),(0,i.val)(a,e),window.post.checkCopyright()}t.default={open:function(e,t,n){void 0===e&&(e=!1),void 0===n&&(n="");var c=new RegExp("{link}(.*){/link}"),u=c.exec((0,o.getLang)("mobile_wall_post_copyright_mb_text"))[1],d="/@adminsclub-citation?from="+encodeURIComponent(nav.cur),_=(0,o.getLang)("mobile_wall_post_copyright_mb_text").replace(c,"<a onclick=\"Popup.close(this); nav.go('"+d+'\', null)" href="'+d+'">'+u+"</a>"),f=(0,a.default)({class:"AddCopyrightPopup",header:{title:e?(0,o.getLang)("mobile_wall_post_copyright_mb_title_text_edit"):(0,o.getLang)("mobile_wall_post_copyright_mb_title_text")},content:{inner:[!e&&{tag:"span",inner:Wd.wrap(_)},(0,r.default)({class:"AddCopyrightPopup__input",placeholder:(0,o.getLang)("mobile_post_copyright_input_placeholder"),value:decodeURIComponent(n),spellcheck:!1,on_key_down:["posting.saveSource",t]}),{class:"AddCopyrightPopup__error",style:"display: none;"},{class:"Popup__buttons",inner:[(0,s.default)({class:"Popup__button",inner:e?(0,o.getLang)("mobile_wall_post_copyright_edit_button"):(0,o.getLang)("mobile_wall_post_copyright_add_button"),theme:"regular",use_native_onclick:!0,on_click:'posting.saveSource("'+t+'", this)'}),e?(0,s.default)({class:"Popup__button",inner:(0,o.getLang)("mobile_delete"),theme:"secondary",use_native_onclick:!0,on_click:'posting.deleteSource(event, this, "'+t+'")'}):{}]}]}});a.default.open(Wd.elem(f),!0);var p=(0,l.$)(".AddCopyrightPopup__input input");p&&(0,i.elfocus)(p)},submit:function(e,t,n){var o=(0,l.$)(".Btn",n.parentNode);o.disabled=!0,window.ajax.post("/wall?act=check_copyright_link",{_ajax:1,link:e},{onDone:function(r){var s=(0,l.$)(".AddCopyrightPopup__error");r.status?(n.classList.remove("TextInput_error"),(0,i.hide)(s),c(e,t),a.default.close(n)):(n.classList.add("TextInput_error"),(0,i.show)(s),(0,i.val)(s,r.error)),window.post.saveDraft(null,t),o.disabled=!1}})},remove:function(e,t){t&&a.default.close(t),c("",e),e&&window.post.saveDraft(null,e)}}},47847:function(e,t,n){"use strict";var i=n(68871);window.AddCopyrightPopup=i.default,t.default=i.default},76728:function(e,t,n){"use strict";var i=n(9046),o=n(46950),a={rollback:{onDone:function(e){var t=e.html,n=e.post;e.hash;cur.restored=0;var o=(0,i.ge)(n+"__message-archived");if(t){var a=n+"__message-rollback",r=(0,i.ce)("div",{className:["post_message_item",o.className].join(" "),innerHTML:t,id:a});(0,i.hide)(o),(0,i.ge)(r)||(0,i.after)(r,o)}else{var s=(0,i.ge)(n+"__message-rollback");(0,i.show)(o),(0,i.remove)(s)}}},set:{onStart:function(){var e=this.link;e.classList.contains("wia_item")&&(0,i.addClass)(e,"wia_item--loading")},onDone:function(e){var t=e.html,n=e.post,a=e.restored,r=e.rollback_hash,s=this.link;cur.restored||(cur.restored=0),a&&"profile"===cur.module&&cur.restored++,(0,i.removeClass)(s,"wia_item--loading");var l=(0,i.ge)(n),c=(0,i.ge)(n+"_replies");if(t){if(cur.restored>3){var u=l.id+"?act=rollback_archive&hash="+r;t+=Wd.html({class:"service_msg_row",inner:{tag:"a",href:u,onclick:"return ajax.click(this, Archive.rollback)",inner:(0,o.getLang)("mobile_archive_restore_bulk")}})}var d=l.id+"__message-archived",_=(0,i.ce)("div",{className:["post_message_item",l.className].join(" "),innerHTML:t,id:d});(0,i.hide)(l),(0,i.hide)(c),(0,i.ge)(d)||(0,i.after)(_,l)}else if(n){var f=(0,i.ge)(n+"__message-archived"),p=(0,i.ge)(n+"_replies");(0,i.show)(n),(0,i.show)(p),(0,i.remove)(f)}}}};t.default=a},85843:function(e,t,n){"use strict";var i=n(76728);window.Archive=i.default},22899:function(e,t,n){"use strict";var i=n(35909);t.default=function(e){var t="animation-duration: "+e.duration+"s;";return{inner:[{inner:[(0,i.Icon16Cancel)()],class:"CancelTimer__cross",tag:"div"},{inner:[{inner:[{class:"CancelTimer__line",style:t,tag:"span"}],class:"CancelTimer__hand",tag:"div"},{inner:[{class:"CancelTimer__line",style:t,tag:"span"}],class:"CancelTimer__hand",tag:"div"}],class:"CancelTimer__timer",tag:"div"}],class:"CancelTimer",tag:"div"}}},45301:function(e,t,n){"use strict";n.d(t,{open:function(){return r},go:function(){return s}});var i=n(46950),o=n(17656),a=n(49751);function r(e,t,n,r){var s=(0,o.default)({class:"CopyrightPopup",header:{title:(0,i.getLang)("mobile_wall_post_copyright_source")},content:{inner:[t,{class:"Popup__buttons",inner:[(0,a.default)({class:"Popup__button",inner:(0,i.getLang)("mobile_wall_post_copyright_go"),theme:"regular",use_native_onclick:!0,on_click:"CopyrightPopup.go(this, '"+n+"', "+(r?1:0)+")"})]}]}});o.default.open(Wd.elem(s),!0)}function s(e,t,n){var i;if(o.default.close(e),t.startsWith("/story"))window.Stories.init(t.substr(1),{source:"view_source"});else if(i=/^\/?narrative(-?\d+)_(\d+)(?:_(\d+))?(\/?([a-z0-9_-]+))?$/i.exec(t)){var a=i,r=a[0],s=a[1],l=a[2];window.showNarrative(r,s,l,{source:"view_source"})}else{if(/^@-?[\d\w._]+-[\d\w.-]+/.test(t.substr(1))&&(t+="?from="+nav.cur),!n)return nav.go(t,null);window.open(t,"post_copyright")}}},69604:function(e,t,n){"use strict";var i=n(45301);window.CopyrightPopup={open:i.open,go:i.go}},85100:function(e,t,n){"use strict";n.d(t,{FakeInfoModal:function(){return r}});var i=n(33837),o=n(35909),a=n(46950);function r(e){void 0===e&&(e={});var t=(0,a.getLang)("mobile_wall_post_fake_info_modal_title"),n=(0,a.getLang)("mobile_wall_post_fake_info_modal_text"),r=[{text:(0,a.getLang)("mobile_wall_post_fake_info_modal_button"),onClick:"ModalMenu.close(this)"}],s={inner:[n,{inner:[{inner:[(0,a.getLang)("mobile_wall_post_fake_info_modal_more")],href:e.url,target:"_blank",rel:"noopener",tag:"a"}],style:"margin: 8px 0 20px",tag:"div"}],tag:"div"};return(0,i.ModalCard)({title:t,icon:(0,o.Icon56ErrorOutline)(),subhead:s,actions:r})}},3921:function(e,t,n){"use strict";var i=n(85261);window.FakeInfo=i.fakeInfo},78022:function(e,t,n){"use strict";n.d(t,{openContextMenu:function(){return a}});var i=n(89359),o="post_draft_reminder_container";function a(e,t,n){var a=window.lang;e.preventDefault(),e.stopPropagation();var r=Wd.html([(0,i.ContextMenuItem)({title:a.mobile_wall_draft_delete,href:n.remove_url,ref:"wall_draft_reminder"})]),s=Wd.elem((0,i.ContextMenu)({list:r}));s.parentNode.id=o,i.ContextMenu.open(s,"#"+o,{appendToBody:!0})}},10079:function(e,t,n){"use strict";var i=n(78022);window.PostDraftReminder={openContextMenu:i.openContextMenu}},18744:function(e,t,n){"use strict";n.d(t,{PostPrivacyModal:function(){return s}});var i=n(33837),o=n(35909),a=n(46950),r=n(9046);function s(e){void 0===e&&(e={});var t="",n="",s=null;return e.isOwner?(t=(0,a.getLang)(e.isOnlyForBestFriends?"mobile_post_privacy_modal_best_friends_owner_title":"mobile_post_privacy_modal_friends_owner_title"),n=(0,a.getLang)(e.isOnlyForBestFriends?"mobile_post_privacy_modal_best_friends_owner_description":"mobile_post_privacy_modal_friends_owner_description"),e.isOnlyForBestFriends&&0===e.bestFriendsCount&&(t=(0,a.getLang)("mobile_post_privacy_modal_no_one_will_see_title"),n=(0,a.getLang)("mobile_post_privacy_modal_no_one_will_see_description"),s={text:(0,a.getLang)("mobile_post_privacy_modal_choose_best_friends_button_title"),onClick:e.onChooseBestFriendsClick})):(t=(0,r.langSex)(e.ownerSex,(0,a.getLang)(e.isOnlyForBestFriends?"mobile_post_privacy_modal_best_friends_title":"mobile_post_privacy_modal_friends_title","raw")).replace("{user_first_name}",e.ownerFirstName),n=(0,a.getLang)(e.isOnlyForBestFriends?"mobile_post_privacy_modal_best_friends_description":"mobile_post_privacy_modal_friends_description"),s=e.createPostUrl&&{text:(0,a.getLang)("mobile_post_privacy_modal_create_post_button_title"),url:e.createPostUrl,onClick:"PostPrivacyModal.onCreatePostClick(this);"},e.isOnlyForBestFriends&&0===e.viewerBestFriendsCount&&(s={text:(0,a.getLang)("mobile_post_privacy_modal_choose_best_friends_button_title"),onClick:e.onChooseBestFriendsClick})),(0,i.ModalCard)({title:t,icon:(0,o.Icon56LockOutline)(),needCloseIcon:!0,subhead:n,actions:s?[s]:null})}},16336:function(e,t,n){"use strict";n.d(t,{PostPrivacySelect:function(){return u}});var i=n(49751),o=n(42450),a=n(46950),r=n(91687),s=n(95916),l=n(35909),c=n(80908);function u(e){void 0===e&&(e={});var t={inner:[e.friendsUsersStackHtml?e.friendsUsersStackHtml:null,{inner:[(0,a.getLang)("mobile_profile_new_post_privacy_select_banner_header")],class:"PostPrivacySelectBestFriendsBanner__header",tag:"div"},{inner:[(0,a.getLang)("mobile_profile_new_post_privacy_select_banner_description")],class:"PostPrivacySelectBestFriendsBanner__description",tag:"div"},(0,i.default)({inner:[(0,a.getLang)("mobile_profile_new_post_privacy_select_banner_button_label")],onClick:["PostPrivacySelect.onEditBestFriendsClick"],use_native_onclick:!0})],class:"PostPrivacySelectBestFriendsBanner",tag:"div"},n={inner:[(0,o.default)({type:"radio",onChange:["PostPrivacySelect.onPrivacyChange"],name:"PostPrivacySelectOption",value:"best_friends_only",label:(0,a.getLang)("mobile_profile_new_post_privacy_best_friends_only"),checked:"best_friends_only"===e.selectedValue}),{inner:[e.bestFriendsUsersStackHtml?e.bestFriendsUsersStackHtml:null,{inner:[(0,l.Icon16Dropdown)()],class:"PostPrivacySelectBestFriendsControlAction__icon",tag:"div"}],class:"PostPrivacySelectBestFriendsControlAction",onClick:["PostPrivacySelect.onEditBestFriendsClick"],tag:"div"}],class:"PostPrivacySelectBestFriendsControl",tag:"div"},u=[(0,s.default)({inner:[(0,a.getLang)("mobile_profile_new_post_privacy_select_header")],onClose:["ModalMenu.close","this"],mix:"PostPrivacySelectModalMenuHeader"}),{inner:[(0,c.default)({noOffset:!0}),{inner:[(0,a.getLang)("mobile_profile_new_post_privacy_select_description")],class:"PostPrivacySelectBestFriends__description",tag:"div"},e.isForBestFriendsAvailable&&0===e.bestFriendsCount?t:null,(0,o.default)({type:"radio",onChange:["PostPrivacySelect.onPrivacyChange"],name:"PostPrivacySelectOption",value:"public",label:(0,a.getLang)("mobile_profile_new_post_privacy_public"),checked:"public"===e.selectedValue}),(0,o.default)({type:"radio",onChange:["PostPrivacySelect.onPrivacyChange"],name:"PostPrivacySelectOption",value:"friends_only",label:(0,a.getLang)("mobile_profile_new_post_privacy_friends_only"),checked:"friends_only"===e.selectedValue}),e.isForBestFriendsAvailable&&e.bestFriendsCount>0?n:null],class:"PostPrivacySelectBestFriends",tag:"div"}];return(0,r.default)({attached:!0,body:u})}},31927:function(e,t,n){"use strict";var i=n(96398),o=n(5987),a=n(92509),r=n(18696);window.PostPrivacy=new i.PostPrivacy,window.PostPrivacySelect=new o.PostPrivacySelect,window.PostPrivacyBanner=new a.PostPrivacyBanner,window.PostPrivacyModal=new r.PostPrivacyModal},36040:function(e,t,n){"use strict";var i=n(46950),o=n(9046),a=n(70675);t.default=function(e,t){(0,o.cancelEvent)(e);var n=t.getAttribute("href"),r=(0,i.getLang)("mobile_wall_prometheus_edit_warn");(0,a.Confirm)(r,'Popup.close(this); nav.go("'+n+'");',"",{title:(0,i.getLang)("mobile_prometheus_edit_warn_popup_title")})}},77292:function(e,t,n){"use strict";var i=n(36040);i.default;window.PrometheusEditConfirm=i.default},19598:function(e,t,n){"use strict";var i,o,a=n(9046),r=n(11393),s=n(69756),l=n(61124),c=n(54440),u=n(37425),d=n(22899),_=n(64723),f=n(92424),p=n(46950),m=n(74521),h=n(6362),v=n(1730),g=!1,A=!1,y={};window.Replies={init:function(e,t){void 0===t&&(t=0);!function(e){e&&function(){var e=(0,a.geByClass1)("wall_replies"),t=(0,a.domLC)(e);if(!t||!(0,a.hasClass)("RepliesThreadNext",t))return;var n=(0,a.geByClass1)("RepliesThreadNext__link",t);(0,a.autoScroll)((function(){if((0,a.domPN)(t)&&!(0,a.hasClass)("RepliesThreadNext_loading",t))return n}),window.RepliesNext,{no_cache:!0})}();(function(){var e=(0,a.ge)("reply_field");if(!e||(0,a.hasClass)("RepliesField_static",e))return;var t=window.onBodyScroll,n=!1;t((0,a.throttle)((function(t){var i=t+(0,a.getCh)(),o=(0,a.getH)(e),r=i<(0,a.getY)(e)+o;r&&!n?((0,a.setStyle)(e,{height:o}),(0,a.addClass)("RepliesField_fixed",e)):!r&&n&&((0,a.removeClass)("RepliesField_fixed",e),(0,a.setStyle)(e,{height:null})),n=r}),10)),(0,a.onBodyScrollForce)()})(),function(e){var t=(0,a.ge)("replies_to_last"),n=(0,a.geByClass1)("RepliesWrap"),i=(0,a.geByClass1)("RepliesField_wrap");if(!t||!n)return;var o=(0,a.ge)("reply_field"),r=(0,a.hasClass)("RepliesField_static",o),s=(0,a.getY)(n),l=window.onBodyScroll,c=!1;E(),l((0,a.throttle)((function(e){var l=e+(0,a.getCh)(),u=o&&!r?(0,a.getY)(o)-50:s+(0,a.getH)(n)-(0,a.getH)(i),d=s<e&&l<u;d!==c&&((0,a.toggleClass)("Replies_last_shown",t,d),t.setAttribute("tabindex",d?0:-1),c=d)}),10))}()}(e);var n=(0,a.ge)("reply_field"),i=(0,a.ge)("reply_field_text");window.mediaUpload&&n&&(window.mediaUpload.onStart(I),window.mediaUpload.onRemove((function(){I(),i.focus()})));if(m.default.checkStickers(),n){var o=window.cur;o.onStickersToggleCallbacks=o.onStickersToggleCallbacks||[],o.onStickersToggleCallbacks.push((function(e){if((0,a.onBodyScrollForce)(),C(),e){var t=(0,a.geByTag1)("a","stickers_panel");t&&t.focus()}else i.focus()})),function(e){var t=(0,p.getState)("mention_items_"+e);t&&window.Mention.init({appendTo:(0,v.$)(".MentionContainer"),items:t})}(t),k()}window.post.stickersInit()},replyTo:function(e,t,n,i,o){void 0===o&&(o="wall_reply");if((0,a.checkEvent)(e))return!0;if(window.cur.replyTo!==n&&g)return D(),!0;n=n||0,(0,a.geByClass)("ReplyItem_active").forEach((function(e){(0,a.removeClass)("ReplyItem_active",e)}));var r,s=(0,a.ge)("reply_field"),l=(0,a.ge)("reply_field_text"),u=(0,a.hasClass)("RepliesField_static",s),d=!!window.post&&window.post.replyNamesRE(),_=(0,a.val)(l),f="";if(n){if(r=(0,a.ge)(o+t+"_"+n))if(u||(0,a.addClass)("ReplyItem_active",r),!(0,a.hasClass)("ReplyItem_deleted",r)&&i){var p=window.cur.replyNames[i]||{},m=p[0]||"";f=p[1]||"",_=_?d?_.replace(d,m):_:m,window.post&&window.post.onReplyClick(!0,m)}else _=d?_.replace(d,""):_}else _=d?_.replace(d,""):_;(0,a.val)(l,(0,a.replaceEntities)(_));var h=(0,a.ge)("reply_field_to"),v=(0,a.geByClass1)("RepliesField__infoName",h);(0,a.val)(v,(0,a.htsc)(f)),(0,a.toggleClass)("RepliesField__infoItem_shown",h,n&&f),(0,a.toggleClass)("RepliesField__infoItem_shown","reply_field_to_empty",n&&!f);var A=(0,a.ge)("reply_field_info"),y=(0,a.ge)("reply_field_from");if((0,a.toggleClass)("RepliesField__info_shown",A,n||y),(0,a.toggleClass)("RepliesField__info_single",A,n&&!y||!n&&y),(0,a.val)("field_reply_to",n),(0,a.val)("field_reply_to_name",n&&f?"1":""),window.cur.replyTo=n,(0,a.val)("field_timestamp",N()),u)if(r)c.default.changePosition(c.default.getByName("attaches"),!0,!1),(0,a.domInsertAfter)(s,r);else{c.default.changePosition(c.default.getByName("attaches"),!0,!0);var w=(0,a.geByClass1)("wall_replies");(0,a.domInsertBefore)(s,w)}return C(),k(),(0,a.elfocus)(l),(0,a.cancelEvent)(e)},showMoreActions:function(e,t){var n=(0,a.ge)("reply_more_"+e);if(!n)return;var i=(0,a.geByClass)("ReplyItem__action",n),o=[];i.forEach((function(e){o.push((0,s.ModalMenuBtn)({inner:(0,a.val)(e),onclick:"Replies.onClickMoreAction('"+e.id+"', event)"}))}));var c=(0,s.default)({close:!0,items:o}),u=(0,a.ceFromString)(r.default.html(c));u=l.default.open(u,!0,{oncloseCallback:function(){var t=(0,a.ge)("reply_more"+e);t&&t.focus()}});var d=(0,a.geByClass1)("ModalMenu__btn",u);d&&d.focus();return(0,a.cancelEvent)(t)},onClickMoreAction:function(e,t){t&&l.default.close(t.target);var n=(0,a.ge)(e);if(!n)return;n.click()},onFieldInput:k,toggleStickers:function(e,t){if(g)return(0,a.cancelEvent)(t);return window.post.stickersToggle(e),(0,a.cancelEvent)(t)},replyAsShow:function(e,t,n){void 0===n&&(n=!1);var i,o=!!window.cur.replyAs;x(w),o?i=P(window.cur.replyAs):(i=(0,_.default)({large:!0}),function(e,t){void 0===t&&(t=!1);if(window.cur.replyAsLoading)return;var n=window.ajax;window.cur.replyAsLoading=!0,n.post("/wall.php",{act:"get_reply_clubs_list",only_this_group:t?1:0,post_oid:e,modal:1},{onDone:function(e){window.cur.replyAs=e;var t=(0,a.ge)("reply_as_users_list");if(t){var n=P(e);(0,a.val)(t,r.default.html(n));var i=(0,a.geByClass1)("ModalMenuUserList__item",t);i&&i.focus()}delete window.cur.replyAsLoading},onFail:function(){delete window.cur.replyAsLoading}})}(t,n));var c=(0,s.default)({title:(0,a.getLang)("mobile_wall_reply_as_title"),close:!0,items:[{id:"reply_as_users_list",inner:i}]}),u=(0,a.ceFromString)(r.default.html(c));if(l.default.open(u,!0),o){var d=(0,a.geByClass1)("ModalMenuUserList__item",(0,a.ge)("reply_as_users_list"));d&&d.focus()}return(0,a.cancelEvent)(e)},replyAsChange:function(e,t,n,i){var o=(0,a.ge)("reply_field_from"),r=(0,a.geByClass1)("RepliesField__infoName",o);return(0,a.val)(r,(0,a.htsc)(i)),(0,a.val)("field_from_oid",n),s.default.close(t),(0,a.ge)("reply_field_text").focus(),(0,a.cancelEvent)(e)},checkSendButton:function(e){if(!M())return(0,a.cancelEvent)(e);window.cur.needTrackMyTracker&&(0,h.tmrTrackCustomGoal)("comment_in_sport_broadcast")},onClickLastReplies:function(e,t){var n=(0,a.geByClass1)("wall_replies"),i=(0,a.domLC)(n),o=i&&(0,a.hasClass)("RepliesThreadNext",i);if(o){var r=(0,a.geByClass1)("Loading",i);r||(r=(0,a.ceFromString)((0,_.default)({})),(0,a.append)(r,i)),(0,a.addClass)("RepliesThreadNext_loading",i)}if((0,a.removeClass)("RepliesWrap_last_shown",e),window.scrollTo(0,document.body.scrollHeight),o)return i.focus(),window.ajax.click(e,window.RepliesLast);i&&((0,a.hasClass)("RepliesThread",i)&&(i=(0,a.domPS)(i)),(0,a.hasClass)("ReplyItem",i)&&(0,a.geByClass1)("ReplyItem__name",i).focus());return(0,a.cancelEvent)(t)},onSubmitForm:function(e,t){if(N())D();else{if(e.preventDefault(),A)return;var n=(0,v.$)('textarea[name="message"]',t),s=n?n.value:"";if(!s)return R(-1),void D();A=!0;var l=location.pathname.match(/^\/wall(-?[0-9]+)_([0-9]+)$/),c=l[1],u=l[2];window.ajax.post("/wall.php",{act:"check_comment",oid:c,post_oid:u,text:s},{onDone:function(e){if(A=!1,R(e.timestamp),e.delay){var t,n=1e3*e.delay,s=(0,v.$)("#reply_field");(0,a.hasClass)("RepliesField_fixed",s)?t=(0,a.getH)(s)+5:(0,a.hasClass)("RepliesField_static",s)||(t=(0,a.getH)((0,v.$)("body"))-(0,a.getY)(s)+5),o=window.Snackbar.init({type:f.SNACKBAR_TYPE_BULLYING,text:e.description,bottom:t,duration:n}),i=setTimeout((function(){B(),D()}),n),function(e){var t=(0,v.$)("#nc_submit"),n=(0,v.$)(".RepliesField__field"),i=r.default.elem({class:"RepliesField__action RepliesField__action_cancel",inner:(0,d.default)({duration:e/1e3}),onclick:["Replies.abortTimer",S]});g=!0;var o=(0,v.$)(".RepliesField__action_attach"),s=(0,v.$)(".RepliesField__action_smile");o&&o.classList.add(b),s&&s.classList.add(b),n.appendChild(i),(0,a.hide)(t)}(n)}else D()},onFail:function(){A=!1,D()}})}},abortTimer:x,setCurrentTimestamp:R,getCurrentTimestamp:N};var w="editing",S="button",b="RepliesField__action_disabled";function k(){var e=(0,a.ge)("reply_field_text"),t=(0,a.ge)("reply_field_text_fake");if(e&&t){var n=e.value;t.innerText=n,"\n"===(0,a.last)(n)&&(t.innerHTML+="&nbsp;");var i=(0,a.getH)(t);(0,a.getH)(e)!==i&&((0,a.setStyle)(e,{height:i}),C()),T(),x(w)}}function C(){var e=(0,a.ge)("reply_field");(0,a.hasClass)("RepliesField_static",e)||(0,a.hasClass)("RepliesField_fixed",e)&&((0,a.setStyle)(e,{height:(0,a.getH)((0,a.geByClass1)("RepliesField_wrap",e))}),E(),(0,a.onBodyScrollForce)())}function E(){var e=(0,a.ge)("replies_to_last"),t=(0,a.ge)("reply_field");if(e&&t&&!(0,a.hasClass)("RepliesField_static",t)){var n=(0,a.domData)(e,"bottom");n||(n=parseInt((0,a.getStyle)(e,"bottom"))||20,(0,a.domData)(e,"bottom",n)),(0,a.setStyle)(e,"bottom",(0,a.getH)(t)+parseInt(n))}}function I(){T(),C();var e=(window.mediaUpload?window.mediaUpload.getAttachesCount():0)<2;["photo_device","photo","video","audio","doc"].forEach((function(t){c.default.toggleItemEnabled(c.default.getByName("attaches"),t,e)}))}function T(){var e=(0,a.ge)("nc_submit");e&&(0,a.toggleClass)("RepliesField__action_send_active",e,M())}function M(){var e=((0,a.ge)("reply_field_text")||{}).value;return(0,a.trim)(e)||window.mediaUpload&&window.mediaUpload.getAttachesCount()}function P(e){var t=[];return e.forEach((function(e){t.push((0,u.ModalMenuUserListItem)({href:e[2],image:e[1],name:e[3],id:e[0],onclick:"return Replies.replyAsChange(event, this, "+parseInt(e[0])+", '"+e[4]+"')"}))})),(0,u.default)({users:t})}function L(){g=!1,clearTimeout(i),window.Snackbar.close(o),B()}function N(){return y[""+window.cur.replyTo]}function R(e){y[""+window.cur.replyTo]=e,(0,a.val)("field_timestamp",e)}function x(e){if(g){var t=location.pathname.match(/^\/wall(-?[0-9]+)_([0-9]+)$/),n=t[1],i=t[2],o=N();window.ajax.post("/wall.php",{act:"cancel_check_comment",oid:n,post_oid:i,reason:e,timestamp:o})}L()}function B(){var e=(0,v.$)("#nc_submit"),t=(0,v.$)(".RepliesField__action_cancel"),n=(0,v.$)(".RepliesField__action_attach"),i=(0,v.$)(".RepliesField__action_smile");n&&n.classList.remove(b),i&&i.classList.remove(b),(0,a.remove)(t),(0,a.show)(e)}function D(){var e=(0,v.$)("#nc_submit");R(N()),nav.go(e,window.event),R(0)}nav.onBeforeGo((function(e,t){var n=location.pathname.substr(1,4);(0,a.isString)(e)&&e.substr(1,4)!==n&&"wall"===n&&(y={})})),window.page&&window.page.onChange((function(e,t){L()}))},72841:function(e,t,n){"use strict";n.d(t,{submit:function(){return c}});var i=n(46769),o=n(17656),a=n(70675),r=n(1730),s=n(9046),l=n(46950);function c(e,t,n,a,c,u){"string"==typeof c&&(c=JSON.parse(c));var d=(0,r.$)("#mcont");(0,s.setStyle)(d,{"pointer-events":"none"}),window.ajax.post(e,(0,i.default)({_ajax:1,reason:n,onDone:function(){(0,s.isVkWebView)()&&history.back()}},c)),"story"===c.type&&window.Stories.sendAnalyticsEvent("claim"),window.Snackbar.init({text:u||(0,l.getLang)("mobile_msg_reported")}),(0,r.$$)(".Confirm").forEach((function(e){return o.default.close(e)}))}t.default=function(e,t,n,i,o,r,s,l){n?(0,a.Confirm)(t,"ReportConfirm.submit('"+o+"', false, "+i+", '"+r+"', "+JSON.stringify(s)+")","",{title:e,id:"confirm-"+i}):c(o,!0,i,r,JSON.stringify(s),l)}},4850:function(e,t,n){"use strict";var i=n(9046),o=n(72841);(0,i.extend)(o.default,{submit:o.submit}),window.ReportConfirm=o.default;o.default},27210:function(e,t,n){"use strict";n.d(t,{initSharePage:function(){return a}});var i=n(1730),o=n(9046);n(46950),n(35909);function a(e,t){var n=(0,o.ge)("SharePageInput__to"),a="";n&&(a=n.value);var r={};if("mail"===e&&""!==n.value&&(r=a.split(",").reduce((function(e,t){return e[t]=!0,e}),{})),"club"===e){var s=(0,i.$)(".SharePage .qsearch_wrap"),l=(0,i.$)(".hp_block",s);(0,o.show)(s),(0,o.show)(l)}var c=(0,i.$)(".SharePage .SharePanel.MessagePanel"),u=(0,i.$)(".SharePage .SharePanel.ActionsPanel");(0,o.extend)(cur,{publishTo:e,refreshSelected:function(e,t,i){var a;void 0===i&&(i=!0),(0,o.isUndefined)(e)||(cur.publishSelected=e),t=cur.publishTo,e=cur.publishSelected,"group"===t?a=(0,o.ge)("club"+e):"mail"===t&&(a=(0,o.ge)("peer"+e));var r=!!cur.selectedMap[e];a&&(a.classList.toggle("inline_item_selected",i?!r:r),cur.like_search.toggleAttach(e,!r),i&&(cur.selectedMap[e]=!r),n.value=Object.keys(cur.selectedMap).filter((function(e){return cur.selectedMap[e]})).join(","));var s=Object.keys(cur.selectedMap).length>0&&Object.keys(cur.selectedMap).some((function(e){return!!cur.selectedMap[e]}));return c.classList.toggle("SharePanel--active",s),u.classList.toggle("SharePanel--active",!s),!1},selectedMap:r,selectPeer:function(e,t){return cur.refreshSelected(t,"mail"),!1}}),Object.keys(r).forEach((function(t){cur.refreshSelected(t,e,!1)}))}},44556:function(e,t,n){"use strict";var i=n(27210);window.initSharePage=i.initSharePage},52558:function(e,t,n){"use strict";n.d(t,{onSearch:function(){return r},checkOverflow:function(){return s}});var i=n(1730),o=n(9046),a=n(86900);function r(e,t){e.preventDefault(),(0,a.statlogsValueEvent)("mvk_wall_search_button"),nav.go(t)}function s(){var e="WallSearchBtn--divided";(0,i.$$)(".WallSearchBtn__wrapper").forEach((function(t){var n=t.querySelector(".Slider__scroll"),i=null==n?void 0:n.getBoundingClientRect(),o=t.querySelector(".Slider__line"),a=null==o?void 0:o.getBoundingClientRect(),r=t.querySelector(".WallSearchBtn");(null==i?void 0:i.width)<(null==a?void 0:a.width)?null==r||r.classList.add(e):(null==r?void 0:r.classList.contains(e))&&(null==r||r.classList.remove(e))}))}window.onDOMReady((function(){s(),(0,o.onBodyResize)(s)})),window.page.onChange(s)},19574:function(e,t,n){"use strict";var i=n(52558);window.WallSearch={onSearch:i.onSearch,checkOverflow:i.checkOverflow}},24112:function(e,t,n){"use strict";n.d(t,{open:function(){return l},init:function(){return c}});var i=n(11393),o=n(17656),a=n(49751),r=n(9046),s=n(1730);function l(){var e=window.lang,t=(0,s.$)(".pcont .service_msg_box");if(t){var n=(0,s.$)(".service_msg",t).innerHTML;(0,r.remove)(t);var l=(0,o.default)({class:"CopyrightPopup",content:[{inner:i.default.wrap(n)},{class:"Popup__buttons",inner:[(0,a.default)({class:"Popup__button",inner:e.mobile_zphoto_close,theme:"regular",on_click:"Popup.close(this)",use_native_onclick:!0})]}]});o.default.open(i.default.elem(l),!0)}}function c(){window.onDOMReady((function(){l()}))}},63281:function(e,t,n){"use strict";var i=n(24112);window.ZeroVKPopup={open:i.open,init:i.init}},65156:function(e,t,n){"use strict";n(46950),n(49751),n(86205),n(72553),n(89479),n(74220),n(75593),n(11393)},76661:function(e,t,n){"use strict";n(65156);var i=n(1539);window.RedirectScreen=i.RedirectScreen},24179:function(e,t,n){"use strict";n.d(t,{VacancyPhone:function(){return _},VacancyPhoneData:function(){return c},VacancyPhoneError:function(){return d},VacancyPhoneSpinner:function(){return u}});var i=n(91687),o=n(35909),a=n(46950),r=n(14848),s=n(49751),l=n(27109);function c(e){var t=e.phone,n=e.name,i=e.profession,l=e.company,c=(0,a.getLang)("market_worki_snippet_phone_modal_title"),u=(0,a.getLang)("market_worki_snippet_phone_modal_call"),d="tel:"+t,_=11===t.length?"+"+t.substr(0,1)+" "+t.substr(1,3)+" "+t.substr(4,3)+" "+t.substr(7,2)+" "+t.substr(9,2):t;return[(0,o.Icon56PhoneOutline)(),{inner:[_],class:"VacancyPhone__phone",tag:"div"},{inner:[n],class:"VacancyPhone__name",tag:"div"},{class:"VacancyPhone__separator",tag:"div"},{inner:[c],class:"VacancyPhone__label",tag:"div"},{inner:[(0,r.MiniInfoCell)({before:(0,o.Icon20UserOutline)(),text:i}),(0,r.MiniInfoCell)({before:(0,o.Icon20WorkOutline)(),text:l})],class:"VacancyPhone__info",tag:"div"},(0,s.default)({inner:[u],class:"VacancyPhone__call",url:d,role:"link",theme:"large",onClick:'VacancyPhone.onClickCall("'+e.wallitemId+'")',use_native_onclick:!0})]}function u(){return{inner:[(0,l.default)()],class:"VacancyPhone__spinner",tag:"div"}}function d(e){var t=["VacancyPhone.retry",e.id,e.hash,e.wallitemId];return{inner:[{inner:[(0,a.getLang)("mobile_market_worki_snippet_phone_modal_error")],class:"VacancyPhone__text",tag:"p"},(0,s.default)({inner:[(0,a.getLang)("mobile_market_worki_snippet_phone_modal_error_retry")],class:"VacancyPhone__retry",theme:"link",onClick:t})],class:"VacancyPhone__error",tag:"div"}}function _(){return(0,i.default)({on_overlay_click:["return VacancyPhone.close","this"],class:"VacancyPhone",onClose:["return VacancyPhone.close","this"],body:{inner:[{inner:[(0,o.Icon12Cancel)()],class:"VacancyPhone__close",onClick:"VacancyPhone.close(this)",tag:"button"},{class:"VacancyPhone__content",tag:"div"}],class:"VacancyPhone__wrap",tag:"div"}})}},32634:function(e,t,n){"use strict";n.d(t,{VacancyPhone:function(){return c}});var i=n(69756),o=n(1730),a=n(11393),r=n(24179),s=n(43520),l=n(80479),c={open:function(e,t,n,c,f){var m=f.$btn.closest(c),g=(0,o.$)(_,m);if(g){var A=i.default.open(g,!0,"",{expandable:!0}),y=A.querySelector(p);return y&&(y.innerHTML=a.default.html((0,r.VacancyPhoneSpinner)()),d=h(e,n,t,y),u=function(){v(A),d()},nav.onBeforeGo(u),s.WorkiSnippetStats.logEvent({event_name:l.WorkiSnippetEventNames.CLICK_CTA,wallitem_id:t})),A}return!1},close:v,retry:function(e,t,n,i){var o=i.$btn.closest(p);o&&(o.innerHTML=a.default.html((0,r.VacancyPhoneSpinner)()),d=h(e,t,n,o))},onClickCall:function(e){e&&s.WorkiSnippetStats.logEvent({event_name:l.WorkiSnippetEventNames.CLICK_CALL,wallitem_id:e});return!0}},u=function(){},d=function(){},_=".VacancyPhone",f=".VacancyPhone.Popup_open",p=".VacancyPhone__content";function m(e,t){e.innerHTML=a.default.html((0,r.VacancyPhoneError)(t))}function h(e,t,n,i){return window.ajax.post("worki.php",{act:"get_vacancy",vacancy_id:e,hash:t},{onDone:function(o){o?function(e,t,n){t.wallitemId=n,e.innerHTML=a.default.html((0,r.VacancyPhoneData)(t))}(i,o,n):m(i,{id:e,hash:t,wallitemId:n})},onFail:function(){m(i,{id:e,hash:t,wallitemId:n})}}).abort}function v(e){return e||(e=(0,o.$)(".Popup_open.VacancyPhone")||(0,o.$)(f)),e&&(i.default.close(e),d()),nav.onBeforeGo.off(u),!1}},60561:function(e,t,n){"use strict";var i=n(24179),o=n(32634);Object.assign(i.VacancyPhone,o.VacancyPhone);var a=i.VacancyPhone;window.VacancyPhone=a},84604:function(e,t,n){"use strict";var i,o,a,r,s,l=n(3226);window.FeedAssistanceStats=((i={register:Ce,forceRegister:function(e,t){e[_]=Ie(e),e[p]=t,se.push(e)},onScroll:throttle(Me,50),onStartViewElement:(0,l.default)("element"),onEndViewElement:(0,l.default)("element"),onStopTrackElement:(0,l.default)("element"),onViewedElement:(0,l.default)("element"),onBeforePageChange:Re,onPageChanged:xe,getElementType:Ie,registerElements:be,registerTrackingCls:function(e){ye.push(e)},unregisterTrackingCls:Se}).unregisterTrackingCls=Se,i.setParenViewableX=function(e,t){e[C]=t},i.forceProcessTrack=Ee,i.dispatchElementEvent=function(e,t){var n=function(e){return te[e]}(ot(t[_]||Ie(t),e));Oe({type:e,data:n(t)})},i.dispatchEvent=function(e){Oe(e)},i.serializeEventData=Te,i.clearElemsCache=function(){se.forEach((function(e){e[g]=!1,e[A]=!1}))},i._debug=function(){return{started:le,tracking:se,events:Ae,blindTop:ue,blindBottom:de}},i.getFromRef=ft,i.getRoot=pt,i.BLOCKS={},i.EVENTS={},i);var c=.5,u=.25,d=500,_="_feedAssistanceStatsType",f="_feedAssistanceStatsIdled",p="_feedAssistanceStatsModule",m="_feedAssistanceStatsStarted",h="_feedAssistanceStatsProcessed",v="_feedAssistanceStatsEventTs",g="_feedAssistanceStatsCachedY",A="_feedAssistanceStatsCachedX",y="_feedAssistanceStatsLeft",w="_feedAssistanceStatsHeight",S="_feedAssistanceStatsWidth",b="_feedAssistanceStatsTop",k="_feedAssistanceStatsBottom",C="_feedAssistanceStatsParentViewableX",E="BLOCK_TYPE_RECOMMENDED_SLIDER",I="BLOCK_TYPE_RECOMMENDED_GROUPS_SLIDER",T="BLOCK_TYPE_EXPLORE_BAIT",M="BLOCK_TYPE_PROFILE_PHOTO",P="BLOCK_TYPE_PROMO_BUTTON",L="BLOCK_TYPE_IMPORT_CONTACTS",N="BLOCK_TYPE_PUSH_SWITCH",R="view_block",x="explore_bait",B="feed_assistance",D="hide",O="promo_button",U="SUB_EXPLORE_BAIT",H="view",F="opened",V="subscribe",j="unsubscribe",$="open_user",q="open_group",W="hide",G="report",Y="seen",K="filled",Q="enable_push",z="decline_push",X="SUB_PROMO_BUTTON",J="clicked",Z=((o={}).BLOCK_TYPE_RECOMMENDED_SLIDER=R,o.BLOCK_TYPE_RECOMMENDED_GROUPS_SLIDER=R,o.BLOCK_TYPE_PROMO_BUTTON=R,o.BLOCK_TYPE_EXPLORE_BAIT=x,o.BLOCK_TYPE_PROFILE_PHOTO=B,o.BLOCK_TYPE_IMPORT_CONTACTS=B,o.BLOCK_TYPE_PUSH_SWITCH=B,o),ee=((a={}).BLOCK_TYPE_RECOMMENDED_SLIDER=500,a.BLOCK_TYPE_EXPLORE_BAIT=d,a.BLOCK_TYPE_PROFILE_PHOTO=d,a.BLOCK_TYPE_IMPORT_CONTACTS=d,a.BLOCK_TYPE_PUSH_SWITCH=d,a),te=((r={})[ot(E,R)]=function(e){var t=geByClass1("Slider__scroll",e),n=domData(t,"code"),i=domData(t,"ref");return Te(R,"",e,i,n)},r[ot(I,R)]=function(e){var t=e.querySelector(".Slider__scroll"),n=domData(t,"code");return Te(R,"",e,"",n)},r[ot(P,R)]=function(e){var t=geByClass1("feedAssistancePromoButtonInstallApp__button",e)?"promo_install_app":"promo_button";return Te(R,t,e)},r[ot(T,x)]=function(){return Te(U,H)},r[ot(M,B)]=function(e){return Te(B,e,"m_ph",Y)},r[ot(L,B)]=function(e){return Te(B,e,"m_mp",Y)},r[ot(N,B)]=function(e){return Te(B,e,"m_push_switch",Y)},r),ne=((s={}).view_block=function(e,t,n,i){return n=n||ft(t),[e,domChildIndex(t),mt(t),n,i].join("|")},s.SUB_EXPLORE_BAIT=function(e){return e},s.feed_assistance=function(e,t,n){return[t,n,ft(e)].join("|")},s.hide=function(e,t){return[e,mt(t),domChildIndex(t),ft(t)].join("|")},s.SUB_PROMO_BUTTON=function(e,t,n){return[domChildIndex(e),t,n||""].join("|")},s),ie="feed_other",oe="feedAssistance",ae="feedAssistanceStat.events",re="feedAssistanceStat.idled",se=[],le=[],ce=Date.now(),ue=0,de=0,_e=!1,fe=null,pe=null,me=null,he=null,ve=null,Ae=[],ye=[],we=!1;function Se(e){lt(ye,e)}function be(){var e=[];each(ye,(function(){e=e.concat(geByClass(this))})),each(e,(function(){Ce(this,"feed")}))}function ke(){be();var e=et();e.length&&(ze(e),tt()),Ee(),$e()}function Ce(e,t){!e[_]&&function(e){return!~se.indexOf(e)}(e)&&(e[_]=Ie(e),e[p]=t,se.push(e))}function Ee(){Be(scrollGetY(),getCh())}function Ie(e){return e[_]?e[_]:hasClass("feedAssistance_recommendedFriends",e)?E:e.classList.contains("feedAssistance_recommendedGroups")?I:hasClass("post_exploreBait",e)?T:hasClass("feedAssistance_profilePhoto",e)?M:hasClass("feedAssistance_promoButton",e)?P:hasClass("feedAssistance_importContacts",e)?L:hasClass("feedAssistance_pushNotificationsSwitch",e)?N:"BLOCK_TYPE_DEFAULT"}function Te(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];return ne[e].apply(ne,n)}function Me(e,t){var n,i=Me;Be(e||scrollGetY(),t||getCh()),_e||we?(clearTimeout(i.timer),i.timer=setTimeout(Pe,150),we=!1):(_e=!0,je(),n=ge("vk_head"),ue=n&&n.offsetHeight,de=0)}function Pe(){je(),Ve(),_e=!1}function Le(){je(),_t(le),ze(Ae.concat(it(le))),ut(le),Ae=[],le=[],qe()}function Ne(){le.forEach((function(e){e[m]=Date.now()})),Xe(null),Je(null),Ve(),qe(),$e()}function Re(){je(),_t(le),Ae=Ae.concat(it(le)),ut(le),le=[],we=!0,Ve()}function xe(){be(),Ee()}function Be(e,t){var n=[];se.forEach((function(i){st(i)?n.push(i):!function(e,t,n){return!e[m]&&He(e,c,t,n)&&Fe(e,c)}(i,e,t)?!function(e,t,n){return e[m]&&(!He(e,u,t,n)||!Fe(e,u))}(i,e,t)?Ue(i)&&(De(i),FeedAssistanceStats.onViewedElement(i)):(i[f]?delete i[f]:(De(i),FeedAssistanceStats.onEndViewElement(i)),delete i[m]):(i[m]=Date.now(),le.push(i),FeedAssistanceStats.onStartViewElement(i))})),n.forEach((function(e){lt(se,e),FeedAssistanceStats.onStopTrackElement(e)}))}function De(e){lt(le,e),dt(e),Oe(rt(e)),ct(e)}function Oe(e){e&&Ae.push(e)}function Ue(e){return!!e[m]&&Math.min(3e5,Date.now()-e[m])>function(e){var t=Ie(e);return ee[t]||d}(e)}function He(e,t,n,i){if(!e)return!1;e[g]||(e[g]=!0,e[w]=e.offsetHeight,e[b]=n+e.getBoundingClientRect().top,e[k]=e[b]+e[w]);var o=i-ue-de,a=n+ue,r=n+i-de,s=e[w],l=e[b],c=e[k];return(c>a&&l<r?Math.min(r,c)-Math.max(a,l):0)>=Math.min(o*t,s*t)}function Fe(e,t){var n=e[C];n&&!n[A]&&~se.indexOf(n)&&(n[A]=!0,n[S]=n.clientWidth,n[y]=n.getBoundingClientRect().left+n.clientLeft),e[A]||(e[A]=!0,e[S]=e.offsetWidth);var i=n?n[S]||n.clientWidth:getCw(),o=n?n[y]||n.getBoundingClientRect().left+0:0,a=i+o,r=e[S],s=e.getBoundingClientRect().left,l=r+s,c=r*t,u=r*Math.max(0,1-t);return s+c>=o&&l-u<=a}function Ve(){fe=setTimeout(We,2500),pe=setTimeout(Ge,1e4),me=setTimeout(Ye,6e3),he=setTimeout(Ke,2e4)}function je(){clearTimeout(fe),clearTimeout(pe),clearTimeout(me),clearTimeout(he)}function $e(){ve=setInterval(Qe,3e4)}function qe(){clearInterval(ve)}function We(){Ae.length&&Xe(Ae)}function Ge(){ze(Ae),Ae=[],Xe(null)}function Ye(){le.length&&(Je(it(le)),me=setTimeout(Ye,5e3))}function Ke(){clearTimeout(me),_t(le),ze(it(le)),ut(le),le.forEach((function(e){e[f]=!0})),le=[],Je(null)}function Qe(){Ae.length>=100&&Ge()}function ze(e){if(e&&e.length){var t={act:"assistance_stats"};t=extend(t,(n={},each(e,(function(){n[this.type]?n[this.type].push(this.data):n[this.type]=[this.data]})),n)),ajax.post("/feed",t)}var n}function Xe(e){Ze(ae,e)}function Je(e){Ze(re,e)}function Ze(e,t){var n=lsGet(e)||{};t?n[ce]=t:delete n[ce],lsSet(e,n)}function et(){var e=et,t=[],n=lsGet(ae)||{},i=lsGet(re)||{};return e.iterator||(e.iterator=function(e){return function(n){nt(n)&&(t=t.concat(e[n]))}}),Object.keys(n).forEach(e.iterator(n)),Object.keys(i).forEach(e.iterator(i)),t}function tt(){var e=tt,t=lsGet(ae)||{},n=lsGet(re)||{};e.iterator||(e.iterator=function(e){return function(t){nt(t)&&delete e[t]}}),Object.keys(t).forEach(e.iterator(t)),Object.keys(n).forEach(e.iterator(n)),lsSet(ae,t),lsSet(re,n)}function nt(e){var t=Number(e);return t!==ce&&Date.now()-t>=36e4}function it(e){var t=[];return e.forEach((function(e){var n=rt(e);n&&t.push(n)})),t}function ot(e,t){return e+"_"+t}function at(e,t){return(0,te[ot(e[_],t)])(e)}function rt(e){if(st(e))return null;if(!Ue(e))return null;var t=function(e){return Z[e[_]]}(e);return{type:t,data:at(e,t)}}function st(e){return e[h]||!document.body.contains(e)}function lt(e,t){var n=e.indexOf(t);n>=0&&e.splice(n,1)}function ct(e){st(e)||Ue(e)&&(e[h]=!0)}function ut(e){each(e,(function(){ct(this)}))}function dt(e){e[v]=Date.now()}function _t(e){e.forEach(dt)}function ft(e){return(e=pt(e))&&domData(e,"from-ref")||ie}function pt(e){return hasClass(e,oe)||(e=domCA(e,".feedAssistance")),e}function mt(e){var t=(new Date).getTime();return e&&(e[v]||e[m])||t}FeedAssistanceStats.BLOCKS={BLOCK_TYPE_RECOMMENDED_SLIDER:E,BLOCK_TYPE_RECOMMENDED_GROUPS_SLIDER:I,BLOCK_TYPE_EXPLORE_BAIT:T,BLOCK_TYPE_PROFILE_PHOTO:M,BLOCK_TYPE_PROMO_BUTTON:P,BLOCK_TYPE_IMPORT_CONTACTS:L},FeedAssistanceStats.EVENTS={EVENT_EXPLORE_BAIT:x,EVENT_EXPLORE_BAIT_SUB:U,EVENT_FEED_ASSISTANCE:B,SUB_EVENT_EXPLORE_BAIT_VIEW:H,SUB_EVENT_EXPLORE_BAIT_OPENED:F,SUB_EVENT_EXPLORE_BAIT_SUBSCRIBE:V,SUB_EVENT_EXPLORE_BAIT_UNSUBSCRIBE:j,SUB_EVENT_EXPLORE_BAIT_OPEN_USER:$,SUB_EVENT_EXPLORE_BAIT_OPEN_GROUP:q,SUB_EVENT_EXPLORE_BAIT_HIDE:W,SUB_EVENT_EXPLORE_BAIT_REPORT:G,SUB_EVENT_SEEN:Y,SUB_EVENT_FILLED:K,EVENT_HIDE_BLOCK:D,SUB_EVENT_ENABLE_PUSH:Q,SUB_EVENT_DECLINE_PUSH:z,EVENT_PROMO_BUTTON:O,EVENT_PROMO_BUTTON_SUB:X,SUB_EVENT_PROMO_BUTTON_CLICK:J},addEvent(window,"blur",Le),addEvent(window,"focus",Ne),onDOMReady((function(){setTimeout(ke,500)})),addEvent(window,"scroll",(function(){Me(scrollGetY(),getCh())}),{passive:!0}),nav.onBeforeGo((function(){return Re()})),page.onChange((function(){return xe()}))},65023:function(){var e="friendsStat.events",t=null;function n(){clearTimeout(t);var n=lsGet(e)||[];if(n.length){lsSet(e);var i,o={act:"stats"};o=extend(o,(i={},each(n,(function(){i[this.type]?i[this.type].push(this.data):i[this.type]=[this.data]})),i)),ajax.post("/friends",o)}}window.FriendsStats={log:function(i,o,a){var r=function(e,t){var n=[],i=(new Date).getTime();switch(e){case FriendsStats.EVENTS.EVENT_VIEW_USER:n=[t.uid,i,t.pos,t.ref,t.blockType,t.trackCode];break;case FriendsStats.EVENTS.EVENT_HIDE_BLOCK:n=[i,t.ref,t.trackCode];break;case FriendsStats.EVENTS.EVENT_OPEN_USER:n=[t.uid,i,t.ref,t.trackCode]}return n.join("|")}(i,o);if(!r)return;var s=lsGet(e)||[];s.push({type:i,data:r}),lsSet(e,s),clearTimeout(t),a?n():t=setTimeout(n,1e4)},EVENTS:{EVENT_VIEW_USER:"show_user_rec",EVENT_HIDE_BLOCK:"hide_block",EVENT_OPEN_USER:"open_user"}},t=setTimeout(n,1e4)},93954:function(e,t,n){"use strict";n.d(t,{log:function(){return r},mark:function(){return s},error:function(){return l},clean:function(){return c},logQueueSize:function(){return u}});var i=n(45877),o=n(62018),a={};function r(e,t){var n={action:t,startTime:Date.now(),networkType:(0,i.getNetworkType)(),lpState:o.default.isLongPollingEnabled()};a[e]=n}function s(e,t){if(a[e]){var n=a[e],i=n.startTime,o=n.action,r=n.lpState,s=n.networkType;statlogsValueEvent("mvk_mail_send_time",Date.now()-i,o,t,r,s)}}function l(e,t,n){if(a[e]){var i=a[e],o=i.action,r=i.lpState,s=i.networkType;statlogsValueEvent("mvk_mail_send_error",0,o,t,n,r,s)}}function c(e){delete a[e]}function u(e){statlogsValueEvent("mvk_mail_send_queue_size",e,(0,i.getNetworkType)())}},43492:function(e,t,n){"use strict";var i=n(33764),o=n(57865),a=n(57551),r=n(74521);o.StickersAnimation.init({animatorLoader:function(){return Promise.all([n.e(8695),n.e(5544)]).then(n.bind(n,34206)).then((function(e){return e.default}))}}),window.Stickers=i.Stickers,window.StickersAnimation=o.StickersAnimation,window.StickersSettings=a.StickersSettings,window.StickersCache=r.default},91063:function(){var e={obj:null,highlight:!1,start:function(t){t.touches&&1==t.touches.length&&(e.clear(),e.end(t),e.obj=this||null,e.obj&&(e.highlight=!0,addClass("hover",e.obj),addClass("_thover",e.obj)))},cancel:function(t){e.obj&&(e.highlight=!1,e.end(t))},end:function(){e.obj&&(removeClass("hover",e.obj),e.highlight&&(e.clear(),addClass("active",e.obj)),e.obj=null,e.highlight=!1)},clear:function(){removeClass("active",geByClass1("active","vk_wrap")),removeClass("active",$(".Popup .active._thover"))}};window.thover=e},12408:function(){var e={tt:!1,handlers:[],show:function(){e.shown||(e.tt=Array.prototype.slice.call(arguments))},hide:function(){e.tt&&(e.tt=!1)},addHandler:function(t){t&&e.handlers.push(t)},removeHandler:function(t){t?each(e.handlers,(function(n){if(t===this)return e.handlers.splice(n,1),!1})):e.handlers=[]},onClose:function(){each(e.handlers,(function(){this()}))},clear:function(){e.tt&&(e.hide(),e.onClose(),e.removeHandler())},closeByTap:function(t){if(!e.tt||!t.target)return!1;var n=t.target;do{for(var i=0;i<e.tt.length;i++)if(n===e.tt[i])return!1}while(n=n.parentNode);return e.hide(),e.onClose(),!0}};window.tooltip=e},20123:function(e,t,n){"use strict";var i={onClose:(0,n(3226).default)(),inited:!1,width:!1,height:!1,onResize:null,_lastNav:!1,_opened:!1,_destroy:!1,init:function(){i.inited||(i.inited=!0,i.initEvents())},initEvents:function(){var e=function(e){i.fixHeight(vkNow()+2e3,e)};addEvent(window,"orientationchange",e),onBodyResize(e),e(!0)},opened:function(){return hasClass("z_opened",window.bodyNode)!==i.opened&&toggleClass("z_opened",window.bodyNode,i._opened),i._opened},toggle:function(e,t){return!!checkEvent(e)||(i.opened()?i.close(e,t):i.open(e,t),!1)},open:function(e,t){return!!checkEvent(e)||(i.opened()||(thover.clear(),i.init(),i._st=scrollTop(),i._lastNav=!1,addClass("z_opened",window.bodyNode),i._opened=!0,i.fixHeight(vkNow()+2e3,!0),scrollTop(0)),!1)},close:function(e,t){return!!checkEvent(e)||!!i.opened()&&(thover.clear(),val("z",""),removeClass("z_opened",window.bodyNode),i._lastNav={cur:nav.cur,path:nav.path,params:nav.params,hash:nav.hash},i._opened=!1,i._destroy&&(i._destroy(),i._destroy=!1),scrollTop(i._st,1),i._st=!1,i.onResize=null,i.onClose(),!1)},updateSize:function(){var e=ge("z");e&&e.offsetWidth&&e.offsetHeight&&(i.width=e.offsetWidth,i.height=e.offsetHeight,i.onResize&&i.onResize())},fixHeight:function(e,t){if((i._opened||t)&&(e&&!(vkNow()>e)||t)){var n=getCw(),o=getCh();(i._lastWidth!=n||i._lastHeight!=o||t)&&(i._lastWidth=n,i._lastHeight=o,setStyle("z","height",o),i.updateSize(),scrollTop()||scrollTop(0)),clearTimeout(i._fixTo),i._fixTo=setTimeout(i.fixHeight,50,e)}},create:function(e,t){val("z",e),i._destroy=t}};window.zlayer=i},80140:function(e,t,n){"use strict";n.d(t,{processThumbs:function(){return m},move:function(){return g},scale:function(){return A},crop:function(){return y},getRatio:function(){return w},convert:function(){return S},isValidThumbType:function(){return b},THUMB_DRAG_ANIMATION_DURATION:function(){return u},THUMBS_CONTAINER_DEFAULT_RATIO:function(){return c},THUMBS_MESH_GAP_MVK:function(){return d},THUMBS_MESH_GAP_MVK_SMALL:function(){return _}});var i=n(46769);!window.isMVK&&(window.vkExpand=window.vkExpand||"VK"+ +new Date,window.vkUUID=window.vkUUID||0,window.vkCache=window.vkCache||{});var o="doc",a="photo",r="video",s="album",l="market_album",c=1.5,u=window.isMVK?200:120,d=6,_=3,f=window.isMVK?604:537,p=window.isMVK?360:343;function m(e,t,n,i){var o=function(e){var t=0;return each(e,(function(e,n){t+=n})),t},a=function(e,t,n){return(t-(e.length-1)*n)/o(e)},s=(i=C(i)?i:{}).wide,l=[],c=0,u=[],m=[];each(n,(function(e,t){b(t.type)&&(u[u.length]=t[t.type]),t.type===r&&l.push(c),c++}));var v="",g=[],A=u.length;each(u,(function(n,i){var o=w(i,e,t);v+=o>1.2?"w":o<.8?"v":"q",g[g.length]=o}));var y,S,E=g.length>0?o(g)/g.length:1,I=5;window.isMVK&&(I=window.innerWidth>=480?d:_);var T=I;i.force?(y=e,S=t):(s?(y=f,S=p):e>=381?(y=381,S=1==A?361:237):(y=337,S=1==A?320:214),e<y&&(y=e,S=t),window.isMVK&&(y=Math.min(f,window.innerWidth),S=Math.min(p,y)));var M=y/S,P=0,L=0;if(1==A){var N={lastColumn:1,lastRow:1,single:1};u[0].thumb?(P=279,L=185):g[0]>=1*M?(P=y,L=Math.min(P/g[0],S)):(L=S,P=Math.min(L*g[0],y));var R=h(u[0],P,L,N);!R.unsized&&(R.image.width<P&&R.image.height<=S||R.image.height<L&&R.image.width<=y)&&(P=R.image.width,L=R.image.height,R=h(u[0],P,L,N)),m[0]=R}else if(2==A){var x,B;switch(v){case"ww":if(E>1.4*M&&g[1]-g[0]<.2){B=y,x=Math.min(B/g[0],B/g[1],(S-T)/2),m[0]=h(u[0],B,x,{lastColumn:1}),m[1]=h(u[1],B,x,{lastColumn:1,lastRow:1}),P=y,L=2*x+T;break}case"vv":case"qv":case"vq":case"qq":B=(y-I)/2,x=Math.min(B/g[0],B/g[1],S),m[0]=h(u[0],B,x,{lastRow:1}),m[1]=h(u[1],B,x,{lastRow:1,lastColumn:1}),P=y,L=x;break;default:var D=intval((y-I)/g[1]/(1/g[0]+1/g[1])),O=y-D-I;x=Math.min(S,D/g[0],O/g[1]),m[0]=h(u[0],D,x,{lastRow:1}),m[1]=h(u[1],O,x,{lastColumn:1,lastRow:1}),P=y,L=x}}else if(3==A)if((g[0]>1.2*M||E>1.5*M)&&"www"==v){var U,H=y,F=Math.min(H/g[0],.66*(S-T));if(m[0]=h(u[0],H,F,{lastColumn:1}),"www"==v){var V=intval(y-I)/2;U=Math.min(S-F-T,V/g[1],V/g[2]),m[1]=h(u[1],V,U,{lastRow:1}),m[2]=h(u[2],y-V-I,U,{lastColumn:1,lastRow:1})}else{var j=intval((y-I)/g[2]/(1/g[1]+1/g[2])),$=y-j-I;U=Math.min(S-F-T,j/g[2],$/g[1]),m[1]=h(u[1],j,U,{lastRow:1}),m[2]=h(u[2],j,U,{lastRow:1,lastColumn:1})}P=y,L=F+U+T}else{var q=S,W=intval(Math.min(q*g[0],.75*(y-I)));m[0]=h(u[0],W,q,{lastRow:1});var G=g[1]*(S-T)/(g[2]+g[1]),Y=S-G-T,K=Math.min(y-W-I,intval(G*g[2]),intval(Y*g[1]));m[1]=h(u[1],K,Y,{lastColumn:1}),m[2]=h(u[2],K,G,{lastColumn:1,lastRow:1}),P=W+K+I,L=S}else if(4==A)if((g[0]>1.2*M||E>1.5*M)&&"wwww"==v){var Q=y,z=Math.min(Q/g[0],.66*(S-T));m[0]=h(u[0],Q,z,{lastColumn:1});var X=(y-2*I)/(g[1]+g[2]+g[3]),J=intval(X*g[1]),Z=intval(X*g[2]),ee=Q-J-Z-2*I;X=Math.min(S-z-T,X),m[1]=h(u[1],J,X,{lastRow:1}),m[2]=h(u[2],Z,X,{lastRow:1}),m[3]=h(u[3],ee,X,{lastColumn:1,lastRow:1}),P=y,L=z+X+T}else{var te=S,ne=Math.min(te*g[0],.66*(y-I)),ie=(S-2*T)/(1/g[1]+1/g[2]+1/g[3]),oe=intval(ie/g[1]),ae=intval(ie/g[2]),re=te-oe-ae-2*T;ne+(ie=Math.min(y-ne-I,ie))+I<y&&te*g[0]>ne&&(ne=Math.min(te*g[0],y-I-ie)),m[0]=h(u[0],ne,te,{lastRow:1}),m[1]=h(u[1],ie,oe,{lastColumn:1}),m[2]=h(u[2],ie,ae,{lastColumn:1}),m[3]=h(u[3],ie,re,{lastColumn:1,lastRow:1}),P=ne+ie+I,L=S}else{var se=[],le=0;E>(l.length?1.3:1.1)?each(g,(function(e,t){se[se.length]=Math.max(1,t)})):each(g,(function(e,t){~l.indexOf(le)?se[se.length]=t:se[se.length]=Math.min(1,t),le++}));var ce,ue,de={};for(de[A+""]=[a(se,y,I)],ce=1;ce<=A-1;ce++)de[ce+","+(ue=A-ce)]=[a(se.slice(0,ce),y,I),a(se.slice(ce),y,I)];for(ce=1;ce<=A-2;ce++)for(ue=1;ue<=A-ce-1;ue++)de[ce+","+ue+","+(A-ce-ue)]=[a(se.slice(0,ce),y,I),a(se.slice(ce,ce+ue),y,I),a(se.slice(ce+ue),y,I)];var _e,fe=null,pe=0;for(var me in de)if(de.hasOwnProperty(me)){var he=de[me],ve=o(he)+T*(he.length-1),ge=Math.abs(ve-S);if(~me.indexOf(",")){for(var Ae=me.split(","),ye=0;ye<Ae.length;ye++)Ae[ye]=intval(Ae[ye]);(Ae[0]>Ae[1]||Ae[2]&&Ae[1]>Ae[2])&&(ge+=50,ge*=1.5)}(null===fe||ge<pe)&&(fe=me,pe=ge,_e=ve)}for(var we=k(u),Se=k(se),be=fe.split(","),ke=de[fe],Ce=be.length-1,Ee=0;Ee<be.length;Ee++){var Ie=parseInt(be[Ee]),Te=we.splice(0,Ie),Me=ke.shift(),Pe=Te.length-1,Le={};Ce==Ee&&(Le.lastRow=!0);for(var Ne=y,Re=0;Re<Te.length;Re++){var xe=Te[Re],Be=Se.shift(),De=Le,Oe=void 0;Pe==Re?(Oe=Math.ceil(Ne),De.lastColumn=!0):Ne-=(Oe=intval(Be*Me))+I,m[m.length]=h(xe,Oe,Me,De)}}P=y,L=_e}return{width:intval(P),height:intval(L),thumbs:m}}function h(e,t,n,i){var o={id:e.id,width:intval(t),height:intval(n),lastColumn:i.lastColumn,lastRow:i.lastRow,single:i.single,image:v(e,t,n,i.single),unsized:e.unsized,type:e.type,orig:e};return e.title&&void 0!==e.size?extend(o,{title:e.title,size:e.size}):e.title&&void 0!==e.msize?extend(o,{title:e.title,msize:e.msize}):e.type===r&&e.name&&void 0!==e.name&&extend(o,{name:e.namem}),"number"==typeof e.duration&&(e.duration=formatTime(e.duration)),o.unsized?o.ratio=1:o.ratio=o.image.width/o.image.height,o}function v(e,t,n,i){if(!e)return{};t=intval(t),n=intval(n);var a,s=window.devicePixelRatio||1;if(e.type===r||e.type===o){(e.vid?["x","y","l","s","m"]:["o","z","y","x","m","s","temp"]).forEach((function(i){e.sizes[i]&&(!a||t*s<=e.sizes[i][1]&&n*s<=e.sizes[i][2])&&(a=e.sizes[i])}))}else{var l=e.thumb?e.thumb.sizes:e.sizes,c=l.x||l[l.length-1],u=c?(c[1]||1)/(c[2]||1):1,d=0;u>t/n?(d=n,u>1&&(d*=u)):(d=t,u<1&&(d/=u)),n*=s,t*=s;var _=!i&&l.o,f="";f=l.temp?"temp":d<75?"s":d<130?"m":_&&l.o&&l.o[1]>=t&&l.o[2]>=n?"o":_&&l.p&&l.p[1]>=t&&l.p[2]>=n?"p":_&&l.q&&l.q[1]>=t&&l.q[2]>=n?"q":_&&l.r&&l.r[1]>=t&&l.r[2]>=n?"r":"x",a=l[f]||[]}return a[1]=intval(a[1]),a[2]=intval(a[2]),a[1]&&a[2]||(e.unsized=!0),{src:a[0],width:a[1],height:a[2]}}function g(e,t,n){if(n>=e.length)for(var i=n-e.length;1+i--;)e.push(void 0);return e.splice(n,0,e.splice(t,1)[0]),e}function A(e,t,n,i){n=intval(n),i=intval(i)||n;var o=e,a=t;return e>=t&&e>n?(o=intval(n),a=intval(t/(e/n))):e<t&&t>i&&(a=intval(i),o=intval(e/(t/i))),[o,a]}function y(e,t,n){var i=t,o=n,a=0,r=0;if(!e.vid&&e.image.width&&e.image.height){var c=e.image.width/e.image.height;c<t/n?(e.single&&e.image.width<t&&(t=e.image.width,n=Math.min(n,e.image.height)),(o=(i=t)/c)>n&&(r=-intval((o-n)/2))):(e.single&&e.image.height<n&&(n=e.image.height,t=Math.min(t,e.image.width)),(i=(o=n)*c)>t&&(a=-intval((i-t)/2)))}return{width:i,height:o,marginLeft:a,marginTop:e.orig&&(e.type===l||e.type===s)&&e.single?0:r}}function w(e,t,n){var i;switch(e.type){case o:i=e.ratio;break;case r:i=e.ratio||1.777;break;case s:case l:i=1.5;break;default:if(e.sizes&&e.sizes.x){var a=e.sizes.x,c=a[1],u=a[2];c&&u&&(i=c/u)}if(e.sizes&&e.sizes.temp){var d=e.sizes.temp,_=d[1],f=d[2];_&&f&&(i=_/f)}}return i||1}function S(e,t,n,c){var u=t.split("_"),d=u[0],_=u[1],f=(0,i.default)({owner_id:d,ownerId:d,itemId:_,type:e,remove:n.remove,click:n.click,temp:"temp"in n.sizes},c);switch(e){case o:f.data={sizes:n.sizes,ratio:n.ratio,label:n.label,href:n.href},f.doc=f.data;break;case a:f.data={pid:_,sizes:n.sizes,restrictionBlur:n.restrictionBlur,restrictionGeo:n.restrictionGeo,photoId:n.photoId},f.photo=f.data;break;case r:f.data={vid:_,duration:n.duration,platform:n.platform,play_icon:n.play_icon,preview:n.preview,active_live:n.active_live,restriction:n.restriction,ratio:n.ratio,sizes:n.sizes,name:n.name},f.video=f.data;break;case s:f.data={aid:_,title:n.title,size:n.size,thumb:{sizes:n.sizes},restrictionBlur:n.restrictionBlur,restrictionGeo:n.restrictionGeo,photoId:n.photoId},f.album=f.data;break;case l:f.data={type:l,aid:_,title:n.title,msize:n.msize,thumb:{sizes:n.sizes}},f.market_album=f.data}return f.data.type=e,f.data.id=f.temp?e+"temp_"+d:""+e+f.ownerId+"_"+f.itemId,f}function b(e){return!!~[o,a,r,s,l].indexOf(e.toString())}function k(e,t){var n=C(e)||void 0===e.length?{}:[];for(var i in e)(!/webkit/i.test(_ua)||"layerX"!=i&&"layerY"!=i&&"webkitMovementX"!=i&&"webkitMovementY"!=i)&&(t&&"object"==typeof e[i]&&"prototype"!==i&&null!==e[i]?n[i]=k(e[i]):n[i]=e[i]);return n}var C=function(e){return"[object Object]"===Object.prototype.toString.call(e)}},81020:function(e,t,n){"use strict";n.d(t,{AudioAds:function(){return r}});var i=n(63197),o=n(9961),a=n(79322),r=function(){function e(e,t,n){this._isPlaying=!1,this._adsCurrentProgress=0,this._adman=null,this._admanLoaded=!1,this._adEvents=[],this.player=e||{},this.playerVersion=t||null,this._startAdsTO=null,this._adsConfig=null,this._duration=0,this.isMvk=Boolean(n),this.adsStatUrl=this.isMvk?"audio":"al_audio.php"}var t=e.prototype;return t.isPlaying=function(){return this._isPlaying},t.setAdsConfig=function(e){this._adsConfig=e},t.getCurrentProgress=function(){return this._adsCurrentProgress},t.getDuration=function(){return this._duration},t.loadAdman=function(t){var n=this,o=function(e){return t&&t(e)};if(this._admanLoaded)o();else{var a=0;(0,i.loadScript)(e.ADMAN_SRC,{onLoad:function(){n._admanLoaded=!0,o()},onError:function(){window.abp?(n._admanLoaded=!0,o()):(3===(a+=1)&&(n._admanLoaded=!0),o("script_load_fail"))}})}},t._fetchAd=function(t,n,i,a,r){var l=this;this.loadAdman((function(c){if(!window.AdmanHTML)return l._sendEvent("no_adman",n,e.AD_TYPE,c),a&&a();l._adman=new AdmanHTML;var u=l._adsConfig||vk.audioAdsConfig||window.audioAdsConfig,d={_SITEID:276,ver:251116,vk_id:vk.id,duration:t.duration,content_id:s(t.ownerId,t.id),vk_catid:e.CAT_IDS[n]||e.CAT_IDS.other,sign:u.sign||""};extend(d,t.ads||{}),nav.objLoc&&nav.objLoc.preview&&(d.preview=intval(nav.objLoc.preview)),cur.adsPreview&&(d.preview=1,d.vk_id=398724832),l._adman.setDebug(!!d.preview),l._adman.onError((function(){return a&&a()})),l._adman.onReady((function(){if(l._adman){var t=l._adman.getBannersForSection(e.AD_TYPE);t&&t.length?"statistics"===t[0].type?(l._play(!0,n),a&&a()):(l._sendEvent("received",n),i?(l._sendEvent("rejected",n,e.AD_TYPE,r),l.deinit(),a&&a()):(l._sendEvent("ready",n),l.player.notify(o.events.AD_READY),l._play(!1,n,a))):(i||l._sendEvent("not_received",n),a&&a())}})),l._adman.init({slot:3514,wrapper:l.isMvk?ce("div"):se("<div></div>"),params:d,browser:{adBlock:!!window.abp,mobile:!1}}),l._sendEvent("requested",n)}))},t._sendEvent=function(e,t,n,i){var o=this,a=n?"/"+n:"",r=i?"/"+i:"";this._adEvents.push(e+"/"+t+a+r),clearTimeout(this._adEventDelay),this._adEventDelay=setTimeout((function(){ajax.post(o.adsStatUrl,{act:"ad_event",events:o._adEvents.join(","),v:o.playerVersion,abp:intval(window.abp)},{onFail:function(){return!0}}),o._adEvents=[]}),500)},t._play=function(t,n,i){var a=this;this._adman.onCompleted((function(){a.deinit(!0),t?a._sendEvent("statistics",n):(a.player.notify(o.events.PROGRESS,0),a.player.notify(o.events.AD_COMPLETED),a._isPlaying=!1,a._adsCurrentProgress=0,a._sendEvent("completed",n),window.setDocumentTitle&&window.setDocumentTitle(a._adsPrevTitle),i&&i())})),this._adman.onStarted((function(){t||(a.player.setIsPlaying(!0),a.player.notify(o.events.PLAY),a.player.notify(o.events.PROGRESS,0),a.player.notify(o.events.AD_STARTED),a.updateVolume(),a._sendEvent("started",n),window.statlogsValueEvent&&statlogsValueEvent("audio_web_ad_link","show"))})),this._adman.onPaused((function(){a.player.setIsPlaying(!1),a.player.notify(o.events.PAUSE)})),this._adman.onPlayed((function(){a.player.setIsPlaying(!0),a.player.notify(o.events.PLAY)}));var r=[.25,.5,.75];if(this._adman.onTimeRemained((function(e){a._duration=isNaN(e.duration)?0:e.duration,a._adsCurrentProgress=(isNaN(e.percent)?0:e.percent)/100,a.player.notify(o.events.PROGRESS,a._adsCurrentProgress,a._duration),each(r,(function(e,t){if(a._adsCurrentProgress>=t)return r.shift(),a._sendEvent("progress_"+intval(100*t),n),!1}))})),this._adman.start(e.AD_TYPE),t)return i&&i();this._isPlaying=!0,this._adsPrevTitle=document.title,this.isMvk||setDocumentTitle(getLang("global_audio_ad"))},t.updateVolume=function(){this._adman&&this._adman.setVolume(.7*this.player.getVolume())},t.deinit=function(e){this._adman=null,!e&&this.player.notify(o.events.AD_DEINITED)},t.pause=function(){this._adman&&(this.player.setIsPlaying(!1),this._adman.pause())},t.stop=function(){this._adman&&(this.player.setIsPlaying(!1),this._adman.stop())},t.resume=function(){this._adman&&(this.player.setIsPlaying(!0),this._adman.resume(),this.player.notify(o.events.PLAY))},t.checkPlay=function(t,n){var i=this.player._getPlayingContextSection(),o=this._isAllowed(t),a=o.type,r=o.reason,s=function(){return n&&n()};switch(a){case e.ALLOW_ALLOWED:this._fetchAd(t,i,!1,s);break;case e.ALLOW_DISABLED:s();break;case e.ALLOW_REJECT:this._fetchAd(t,i,!0,!1,r),s()}},t.hasAdsSupport=function(){var e=intval(browser.version.split(".")[0]);return!(browser.safari&&e<14||browser.chrome&&e<50)},t._isAllowed=function(t){if(vk.widget)return{type:e.ALLOW_DISABLED};if((0,a.isPodcast)(t))return{type:e.ALLOW_DISABLED};var n=this._adsConfig||vk.audioAdsConfig||window.audioAdsConfig;if(n){if(!n.enabled||!this.hasAdsSupport())return{type:e.ALLOW_DISABLED};if(cur.adsPreview)return{type:e.ALLOW_ALLOWED};if(n.day_limit_reached)return{type:e.ALLOW_REJECT,reason:e.REJECT_REASON_LIMIT};var i=this.player._getPlayingContextSection();return n.sections.indexOf(i)>-1?{type:e.ALLOW_ALLOWED}:{type:e.ALLOW_REJECT,reason:e.REJECT_REASON_SECTION}}return{type:e.ALLOW_REJECT,reason:e.REJECT_REASON_UNKNOWN}},t.startPlay=function(e,t){this.checkPlay(e,t)},e}();function s(e,t){for(var n=e.toString(16),i=t.toString(16);i.length<8;)i="0"+i;return n+i}r.ADMAN_SRC="//ad.mail.ru/static/admanhtml/rbadman-html5.min.js",r.CAT_IDS={my:101,my_playlists:101,audio_feed:109,recent:113,user_wall:104,group_wall:104,user_list:102,group_list:103,user_playlists:102,group_playlists:103,feed:105,search:110,global_search:110,replies:104,im:106,group_status:104,user_status:104,recs:107,recs_audio:107,recs_album:107,other:114},r.AD_TYPE="preroll",r.ALLOW_DISABLED=1,r.ALLOW_ALLOWED=2,r.ALLOW_REJECT=3,r.REJECT_REASON_UNKNOWN="unknown",r.REJECT_REASON_LIMIT="track_limit_exceeded",r.REJECT_REASON_SECTION="section_not_allowed"},9961:function(e,t,n){"use strict";n.d(t,{events:function(){return i}});var i={CURRENT_CHANGED:"curr",PLAY:"start",PLAY_REQUESTED:"request_play",PAUSE:"pause",STOP:"stop",UPDATE:"update",LOADED:"loaded",ENDED:"ended",FAILED:"failed",BUFFERED:"buffered",PROGRESS:"progress",VOLUME:"volume",PLAYLIST_CHANGED:"plchange",ADDED:"added",REMOVED:"removed",FREQ_UPDATE:"freq",SEEK:"seek",PLAY_NEXT:"play_next",AD_READY:"ad_ready",AD_DEINITED:"ad_deinit",AD_STARTED:"ad_started",AD_COMPLETED:"ad_completed",START_LOADING:"start_load",CAN_PLAY:"actual_start",SELECT:"select",DESELECT:"deselect",EMPTY_PLAYLIST:"empty_playlist",NOT_FOUND_PLAYLIST:"not_found_playlist",INIT:"init",REQUEST_EXPANDED:"request_expanded",MUSIC_AUDIOS_ADD:"music_audios_add",MUSIC_PLAYLISTS_ADD:"music_playlists_add"}},74873:function(e,t,n){"use strict";n.d(t,{AudioPlayerHTML5:function(){return r}});var i=n(76663),o=n(88241),a=n(34220),r=function(){function e(e){this.type="html5",this.opts=e||{},this._audioNodes=[],this._currentAudioEl=this._createAudioNode(),this._prefetchAudioEl=this._createAudioNode()}var t=e.prototype;return t.destroy=function(){},t.getPlayedTime=function(){for(var e=this._currentAudioEl.played,t=0,n=0;n<e.length;n++)t+=e.end(n)-e.start(n);return t},t.getCurrentTime=function(){return this._currentAudioEl.currentTime},t.clearAudioNode=function(){this._currentAudioEl=this._createAudioNode(o.SILENCE)},t.isCurrent=function(e){return e===this._currentAudioEl},t._createAudioNode=function(e){var t=this,n=new a.AudioHlsNode({onBufferUpdate:function(){t.isCurrent(n)&&t.opts.onBufferUpdate(t.getCurrentBuffered())},onProgressUpdate:function(){t.isCurrent(n)&&t.opts.onProgressUpdate(t.getCurrentProgress(),t.getPlayedTime(),t.getCurrentTime())},onEnd:function(){t.isCurrent(n)&&n.src!==o.SILENCE&&t.opts.onEnd()},onSeeked:function(){t.isCurrent(n)&&t.opts.onSeeked()},onSeek:function(){t.isCurrent(n)&&t.opts.onSeek()},onFail:function(e){t._prefetchAudioEl===n?t._prefetchAudioEl=t._createAudioNode():t.isCurrent(n)&&n.src!==o.SILENCE&&(t._hlsError=e,t.opts.onFail&&t.opts.onFail())},onDurationChange:function(){t.isCurrent(n)&&t._seekOnReady&&n.duration>0&&(t.seek(t._seekOnReady),t._seekOnReady=!1)},onCanPlay:function(){t.isCurrent(n)&&t.opts.onCanPlay&&t.opts.onCanPlay()},onPause:this.opts.onPause,onPlay:this.opts.onPlay,volume:this.hasOwnProperty("_volume")?this._volume:this.opts.defaultVolume},e);return n},t.onReady=function(e){e()},t.prefetch=function(e){this._prefetchAudioEl&&this._prefetchAudioEl.url===(0,i.audioUnmaskSource)(e)||(this._prefetchAudioEl=this._createAudioNode(e))},t.seek=function(e){var t=this._currentAudioEl;t.duration>0&&t.src&&t.src!==o.SILENCE?t.currentTime=t.duration*e:this._seekOnReady=e},t.setVolume=function(e){void 0===e&&(e=this._currentAudioEl.volume),this._currentAudioEl.volume=e,this._prefetchAudioEl&&(this._prefetchAudioEl.volume=e),this._volume=e},t.setPlaybackRate=function(e){this._currentAudioEl.playbackRate=e},t.getCurrentProgress=function(){return this._currentAudioEl.currentProgress},t.getCurrentBuffered=function(){return this._currentAudioEl&&this._currentAudioEl.currentBuffered},t.getDuration=function(){return this._currentAudioEl&&this._currentAudioEl.duration},t.isFullyLoaded=function(){return this._currentAudioEl.isFullyLoaded},t.setUrl=function(e,t){var n,a=this;if(void 0===t&&(t=function(){}),!e)return t&&t(!1);var r=(0,i.audioUnmaskSource)(e),s=this._currentAudioEl;if(this._currentAudioEl.src&&this._currentAudioEl.src!==o.SILENCE&&(this._seekOnReady=!1),this._currentAudioEl.src===r)return this.opts.onCanPlay&&this.opts.onCanPlay(),void(t&&t(!0));if(this._prefetchAudioEl){if(this._prefetchAudioEl.src===r)return this._currentAudioEl.pause(),this._currentAudioEl.setUrl(o.SILENCE),this._prefetchAudioEl.readyState>=3&&setTimeout((function(){return a.opts.onCanPlay&&a.opts.onCanPlay()})),this._currentAudioEl=this._prefetchAudioEl,this._prefetchAudioEl=null,void(t&&t(!0));r!==o.SILENCE&&this._prefetchAudioEl.setUrl(o.SILENCE)}s.src!==r&&(n=s.setUrl(r).then((function(){return a._stopFrequencyAnalise()}))),n?n.then((function(){return t(!0)})).catch((function(){return t(!1)})):t(!0)},t.play=function(){this._stopFrequencyAnalise();var e=this._currentAudioEl;if(e.src){var t=e.play();return this._startFrequencyAnalise(),t}return Promise.resolve()},t.preparePlay=function(){if(browser.safari)return this._currentAudioEl.play()},t._startFrequencyAnalise=function(){var e=this;function t(e,t,n,i){return(n-t)*e/i+t}function n(e,t){return Math.random()*(t-e)+e}this._stopFrequencyAnalise();var i=999,o=null,a=null;this._freqUpdateInterval=setInterval((function(){var r;e._currentAudioEl.paused?r=[0,0,0,0]:(++i>3&&(i=0,o=a,a=[n(.7,1),n(.55,.8),n(.3,.55),n(.03,.45)],o||(o=[n(.7,1),n(.55,.8),n(.3,.55),n(.03,.45)])),r=[t(i,o[0],a[0],3),t(i,o[1],a[1],3),t(i,o[2],a[2],3),t(i,o[3],a[3],3)]),e.opts.onFrequency&&e.opts.onFrequency(r)}),50)},t._stopFrequencyAnalise=function(){clearInterval(this._freqUpdateInterval),this.opts.onFrequency&&this.opts.onFrequency([0,0,0,0])},t.pause=function(){this._currentAudioEl.pause(),this._stopFrequencyAnalise()},t.stop=function(){this._currentAudioEl.pause(),this.seek(0),this._stopFrequencyAnalise()},t._setFadeVolumeInterval=function(e){if(e){if(!this._fadeVolumeWorker&&window.Worker&&window.Blob){var t=new Blob(["\n          var interval;\n          onmessage = function(e) {\n            clearInterval(interval);\n            if (e.data == 'start') {\n              interval = setInterval(function() { postMessage({}); }, 20);\n            }\n          }\n        "]);try{this._fadeVolumeWorker=new Worker(window.URL.createObjectURL(t))}catch(e){this._fadeVolumeWorker=!1}}this._fadeVolumeWorker?(this._fadeVolumeWorker.onmessage=e,this._fadeVolumeWorker.postMessage("start")):this._fadeVolumeInterval=setInterval(e,60)}else this._fadeVolumeWorker&&(this._fadeVolumeWorker.terminate(),this._fadeVolumeWorker=null),this._fadeVolumeInterval&&clearInterval(this._fadeVolumeInterval)},t.fadeVolume=function(e,t,n){var i=this;e=Math.max(0,Math.min(1,e));var o=this._currentAudioEl,a=0;if(t){var r=e-o.volume;a=r/(t/20||1)}else a=e<o.volume?-.06:.001;if(Math.abs(e-o.volume)<=.001)return this._setFadeVolumeInterval(),n&&n();var s=o.volume;this._setFadeVolumeInterval((function(){!t&&a>0&&(a*=1.35),s+=a;if(a<0?s<=e:s>=e)return i.setVolume(e),i._setFadeVolumeInterval(),n&&n();i.setVolume(s)}))},t.getErrorData=function(){var e=this._currentAudioEl.error||{};return{is_hls:this._currentAudioEl.hls?1:0,url:this._currentAudioEl.src,error_code:e.code,error_message:e.message,hls_error:this._hlsError?JSON.stringify(this._hlsError):null}},e}()},43946:function(e,t,n){"use strict";n.d(t,{AudioStats:function(){return L}});var i,o,a=n(46769),r=n(14786),s=n(3369),l=n(86900),c=n(63150),u=n.n(c),d=n(51988),_="start",f="stop",p="volume",m="rewind",h="play_further",v="default",g="next_track",A="prev_track",y="auto",w="interruption",S="pause",b="new",k="close_app",C="queue",E="pause",I="session_end",T=((i={}).start=1,i.stop=2,i.volume=3,i.rewind=4,i.play_further=5,i.added=6,i.removed=7,i.recommendation_removed=8,i.show_album=9,i.share_audio=10,i.broadcast=11,i.curator=12,i),M=((o={}).default=1,o.next_track=2,o.prev_track=3,o.auto=4,o.interruption=5,o.pause=6,o.new=7,o.close_app=8,o.queue=9,o.pause=10,o.upload=11,o.on=12,o.off=13,o.follow=14,o.unfollow=15,o),P="audio_unique_unauth_id",L=function(){function e(e){if(this.playerAdapter=e,this.listenedData=null,this.sendTimeout=null,this.currentAudioId=null,this.currentAudio=null,this.currentAudioTrackCode=null,this.pausedAudioId=null,this.playlistChanged=!1,this.currentPosition=0,this.currentListened=0,this.playedTime=0,this.adsCompleted=!1,this.wasEnded=!1,vk.id)this.uniqueUserId=null;else{var t=d.default.get(P);t?this.uniqueUserId=t:(this.uniqueUserId=u()(),d.default.set(P,this.uniqueUserId))}this.debug=e.isDebug(),this.onVolume=(0,s.debounce)(this.onVolume.bind(this),300),this.playerAdapter.listenPlay(this.onPlay,this),this.playerAdapter.listenPause(this.onPause,this),this.playerAdapter.listenStop(this.onPause,this),this.playerAdapter.listenProgress(this.onProgress,this),this.playerAdapter.listenVolume(this.onVolume,this),this.playerAdapter.listenSeek(this.onSeek,this),this.playerAdapter.listenPlaylistChanged(this.onPlaylistChanged,this),this.playerAdapter.listenEnded(this.onEnded,this),this.playerAdapter.listenPlayNext(this.onPlayNext,this),this.playerAdapter.listenAdCompleted(this.onAdCompleted,this),this.onPageClose=this.onPageClose.bind(this),addEvent(window,"beforeunload",this.onPageClose)}var t=e.prototype;return t.canOperate=function(){return!this.playerAdapter.isPodcast()&&!this.playerAdapter.isAdPlaying()},t.getCurrentAudioParams=function(){var e=this.currentAudioId||this.playerAdapter.getAudioId();if(e){var t=e.split("_");return{ownerId:t[0],audioId:t[1],trackCode:this.currentAudioTrackCode||this.playerAdapter.getAudioTrackCode()}}return{}},t.getEnvParams=function(){return{state:this.playerAdapter.getState(),context:this.playerAdapter.getContext(),ref:window.cur&&vk.widget?String(cur.widgetReferrer||"").substring(0,20):""}},t.getListenedTime=function(){return Math.round(this.playerAdapter.getListenedTime())||0},t.getPlaySubtype=function(){if(this.playerAdapter.isAutoPlayed())return y;var e=this.playerAdapter.getSequence();if(e)return e>0?g:A;var t=this.pausedAudioId,n=this.playerAdapter.getAudioId();return t&&n===t?S:b},t.onPlay=function(){if(this.canOperate()){var e=this.playerAdapter.getAudio(),t=e.fullId,n=this.currentAudioId===t||!this.currentAudioId,i=this.currentAudioId!==this.pausedAudioId,o=this.playerAdapter.getListenedTime();!n&&i&&this.onTrackSwitch(this.currentAudio,this.currentPlaylistId),this.playedTime=vkNow(),this.currentAudioId=t,this.currentAudio=e,this.currentAudioTrackCode=this.playerAdapter.getAudioTrackCode(),this.currentPlaylistId=this.playerAdapter.getPlaylistId(),this.wasEnded||this.playerAdapter.hasPrevAudio()&&(!this.pausedAudioId||this.playerAdapter.isAutoPlayed())?(this.currentPosition=0,o=0):this.currentPosition=this.playerAdapter.getProgressInSeconds(),this.currentListened=o,this.sendCurrentAudioEvent({type:_,subtype:this.getPlaySubtype(),position:this.currentPosition,listened:o}),this.pausedAudioId=null,this.playlistChanged=!1,this.wasEnded=!1}},t.onPause=function(){var e=this,t=this.playerAdapter.getAudioId();if(this.canOperate()&&t){var n=this.collectListenedData();this.sendListenedDataDelayed(1e3,n),setTimeout((function(){if(!(e.currentAudio&&t!==e.currentAudio.fullId||vkNow()-e.playedTime<150)){e.pausedAudioId=t;var n=e.playerAdapter.getPausedBy(e.playedTime);e.sendCurrentAudioEvent({type:f,subtype:n?n===C?C:w:E})}}),100)}},t.onProgress=function(){this.playerAdapter.getProgress()<.01||!this.playerAdapter.isPlaying()||(this.currentPosition=this.playerAdapter.getProgressInSeconds(),this.currentListened=this.playerAdapter.getListenedTime(),!this.pausedAudioId&&vkNow()-this.playedTime>150&&this.collectListenedData(),this.adsCompleted&&(this.sendCurrentAudioEvent({type:_,subtype:this.getPlaySubtype(),position:this.currentPosition}),this.adsCompleted=!1))},t.onVolume=function(){this.canOperate()&&this.sendCurrentAudioEvent({type:p,subtype:v})},t.onSeek=function(){if(this.canOperate()){var e={position:this.currentPosition,positionTo:this.playerAdapter.getProgressInSeconds()};e.position!==e.positionTo&&this.sendCurrentAudioEvent((0,a.default)({type:m,subtype:v},e))}},t.onPlaylistChanged=function(){this.canOperate()&&(this.playlistChanged=!0)},t.onEnded=function(){this.listenedData&&this.playerAdapter.isLastTrack()&&(this.listenedData.end_stream_reason=I),this.wasEnded=!0,this.playerAdapter.isRepeatCurrentAudio()?(this.sendCurrentAudioEvent({type:f,subtype:y}),this.collectListenedData(),this.sendListenedData()):this.sendListenedDataDelayed(150)},t.onPlayNext=function(e,t){if(this.canOperate()){var n=t.split("_"),i=n[0],o=n[1];this.sendAudioEvent({type:h,subtype:v,ownerId:i,audioId:o})}},t.onAdCompleted=function(){this.adsCompleted=!0},t.onTrackSwitch=function(e,t){if(e){var n=b,i=this.playerAdapter.getSequence(),o=e.fullId.split("_"),a=o[0],r=o[1];this.playerAdapter.isAutoPlayed()?n=y:i&&(n=i>0?g:A),this.sendCurrentAudioEvent({type:f,subtype:n,position:this.currentPosition,listened:this.currentListened,trackCode:e.trackCode,playlistId:t,ownerId:a,audioId:r}),this.wasEnded=!0,this.collectListenedData(e),this.collectListenedDataSwitch();var s=this.listenedData;this.listenedData=null,this.sendListenedData(s)}},t.onPageClose=function(){this.playerAdapter.isPlaying()&&(this.sendCurrentAudioEvent({type:f,subtype:k}),this.sendListenedData())},t.collectListenedDataSwitch=function(){if(this.listenedData){if(this.listenedData.end_stream_reason===I)return;var e=this.playerAdapter.isAutoPlayed(),t=this.getListenedTime(),n=this.playerAdapter.getSequence(),i=null;n&&!e?i=n>0?"next_btn":"prev":this.playlistChanged&&(i="playlist_change"),!i&&e&&(i="playlist_next"),this.listenedData.end_stream_reason=i||"new",t&&(this.listenedData.listened=t)}},t.collectListenedData=function(e){void 0===e&&(e=null);var t=e||this.currentAudio;if(this.canOperate()&&t){var n=t.fullId,i=t.trackCode||this.playerAdapter.getAudioTrackCode(),o=this.getListenedTime(),a=t.urlHash;if(a||console.log("no url hash"),o&&a){var r={audio_id:n,listened:o,context:this.playerAdapter.getContext(),hash:a};return window.cur&&vk.widget&&(r.ref=cur.widgetReferrer||""),this.playerAdapter.hasSearchParams()&&(r.search_params=JSON.stringify(this.playerAdapter.getSearchParams())),this.playerAdapter.hasPlaylist()&&(this.playerAdapter.isRealPlaylist()&&(r.playlist_id=this.playerAdapter.getPlaylistId()),this.playerAdapter.isShuffledPlaylist()&&(r.shuffled=1)),i&&(r.track_code=i),this.playerAdapter.isRepeatCurrentAudio()?r.repeat="one":this.playerAdapter.isRepeatAll()&&(r.repeat="all"),this.playerAdapter.isAutoPlayed()&&(r.auto=1),this.playerAdapter.hasPrevAudio()&&(r.prev_audio_id=this.playerAdapter.getPrevAudioId()),this.playerAdapter.hasPrevPlaylist()&&this.playerAdapter.isRealPrevPlaylist()&&(r.prev_playlist_id=this.playerAdapter.getPrevPlaylistId()),this.playerAdapter.isPlaying()||(r.end_stream_reason="stop_btn"),r.state=document.hidden?"background":"app",this.listenedData=r,this.sendListenedDataDelayed(1e4,r),r}}},t.sendListenedData=function(e){void 0===e&&(e=null),clearTimeout(this.sendTimeout);var t=e||this.listenedData;this.listenedData=null,t&&t.listened&&(this.uniqueUserId&&(t.unique_id=this.uniqueUserId),this.playerAdapter.sendListenedData(t))},t.sendListenedDataDelayed=function(e,t){var n=this;void 0===e&&(e=0),void 0===t&&(t=null),clearTimeout(this.sendTimeout),this.sendTimeout=setTimeout((function(){return n.sendListenedData(t)}),e)},t.serializeEvent=function(e){var t=[T[e.type],M[e.subtype],1];return e.audioId?t.push(e.ownerId+"_"+e.audioId):t.push(0),e.trackCode?t.push(e.trackCode):t.push(0),e.state?t.push(e.state):t.push(r.UNKNOWN_STATE),e.ref?t.push(e.ref):t.push(""),e.context?t.push(e.context):t.push("other"),e.volume||0===e.volume?t.push(e.volume):t.push(this.playerAdapter.getVolume()),e.position||0===e.position?t.push(e.position):t.push(this.playerAdapter.getProgressInSeconds()),e.shuffle?t.push(e.shuffle?1:0):t.push(0),e.repeat?t.push(e.repeat):t.push(0),e.listened?t.push(Math.max(e.listened,0)):t.push(0),e.playlistId?t.push(e.playlistId):t.push(""),e.targetOwnerId?t.push(e.targetOwnerId):t.push(0),this.uniqueUserId?t.push(this.uniqueUserId):t.push(""),e.positionTo?t.push(e.positionTo):t.push(null),t},t.sendEvent=function(e){this.debug&&(console.log("audio stats event",e.type,e.subtype,e),window._statForTest||(window._statForTest=[]),window._statForTest.push(e)),l.statlogsValueEvent.apply(void 0,["audio_sts"].concat(this.serializeEvent(e)))},t.sendCurrentAudioEvent=function(e){this.sendEvent((0,a.default)({shuffle:this.playerAdapter.isShuffledPlaylist(),repeat:this.playerAdapter.isRepeatCurrentAudio()?1:this.playerAdapter.isRepeatAll()?2:0,volume:this.playerAdapter.getVolume(),position:this.playerAdapter.getProgressInSeconds(),listened:this.getListenedTime(),playlistId:this.playerAdapter.getPlaylistId()},this.getEnvParams(),{},this.getCurrentAudioParams(),{},e))},t.sendAudioEvent=function(e){var t=(0,a.default)({},e,{},this.getEnvParams());!vk.id&&this.uniqueUserId&&(t.uniqueUnauthId=this.uniqueUserId),this.sendEvent(t)},t.destroy=function(){this.playerAdapter.unListenAll(),removeEvent(window,"beforeunload",this.onPageClose),this.playerAdapter=null,this.listenedData=null,clearTimeout(this.sendTimeout)},e}()},14786:function(e,t,n){"use strict";n.d(t,{UNKNOWN_STATE:function(){return o},FULL_SCREEN_STATE:function(){return a},AudioStatsPlayerAdapter:function(){return r}});var i=n(9961),o=0,a=2,r=function(){function e(e){this.player=e,this.listeners=[]}var t=e.prototype;return t.listen=function(e,t,n){var i=t.bind(n||this);this.listeners.push({event:e,fn:t,listener:i}),this.playerListen(e,i)},t.unListen=function(e,t){var n=-1;if(each(this.listeners,(function(i,o){if(o.event===e&&o.listener===t)return n=i,!1})),!(n<0)){var i=this.listeners[n];this.playerUnListen(e,i.listener),this.listeners.splice(n,1)}},t.unListenAll=function(){for(var e;e=this.listeners[0];)this.unListen(e.event,e.listener)},t.listenPlay=function(e,t){this.listen(i.events.PLAY,e,t)},t.listenPause=function(e,t){this.listen(i.events.PAUSE,e,t)},t.listenStop=function(e,t){this.listen("stop",e,t)},t.listenProgress=function(e,t){this.listen(i.events.PROGRESS,e,t)},t.listenVolume=function(e,t){this.listen(i.events.VOLUME,e,t)},t.listenSeek=function(e,t){this.listen(i.events.SEEK,e,t)},t.listenPlaylistChanged=function(e,t){this.listen(i.events.PLAYLIST_CHANGED,e,t)},t.listenEnded=function(e,t){this.listen(i.events.ENDED,e,t)},t.listenPlayNext=function(e,t){this.listen(i.events.PLAY_NEXT,e,t)},t.listenAdCompleted=function(e,t){this.listen(i.events.AD_COMPLETED,e,t)},t.playerListen=function(e,t){this.player.subscribe(e,t)},t.playerUnListen=function(e,t){this.player.unsubscribe(e,t)},t.getPausedBy=function(){return null},t.getState=function(){return document.hidden?1:3},t.getProgress=function(){return this.player.playerGetProgress()},t.getProgressInSeconds=function(){return this.player.getProgressInSeconds()},t.getVolume=function(){return this.player.getVolume()},t.getAudioId=function(){return this.player.getAudioId()},t.getAudio=function(){return this.player.getAudio()},t.getAudioTrackCode=function(){return this.player.getAudioTrackCode()},t.getPrevAudioId=function(){return this.player.getPrevAudioId()},t.getPrevPlaylistId=function(){return this.player.getPrevPlaylistId()},t.getPlaylistId=function(){return this.player.getPlaylistId()},t.getContext=function(){return this.player.getContext()},t.getSequence=function(){return this.player.getSequence()},t.getType=function(){return this.player.getType()},t.getListenedTime=function(){return isNaN(this.player.getListenedTime())?0:Math.round(this.player.getListenedTime())},t.getSearchParams=function(){return this.player.getSearchParams()},t.isPlaying=function(){return this.player.isPlaying()},t.isAutoPlayed=function(){return this.player.isAutoPlayed()},t.isRepeatCurrentAudio=function(){return this.player.isRepeatCurrentAudio()},t.isRepeatAll=function(){return this.player.isRepeatAll()},t.isShuffledPlaylist=function(){return this.player.isShuffledPlaylist()},t.isRealPlaylist=function(){return this.player.isRealPlaylist()},t.isRealPrevPlaylist=function(){return this.player.isRealPrevPlaylist()},t.isPodcast=function(){return this.player.isPodcast()},t.isAdPlaying=function(){return this.player.ads.isPlaying()},t.isLastTrack=function(){return this.player.isLastTrack()},t.hasPrevAudio=function(){return this.player.hasPrevAudio()},t.hasPrevPlaylist=function(){return this.player.hasPrevPlaylist()},t.hasPlaylist=function(){return this.player.hasPlaylist()},t.hasSearchParams=function(){return this.player.hasSearchParams()},t.isDebug=function(){return!1},t.sendListenedData=function(e){return this.player.sendListenedData(e)},e}()},88241:function(e,t,n){"use strict";n.d(t,{SILENCE:function(){return i}});var i="data:audio/wav;base64,UklGRigAAABXQVZFZm10IBIAAAABAAEARKwAAIhYAQACABAAAABkYXRhAgAAAAEA"},41650:function(e,t,n){"use strict";n.d(t,{AUDIO_PLAYER_ENUMS:function(){return i}});var i={AUDIO_ITEM_INDEX_ID:0,AUDIO_ITEM_INDEX_OWNER_ID:1,AUDIO_ITEM_INDEX_URL:2,AUDIO_ITEM_INDEX_TITLE:3,AUDIO_ITEM_INDEX_PERFORMER:4,AUDIO_ITEM_INDEX_DURATION:5,AUDIO_ITEM_INDEX_ALBUM_ID:6,AUDIO_ITEM_INDEX_AUTHOR_LINK:8,AUDIO_ITEM_INDEX_LYRICS:9,AUDIO_ITEM_INDEX_FLAGS:10,AUDIO_ITEM_INDEX_CONTEXT:11,AUDIO_ITEM_INDEX_EXTRA:12,AUDIO_ITEM_INDEX_HASHES:13,AUDIO_ITEM_INDEX_COVER_URL:14,AUDIO_ITEM_INDEX_ADS:15,AUDIO_ITEM_INDEX_SUBTITLE:16,AUDIO_ITEM_INDEX_MAIN_ARTISTS:17,AUDIO_ITEM_INDEX_FEAT_ARTISTS:18,AUDIO_ITEM_INDEX_ALBUM:19,AUDIO_ITEM_INDEX_TRACK_CODE:20,AUDIO_ITEM_INDEX_RESTRICTION:21,AUDIO_ITEM_INDEX_ALBUM_PART:22,AUDIO_ITEM_ACCESS_KEY:24,AUDIO_ITEM_CHART_INFO_INDEX:25,AUDIO_ITEM_HAS_LYRICS_BIT:1,AUDIO_ITEM_CAN_ADD_BIT:2,AUDIO_ITEM_CLAIMED_BIT:4,AUDIO_ITEM_QUEUE_BIT:8,AUDIO_ITEM_HQ_BIT:16,AUDIO_ITEM_LONG_PERFORMER_BIT:32,AUDIO_ITEM_UMA_BIT:128,AUDIO_ITEM_REPLACEABLE:512,AUDIO_ITEM_EXPLICIT_BIT:1024,AUDIO_ENOUGH_LOCAL_SEARCH_RESULTS:500,AUDIO_RECOMS_TYPE_LISTENED:"recoms6",AUDIO_PLAYING_CLS:"audio_row__playing",AUDIO_CURRENT_CLS:"audio_row__current",AUDIO_DURATION_CLS:"audio_row__duration",AUDIO_LAYER_HEIGHT:550,AUDIO_LAYER_MIN_WIDTH:400,AUDIO_LAYER_MAX_WIDTH:1e3,AUDIO_HQ_LABEL_CLS:"audio_hq_label_show",AUDIO_MAX_AUDIOS_IN_SNIPPET:5,AUDIO_ROW_COVER_SIZE:40,AUDIO_ROW_PLAY_SIZE:24,AUDIO_ROW_ACTION_ROW_ITEM:'<button class="audio_row__more_action audio_row__more_action_%0% _audio_row__more_action_%0% %3%">%2%</button>',LOG_LS_KEY:"audiolog"}},78869:function(e,t,n){"use strict";n.d(t,{asObject:function(){return a}});var i=n(41650),o=n(51478);function a(e){if(!e)return null;if(isObject(e))return e;if("string"==typeof e)return{id:e};var t=(e[i.AUDIO_PLAYER_ENUMS.AUDIO_ITEM_INDEX_HASHES]||"").split("/"),n=(e[i.AUDIO_PLAYER_ENUMS.AUDIO_ITEM_INDEX_COVER_URL]||"").split(","),a=(0,o.getAudioPerformers)(e,!1);return{id:intval(e[i.AUDIO_PLAYER_ENUMS.AUDIO_ITEM_INDEX_ID]),owner_id:intval(e[i.AUDIO_PLAYER_ENUMS.AUDIO_ITEM_INDEX_OWNER_ID]),ownerId:e[i.AUDIO_PLAYER_ENUMS.AUDIO_ITEM_INDEX_OWNER_ID],fullId:e[i.AUDIO_PLAYER_ENUMS.AUDIO_ITEM_INDEX_OWNER_ID]+"_"+e[i.AUDIO_PLAYER_ENUMS.AUDIO_ITEM_INDEX_ID],title:e[i.AUDIO_PLAYER_ENUMS.AUDIO_ITEM_INDEX_TITLE]||"",subTitle:e[i.AUDIO_PLAYER_ENUMS.AUDIO_ITEM_INDEX_SUBTITLE],performer:a,mainArtists:e[i.AUDIO_PLAYER_ENUMS.AUDIO_ITEM_INDEX_MAIN_ARTISTS],featArtists:e[i.AUDIO_PLAYER_ENUMS.AUDIO_ITEM_INDEX_FEAT_ARTISTS],authorLink:e[i.AUDIO_PLAYER_ENUMS.AUDIO_ITEM_INDEX_AUTHOR_LINK],duration:intval(e[i.AUDIO_PLAYER_ENUMS.AUDIO_ITEM_INDEX_DURATION]),lyrics:e[i.AUDIO_PLAYER_ENUMS.AUDIO_ITEM_INDEX_LYRICS]||"",url:e[i.AUDIO_PLAYER_ENUMS.AUDIO_ITEM_INDEX_URL],flags:e[i.AUDIO_PLAYER_ENUMS.AUDIO_ITEM_INDEX_FLAGS],context:e[i.AUDIO_PLAYER_ENUMS.AUDIO_ITEM_INDEX_CONTEXT],extra:e[i.AUDIO_PLAYER_ENUMS.AUDIO_ITEM_INDEX_EXTRA],accessKey:e[i.AUDIO_PLAYER_ENUMS.AUDIO_ITEM_ACCESS_KEY],addHash:t[0]||"",editHash:t[1]||"",actionHash:t[2]||"",deleteHash:t[3]||"",replaceHash:t[4]||"",urlHash:t[5]||"",restoreHash:t[6]||"",canEdit:!!t[1],canDelete:!!t[3],isLongPerformer:e[i.AUDIO_PLAYER_ENUMS.AUDIO_ITEM_INDEX_FLAGS]&i.AUDIO_PLAYER_ENUMS.AUDIO_ITEM_LONG_PERFORMER_BIT,canAdd:!!(e[i.AUDIO_PLAYER_ENUMS.AUDIO_ITEM_INDEX_FLAGS]&i.AUDIO_PLAYER_ENUMS.AUDIO_ITEM_CAN_ADD_BIT),coverUrl_s:n[0],coverUrl_p:n[1],isClaimed:!!(e[i.AUDIO_PLAYER_ENUMS.AUDIO_ITEM_INDEX_FLAGS]&i.AUDIO_PLAYER_ENUMS.AUDIO_ITEM_CLAIMED_BIT),isFromQueue:!!(e[i.AUDIO_PLAYER_ENUMS.AUDIO_ITEM_INDEX_FLAGS]&i.AUDIO_PLAYER_ENUMS.AUDIO_ITEM_QUEUE_BIT),isExplicit:!!(e[i.AUDIO_PLAYER_ENUMS.AUDIO_ITEM_INDEX_FLAGS]&i.AUDIO_PLAYER_ENUMS.AUDIO_ITEM_EXPLICIT_BIT),isUMA:!!(e[i.AUDIO_PLAYER_ENUMS.AUDIO_ITEM_INDEX_FLAGS]&i.AUDIO_PLAYER_ENUMS.AUDIO_ITEM_UMA_BIT),isReplaceable:!!(e[i.AUDIO_PLAYER_ENUMS.AUDIO_ITEM_INDEX_FLAGS]&i.AUDIO_PLAYER_ENUMS.AUDIO_ITEM_REPLACEABLE),ads:e[i.AUDIO_PLAYER_ENUMS.AUDIO_ITEM_INDEX_ADS],album:e[i.AUDIO_PLAYER_ENUMS.AUDIO_ITEM_INDEX_ALBUM],albumId:intval(e[i.AUDIO_PLAYER_ENUMS.AUDIO_ITEM_INDEX_ALBUM_ID]),albumPart:intval(e[i.AUDIO_PLAYER_ENUMS.AUDIO_ITEM_INDEX_ALBUM_PART]),trackCode:e[i.AUDIO_PLAYER_ENUMS.AUDIO_ITEM_INDEX_TRACK_CODE],restrictionStatus:e[i.AUDIO_PLAYER_ENUMS.AUDIO_ITEM_INDEX_RESTRICTION],chartInfo:e[i.AUDIO_PLAYER_ENUMS.AUDIO_ITEM_CHART_INFO_INDEX]}}},76663:function(e,t,n){"use strict";n.d(t,{audioUnmaskSource:function(){return a}});var i="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMN0PQRSTUVWXYZO123456789+/=",o={v:function(e){return e.split("").reverse().join("")},r:function(e,t){var n;e=e.split("");for(var o=i+i,a=e.length;a--;)~(n=o.indexOf(e[a]))&&(e[a]=o.substr(n-t,1));return e.join("")},s:function(e,t){var n=e.length;if(n){var i=function(e,t){var n=e.length,i=[];if(n){var o=n;for(t=Math.abs(t);o--;)t=(n*(o+1)^t+o)%n,i[o]=t}return i}(e,t),o=0;for(e=e.split("");++o<n;)e[o]=e.splice(i[n-1-o],1,e[o])[0];e=e.join("")}return e},i:function(e,t){return o.s(e,t^vk.id)},x:function(e,t){var n=[];return t=t.charCodeAt(0),each(e.split(""),(function(e,i){n.push(String.fromCharCode(i.charCodeAt(0)^t))})),n.join("")}};function a(e){if((!window.wbopen||!~(window.open+"").indexOf("wbopen"))&&~e.indexOf("audio_api_unavailable")){var t,n,i=e.split("?extra=")[1].split("#"),a=""===i[1]?"":r(i[1]);if(i=r(i[0]),"string"!=typeof a||!i)return e;for(var s=(a=a?a.split(String.fromCharCode(9)):[]).length;s--;){if(t=(n=a[s].split(String.fromCharCode(11))).splice(0,1,i)[0],!o[t])return e;i=o[t].apply(null,n)}if(i&&"http"===i.substr(0,4))return i}return e}function r(e){if(!e||e.length%4==1)return!1;for(var t,n,o=0,a=0,r="";n=e.charAt(a++);)~(n=i.indexOf(n))&&(t=o%4?64*t+n:n,o++%4)&&(r+=String.fromCharCode(255&t>>(-2*o&6)));return r}},33464:function(e,t,n){"use strict";function i(e,t){var n="";return e.forEach((function(i,o){var a="/audio?performer=1&q="+encodeURIComponent(i.name),r=window.getWebHost?window.getWebHost():"";i.id&&(a="/artist/"+i.id),n+=t?'<a class="artist_link" href="'+r+a+'">'+i.name+"</a>":i.name,o<e.length-1&&(n+=", ")})),n}n.d(t,{getAudioArtistsString:function(){return i}})},51478:function(e,t,n){"use strict";n.d(t,{getAudioPerformers:function(){return r}});var i=n(79322),o=n(33464),a=n(41650);function r(e,t){void 0===t&&(t=!0);var n="",r=!(0,i.isPodcast)(e)&&t;if(isArray(e[a.AUDIO_PLAYER_ENUMS.AUDIO_ITEM_INDEX_MAIN_ARTISTS])&&(n=(0,o.getAudioArtistsString)(e[a.AUDIO_PLAYER_ENUMS.AUDIO_ITEM_INDEX_MAIN_ARTISTS],r)),isArray(e[a.AUDIO_PLAYER_ENUMS.AUDIO_ITEM_INDEX_FEAT_ARTISTS])&&(n+=" feat. ",n+=(0,o.getAudioArtistsString)(e[a.AUDIO_PLAYER_ENUMS.AUDIO_ITEM_INDEX_FEAT_ARTISTS],r)),!n){var s=e[a.AUDIO_PLAYER_ENUMS.AUDIO_ITEM_INDEX_PERFORMER]?e[a.AUDIO_PLAYER_ENUMS.AUDIO_ITEM_INDEX_PERFORMER].replace(/<\/?em>/g,""):"";if(r)n='<a class="artist_link" data-performer="'+s+'" href="'+("/audio?performer=1&q="+encodeURIComponent(s))+'">'+s+"</a>";else n=s}return n}},82312:function(e,t,n){"use strict";n.d(t,{getCurrentAudio:function(){return o}});var i=n(78869);function o(){try{return window.isMVK?window.audio.getCurrent():(0,i.asObject)(window.getAudioPlayer().getCurrentAudio())}catch(e){return{id:0,ownerId:0}}}},79322:function(e,t,n){"use strict";n.d(t,{isPodcast:function(){return o}});var i=n(41650);function o(e){if(!e)return!1;var t=isObject(e)?e.extra:e[i.AUDIO_PLAYER_ENUMS.AUDIO_ITEM_INDEX_EXTRA];return isObject(t)||(t=JSON.parse(t||"{}")),!!t.podcast}},67334:function(e,t,n){"use strict";function i(e,t){if(!window.Worker||!window.Blob)return setTimeout(e,t);var n=new Blob(["\n      var timeout;\n      onmessage = function(e) {\n        clearTimeout(timeout);\n        if (e.data == 'start') {\n          timeout = setTimeout(function() { postMessage({}); }, "+t+");\n        }\n      }\n    "]);try{var i=new Worker(window.URL.createObjectURL(n));return i.onmessage=function(){i.terminate(),e()},i.postMessage("start"),i}catch(n){return setTimeout(e,t)}}n.d(t,{setWorkerTimeout:function(){return i}})},22124:function(e,t,n){"use strict";function i(e){try{return e.play()||Promise.resolve()}catch(e){return Promise.reject(e)}}n.d(t,{wrapAudioPlay:function(){return i}})},79866:function(e,t,n){"use strict";n.d(t,{PlayerFlash:function(){return o}});var i=n(41880),o=function(){function e(e){this.opts=e||{},window._flashVoiceInstance=this}var t=e.prototype;return t.fadeVolume=function(e,t){return this.setVolume(e),t()},t.destroy=function(){re(e.PLAYER_EL_ID)},t.onReady=function(t){if(this._player)return t(!0);if(!1===this._player)return t(!1);this._onReady=t;ge(e.PLAYER_EL_ID)||document.body.appendChild(ce("div",{id:e.PLAYER_EL_ID,className:"fixed"}));var n=this;renderFlash(e.PLAYER_EL_ID,{url:"/swf/audio_lite.swf",id:"flash_voice_player",height:2},{swliveconnect:"true",allowscriptaccess:"always",wmode:"opaque"},{onPlayFinish:"VoicePlayerFlash.onAudioFinishCallback",onLoadProgress:"VoicePlayerFlash.onAudioLoadProgressCallback",onPlayProgress:"VoicePlayerFlash.onAudioProgressCallback"})&&setTimeout((function(){n._checkFlashLoaded()}),50)},t.setUrl=function(e,t){this._trackOptions={},t&&"object"==typeof t&&(this._trackOptions=t,t=t.callback),this._url!=e?(this._url=e,this._player&&this._player.loadAudio(e),t&&t(!0)):t&&t(!0)},t.setVolume=function(e){this._player&&this._player.setVolume&&this._player.setVolume(e)},t.play=function(){this._player&&this._player.playAudio()},t.seek=function(e){var t=(this._total||0)*e;this._player&&this._player.playAudio(t)},t.pause=function(){this._player&&this._player.pauseAudio()},t.isFullyLoaded=function(){return!1},t.getPlayedTime=function(){return 0},t.getCurrentProgress=function(){return this._currProgress||0},t.getCurrentBuffered=function(){return this._currBuffered||0},t.stop=function(){this._player&&this._player.stopAudio()},t._checkFlashLoaded=function(){var e=ge("flash_voice_player");if(this._checks=this._checks||0,this._checks++,this._checks>10){this._player=!1;var t=this._onReady;return t&&t(!1)}if(e&&e.paused){this._player=e;var n=this._onReady;n&&n(!0),this._onReady=null}else{var i=this;setTimeout((function(){i._checkFlashLoaded()}),100)}},e.onAudioFinishCallback=function(){var e=window._flashVoiceInstance;e.opts.onEnd&&e.opts.onEnd()},e.onAudioProgressCallback=function(e,t){var n=window._flashVoiceInstance;t&&(n._total=t,n._currProgress=e/t,n.opts.onProgressUpdate&&n.opts.onProgressUpdate(n._currProgress))},e.onAudioLoadProgressCallback=function(e,t){var n=window._flashVoiceInstance;n._currBuffered=e/t,n.opts.onBufferUpdate&&n.opts.onBufferUpdate(n._currBuffered)},(0,i.default)(e,[{key:"type",get:function(){return"flash"}},{key:"loaded",get:function(){return!!this._player}}]),e}();window.VoicePlayerFlash=o,o.PLAYER_EL_ID="flash_voice"},36164:function(e,t,n){"use strict";n.d(t,{PlayerHTML5:function(){return s}});var i=n(41880),o=n(22124),a="data:audio/wav;base64,UklGRiQAAABXQVZFZm10IBAAAAABAAEARKwAAIhYAQACABAAZGF0YQAAAAA=",r='audio/mpeg; codecs="mp3"',s=function(){function e(e){this.opts=e||{},this._trackOptions={},this._audioNodes=[],this._currentAudioEl=this._createAudioNode(),this._prefetchAudioEl=this._createAudioNode()}e.isSupported=function(e){var t=document.createElement("audio");return!!t.canPlayType&&(!((e=e||r)!==r||!(browser.safari||browser.safari_mobile||browser.ios)||!browser.version.toString().startsWith("14"))||!!t.canPlayType(e).replace(/no/,""))};var t=e.prototype;return t.destroy=function(){},t.getPlayedTime=function(){for(var e=this._currentAudioEl.played,t=0,n=0;n<e.length;n++)t+=e.end(n)-e.start(n);return t},t._setAudioNodeUrl=function(e,t){window.data&&window.data(e,"setUrlTimesetUrlTime",t==a?0:vkNow()),e.src=t},t._createAudioNode=function(e){var t=new Audio,n=this;return this.opts.onBufferUpdate&&addEvent(t,"progress",(function(){n._currentAudioEl==t&&n.opts.onBufferUpdate(n.getCurrentBuffered());var e=t.buffered;1==e.length&&0==e.start(0)&&e.end(0)==t.duration&&(t._fullyLoaded=!0)})),addEvent(t,"stalled",(function(){n._currentAudioEl==t&&n._isInvalidDuration()&&n._currentAudioEl.currentTime>=n.duration-1&&n._currentAudioEl.dispatchEvent(new Event("ended"))})),this.opts.onProgressUpdate&&addEvent(t,"timeupdate",(function(){n._currentAudioEl==t&&n.opts.onProgressUpdate(n.getCurrentProgress())})),this.opts.onEnd&&addEvent(t,"ended",(function(){n._currentAudioEl==t&&n.opts.onEnd()})),this.opts.onSeeked&&addEvent(t,"seeked",(function(){n._currentAudioEl==t&&n.opts.onSeeked()})),this.opts.onSeek&&addEvent(t,"seeking",(function(){n._currentAudioEl==t&&n.opts.onSeek()})),addEvent(t,"error",(function(){n._prefetchAudioEl==t?n._prefetchAudioEl=n._createAudioNode():n._currentAudioEl==t&&n.opts.onFail&&n.opts.onFail()})),addEvent(t,"canplay",(function(){n._prefetchAudioEl,n._currentAudioEl==t&&(n.opts.onCanPlay&&n.opts.onCanPlay(),n._seekOnReady&&(n.seek(n._seekOnReady),n._seekOnReady=!1))})),e&&(this._setAudioNodeUrl(t,e),t.preload="auto",t.volume=this._volume||1,t.load()),this._audioNodes.push(t),t},t.onReady=function(e){e(!0)},t.prefetch=function(e){this._prefetchAudioEl&&this._setAudioNodeUrl(this._prefetchAudioEl,a),this._prefetchAudioEl=this._createAudioNode(e)},t.seek=function(e){var t=this._currentAudioEl;this.duration?t.currentTime=this.duration*e:this._seekOnReady=e},t.setVolume=function(e){void 0===e&&(e=this._currentAudioEl.volume),this._currentAudioEl.volume=e,this._prefetchAudioEl&&(this._prefetchAudioEl.volume=e),this._volume=e},t._isInvalidDuration=function(){var e=this._currentAudioEl;return isNaN(e.duration)||e.duration==1/0||0==e.duration},t.getCurrentProgress=function(){var e=this._currentAudioEl;return this.duration?Math.max(0,Math.min(1,e.currentTime/this.duration)):0},t.getCurrentBuffered=function(){var e=this._currentAudioEl;return e&&e.buffered.length?Math.min(1,e.buffered.end(0)/e.duration):0},t.isFullyLoaded=function(){return this._currentAudioEl._fullyLoaded},t.setUrl=function(t,n){var i=this._currentAudioEl;if(this._seekOnReady=!1,this._trackOptions={},n&&"object"==typeof n&&(this._trackOptions=n,n=n.callback),i.src==t)return this.opts.onCanPlay&&this.opts.onCanPlay(),n&&n(!0);if(this._prefetchAudioEl&&this._prefetchAudioEl.readyState>e.STATE_HAVE_NOTHING)if(this._prefetchAudioEl.src==t){this._currentAudioEl.pause(0),this._setAudioNodeUrl(this._currentAudioEl,a);var o=this;this._prefetchAudioEl.readyState>=e.STATE_HAVE_FUTURE_DATA&&setTimeout((function(){o.opts.onCanPlay&&o.opts.onCanPlay()})),i=this._currentAudioEl=this._prefetchAudioEl,this._prefetchAudioEl=!1}else this._prefetchAudioEl.src&&this._setAudioNodeUrl(this._prefetchAudioEl,a);return i.src!=t&&(this._setAudioNodeUrl(i,t),i.load()),n&&n(!0)},t.play=function(t){this._prefetchAudioEl.src==t&&this._prefetchAudioEl.readyState>e.STATE_HAVE_NOTHING&&(this._setAudioNodeUrl(this._currentAudioEl,a),this._currentAudioEl=this._prefetchAudioEl,this._prefetchAudioEl=this._createAudioNode(),this.opts.onCanPlay&&this.opts.onCanPlay());var n=this._currentAudioEl;n.src&&(0,o.wrapAudioPlay)(n).catch((function(){debugLog("Audio: url set failed (html5 impl)")}))},t.pause=function(){var e=this._currentAudioEl;e.src&&e.pause()},t.stop=function(){var e=this._currentAudioEl;this._setAudioNodeUrl(e,a)},t._setFadeVolumeInterval=function(e){if(e){if(!this._fadeVolumeWorker&&window.Worker&&window.Blob){var t=new Blob(["\n        var interval;\n        onmessage = function(e) {\n          clearInterval(interval);\n          if (e.data == 'start') {\n            interval = setInterval(function() { postMessage({}); }, 20);\n          }\n        }\n      "]);try{this._fadeVolumeWorker=new Worker(window.URL.createObjectURL(t))}catch(e){this._fadeVolumeWorker=!1}}this._fadeVolumeWorker?(this._fadeVolumeWorker.onmessage=e,this._fadeVolumeWorker.postMessage("start")):this._fadeVolumeInterval=setInterval(e,60)}else this._fadeVolumeWorker&&(this._fadeVolumeWorker.terminate(),this._fadeVolumeWorker=null),this._fadeVolumeInterval&&clearInterval(this._fadeVolumeInterval)},t.fadeVolume=function(e,t){e=Math.max(0,Math.min(1,e));var n=this._currentAudioEl,i=0;if(i=e<n.volume?-.04:.001,Math.abs(e-n.volume)<=.001)return this._setFadeVolumeInterval(),t&&t();var o=n.volume;this._setFadeVolumeInterval(function(){i>0&&(i*=1.2),o+=i;if(i<0?o<=e:o>=e)return this.setVolume(e),this._setFadeVolumeInterval(),t&&t();this.setVolume(o)}.bind(this))},(0,i.default)(e,[{key:"type",get:function(){return"html5"}},{key:"loaded",get:function(){return!0}},{key:"duration",get:function(){var e=this._currentAudioEl,t=isNaN(e.duration)||e.duration==1/0?0:e.duration;return!t&&this._trackOptions.duration&&(t=parseInt(this._trackOptions.duration)),t}}]),e}();s.STATE_HAVE_NOTHING=0,s.STATE_HAVE_FUTURE_DATA=3,s.HAVE_ENOUGH_DATA=4,s.AUDIO_EL_ID="ap_audio"},199:function(e,t,n){"use strict";n.d(t,{VoiceMessagePlayer:function(){return p}});var i,o=n(41880),a=n(36164),r=n(79866),s=n(9961),l=n(22124),c=n(30675),u=n(51988),d=n(86900),_=n(93263),f=!1,p=function(){function e(e){var t=this,n=(void 0===e?{}:e).onListened;this._reattach=!1,this._audioEl=null,this._playing=!1,this._timer=null,this._duration=0,this._detaching=!1;var o={onEnd:function(){t.detach()},onFail:function(){o.onEnd()},onCanPlay:function(){},onProgressUpdate:function(e){t._updateProgress(e)}};i=!1,a.PlayerHTML5.isSupported()?(a.PlayerHTML5.isSupported('audio/ogg;codecs="opus"')&&!a.PlayerHTML5.isSupported('audio/ogg;codecs="codec_check"')&&(i=!0),this._impl=new a.PlayerHTML5(o)):browser.flash&&window.renderFlash&&(this._impl=new r.PlayerFlash(o)),this.onPlayPause=function(e){return cancelEvent(e),t._clearMediaSession(),t.toggle()},this.onDurationClick=function(e){t.durationType=!t.durationType,cancelEvent(e)},this._onListened=function(){n&&n(t._audioEl)},this._initEvents()}var t=e.prototype;return t._updateProgress=function(e){this._audioEl&&(this._duration*e>=1||this._duration<1)&&!this._audioEl._listened&&(this._audioEl._listened=!0,this._onListened()),this._durationEl&&(this.durationType?this._durationEl.innerHTML="-"+formatTime(Math.round(this._duration*(1-e))):this._durationEl.innerHTML=formatTime(Math.round(this._duration*e))),this._progressSlider&&this._progressSlider.setValue(e)},t._initInterface=function(){var e=this;this._el=ce("div",{innerHTML:'<div class="audio-msg-player audio-msg-track"><button class="audio-msg-track--btn"></button><div class="audio-msg-track--duration"></div><div class="audio-msg-track--wave-wrapper"><div class="audio-msg-track--slider"></div></div></div>'}).firstChild,window.getLang&&attr(this._el,"aria-label",getLang("mail_audio_message")),this._playBtn=geByClass1("audio-msg-track--btn",this._el);var t=this._audioEl.getAttribute("id");if(t&&this._el.setAttribute("id","vmp_"+t),this._audioEl.classList.contains("audio-msg-track--preview")){this._el.classList.add("audio-msg-track--preview"),this._playBtn.classList.add("audio-msg-track--btnSvg");var n=geByClass1("audio-msg-track--btn",this._audioEl);this._playBtn.innerHTML=n.innerHTML}window.getLang&&attr(this._playBtn,"aria-label",getLang("global_audio_play")),this._durationEl=geByClass1("audio-msg-track--duration",this._el),this._durationEl.innerHTML=formatTime(this._duration),this._progressSlider=new c.Slider(geByClass1("audio-msg-track--slider",this._el),{value:0,size:0,hintClass:"audio_player_hint",formatHint:function(t){return formatTime(Math.round(t*e._duration))},onEndDragging:function(t){e._impl.seek(t)}});var i=geByClass1("audio-msg-track--wave-wrapper",this._el),o=geByClass1("audio-msg-track__transcriptionButton",this._audioEl),a=geByClass1("audio-msg-track__after",this._audioEl);a&&o&&(i.appendChild(o.cloneNode(!0)),this._el.appendChild(a.cloneNode(!0)),this._el.setAttribute("data-transcription-expanded",this._audioEl.getAttribute("data-transcription-expanded")));var r=geByClass1("audio-msg-track--wave-wrapper",this._audioEl).children[0];geByClass1("slider_slide",this._el).appendChild(r.cloneNode(!0)),geByClass1("slider_amount",this._el).appendChild(r.cloneNode(!0)),addEvent(this._playBtn,"click",this.onPlayPause),addEvent(this._durationEl,"click",this.onDurationClick),this._audioEl.parentNode.prepend(this._el),this._clearMediaSession()},t._clearMediaSession=function(){var e=this;_.HAS_MEDIA_SESSION&&(navigator.mediaSession.setActionHandler("play",(function(){return e.play()})),navigator.mediaSession.setActionHandler("pause",(function(){return e.pause()})),navigator.mediaSession.setActionHandler("seekbackward",null),navigator.mediaSession.setActionHandler("seekforward",null),navigator.mediaSession.setActionHandler("previoustrack",null),navigator.mediaSession.setActionHandler("nexttrack",null),navigator.mediaSession.metadata=new MediaMetadata({title:"",artist:"",album:"",artwork:[]}))},t._destroyInterface=function(){hide(this._el),this._audioEl.parentNode.contains(this._el)&&this._audioEl.parentNode.removeChild(this._el),removeEvent(this._playBtn,"click",this.onPlayPause),this._progressSlider&&(this._progressSlider.destroy(),this._progressSlider=null),this._playBtn=null,this._durationEl=null,this._el=null},t.attachTo=function(e){var t=this;if(this._audioEl!=e){null!=this._audioEl&&(this._reattach=!0),this.detach(),this._audioEl=e,addClass(this._audioEl,"audio-msg-track_player-attached"),this._duration=attr(e,"data-duration"),this._initInterface();var n=this._audioEl.id.split("_");if(n&&n.length>1&&(this._owner_id=n[1]),this._reattach=!1,!this._impl.loaded)return new Promise((function(n,o){t._impl.onReady((function(){t._impl.setUrl(attr(e,i?"data-ogg":"data-mp3"),{duration:t._duration,callback:n})}))}));this._impl.setUrl(attr(e,i?"data-ogg":"data-mp3"),{duration:this._duration})}return!0},t.detach=function(e){if(void 0===e&&(e=!1),this._audioEl&&this._el&&!this._detaching){if(e&&this.isAttached())return;this._detaching=!0,this.stop(),this._destroyInterface(),removeClass(this._audioEl,"audio-msg-track_player-attached"),this._audioEl._listened=!1,this._audioEl=null}this._detaching=!1},t.play=function(){this._audioEl&&(this._reattach||e.pauseGlobalMedia(),addClass(this._el,"audio-msg-track_playing"),window.getLang&&attr(this._playBtn,"aria-label",getLang("global_audio_pause")),this._playing=!0,this._createTimer(),this._owner_id&&(0,d.statlogsValueEvent)("audio_message_play",this._owner_id),this._impl.play())},t.pause=function(){this._audioEl&&(!this._reattach&&this._playing&&e.resumeGlobalMedia(),window.getLang&&attr(this._playBtn,"aria-label",getLang("global_audio_play")),removeClass(this._el,"audio-msg-track_playing"),this._playing=!1,this._impl.pause(),this._killTimer())},t.stop=function(){this.pause(),this._impl.stop()},t.toggle=function(){this._playing?this.pause():this.play()},t._createTimer=function(){var e=this;this._duration>0&&(this._killTimer(),this._timer=setInterval((function(){if(e._impl){var t=e._impl.getCurrentProgress();e._updateProgress(t)}}),100))},t._killTimer=function(){this._timer&&(clearInterval(this._timer),this._timer=null)},t._initEvents=function(){var e=this;window.ap?window.ap.on(this,[s.events.PLAY_REQUESTED,s.events.PLAY],(function(){delete window.ap.pausedByMsg,e.pause()})):window.audio&&window.audio.subscribe([s.events.PLAY_REQUESTED,s.events.PLAY],(function(){delete window.audio.pausedByMsg,e.pause()})),window.Notifier&&(window.Notifier.addRecvClbk("audio_start","audio_msg",(function(){e.pause()})),window.Notifier.addRecvClbk("video_start","audio_msg",(function(){e.pause()})))},t.isAttached=function(){if(this._audioEl){for(var e=this._audioEl;e.parentNode;)e=e.parentNode;return!!e.body}return!1},e.pauseGlobalMedia=function(){window.Notifier&&(f=!0,window.Notifier.lcSend("video_start")),window.ap&&window.ap.isPlaying()?(window.ap.pause(),window.ap.pausedByMsg=!0):window.audio&&window.audio.playing&&window.audio.playing()&&(window.audio.pause(),window.audio.pausedByMsg=!0)},e.resumeGlobalMedia=function(){window.Notifier&&f&&(f=!1,window.Notifier.lcSend("video_hide")),window.ap&&window.ap.pausedByMsg?(window.ap.play(),delete window.ap.pausedByMsg):window.audio&&window.audio.playing&&window.audio.pausedByMsg&&((0,l.wrapAudioPlay)(window.audio).catch((function(){})),delete window.audio.pausedByMsg)},(0,o.default)(e,[{key:"type",get:function(){return this._impl.type}},{key:"durationType",get:function(){return window.AudioPlayer?!!u.default.get(AudioPlayer.LS_PREFIX+AudioPlayer.LS_DURATION_TYPE):"1"==u.default.get("audio_time_left")},set:function(e){window.AudioPlayer?u.default.set(AudioPlayer.LS_PREFIX+AudioPlayer.LS_DURATION_TYPE,!!e):u.default.set("audio_time_left",e?"1":"0")}}]),e}()},66556:function(e,t,n){"use strict";n.d(t,{init:function(){return r}});var i=n(86900),o=n(20848),a="supportedFeatures";function r(){var e={is_schemes_supported:(0,o.isCSSVariablesSupported)(),is_auto_schemes_supported:(0,o.isAutoSchemesSupported)(),current_scheme:(0,o.isDarkTheme)()?2:(0,o.isLightTheme)()},t=Object.keys(e).sort().map((function(t){return t+":"+Number(e[t])})).join("/");if(localStorage&&localStorage.getItem){var n=localStorage.getItem(a);null!==n&&t===n||(localStorage.setItem(a,t),(0,i.statlogsValueEvent)("browser_features",t))}}},30675:function(e,t,n){"use strict";n.d(t,{Slider:function(){return a}});var i=n(41880),o=n(3369);void 0===window.isTouch&&(window.isTouch=!1);var a=function(){function e(e,t){if(!e)throw new Error("No element was provided for Slider");e=ge(e),this.options=t||{size:1},void 0===this.options.logfbase&&(this.options.logfbase=35),this.options.backValue=this.options.backValue||0;var n=100*this.options.backValue,i='<div class="slider_slide"><div class="slider_loading_bar" style="opacity: 0; display: none;"></div> '+(this.options.withBackLine?'<div class="slider_back" style="width:'+n+'%"></div>':"")+' <div class="slider_amount"></div> <div class="slider_handler"></div> </div>';this._el=ce("div",{innerHTML:i,className:"slider",id:e.getAttribute("id")||""});var a=this;if(e.classList)for(var r=e.classList,s=0,l=r.length;s<l;s++)addClass(this._el,r[s]);else this._el.className=e.className;each(this._el.attributes,(function(e,t){"id"==t.name&&"class"==t.name||a._el.setAttribute(t.name,t.value)})),e.parentNode.replaceChild(this._el,e),this._amountEl=geByClass1("slider_amount",this._el),this._handlerEl=geByClass1("slider_handler",this._el),this._slideEl=geByClass1("slider_slide",this._el),this._backEl=geByClass1("slider_back",this._el),this._progressEl=geByClass1("slider_loading_bar",this._el),this.options.color&&(setStyle(this._amountEl,{backgroundColor:this.options.color}),setStyle(this._handlerEl,{backgroundColor:this.options.color})),this.options.backColor&&setStyle(this._slideEl,{backgroundColor:this.options.backColor}),addClass(this._el,"slider_size_"+this.options.size),this.options.debounce&&(this._onValueChangeDebounced=(0,o.debounce)(this._onValueChange,this.options.debounce)),!isTouch&&t.formatHint&&(addEvent(this._el,"mousemove",this._ev_onMouseOver=this._onMouseOver.bind(this)),addEvent(this._el,"mouseleave",this._ev_onMouseLeave=this._onMouseLeave.bind(this))),addEvent(this._el,isTouch?"touchstart":"mousedown",this._ev_onMouseDown=this._onMouseDown.bind(this)),addEvent(this._el,"click",cancelEvent),this.setValue(this.options.value||0,!this.options.fireChangeEventOnInit,!1),this.setBackValue(this.options.backValue)}var t=e.prototype;return t.toggleLoading=function(e){e=!!e,toggle(this._progressEl,e),setStyle(this._progressEl,"opacity",e?1:0)},t.destroy=function(){!isTouch&&this.options.formatHint&&(removeEvent(this._el,"mousemove",this._ev_onMouseOver),removeEvent(this._el,"mouseleave",this._ev_onMouseLeave),removeEvent(this._el,"mousedown",this._ev_onMouseDown));var e=window.re||window.remove;e(this._el),e(this._currHintEl)},t._updateHint=function(e,t){this._currHintEl||(this._currHintEl=ce("div",{className:"slider_hint",id:"slider_hint"}),this.options.hintClass&&addClass(this._currHintEl,this.options.hintClass),this._el.appendChild(this._currHintEl));var n=this._getPos(),i=Math.round((e.pageX||e.touches[0].pageX)-n[0]),o=this._width;if((i=t?Math.min(Math.max(0,i),o):i)>=0&&i<=o){var a=i/o;this._currHintEl.innerHTML=this.options.formatHint?this.options.formatHint.call(this,a):a;var r=this._currHintEl.getBoundingClientRect();setStyle(this._currHintEl,{left:this._slideEl.offsetLeft+i-(r.right-r.left)/2,top:this._slideEl.offsetTop-(r.bottom-r.top)-10}),!t&&this._toggleHint(!0)}else!t&&this._toggleHint(!1);this.options.formatHint||this._toggleHint(!1)},t._toggleHint=function(e){toggleClass(this._currHintEl,"visible",e)},t._onMouseOver=function(t){e._currenSliderDrag||hasClass(this._el,"active")||this._updateHint(t)},t._onMouseLeave=function(e){hasClass(this._el,"active")||this._toggleHint(!1)},t._onMouseDown=function(t){(0==t.button||t.touches)&&(delete cur._sliderMouseUpNowEl,addEvent(window,isTouch?"touchmove":"mousemove",this._ev_onMouseMove=this._onMouseMove.bind(this)),addEvent(window,isTouch?"touchend touchcancel":"mouseup",this._ev_onMouseUp=this._onMouseUp.bind(this)),this._onMouseMove(t),e._currenSliderDrag=this,addClass(this._el,"active"),cancelEvent(t))},t._onMouseUp=function(t){cur._sliderMouseUpNowEl=this._el,removeEvent(window,isTouch?"touchmove":"mousemove",this._ev_onMouseMove),removeEvent(window,isTouch?"touchend touchcancel":"mouseup",this._ev_onMouseUp),this._onValueChange(),removeClass(this._el,"active"),e._currenSliderDrag=!1,this._toggleHint(!1),this.options.onEndDragging&&this.options.onEndDragging(this._currValue),cancelEvent(t)},t._onMouseMove=function(e){var t=this._getPos(),n=t[0];n=void 0!==e.touches&&e.touches.length>0?e.touches[0].pageX:e.pageX,n=Math.max(n,t[0]),n=Math.min(n,t[0]+this._width),n-=t[0],this.setValue(n/this._width,!0,!0),this._onValueChangeDebounced?this._onValueChangeDebounced():this._onValueChange(),this._toggleHint(!0),this._updateHint(e,!0),cancelEvent(e)},t._getPos=function(){return this._slidePos=getXY(this._slideEl)},t._logf=function(e){if(!this.options.log)return e;var t=this.options.logfbase;return(Math.pow(t,e)-1)/(t-1)},t._unlogf=function(e){if(!this.options.log)return e;var t,n,i=this.options.logfbase;return t=i,n=1+e*(i-1),Math.log(n)/Math.log(t)},t.setValue=function(e,t,n){if(!hasClass(this._el,"active")||n){var i=n?this._logf(e):e;if(this._currValue!=i){this._currValue=i;var o=n?e:this._unlogf(e);o=100*o+"%",setStyle(this._amountEl,{width:o}),setStyle(this._handlerEl,{left:o}),!t&&this._onValueChange()}}},t.setBackValue=function(e){toggleClass(this._backEl,"slider_back_transition",e>this._backValue),this._backValue=e;var t=100*e+"%";setStyle(this._backEl,{width:t})},t._onValueChange=function(){this._lastValue=this._lastValue||0,this._lastValue!=this._currValue&&(this._lastValue=this._currValue,this.options.onChange&&this.options.onChange(this._currValue))},(0,i.default)(e,[{key:"_width",get:function(){if(!this._widthCache){var e=this._el.getBoundingClientRect();this._widthCache=e.right-e.left}return this._widthCache}}]),e}()},13172:function(e,t,n){"use strict";n.d(t,{ONLINE_SEEN_RECENTLY:function(){return i},ONLINE_SEEN_LAST_WEEK:function(){return o},ONLINE_SEEN_LAST_MONTH:function(){return a},ONLINE_SEEN_LONG_AGO:function(){return r}});var i="recently",o="last_week",a="last_month",r="long_ago"},13482:function(e,t,n){"use strict";n.d(t,{gemiusTrackPage:function(){return o}});var i=n(86353);function o(){if((0,i.partConfigEnabled)("geminus_counter")){var e="pzBAVLtpzyiyDVIwmwjmX5a2zSVdA6eUI7mpf0ufDFf.57";if(window.pp_gemius_identifier)window.pp_gemius_hit(e);else{window.pp_gemius_identifier=e;var t=function(e){window[e]=window[e]||function(){var t=window[e+"_pdata"]=window[e+"_pdata"]||[];t[t.length]=arguments}};t("gemius_hit"),t("gemius_event"),t("pp_gemius_hit"),t("pp_gemius_event"),function(e,t){try{var n=e.createElement(t),i=e.getElementsByTagName(t)[0],o="http"+("https:"==location.protocol?"s":""),a="vkgalv";if(window.vk&&window.vk.countryISO)switch(window.vk.countryISO){case"BY":a="vkgaby";break;case"MD":a="vkgamd";break;case"EE":a="vkgaee"}n.setAttribute("async","async"),n.setAttribute("defer","defer"),n.src=o+"://"+a+".hit.gemius.pl/xgemius.js",i.parentNode.insertBefore(n,i)}catch(e){}}(document,"script")}}}},41001:function(e,t,n){"use strict";n.d(t,{mediascopeTrackPage:function(){return r}});var i=n(17999),o=n(86900),a=n(86353);function r(e,t){var n=location.protocol,r=window._tns&&(window._tns.tnsPixelSocdem||"83"),s=t.replace(/\*/g,"%2a").split("#")[0],l=window._tns&&window._tns.tnsPixelType;if((0,i.vkImage)().src=n+"//www.tns-counter.ru/V13a**clid:"+r+"*"+s+"*vk_com/ru/UTF-8/tmsec=vksite_total/"+Math.round(1e9*Math.random()),(0,a.partConfigEnabled)("tns_track_sections")){var c="content",u="photo",d="music",_="video",f="clips",p="ecomm",m="games",h="docs",v=[[/^https?:\/\/(?:(?:www|m)\.)?(?:\w+\.)*vk.com\b.*?\bw=story-?\d+_\d+/,c,"story"],[/^https?:\/\/(?:(?:www|m)\.)?(?:\w+\.)*vk.com\b.*?\bz=video-?\d+_\d+/,_,"videoview"],[/^https?:\/\/(?:(?:www|m)\.)?(?:\w+\.)*vk.com\b.*?\bz=(photo(_tag)?-?\d+_\d+|albums?-?\d+)/,u,"photoview"],[/^https?:\/\/(?:(?:www|m)\.)?(?:\w+\.)*vk.com\b.*?\bz=audio_playlist-?\d+_\d+/,d,"playlistview"],[/^https?:\/\/(?:(?:www|m)\.)?(?:\w+\.)*vk.com\b.*?\bz=podcast-?\d+_\d+/,d,"podcastview"],[/^https?:\/\/(?:(?:www|m)\.)?(?:\w+\.)*vk.com\b.*?\bz=clip-?\d+_\d+/,f,"clipsview"],[/^https?:\/\/(?:(?:www|m)\.)?(?:\w+\.)*vk.com\b.*?\bw=app\d+/,m,"gamesappview"],[/^https?:\/\/(?:(?:www|m)\.)?(?:\w+\.)*vk.com\b.*?\bw=product-?\d+_\d+/,p,"product"],[/^https?:\/\/(?:(?:www|m)\.)?(?:\w+\.)*vk.com\/feed\?section=likes(\/|\&|$)/,c,"likes"],[/^https?:\/\/(?:(?:www|m)\.)?(?:\w+\.)*vk.com\/feed(\/|\?|$)/,c,"feed"],[/^https?:\/\/(?:(?:www|m)\.)?(?:\w+\.)*vk.com\/friends(\/|\?|$)/,c,"friends"],[/^https?:\/\/(?:(?:www|m)\.)?(?:\w+\.)*vk.com\/groups(\/|\?|$)/,c,"groups"],[/^https?:\/\/(?:(?:www|m)\.)?(?:\w+\.)*vk.com\/(id|public|club)\d+(\/|\?|$)/,c,"idpublicclub"],[/^https?:\/\/(?:(?:www|m)\.)?(?:\w+\.)*vk.com\/@[\w-\.]+(\/|\?|$)/,c,"longread"],[/^https?:\/\/(?:(?:www|m)\.)?(?:\w+\.)*vk.com\/bookmarks(\/|\?|$)/,c,"bookmarks"],[/^https?:\/\/(?:(?:www|m)\.)?(?:\w+\.)*vk.com\/stickers(\/|\?|$)/,c,"stickers"],[/^https?:\/\/(?:(?:www|m)\.)?(?:\w+\.)*vk.com\/im(\/|\?|$)/,"messenger","messenger"],[/^https?:\/\/(?:(?:www|m)\.)?(?:\w+\.)*vk.com\/(photos|tag\d+|(albums|photos)-?\d+|(album|photo)-?\d+_\d+)(\/|\?|$)/,u,"photo"],[/^https?:\/\/(?:(?:www|m)\.)?(?:\w+\.)*vk.com\/(audio(s-?\d+)?|music)(\/|\?|$)/,d,"music"],[/^https?:\/\/(?:(?:www|m)\.)?(?:\w+\.)*vk.com\/podcasts(-?\d+)(\/|\?|$)/,"podcasts","podcasts"],[/^https?:\/\/(?:(?:www|m)\.)?(?:\w+\.)*vk.com\/(videos-?\d+|video(-?\d+_\d+)?)(\/|\?|$)/,_,"video"],[/^https?:\/\/(?:(?:www|m)\.)?(?:\w+\.)*vk.com\/(clips(-?\d+)?|clip-?\d+_\d+)(\/|\?|$)/,f,"clips"],[/^https?:\/\/(?:(?:www|m)\.)?(?:\w+\.)*vk.com\/services(\/|\?|$)/,"services","services"],[/^https?:\/\/(?:(?:www|m)\.)?(?:\w+\.)*vk.com\/taxi(\/|\?|$)/,"taxi","taxi"],[/^https?:\/\/(?:(?:www|m)\.)?(?:\w+\.)*vk.com\/eda(\/|\?|$)/,"eda","eda"],[/^https?:\/\/(?:(?:www|m)\.)?(?:\w+\.)*vk.com\/worki(\/|\?|$)/,"worki","worki"],[/^https?:\/\/(?:(?:www|m)\.)?(?:\w+\.)*vk.com\/market(-?\d+)?(\/|\?|$)/,p,"ecomm"],[/^https?:\/\/(?:(?:www|m)\.)?(?:\w+\.)*vk.com\/apps(\/|\?|$)/,m,"gamesapp"],[/^https?:\/\/(?:(?:www|m)\.)?(?:\w+\.)*vk.com\/app\d+(_-?\d+)(\/|\?|$)/,m,"gamesapppage"],[/^https?:\/\/(?:(?:www|m)\.)?(?:\w+\.)*vk.com\/docs(\/|\?|$)/,h,"docs"],[/^https?:\/\/(?:(?:www|m)\.)?(?:\w+\.)*vk.com\/doc-?\d+_\d+(\/|\?|$)/,h,"docdoc"]],g=window.cur&&window.cur.module||"other",A="other",y="other";v.some((function(t){if(t[0].test(e))return A=t[1],y=t[2],!0})),(0,o.statlogsValueEvent)("counters_check_tns",A,y,g)}"unauth"===l?(0,i.vkImage)().src=n+"//www.tns-counter.ru/V13a****vk_ad/ru/UTF-8/tmsec=vkad_cid1015708-posid1184674/"+Math.round(1e9*Math.random()):"has_rough"===l?(0,i.vkImage)().src=n+"//www.tns-counter.ru/V13a****vk_ad/ru/UTF-8/tmsec=vkad_cid1015708-posid1184675/"+Math.round(1e9*Math.random()):"not_has_rough"===l&&((0,i.vkImage)().src=n+"//www.tns-counter.ru/V13a****vk_ad/ru/UTF-8/tmsec=vkad_cid1015708-posid1184677/"+Math.round(1e9*Math.random())),(0,a.partConfigEnabled)("tns_track_hosts")&&((0,i.vkImage)().src="https://"+function(){if(window.cur&&window.cur.module&&(0,i.isString)(window.cur.module)){var e=window.cur.module.trim().toLowerCase().replace(/[^a-z0-9_-]/g,"");if(e)return e}return"unknown"}()+".tns.vk-portal.net?v="+Math.round(1e9*Math.random()))}},6362:function(e,t,n){"use strict";n.d(t,{tmrTrackPage:function(){return f},tmrTrackRegistration:function(){return p},tmrTrackCustomGoal:function(){return m},tmrTrackMiniAppOpen:function(){return S},tmrTrackMiniAppClose:function(){return b},tmrTrackMiniAppLogin:function(){return k},tmrTrackMiniAppRegistration:function(){return C},tmrTrackMiniAppCustom:function(){return E}});var i=n(46769),o=n(27813),a=n(86353),r=n(86900),s="2579437",l="remixtmr_login",c="miniAppEvent",u=["mt_registration","mt_login"];function d(){return window.vk&&window.vk.id?window.vk.id:0}function _(e){if(!(window.vk&&window.vk.zero||window.__dev)){if(e&&e.goal&&u.includes(e.goal)){if((0,a.partConfigEnabled)("mt_log_disable"))return;(0,r.statlogsValueEvent)("counters_check_tmr",e.goal)}window._tmr=window._tmr||[],window._tmr.push(e)}}function f(e,t){_({id:s,url:e,referrer:t,type:"pageView",start:(new Date).getTime(),pid:d(),userid:d()}),(0,o.getCookie)(l)&&((0,o.setCookie)(l,"",-1),_({id:s,type:"reachGoal",goal:"mt_login",userid:d()}))}function p(){_({id:s,type:"reachGoal",goal:"mt_registration",userid:d()})}function m(e,t){void 0===t&&(t={}),_({id:s,type:"reachGoal",goal:e,userid:d(),params:t})}function h(e){var t=d();d&&_({id:s,type:c,params:(0,i.default)({},e,{platformUserId:String(t)})})}var v="open",g="close",A="login",y="registration",w="custom";function S(e,t){h({eventType:v,miniAppId:e,queryParams:t})}function b(e){h({eventType:g,miniAppId:e})}function k(e,t){h({eventType:A,miniAppId:e,customUserId:t})}function C(e,t){h({eventType:y,miniAppId:e,customUserId:t})}function E(e,t){h((0,i.default)({eventType:w,miniAppId:e},t))}},1659:function(e,t,n){"use strict";n.d(t,{updateCounters:function(){return s}});var i=n(13482),o=n(41001),a=n(6362),r=n(86900);function s(e,t){if(!(window.__dev||window.vk&&(window.vk.zero||window.vk.__dev))){t=t||document.referrer||"";[[/(hash|dl)=\w+/g,"$1="],[/(\/(?:write|mail|im|al_im.php))(?:\?[a-z0-9&=_-]*)?$/,"$1"],[/(\/write)\d*(?:\?[a-zA-Z0-9&=_-]*)?$/,"$1"]].forEach((function(n){var i=n[0],o=n[1];e=e.replace(i,o),t=t.replace(i,o)})),(0,a.tmrTrackPage)(e,t);var n=[/\/login\?.*$/];n.some((function(t){return t.test(e)}))||n.some((function(e){return e.test(t)}))||((0,o.mediascopeTrackPage)(e,t),(0,i.gemiusTrackPage)(),(0,r.statlogsValueEvent)("counters_check",1))}}},2955:function(e,t,n){"use strict";function i(e,t){var n=decodeURIComponent(e);return/^\/[^/]/.test(n)||/^(https?:\/\/)?([a-z0-9_\-.]+\.)?vk.com(\/.*)?/.test(n)?e:"/away.php?to="+encodeURIComponent(n)+(t?"&utf=1":"")}n.d(t,{wrapAwayIfExternal:function(){return i}})},70765:function(e,t,n){"use strict";n.d(t,{getLastSeenByStatus:function(){return o}});var i=n(13172);function o(e,t){var n;switch(e){case i.ONLINE_SEEN_RECENTLY:n=getLang("global_online_was_recently","raw");break;case i.ONLINE_SEEN_LAST_WEEK:n=getLang("global_online_was_week","raw");break;case i.ONLINE_SEEN_LAST_MONTH:n=getLang("global_online_this_month","raw");break;case i.ONLINE_SEEN_LONG_AGO:n=getLang("global_online_long_ago","raw");break;default:return""}return langSex(t,n)}},29442:function(e,t,n){"use strict";n.d(t,{random:function(){return i}});function i(){try{if(window.crypto){var e=new Int32Array(1);return crypto.getRandomValues(e),Math.abs(e.reduce((function(e,t){return e+t})))}}catch(e){}return intval(rand(0,2147483647).toFixed(0))}},81691:function(e,t,n){"use strict";var i=n(24961),o={URL:"special-event",ACT:"getPopup",start:function(e,t){var n=this;if(t.stopPropagation(),t.preventDefault(),this.id=window.domData(e,"id"),this.id&&(this.sendStats("click"),!this.timeoutHandle)){var i=Number(window.domData(e,"v"))||0;this.duration||(this.duration=Number(window.domData(e,"duration"))||0),this.animationUrl||(this.animationUrl=String(atob(window.domData(e,"animation-url")))||0),this.hasPopup=Boolean(window.domData(e,"popup")),this.duration&&this.animationUrl?!this.animationData||!this.animationData.v||"number"==typeof this.v&&this.v!==i?(this.v=i,Promise.all([this._getAnimation(),this._loadAnimator()]).then((function(e){var t=e[0],i=e[1];n.animationData=JSON.parse(t),n.animator=i,n._play()}))):this._play():this.hasPopup&&this._loadPopupData((function(){return n._showPopup()}))}},_getAnimation:function(){var e=this;return new Promise((function(t){var n=new XMLHttpRequest;n.open("GET",e.animationUrl,!0),n.send(),n.onreadystatechange=function(){4===n.readyState&&t(n.responseText)}}))},_showPopup:function(){window.ImageStatus&&window.ImageStatus.open&&window.ImageStatus.open({user_id:vk.id,special_id:this.id})},_loadPopupData:function(e){},_play:function(){var e=this;if(this.animator){this.frame||(this.frame=document.createElement("div"),this.frame.className="special_event_frame",document.body.appendChild(this.frame)),this.frame.style.display="block";var t=this.animator.loadAnimation({container:this.frame,renderer:"svg",loop:!1,autoplay:!0,animationData:this.animationData});this._loadPopupData(),this.timeoutHandle=setTimeout((function(){t.stop(),t.destroy(),e.frame.style.display="none",e.timeoutHandle=null,e.sendStats("showed"),e._showPopup()}),this.duration)}},init:function(e){var t=e.platform,n=e.animatorLoader;this.platform=t,this._loadAnimator=n},popupAction:function(){this.sendStats("popup_action");var e=curBox();e&&setTimeout((function(){e.hide()}),0)},sendStats:function(e){e&&(0,i.saveStatlogEvents)({name:"special_event",value:e,keys:[this.platform,this.id]})}};t.default=o},43369:function(e,t,n){"use strict";function i(e,t){var n,i,o=!1;return function a(){if(o)return n=arguments,void(i=this);e.apply(this,arguments),o=!0,setTimeout((function(){o=!1,n&&(a.apply(i,n),n=i=null)}),t)}}n.d(t,{throttle:function(){return i}})},93263:function(e,t,n){"use strict";n.d(t,{HAS_MEDIA_SESSION:function(){return i}});n(88241);var i=window&&window.navigator&&"mediaSession"in window.navigator&&"MediaMetadata"in window},24480:function(e,t,n){"use strict";n.d(t,{AverageAlgorithm:function(){return i}});var i=function(){function e(){this.clear()}var t=e.prototype;return t.push=function(e){this._count++,this._accum+=e},t.get=function(){return this._accum/this._count},t.clear=function(){this._count=0,this._accum=0},e}()},330:function(e,t,n){"use strict";n.d(t,{PeakAlgorithm:function(){return i}});var i=function(){function e(){this.clear()}var t=e.prototype;return t.push=function(e){this._max=Math.max(this._max,Math.abs(e))},t.get=function(){return this._max},t.clear=function(){this._max=0},e}()},7207:function(e,t,n){"use strict";n.d(t,{QuadAlgorithm:function(){return i}});var i=function(){function e(){this.clear()}var t=e.prototype;return t.push=function(e){this._count++,this._accum+=e,this._accum_q+=e*e},t.get=function(){return 1==this._count?this._accum:Math.sqrt((this._accum_q-this._accum*this._accum/this._count)/this._count)},t.clear=function(){this._count=0,this._accum=0,this._accum_q=0},e}()},91461:function(e,t,n){"use strict";n.d(t,{Resampler:function(){return s},fastResample:function(){return l}});var i=n(24480),o=n(330),a=n(7207),r={avg:i.AverageAlgorithm,peak:o.PeakAlgorithm,quad:a.QuadAlgorithm},s=function(){function e(e){this._normalizeAlgorithm=!1,r[e.normalizeAlgorithm]&&(this._normalizeAlgorithm=new r[e.normalizeAlgorithm]),this._srcSampleRate=parseInt(e.srcSampleRate||0),this._dstSampleRate=parseInt(e.dstSampleRate||0),this._truncateTo=1,void 0!==e.truncateTo&&(this._truncateTo=e.truncateTo),this._dstSampleRate>0?this._sampleRate=this._srcSampleRate/this._dstSampleRate:this._sampleRate=0,r[e.algorithm]||(e.algorithm="peak"),this._algorithm=new r[e.algorithm],this._sampleCount=0,this._data=[]}return e.prototype.push=function(e){if(this._sampleRate<=0)return[];for(var t,n=[],i=0;i<e.length;i++)if(this._truncateTo>0&&(e[i]=Math.min(this._truncateTo,Math.abs(e[i]))),this._sampleCount+=1,this._sampleCount>=this._sampleRate)for(;this._sampleCount>=this._sampleRate;)this._sampleCount-=this._sampleRate,this._sampleCount<=.8&&this._algorithm.push(e[i]),t=this._algorithm.get(),n.push(t),this._normalizeAlgorithm&&this._normalizeAlgorithm.push(t),this._algorithm.clear(),this._sampleCount>.2&&this._algorithm.push(e[i]);else this._algorithm.push(e[i]);if(this._normalizeAlgorithm){var o=this._normalizeAlgorithm.get();if(this._normalizeAlgorithm.clear(),o>0)for(var a=0;a<n.length;a++)n[a]=n[a]/o,this._truncateTo>0&&(n[a]=Math.min(this._truncateTo,Math.abs(n[a])))}return n},e}();function l(e,t,n){return void 0===n&&(n="peak"),new s({srcSampleRate:e.length,dstSampleRate:t,normalizeAlgorithm:n,truncateTo:0}).push(e)}},18431:function(e,t,n){"use strict";n.d(t,{cutTextToHighlight:function(){return a}});var i="cutTextToHighlight",o=15;function a(e){var t=null;document.querySelectorAll(e+":not(."+"cutTextToHighlight)").forEach((function(e){if(e.classList.add(i),null===t){var n=getComputedStyle(e).font;t=function(e){var t=document.createElement("canvas").getContext("2d");function n(e){var n=t.measureText(e).width;return Math.ceil(n)}return t.font=e,n}(n)}e.innerHTML=function(e,t,n){void 0===n&&(n="…");var i=e.querySelector(".highlight");if(!i)return e.innerHTML;var a=e.innerHTML.indexOf('<em class="highlight">');if(i.offsetLeft+i.offsetWidth<=e.offsetWidth-o)return e.innerHTML;if(i.offsetWidth<e.offsetWidth-o){for(var r=0,s="",l=a;l>0&&r+i.offsetWidth<=e.offsetWidth;){var c=e.innerHTML.lastIndexOf(" ",l-1);if(-1===c&&(c=0),!((r=t(n+(s=e.innerHTML.substring(c,l)+s).trim()))+i.offsetWidth<=e.offsetWidth-o))break;l=c}a=l}if(a>0)return n+e.innerHTML.substring(a).trim();return e.innerHTML}(e,t)}))}},33764:function(e,t,n){"use strict";n.d(t,{Stickers:function(){return r}});var i=n(29804),o={},a=function(e,t,n,i){delete o[t],1===i?Emoji.favorite.addFavoriteSticker(e,t,n):-1===i&&Emoji.favorite.deleteFavoriteSticker(e,t,n)};var r={toggleFavorite:function(e,t,n){if(t&&t.stopPropagation(),!hasClass(e,"on")&&Emoji.stickers[Emoji.TAB_FAVORITE_STICKERS].stickers.length>=Emoji.favoriteLimit&&!Emoji.favoriteLimitNoticed){var i=langStr(getLang("purchases_stickers_favorite_limit_notice"),"%s",Emoji.favoriteLimit);return setTimeout(window.showFastBox(getLang("global_error"),i).hide,3e3),ajax.post("stickers.php",{act:"favorite_limit_noticed",value:1}),Emoji.favoriteLimitNoticed=!0,!1}var r=attr(e,"data-sticker-id"),s=attr(e,"data-hash");return!(!r||!s)&&(!o[r]&&(o[r]=1,toggleClass(e,"on"),void ajax.post("/stickers.php",{act:"toggle_favorite",sticker_id:r,hash:s},{onDone:a.pbind(n,r,e)})))},getStickerUrl:function(e,t){var n={id:e,size:t};if(window.isMVK){var o=String(t);return i.colorScheme.isDarkScheme()&&(o=o.replace(/b$/,"")+"b"),window.store.stickers&&rs(window.store.stickers.url_template,{id:e,size:o})}return getTemplate("stickers_sticker_url",n)}}},57865:function(e,t,n){"use strict";n.d(t,{StickersAnimation:function(){return i}});var i=function(){var e,t,n,o=!1,a=!1,r={},s={},l={},c={};function u(e){var t=f(e),n=1;if(t){hasClass(e,"animation_play")||(hide(geByClass1("sticker_img",e)),addClass(e,"animation_play")),t.play();var i=attr(e,"data-loop-count");i=parseInt(i),isNaN(i)&&(i=3),-1!==i&&(!t._cbs.loopComplete||t._cbs.loopComplete&&0===t._cbs.loopComplete.length)&&t.addEventListener("loopComplete",(function o(a){n++;var r=!0;i>=n&&(r=!1),r&&(_(e,!1),""!==t._cbs.loopComplete&&t.removeEventListener("loopComplete",o),t.stop())}))}}function d(e){var t=attr(e,"data-uid");return t||(t=attr(e,"data-uid",Math.random().toString(32).substr(2))),t}function _(e,t){c[d(e)]=t}function f(e){var t=attr(e,"data-uniq-id");if(!geByClass1("svg_sticker_animation",e))return!1;var n=s[t];return n||!1}function p(e,t){var i=f(e);if(i)"function"==typeof t&&t(i);else{var o=attr(e,"data-uniq-id");if(!c[d(e)]){_(e,!0);var a=attr(e,"data-animation-path"),l=attr(e,"data-sticker-id"),u=!1;if(l&&(u=(r[l]||a)&&h(e)),u){var p=attr(e,"data-animation-class")||"",m={container:e,renderer:"svg",loop:!0,autoplay:!1,name:o,rendererSettings:{scaleMode:"noScale",progressiveLoad:!0,hideOnTransparent:!0,className:"svg_sticker_animation "+p}};r[l]?m.animationData=r[l]:m.path=a;var v=geByClass1("svg_sticker_animation",e);if(v&&re(v),i=n.loadAnimation(m),!r[l])return void i.addEventListener("data_ready",(function(){r[l]=i.animationData,s[o]=i,"function"==typeof t&&t(i)}))}"function"==typeof t&&(s[o]=i,"function"==typeof t&&t(i))}}}function m(){return t().then((function(e){return n=e,e}))}return{init:function(e){t=e.animatorLoader},checkSettingsAndLoadInWeb:function(e){if(StickersSettings.getAutoplay()){var t=ge("fc_msg"+e),n=geByClass1("sticker_animation",t);i.loadAndPlaySticker(n)}},checkSettingsAndLoad:function(e){if(StickersSettings.getAutoplay()){var t=$(".msg_id_"+e+" .sticker_animation");i.loadAndPlaySticker(t)}},loadStickerInMvkIMAndPlay:function(e,t){var n="_msg"+e;t&&(n="msg_id_"+e);var o=geByClass1("sticker_animation",geByClass1(n));i.loadAndPlayStickerWithTimer(o,500)},loadAutoplayAnimationStickers:function(e){if(n){if(e){if(a)return;a=!0}if(!o){o=!0;var t=geByClass("sticker_animation_autoplay");t&&each(t,(function(e,t){p(t,(function(){u(t)}))})),o=!1}}else m().then((function(){i.loadAutoplayAnimationStickers(e)}))},loadAndPlaySticker:function(e){e&&(n?requestAnimationFrame((function(){p(e,(function(){u(e)}))})):m().then((function(){i.loadAndPlaySticker(e)})))},loadAndPlayStickerWithTimer:function(e,t){if(e&&!l[e]){t||(t=1e3);var n=ge(e);hasClass(n,"sticker_animation_disabled_timer")||(l[e]=setTimeout((function(){!n&&(n=ge(e),hasClass(n,"sticker_animation_disabled_timer"))||(i.loadAndPlaySticker(n),clearTimeout(l[e]),l[e]=!1)}),t))}},reloadStickers:function(){s={}},touchStartSticker:function(t){t.addEventListener("contextmenu",i.preventContextMenu,!1),e=setTimeout((function(){i.loadAndPlaySticker(t)}),500)},touchEndSticker:function(){e&&clearTimeout(e)},preventContextMenu:function(e){e.preventDefault(),e.stopPropagation()}};function h(e){var t=e.getBoundingClientRect().top,n=e.getBoundingClientRect().bottom;return t<window.innerHeight&&n>=0&&isVisible(e)}}()},57551:function(e,t,n){"use strict";n.d(t,{StickersSettings:function(){return i}});var i={autoplay:0,setAutoplay:function(e){this.autoplay=e},getAutoplay:function(){return i.autoplay&&!i.isPreventAutoplayByCalls()},isPreventAutoplayByCalls:function(){return window.Calls&&window.Calls.isInActiveCall}}},27557:function(e,t,n){"use strict";var i=n(86353),o=n(76653),a=n(33912),r=n(17999),s=Object.entries(a.EMOJI_HINTS).map((function(e){var t=e[0],n=e[1],i=(n[0],n[1]);return[new RegExp("(\\s|^)("+(0,r.escapeRE)(i)+(i.endsWith(")")||i.endsWith("(")?"+":"")+")([\\s\\.,]|$)","gi"),t]})),l={q:"й",w:"ц",e:"у",r:"к",t:"е",y:"н",u:"г",i:"ш",o:"щ",p:"з","[":"х","]":"ъ",a:"ф",s:"ы",d:"в",f:"а",g:"п",h:"р",j:"о",k:"л",l:"д",";":"ж","'":"э",z:"я",x:"ч",c:"с",v:"м",b:"и",n:"т",m:"ь",",":"б",".":"ю","/":"."};browser.mac?l["\\"]="ё":l["`"]="ё";var c=new RegExp("["+(0,r.escapeRE)(Object.keys(l).join(""))+"]","gi"),u=function(e){return e.replace(c,(function(e){return l[e]}))},d=Object.entries(l).reduce((function(e,t){var n=t[0];return e[t[1]]=n,e})),_=new RegExp("["+(0,r.escapeRE)(Object.keys(d).join(""))+"]","gi"),f=function(e){return e.replace(_,(function(e){return d[e]}))},p=-184940019,m=function(){function e(e){this.config={mvk:!1,peerId:null,maxInputLength:256},this.setConfig(e)}var t=e.prototype;return t.setConfig=function(e){Object.assign(this.config,e)},t.getQueries=function(e){if(!e||e.length>this.config.maxInputLength)return[""];var t=window.Wall&&window.Wall.replyNamesRE||window.post&&window.post.replyNamesRE;if(t){var n=t();n&&(e=e.replace(n,""))}e=e.toLowerCase(),e=(e=s.reduce((function(e,t){var n=t[0],i=t[1];return e.replace(n,(function(e,t,n,a){return(t||"")+(0,o.emojiByteHexToSymbol)(i)+(a||"")}))}),e)).replace(/^[\s\uFEFF\xA0]+|\n+$/g,"");for(var i=[e=(0,o.emojiRemoveSkinToneModifiers)(e)],a=0,r=[].concat(i);a<r.length;a++){var l=r[a];i.push(u(l)),i.push(f(l))}for(var c=0,d=[].concat(i);c<d.length;c++){var _=d[c];i.push(_.replace(/ё/g,"е")),i.push(_.replace(/е/g,"ё"))}for(var p=0,m=[].concat(i);p<m.length;p++){var h=m[p];i.push(h.replace(/[.!?]+$/,""))}return Object.keys(i.reduce((function(e,t){return e[t]=1,e}),{}))},t.isBotLinkEnabled=function(){return(0,i.partConfigEnabled)("stickers_bot_link")&&this.config.peerId!==p},t.getBotLinkUrl=function(){return this.config.mvk?"/mail?act=show&peer="+p:"/im?sel="+p},t.getBotLinkImageUrl=function(e,t){return void 0===t&&(t="light"),"/images/stickers_suggestions_bot_"+t+"_"+e+".png"},t.getBotLinkClickStatName=function(){return"stickers_suggestions_bot_link"},t.getBotLinkClickStatKeys=function(){return[]},t.isMoneyTransferEnabled=function(){return(0,i.partConfigEnabled)("stickers_money_transfer_suggestions")&&(this.isMoneySendEnabled()||this.isMoneyRequestEnabled())},t.isMoneySendEnabled=function(){return Boolean(this.config.moneyTransfer&&this.config.moneyTransfer.send)},t.isMoneyRequestEnabled=function(){return Boolean(this.config.moneyTransfer&&this.config.moneyTransfer.request)},e}();t.default=m},34256:function(e,t,n){"use strict";function i(){var e=navigator.connection;if(!e)return"";var t=e.effectiveType,n=e.downlink;switch(t){case"slow-2g":return"GPRS";case"2g":return"EDGE";case"3g":return"3G";case"4g":return n>8?"wi-fi":"LTE"}return""}n.d(t,{getConnectionType:function(){return i},saveNavigationStatEvent:function(){return a},serializeNavigationStats:function(){return r},saveViewerStartTime:function(){return l},serializeLoadingStats:function(){return c}});var o=[];function a(e){var t=e.storyRawId,n=e.source,i=e.action,a=0,r=0;if(t){var s=t.split("_");a=s[0],r=s[1]}"reply"===n&&(n="replies_list");var l={ownerId:a,storyId:r,source:n,action:i};o.push(l)}function r(){var e=o.map((function(e){return[e.ownerId,e.storyId,e.source,e.action].join(",")})).join(";");return o=[],e}var s=[];function l(e){var t=e.storyRawId,n=e.source,i=e.time,o=t.split("_"),a={ownerId:o[0],storyId:o[1],source:n,time:i};s.push(a)}function c(){var e=s.map((function(e){return[e.ownerId,e.storyId,e.source,e.time].join(",")})).join(";");return s=[],e}},42893:function(e,t,n){"use strict";n.d(t,{AudioQueue:function(){return d}});var i=n(91512),o=n(61124),a=n(45150),r=n(12888),s=n(46950),l=n(11393),c=n(40975),u=0,d=function(){function e(){this.audioQueueListener=new r.MobileQueueListener(this.handleAudioQueueMessage),this.subscriptionQueueListener=new r.MobileQueueListener(this.handleSubscriptionQueueMessage)}return e.prototype.connect=function(e){var t=this;if(void 0===e&&(e=!1),i.QueueManager.initialized){var n=window.audio.getCurrent(),o=!e&&(this.audioQueueListener.listenQueueKey||this.subscriptionQueueListener.listenQueueKey);n&&!o&&window.ajax.post("/audio",{act:"queue_params",audio_id:n.id,owner_id:n.ownerId,hash:n.actionHash},{onDone:function(e){var n=(0,c.unpackQueues)(e);n.audio&&t.audioQueueListener.connect(n.audio),n.subscription&&t.subscriptionQueueListener.connect(n.subscription),e&&(t.listenQueueRefreshTO&&clearTimeout(t.listenQueueRefreshTO),t.listenQueueRefreshTO=window.setTimeout((function(){return t.connect(!0)}),3e4))},onFail:function(){return u<3&&(u++,setTimeout((function(){return t.connect()}),5e3)),!0}})}},e.prototype.handleAudioQueueMessage=function(t){for(var n=window.audio.playing(),i=0;i<t.events.length;i++){var o=t.events[i].data;if("start"===o.type&&window.audio.getDeviceId()!==o.uuid&&!e.startPlaybackBox&&n){window.audio.pause(),e.showMultipleStreamPopup(o);break}}},e.prototype.handleSubscriptionQueueMessage=function(e){e.events.length&&e.events.forEach((function(e){if(1===e.data.product_id){var t=window.audioAdsConfig||window.vk.audioAdsConfig;t&&(t.enabled=!e.data.active)}}))},e.showMultipleStreamPopup=function(t){var n=e.createPopup(t.device_name);o.default.open(n,!0,{oncloseCallback:function(){return e.startPlaybackBox=!1}}),document.querySelector(".AudioPopup__actionButton").addEventListener("click",(function(){o.default.close()})),e.startPlaybackBox=!0},e.createPopup=function(e){return l.default.elem((0,a.AudioPopup)({title:(0,s.getLang)("mobile_audio_start_playback_title"),description:(0,s.getLang)("mobile_audio_start_playback_body").replace("{device_name}",e),action_button:{text:(0,s.getLang)("mobile_audio_continue")}}))},e.startPlaybackBox=!1,e}()},51452:function(e,t,n){"use strict";n.d(t,{BannersController:function(){return l}});var i=n(97316),o=n(71838),a=n(90128),r=n(86658),s=function(e){var t=e.split(" "),n=(t=t.slice(0,t.length-1)).join(" ");return n&&(n+="..."),n},l=function(e){function t(t,n){var i=e.call(this,t,n)||this;return i.initLoop(),i.truncateTexts(),i.setBannersEvents(),i}return(0,i.__extends)(t,e),t.initBannerBlocks=function(){var e=document.querySelectorAll(".AudioBlock_catalog_banners");return(0,i.__spreadArray)([],(0,i.__read)(e)).map((function(e){return new t(e,e.dataset.blockId||"")}))},t.prototype.truncateTexts=function(){this.getBanners().forEach((function(e){var t=e.querySelector(".Banner__subheader");if(t instanceof HTMLElement&&t.scrollHeight/t.clientHeight>1.1)for(var n=t.clientHeight,i=t.innerHTML;i&&t.scrollHeight/n>1.1;)i=s(i),t.innerHTML=i;var o=e.querySelector(".Banner__header");if(o instanceof HTMLElement&&o.scrollHeight>o.clientHeight)for(var a=o.innerHTML;a&&o.scrollHeight>o.clientHeight;)a=s(a),o.innerHTML=a}))},t.prototype.addConsumableClick=function(e,t){var n=this;if(e.classList.contains("BannerItem--consumable")&&e.dataset.id){var i=e.querySelector(".Banner__link");if(i instanceof HTMLElement){var o=i.onclick;i.onclick=null,i.addEventListener("click",(function(i){n.consumeBanner(t,a.ConsumeReason.Click),n.removeBanner(t),o&&o.call(e,i)}))}}},t.prototype.addConsumableCloseClick=function(e,t){var n=this,i=e.querySelector(".Banner__dismiss");i instanceof HTMLElement&&(i.onclick=function(e){n.consumeBanner(t,a.ConsumeReason.Close),n.removeBanner(t),n.checkItems(),e.stopPropagation(),e.preventDefault()})},t.prototype.removeBanner=function(e){this.blockContent.querySelectorAll('.BannerItem[data-id="'+e+'"]').forEach((function(e){return e.remove()})),this.loopSlider&&this.loopSlider.init()},t.prototype.initLoop=function(){if((this.blockContent.classList.contains("AudioBlock_slider")||this.blockContent.classList.contains("AudioBlock_large_slider"))&&this.blockContent.querySelector(".Slider--loop")){var e=this.blockContent.querySelector(".Slider__scroll");e instanceof HTMLElement&&(e.onwheel=null,this.loopSlider=new o.LoopSlider(e,this.blockContent.querySelector(".Slider__line")))}},t.prototype.destroy=function(){e.prototype.destroy.call(this),this.loopSlider&&this.loopSlider.destroy()},t.prototype.consumeBanner=function(e,t){r.default.post("/audio",{act:"consume_banner",id:e,ref:this.blockId,reason:t})},t}(a.BannersController)},96694:function(e,t,n){"use strict";n.d(t,{Section:function(){return r}});var i=n(9046),o=n(51452),a="",r=function(){function e(){}return e.initBanners=function(){o.BannersController.initLoop()},e.getContainerElement=function(){return document.querySelector("."+e.CONTAINER)},e.getSection=function(t){return document.querySelector("."+e.BASE_SELECTOR+"__"+t)},e.getAllSections=function(){return Array.from(document.querySelectorAll("."+e.BASE_SELECTOR))},e.setSectionContent=function(e,t){var n=document.querySelector("."+e);n&&(n.innerHTML=t)},e.onSearchLoaded=function(t,n,i,o,r){a===o&&e.toggleSearch(o,r)},e.onSearchFiltered=function(t,n){a=t,e.toggleSearch(t,n)},e.toggleSearch=function(t,n){e.getAllSections().forEach((function(e){var o=n===e?!!t:!t,a=e.querySelector(".show_more");a instanceof HTMLElement&&(o?delete a.dataset.disabled:a.dataset.disabled="1"),(0,i.toggle)(e,o)}))},e.handlePagination=function(t,n){var i=e.getSection(n.name),o=window.cdf(t);if(i&&o){var a=void 0,r=i.querySelectorAll(".AudioBlock"),s=r[r.length-1];(a=s instanceof HTMLElement&&s.dataset.view_type&&["list","music_chart_list"].includes(s.dataset.view_type)?s.querySelector(".AudioBlock__content"):i)&&a.append(o)}},e.BASE_SELECTOR="AudioSection",e.CONTAINER="AudioSerp",e}()},12888:function(e,t,n){"use strict";n.d(t,{MobileQueueListener:function(){return r}});var i=n(97316),o=n(40852),a=n(91512),r=function(e){function t(t){return e.call(this,t)||this}return(0,i.__extends)(t,e),t.prototype.connect=function(e){var t=this;e&&this.listenQueueKey!==e.key&&(this.listenQueueKey=e.key,a.QueueManager.addQueue({key:e.key,ts:e.timestamp},(function(e,n){return t.queueHandler(n)})),a.QueueManager.start())},t}(o.QueueListener)},42058:function(e,t,n){"use strict";n.d(t,{getAudioElementsById:function(){return o},getAudioElementById:function(){return a},getPlaylistByAudioId:function(){return r}});var i=n(9046);function o(e){return(0,i.geByClass)("audio_item_"+e)}function a(e){return o(e)[0]}function r(e){var t=a(e);if(!t)return null;if(t.dataset&&t.dataset.playlistId)return t.dataset.playlistId;var n=(0,i.gpeByClass)("AudioPlaylistRoot",t);if(!n)return console.log("no playlist Element found"),null;var o=n.dataset.playlistId;return o||(console.log("no playlist Id found"),null)}},54247:function(e,t,n){"use strict";var i=n(9046),o=n(21943),a=function(){function e(){this.onScroll=(0,i.throttle)(this.onScroll,50)}return e.prototype.init=function(){this.gallery=document.querySelector(".groupsRecommendedSlider"),this.sliderSizes=null,this.allLoaded=!1,this.ajaxIsRunning=!1,this.gallery&&(this.block=document.querySelector(".GroupsRecommendedSlider"),this.sliderScrollNode=this.gallery.querySelector(".Slider__scroll"),this.sliderLineNode=this.gallery.querySelector(".Slider__line"),this.eventLog=new o.RecommendedGroupsEventLog("/groups","stats"))},e.prototype.subscribe=function(e,t,n){var o=e.closest(".prettyCard").dataset,a=o.groupId,r=o.trackCode;if(a&&r&&!e.classList.contains("prettyCard__button_accepted"))return this.eventLog.addLog({eventType:"group_subscribed",groupId:a,trackCode:r}),window.ajax.post("/groups",{act:"subscribe_from_recomm_groups",hash:t,oid:-a,track_code:r},{onDone:function(t){e.classList.add("prettyCard__button_accepted"),e.innerHTML=t,e.onclick=null},onFail:function(){return!1},showProgress:function(){(0,i.lockButton)(e),e.classList.add("prettyCard__button_loading")},hideProgress:function(){(0,i.unlockButton)(e),e.classList.remove("prettyCard__button_loading")}}),n&&(0,i.cancelEvent)(n);(0,i.cancelEvent)(n)},e.prototype.closeGroup=function(e,t,n){var o=e.closest(".prettyCard"),a=o.dataset,r=a.groupId,s=a.trackCode;if(r&&s)return this.eventLog.addLog({eventType:"group_hidden",groupId:r,trackCode:s}),(0,i.remove)(o),this.slides=null,window.ajax.post("/groups",{act:"hide_recomm_groups_block_group",hash:t,track_code:s,group_id:r}),n&&(0,i.cancelEvent)(n)},e.prototype.hideBlock=function(){var e=(0,i.domData)(this.sliderScrollNode,"code")||"";this.eventLog.addLog({eventType:"block_hidden",trackCode:e}),(0,i.remove)(this.block)},e.prototype.clickOnGroup=function(e){var t=e.dataset,n=t.groupId,i=t.trackCode;n&&i&&this.eventLog.addLog({trackCode:i,groupId:n,eventType:"group_opened"})},e.prototype.clickOnViewAll=function(){var e=(0,i.domData)(this.sliderScrollNode,"code")||"";e&&this.eventLog.addLog({trackCode:e,eventType:"block_expanded"})},e.prototype.viewBlock=function(e){this.eventLog.addLog({trackCode:e,eventType:"block_seen"})},e.prototype.onScroll=function(){if(this.gallery&&this.sliderScrollNode){var e=this.getScrollSizeValues();if(!this.ajaxIsRunning&&e){var t=this.sliderScrollNode.scrollLeft,n=Math.max(0,Math.floor((t-e.leftMargin)/e.itemWidth)),o=Math.max(0,Math.floor((t+e.width-e.leftMargin)/e.itemWidth));n*e.itemWidth+e.itemWidth-e.part<t&&n++,o*e.itemWidth+e.part>t+e.width&&o--;var a=this.getSlides();if(a){n=Math.max(0,n),o=Math.min(a.length,o);for(var r=n;r<=o;r++){var s=a[r];if(s&&!s.viewed){s.viewed=!0;var l=s.dataset,c=l.groupId;(d=l.trackCode)&&c&&this.eventLog.addLog({trackCode:d,groupId:c,eventType:"group_seen"})}}if(!this.allLoaded&&t+e.width>=e.scrollWidth/2){var u=(0,i.domData)(this.sliderScrollNode,"next")||"",d=(0,i.domData)(this.sliderScrollNode,"code")||"";if(!u)return void(this.allLoaded=!0);this.ajaxIsRunning=!0;var _=this;window.ajax.post("/groups",{act:"recommended_carousel",next:u,track_code:d},{onDone:function(e,t){if(e){var n=window.cdf(e);(0,i.append)(n,_.sliderLineNode),_.sliderSizes=null,_.slides=null}(0,i.domData)(_.sliderScrollNode,"next",t||null),_.allLoaded=!t,_.ajaxIsRunning=!1},onFail:function(){return setTimeout((function(){return _.ajaxIsRunning=!1}),500),!1}})}}}}},e.prototype.getScrollSizeValues=function(){var e;if(this.sliderSizes)return this.sliderSizes;var t=this.getSlides(),n=(0,i.getSize)(this.sliderScrollNode)[0],o=(0,i.getX)(this.sliderScrollNode),a=(0,i.getX)(t[0])-o,r=(0,i.getSize)(t[0])[0],s={width:n,itemWidth:r+((0,i.getX)(t[1])-o-a-r),leftMargin:a,part:Math.floor(r/3),scrollWidth:null===(e=this.sliderScrollNode)||void 0===e?void 0:e.scrollWidth};return this.sliderSizes=s,this.sliderSizes},e.prototype.getSlides=function(){var e;return this.slides||(this.slides=null===(e=this.gallery)||void 0===e?void 0:e.querySelectorAll(".prettyCard")),this.slides},e}();window.RecommendedGroupsSlider=new a},89907:function(e,t,n){"use strict";n.d(t,{NARRATIVE_MAX_STORIES_COUNT:function(){return m},StoriesArchive:function(){return h}});var i=n(97316),o=n(61927),a=n(1730),r=n(11393),s=n(92424),l=n(46950),c=n(9046),u=n(5277),d=n(78881),_=n(70675),f=n(61124),p=n(40469),m=100,h=function(e){function t(t){var n,a,r=e.call(this,t)||this;return r.storiesArchiveRef=(0,o.createRef)(),r.storiesArchiveStoriesWrapperRef=(0,o.createRef)(),r.storiesArchiveActionsRef=(0,o.createRef)(),r.state=(0,i.__assign)((0,i.__assign)({},t),{storiesLoadedCount:null===(n=t.stories)||void 0===n?void 0:n.length,isLoading:!1,isAllLoaded:(null===(a=t.stories)||void 0===a?void 0:a.length)>=t.storiesTotalCount,selectedStories:[]}),r.deleteSelectedStories=r.deleteSelectedStories.bind(r),r.createNarrativeFromSelectedStories=r.createNarrativeFromSelectedStories.bind(r),r.resetSelectedStories=r.resetSelectedStories.bind(r),r.onStoryThumbCheck=r.onStoryThumbCheck.bind(r),window.nav.onBeforeGo((function(e,t,n){"/narratives"===window.nav.path&&(null==n?void 0:n.need_restore)&&(null==r||r.setState({isLoading:!1,isCreateNarrativeActionLoading:!1}))})),r}return(0,i.__extends)(t,e),t.prototype.componentDidMount=function(){var e=this;(0,d.fixStoryThumbHeaders)(this.storiesArchiveStoriesWrapperRef.current),(0,c.initStickySimulator)((function(){return e.storiesArchiveRef.current}),(function(){return e.storiesArchiveActionsRef.current}),{shouldCalculateAudioPlayer:!0}),(0,c.initAutoScroll)((function(){var t=(0,a.$$)(".StoryThumb",e.storiesArchiveStoriesWrapperRef.current);return t[t.length-1]}),this.loadStories.bind(this))},t.prototype.componentDidUpdate=function(){(0,d.fixStoryThumbHeaders)(this.storiesArchiveStoriesWrapperRef.current)},t.prototype.loadStories=function(){var e=this;if(this.state.isLoading||this.state.isAllLoaded)return!1;this.setState({isLoading:!0}),window.ajax.post("stories",{act:"archive_list",offset:this.state.storiesLoadedCount,owner_id:this.state.ownerId,_ajax:!0},{onDone:function(t){var n=(0,i.__spreadArray)((0,i.__spreadArray)([],(0,i.__read)(e.state.stories)),(0,i.__read)(t.stories||[])),o=n.length>=t.storiesTotalCount;e.setState({stories:n,storiesLoadedCount:n.length,storiesTotalCount:t.storiesTotalCount,isAllLoaded:o,isLoading:!1})}})},t.prototype.deleteSelectedStories=function(){var e,t=this,n=this;if(!(null===(e=this.state.selectedStories)||void 0===e?void 0:e.length))return!1;var i=(0,l.getLangNumeric)(this.state.selectedStories.length,(0,l.getLang)("mobile_stories_archive_confirm_stories_delete_message","raw")),o=(0,_.Confirm)(i,(function(){var e;t.setState({isDeleteActionLoading:!0}),f.default.close(o),window.ajax.post("stories.php",{_ajax:!0,act:"remove_stories",remove_stories_hash:t.state.removeStoriesHash,owner_id:t.state.ownerId,story_ids:null===(e=t.state.selectedStories)||void 0===e?void 0:e.map((function(e){return e.id})).join(",")},{onDone:function(e){var t,i,o,a=e.deletedStoryIds||[];n.setState({stories:null===(t=n.state.stories)||void 0===t?void 0:t.filter((function(e){return!a.includes(e.id)})),selectedStories:null===(i=n.state.selectedStories)||void 0===i?void 0:i.filter((function(e){return!a.includes(e.id)})),isDeleteActionLoading:!1,storiesTotalCount:n.state.storiesTotalCount-a.length,storiesLoadedCount:n.state.storiesLoadedCount-a.length}),s.init({type:s.SNACKBAR_TYPE_SUCCESS,text:(0,l.getLang)("mobile_stories_archive_stories_deleted_successful")}),null===(o=window.StoriesArchive)||void 0===o||o.sendStoryAnalytic("delete_from_archive")},onFail:function(){return n.setState({isDeleteActionLoading:!1}),!0}})}),null,{yes_label:(0,l.getLang)("mobile_stories_archive_remove")})},t.prototype.createNarrativeFromSelectedStories=function(){var e,t,n;if(!(null===(e=this.state.selectedStories)||void 0===e?void 0:e.length))return!1;if((null===(t=this.state.selectedStories)||void 0===t?void 0:t.length)>m)s.init({type:s.SNACKBAR_TYPE_ERROR,text:(0,l.getLangNumeric)(m,(0,l.getLang)("mobile_stories_archive_max_narrative_stories_count_alert","raw"))});else{var i=null===(n=this.state.selectedStories)||void 0===n?void 0:n.map((function(e){return e.id})),o=(0,l.makeUrl)("narratives",{act:"create",owner_id:this.props.ownerId,selected:(null==i?void 0:i.length)?i.join(","):null,from:(0,l.makeUrl)("stories_archive",{owner_id:this.props.ownerId})});(0,p.sendNarrativeAnalytic)(p.NarrativeAnalyticEventType.clickToAddToNarrative,{ownerId:this.props.ownerId},p.NarrativeAnalyticNavScreen.storyArchive),this.setState({isCreateNarrativeActionLoading:!0}),window.nav.go(o)}},t.prototype.resetSelectedStories=function(){this.setState({selectedStories:[]})},t.prototype.onStoryThumbCheck=function(e,t){if(e.preventDefault(),e.stopPropagation(),t){var n=(0,i.__spreadArray)([],(0,i.__read)(this.state.selectedStories));n.some((function(e){return e.id===t.id}))?n=n.filter((function(e){return e.id!==t.id})):n.push(t),this.setState({selectedStories:n})}},t.prototype.render=function(){return r.default.preact(u.StoriesArchive,(0,i.__assign)((0,i.__assign)({},this.state),{onStoryThumbCheck:this.onStoryThumbCheck,onResetSelectedStoriesClick:this.resetSelectedStories,onDeleteStoriesActionClick:this.deleteSelectedStories,onCreateNarrativeActionClick:this.createNarrativeFromSelectedStories,storiesArchiveRef:this.storiesArchiveRef,storiesArchiveStoriesWrapperRef:this.storiesArchiveStoriesWrapperRef,storiesArchiveActionsRef:this.storiesArchiveActionsRef}))},t}(o.Component)},94338:function(e,t,n){"use strict";n.d(t,{addRecent:function(){return o}});var i=n(86658),o=function(e,t){var n={act:"add_recent",group_id:e,hash:t};i.default.post("/groups",n)}},35843:function(e,t,n){"use strict";n.d(t,{handleCaptcha:function(){return a},handleCaptchaSuccess:function(){return r}});var i=n(85828),o=new(n(26186).PromiseQueue);var a=function(e){return o.addTask((function(){return function(e){return(0,i.showCaptcha)({captcha_img:e.captcha_img}).then((function(t){return{captcha_sid:e.captcha_sid,captcha_key:t}}))}(e)}))},r=function(e){return(0,i.onCaptchaComplete)(),Promise.resolve(e)}},88941:function(e,t,n){"use strict";n.d(t,{getAPIDomains:function(){return s},initAPI:function(){return l},apiRequest:function(){return c}});var i,o=n(62643),a=n(48366),r=n(35843);function s(){return window.vk.apiConfigDomains}function l(){if(!window.vkApi){(0,a.makeAuthAndApiGlobal)();var e=s(),t=e.apiDomain,n=e.loginDomain;(0,o.setApiConfig)({appId:a.VK_MVK_APP_ID,version:"5.133",onCaptcha:r.handleCaptcha,onTokenExpired:function(){return function(e){void 0===e&&(e=!1);if(i)return i;return i=(0,o.login)("web_token",{},{},e).then((function(e){var t=e.access_token;return(0,o.setApiConfig)({accessToken:t}),e}))}(!0).then((function(e){return e.access_token}))},domain:t}),(0,o.setLoginConfig)({appId:a.VK_MVK_APP_ID,domain:n})}}function c(e,t,n){return(0,o.api)(e,t,n).then(r.handleCaptchaSuccess)}},26186:function(e,t,n){"use strict";n.d(t,{PromiseQueue:function(){return o}});var i=n(17999),o=function(){function e(){this._active=!1,this.tasks=[],this.taskResolvers=new Map}return e.prototype.addTask=function(e){var t=this;return this.tasks.push(e),new Promise((function(n,i){t.taskResolvers.set(e,{resolve:n,reject:i}),t._active||t.process()}))},e.prototype.process=function(){var e=this,t=this.tasks.pop();if(t){var n=this.taskResolvers.get(t);if(this.taskResolvers.delete(t),(0,i.isFunction)(t)&&n){this._active=!0;var o=t();o instanceof Promise?o.then((function(){return n.resolve()})).catch((function(){return n.reject()})).finally((function(){return e.process()})):(n.resolve(),this.process())}else this.process()}else this._active=!1},e}()},65861:function(e,t,n){"use strict";var i=n(11393);window.Wd=i.default},99144:function(e,t,n){"use strict";var i=n(76238),o=(n(36471),n(67078)),a=n(86353),r=n(66239),s=n(80781),l=n(33127),c=n(90302),u=new r.ModuleNavigationStatCollector(s.NetworkStatCollectorInstance,c.vkLocalStorage);o.default.onChanged((function(){l.navigationStat.addStatEvent(l.navigationStat.getModule(),i.NavigationProductionStatEventTypes.GO),(0,a.partConfigEnabled)("measure_module_navigation_stats_mvk")&&u.logEvent()}))},11116:function(e,t,n){"use strict";var i=n(51988),o=n(17999),a=new(function(){function e(){}return e.prototype.getHintHash=function(e){var t,n,i;return(null===(i=null===(n=null===(t=window.store)||void 0===t?void 0:t.helpHints)||void 0===n?void 0:n.all[e])||void 0===i?void 0:i.hash)||null},e.prototype.toggleLock=function(e,t){var n,i;void 0===t&&(t=null),null===t&&(t=!(null===(i=null===(n=window.store)||void 0===n?void 0:n.helpHints)||void 0===i?void 0:i.locked[e])),window.store.helpHints.locked[e]=Boolean(t)},e.prototype.hide=function(t){if(t){var n=i.default.get(e.SHOWN_HELP_HINTS_LS_KEY)||{};n[t]=!0,i.default.set(e.SHOWN_HELP_HINTS_LS_KEY,n),window.store.helpHints.shown[t]=!0,window.store.helpHints.all[t].active=!1,window.ajax.post("/",{act:"help_hints_hide",hint_id:t,hash:this.getHintHash(t)})}},e.prototype.canShow=function(e){return!(!e||window.store.helpHints.locked[e])&&(this.initShownHelpHints(),(0,o.isUndefined)(window.store.helpHints.all[e])?!window.store.helpHints.shown[e]:!window.store.helpHints.shown[e]&&window.store.helpHints.all[e].active)},e.prototype.initHelpHints=function(e){window.store.helpHints.all=e},e.prototype.initShownHelpHints=function(){window.store.helpHints.shown=i.default.get(e.SHOWN_HELP_HINTS_LS_KEY)||{}},e.SHOWN_HELP_HINTS_LS_KEY="shown_tooltips",e}());a.initShownHelpHints(),window.helpHints=a},76073:function(e,t,n){"use strict";function i(e){var t=document.createElement("div");t.innerHTML=e;var n=t.innerText;return t.remove(),n}n.d(t,{unescapeString:function(){return i}})},80574:function(e,t,n){"use strict";function i(e,t,n){return void 0===t&&(t=""),e&&n?new Promise((function(i,o){window.ajax.post("/?act=track_event",{type:e,value:t,hash:n},{onDone:function(){i()},onFail:function(e){return o(e),!0}})})):Promise.reject()}n.d(t,{trackEvent:function(){return i}})},31591:function(e,t,n){"use strict";n.d(t,{onLastInteractionMethodChanged:function(){return a},initInteractionMethodListener:function(){return r},getLastInteractionMethod:function(){return l}});var i=n(3226),o="touch",a=(0,i.default)();function r(){window.clog("[UserInteraction] init"),o="touch","PointerEvent"in window?function(){function e(e){var t="mouse"===e.pointerType?"mouse":"touch";t!==o&&(window.clog("[UserInteraction] Last interaction method changed to "+t+" (pointer event)"),a(t),o=t)}document.addEventListener("pointerdown",e,{passive:!0,capture:!0}),document.addEventListener("pointerover",e,{passive:!0,capture:!0})}():s()}function s(){document.addEventListener("mousemove",(function e(){window.clog("[UserInteraction] Last interaction method changed to mouse"),a("mouse"),o="mouse",document.removeEventListener("mousemove",e,{capture:!0}),function(){function e(t){var n;(null===(n=t.sourceCapabilities)||void 0===n?void 0:n.firesTouchEvents)||(window.clog("[UserInteraction] Last interaction method changed to touch"),a("touch"),o="touch",document.removeEventListener("touchstart",e,{capture:!0}),s())}document.addEventListener("touchstart",e,{passive:!0,capture:!0})}()}),{passive:!0,capture:!0})}function l(){return o}window.clog("[UserInteraction] done")},10612:function(e,t,n){"use strict";n.d(t,{getPaymentSessionInitialData:function(){return u},handlePaymentComponentChange:function(){return d},handlePaymentComponentDestroy:function(){return _},handleRequestAbortOnDestroy:function(){return f},getPaymentWindow:function(){return p},getOrderPaymentWindow:function(){return m},closePaymentWindow:function(){return h},getOrderPaymentUrl:function(){return v},getOrderIsPaidCheckUrl:function(){return g},startPaymentWaiting:function(){return w},startOrderPaymentWaiting:function(){return S}});var i=n(3226),o=n(1730),a=n(80444),r=n(9046),s=n(11393),l=n(61876),c=n(13234),u=function(){return{id:0}},d=function(e,t){void 0===e&&(e=u());var n=e.id+1;e.id=n,t.sessionId=n},_=function(e,t){(0,i.onEmitOnce)(window.nav.onBeforeGo,(function(){return d(e,t)}))},f=function(e){(0,i.onEmitOnce)(window.nav.onBeforeGo,(function(){return e.abort()}))},p=function(e){var t=window.open("");return null==t||t.focus(),null==t||t.document.write(e),(0,i.onEmitOnce)(window.nav.onBeforeGo,(function(){return null==t?void 0:t.close()})),t||void 0},m=function(){return p((0,r.getLang)("mobile_market_cart_payment_info_waiting"))},h=function(e){return e&&e.close()},v=function(e){var t=e.userId,n=e.orderId,i=e.hash,o=window.ajax.post("/market.php",{act:"get_payment_url_by_order",order_user_id:t,order_id:n,hash:i});return f(o),o.promise.then((function(e){var t=e.json;if(!e.skip){if(!t||!t.data||!t.data.length)throw Error();return decodeURIComponent(t.data[0])}}))},g=function(e){var t=e.orderId,n=e.userId;return(0,a.makeUrl)("/market.php",{act:"check_payment_by_order",order_id:t,order_user_id:n})},A=function(e){var t=e.icon,n=e.title,i=e.description,a=e.type,u=e.continueButtonURL,d=(0,o.$)('[data-section-ref="payment_content"]');if(d){var _=t||(0,l.getPaymentIcon)(a);try{d.innerHTML=s.default.html((0,c.CartOrderInfo)({icon:_,title:n||(0,r.getLang)("mobile_market_cart_payment_info_error"),description:i||"",actionText:(0,r.getLang)("mobile_market_cart_payment_button"),actionUrl:u||window.nav.path}))}catch(e){console.error(e)}}},y=function(e){var t=(void 0===e?{continueButtonURL:void 0}:e).continueButtonURL;A({continueButtonURL:t,title:(0,r.getLang)("mobile_market_cart_payment_info_error"),description:(0,r.getLang)("mobile_market_cart_payment_info_canceled_text"),type:"error"})},w=function(e){var t=e.sessionIdCurrent,n=e.paymentURL,o=e.paymentWindow,a=e.waitingTimeSec,r=void 0===a?5:a,s=e.getIsSuccess,l=e.onLoading,c=e.onResponse,u=e.onCancel,d=e.onFailure,_=e.onTimeout,f=t;window.clog("Open VK Pay window. Starting payment check"),o.location.href=n,l();var p=setInterval((function(){if(f!==t)return clearInterval(p),void h();o&&o.window&&!o.window.closed||(window.clog("VK Pay window was manually closed. Unsubscribing from events"),clearInterval(p),h(),u())}),500),m=function(e){if(f===t)if("externalAppDone"===e.data.method&&e.data.params.status){window.clog("Received VK Pay done event. Waiting for payment success check"),h(),clearInterval(p);var n=Date.now(),i=!0,o=setInterval((function(){return f!==t?(clearInterval(o),void(i=!1)):i?Date.now()-n>=1e3*r?(window.clog("Payment check timeout. Showing done info."),clearInterval(o),i=!1,void _()):void s().then((function(e){if(!i||!e)return!1;window.clog("Payment check succeeded. Showing done info"),clearInterval(o),i=!1})).catch((function(){window.clog("Received VK Pay close or fail event. Unsubscribing from events"),clearInterval(o),d()})):void 0}),1e3);c&&c()}else"closeApp"!==e.data.method&&"externalAppFail"!==e.data.method||(window.clog("Received VK Pay close or fail event. Unsubscribing from events"),clearInterval(p),h(),d());else h()};function h(){window.removeEventListener("message",m,!1)}window.addEventListener("message",m,!1);(0,i.onEmitOnce)(window.nav.onBeforeGo,(function(){h()}))},S=function(e){var t=e.paymentComponent,n=e.checkIsPaidUrl,i=e.sessionIdCurrent,o=e.paymentURL,a=e.paymentWindow,s=e.onCancel,l=e.onFail,c=e.onTimeout;return w({sessionIdCurrent:i,paymentURL:o,paymentWindow:a,waitingTimeSec:40,getIsSuccess:function(){var e=window.ajax.post(n,{});return f(e),e.promise.then((function(e){var n,o=e.json;if(!e.skip){if(i!==t.sessionId)throw Error();if(!o)throw Error();return!!(null===(n=null==o?void 0:o.data)||void 0===n?void 0:n[0].status)&&(function(e){var t=e.description,n=e.continueButtonURL;A({description:t,continueButtonURL:n,title:(0,r.getLang)("mobile_market_cart_payment_info_success"),type:"success"})}({description:o.data[0].text}),!0)}}))},onLoading:function(){!function(e){var t=e.title,n=e.description,i=e.continueButtonURL;A({title:t,description:n,continueButtonURL:i,type:"loading"})}({title:(0,r.getLang)("mobile_market_cart_payment_info_waiting"),description:(0,r.getLang)("mobile_market_cart_payment_info_waiting_text")})},onCancel:function(){s&&s(),y()},onFailure:function(){l&&l(),y()},onTimeout:function(){c&&c(),function(e){var t=(void 0===e?{continueButtonURL:void 0}:e).continueButtonURL;A({continueButtonURL:t,title:(0,r.getLang)("mobile_market_cart_payment_info_success"),description:(0,r.getLang)("mobile_market_cart_payment_info_success_later_text"),type:"timeout"})}()}})}},59655:function(e,t,n){"use strict";var i=n(93858);t.default=i.default},50775:function(e,t,n){"use strict";n.d(t,{MaybeLink:function(){return i.MaybeLink}});var i=n(38099)},77838:function(e,t,n){"use strict";n.d(t,{SVGIconLegacy:function(){return r}});var i=n(97316),o=n(46950),a=n(26350);function r(e,t){var n=(0,o.inlineIconResolver)(t);return n?React.createElement(a.SVGIconHTML,(0,i.__assign)({},n)):[]}},39196:function(e,t,n){"use strict";var i=n(77838);t.default=i.SVGIconLegacy},65354:function(e,t,n){"use strict";var i=n(59013);window.Spinner=i.Spinner},51782:function(e,t,n){"use strict";var i=n(51988),o=n(86900),a=n(20848),r=function(){function e(){this._element=null,this._previousActiveElement=null}return e.prototype.findElement=function(){var e=document.getElementsByClassName("UnsupportedBrowser");return e.length?(this._element=e[0],this._element):null},Object.defineProperty(e.prototype,"element",{get:function(){return this._element?this._element:this.findElement()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isDetected",{get:function(){return[!(0,a.isSVGSupported)(),!(0,a.isSupportsSupported)(),!(0,a.isCSSVariablesSupported)(),!(0,a.isGridsSupported)(),!(0,a.isFlexboxSupported)(),!(0,a.isMatchMediaSupported)(),!(0,a.isIntersectionObserverSupported)()].some((function(e){return e}))},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"daysHidden",{get:function(){var e=(i.default.get("unsupportedBrowser")||{}).hiddenSince;return e?Math.round((Date.now()-e)/1e3/60/60/24):-1},enumerable:!1,configurable:!0}),e.prototype.readyToBeShown=function(e){return void 0===e&&(e=0),!e||this.daysHidden<0||this.daysHidden>=e},e.prototype.show=function(){this.element&&(this._previousActiveElement=document.activeElement,this.element.classList.add("UnsupportedBrowser--active"),this.element.focus(),(0,o.statlogsValueEvent)("mvk_unsupported_browser_alert","shown"))},e.prototype.hide=function(){var e,t,n;null===(t=null===(e=this.element)||void 0===e?void 0:e.classList)||void 0===t||t.remove("UnsupportedBrowser--active"),null===(n=this._previousActiveElement)||void 0===n||n.focus(),i.default.set("unsupportedBrowser",{hiddenSince:Date.now()}),(0,o.statlogsValueEvent)("mvk_unsupported_browser_alert","hidden")},e.prototype.update=function(){(0,o.statlogsValueEvent)("mvk_unsupported_browser_alert","update_link_clicked")},e}();window.UnsupportedBrowser=new r},88332:function(e,t,n){"use strict";n.d(t,{showCaptcha:function(){return c},onHide:function(){return u},onComplete:function(){return d},onSend:function(){return _}});var i=n(11393),o=n(28947),a=n(61124),r=n(58417),s=n(83242),l=n(1730);function c(e){void 0===e&&(e={});var t=i.default.elem((0,o.CaptchaPopup)(e));window.CaptchaPopup.shownCaptchaPromise&&(window.CaptchaPopup.shownCaptchaPromise.reject(),window.CaptchaPopup.shownCaptchaPromise=null);var n=new Promise((function(e,n){window.CaptchaPopup.shownCaptchaPromise={resolve:e,reject:n},(0,a.replacePopup)((0,l.$)(".CaptchaPopup"),t)||(0,a.openPopup)(t,!0,{})}));return n.catch((function(e){throw(0,a.closePopup)(),e})),n}function u(){window.CaptchaPopup.shownCaptchaPromise&&(window.CaptchaPopup.shownCaptchaPromise.reject(),window.CaptchaPopup.shownCaptchaPromise=null)}function d(){window.CaptchaPopup.shownCaptchaPromise=null;var e=(0,l.$)(".CaptchaPopup");e&&(0,a.closePopup)(e)}function _(e){var t=e.$btn;if((0,r.setLoading)(t,!0),!t.form)return u();var n=(0,s.getFormValues)(t.form);return window.CaptchaPopup.shownCaptchaPromise?(window.CaptchaPopup.shownCaptchaPromise.resolve(n.sig||""),!1):void 0}},85828:function(e,t,n){"use strict";n.d(t,{showCaptcha:function(){return i.showCaptcha},onCaptchaComplete:function(){return i.onComplete}});n(28947);var i=n(88332);window.CaptchaPopup||(window.CaptchaPopup={onHide:i.onHide,onSend:i.onSend,shownCaptchaPromise:null})},95198:function(e,t,n){"use strict";n.d(t,{CookiePolicy:function(){return l}});var i=n(97316),o=n(7104),a=n(60559),r=n(60232),s=n(35909);function l(e){return(0,o.jsx)("div",(0,i.__assign)({className:"CookiePolicy"},{children:(0,o.jsxs)("div",(0,i.__assign)({className:"CookiePolicy__content"},{children:[(0,o.jsxs)("div",(0,i.__assign)({className:"CookiePolicy__inner-content"},{children:[(0,o.jsxs)("div",(0,i.__assign)({className:"CookiePolicy__text-container"},{children:[(0,o.jsx)("div",{className:"CookiePolicy__icon"},void 0),(0,o.jsx)("div",(0,i.__assign)({className:"CookiePolicy__text"},{children:a.wrap(e.text)}),void 0)]}),void 0),(0,o.jsx)(r.Btn,(0,i.__assign)({theme:"small",mix:"CookiePolicy__accept_button",use_native_onclick:!0,onClick:"CookiePolicy._onHideClick(event, this)",url:e.hide_url},{children:(0,o.jsx)("span",{children:e.accept_button_text},void 0)}),void 0)]}),void 0),(0,o.jsx)("a",(0,i.__assign)({className:"CookiePolicy__hide",href:e.hide_url,onClick:"CookiePolicy._onHideClick(event, this)"},{children:(0,o.jsx)("div",(0,i.__assign)({className:"CookiePolicy__hideIcon"},{children:(0,o.jsx)(s.Icon20Cancel,{},void 0)}),void 0)}),void 0)]}),void 0)}),void 0)}},2302:function(e,t,n){"use strict";var i=n(9046),o=n(86658);(0,i.need)("onDOMReady")((function(){CookiePolicy._onHideClick=r}));var a=".CookiePolicy";function r(e,t){e.preventDefault();var n=t.getAttribute("href");t.closest(a).style.display="none",o.default.post(n,{_ajax:1})}},67571:function(e,t,n){"use strict";var i=n(95198);window.CookiePolicy=i.CookiePolicy},70923:function(e,t,n){"use strict";n.d(t,{RecommendedNarrativesBlock:function(){return c}});var i=n(2111),o=n(89359),a=n(11393),r=n(46950),s=n(9046),l=n(40469),c=function(){function e(){var e,t=this;this.actionsMenuElement=null,this.openActionsMenu=function(){var e=a.default.elem((0,o.ContextMenu)({withoutWrap:!0,list:[(0,o.ContextMenuItem)({title:(0,r.getLang)("mobile_fb_recommended_narratives_not_interested_action"),onclick:"RecommendedNarrativesBlock.onNotInterestedActionClick"})]}));t.actionsMenuElement=o.ContextMenu.open(e,"",{appendToBody:!0,withoutPopupCloning:!0,menuEl:e},e)},this.closeActionsMenu=function(){t.actionsMenuElement&&(o.ContextMenu.close(t.actionsMenuElement),t.actionsMenuElement=null)},this.onNotInterestedActionClick=function(){t.closeActionsMenu();var e=document.querySelector(".RecommendedNarrativesBlock");if(e){var n=(0,i.getIgnoreUrl)(e);n&&(window.ajax.post(n,{}),(0,s.remove)(e))}},this.onCreateBlockCreateButtonClick=function(e,t,n){(0,l.sendNarrativeAnalytic)(l.NarrativeAnalyticEventType.createNarrative,{ownerId:Number(window.vk.id)},l.NarrativeAnalyticNavScreen.feedBlock),window.nav.go(n)},this.onCreateBlankClick=function(e,t,n){(0,l.sendNarrativeAnalytic)(l.NarrativeAnalyticEventType.createNarrative,{ownerId:Number(window.vk.id)},l.NarrativeAnalyticNavScreen.feedBlock),window.nav.go(n)},null===(e=window.pStats)||void 0===e||e.onViewed((function(e){var t;e.classList.contains("RecommendedNarrativesBlock")&&(null===(t=window.RecommendedNarrativesBlock)||void 0===t||t.onBlockViewed(e))}))}return e.prototype.onBlockViewed=function(e){var t=(0,i.getTrackCode)(e),n=(0,i.getMarkBlockSeenHash)(e);t&&n&&window.ajax.post("narratives",{act:"mark_seen_recommended_narratives_block",hash:n,track_code:t})},e.prototype.onItemClick=function(e,t,n,o){var a=(0,i.getTrackCode)(e);window.showNarrative(n,o,0,i.RECOMMENDED_NARRATIVES_LIST,{trackCode:a,source:i.RECOMMENDED_NARRATIVES_SOURCE})},e.prototype.openRecommendedNarrativesList=function(e){var t,n=(0,i.getTrackCode)(e),o=(0,i.getShareNarrativeMailHash)(e);n&&o&&(null===(t=window.RecommendedNarrativesList)||void 0===t||t.open({trackCode:n,shareNarrativeMailHash:o}))},e}()},33705:function(e,t,n){"use strict";n.d(t,{RecommendedNarrativesList:function(){return f}});var i=n(11393),o=n(46950),a=n(92505),r=n(76566),s=n(2111),l=n(13640),c=n(89359),u=n(92424),d=n(40469),_=n(11386),f=function(){function e(){var e=this;this.popup=null,this.close=function(t){var n;t&&(console.error(t),(0,_.logError)(t,{environment:"mobile_recommended_narratives_list"})),e.closePopup(),(null===(n=e.config)||void 0===n?void 0:n.onClose)&&i.default.handle(e.config.onClose)},this.targetOwnOnClick=function(t,n){window.cur.share.go(n),e.close()},this.setLockerVisible=function(t){var n,i;void 0===t&&(t=!0);var o=null===(n=e.popup)||void 0===n?void 0:n.querySelector(".RecommendedNarrativesList__locker"),a=null===(i=e.popup)||void 0===i?void 0:i.querySelector(".RecommendedNarrativesList__content");o&&a&&(o.style.display=t?"flex":"none",a.style.display=t?"none":"block")}}return e.prototype.open=function(e){var t=this;if(this.config=e,!this.popup){var n=(0,a.default)({title:(0,o.getLang)("mobile_recommended_narratives_list_header"),content:(0,r.RecommendedNarrativesList)(),isLeftActionBack:!0,onLeftActionClick:"RecommendedNarrativesList.close",isConfirmActionAvailable:!1}),s=i.default.elem(n);this.popup=Popup.open(s,!0),this.setLockerVisible(),this.loadData().then((function(e){t.narratives=e,t.renderNarrativesList(e),t.setLockerVisible(!1)})).catch(this.close)}},e.prototype.renderNarrativesList=function(e){var t,n=null===(t=this.popup)||void 0===t?void 0:t.querySelector(".RecommendedNarrativesList__content");if(n){var o="";e.forEach((function(e){o+=i.default.html((0,l.RecommendedNarrativesListItem)({narrative:e}))})),n.innerHTML=o}},e.prototype.toggleNarrativeBookmark=function(e){c.ContextMenu.close(this.actionsContextMenu);var t=e.isBookmarked;e.isBookmarked=!t,window.ajax.post("bookmarks.php",{_ajax:1,act:t?"bookmark_remove":"bookmark_add",item_type:31,item_oid:e.ownerId,item_id:e.id,hash:e.bookmarkHash,ref:window.cur.module},{onDone:function(){u.init({type:u.SNACKBAR_TYPE_BOOKMARK,text:(0,o.getLangReplace)((0,o.getLang)(t?"mobile_stories_narratives_removed_from_bookmarks":"mobile_stories_narratives_added_to_bookmarks"),{narrative_title:e.title})}),t||(0,d.sendNarrativeAnalytic)(d.NarrativeAnalyticEventType.addToBookmarks,e,d.NarrativeAnalyticNavScreen.feedBlock)},onFail:function(){return e.isBookmarked=t,!0}})},e.prototype.shareNarrative=function(e){c.ContextMenu.close(this.actionsContextMenu),(0,d.sendNarrativeAnalytic)(d.NarrativeAnalyticEventType.shareNarrative,e,e.ownerId>0?d.NarrativeAnalyticNavScreen.profile:d.NarrativeAnalyticNavScreen.club),window.Share(e.rawId,{mail_hash:this.config.shareNarrativeMailHash,object:"narrative"+e.rawId,is_bookmarked:e.isBookmarked,bookmark_hash:e.bookmarkHash,bookmark_type:31,can_bookmark:!0,can_to_own:!0,can_to_club:!1,shouldInteractWithGlobalStories:!1,targetOwnOnClick:"RecommendedNarrativesList.targetOwnOnClick"})},e.prototype.prepareActionsMenu=function(e){var t=this,n=e.isBookmarked,a=(0,c.ContextMenu)({withoutWrap:!0,list:[(0,c.ContextMenuItem)({title:n?(0,o.getLang)("mobile_narratives_list_action_save_remove"):(0,o.getLang)("mobile_narratives_list_action_save_fave"),onclick:function(){return t.toggleNarrativeBookmark(e)}}),(0,c.ContextMenuItem)({title:(0,o.getLang)("mobile_narratives_list_action_share"),onclick:function(){return t.shareNarrative(e)}})].filter(Boolean)});return i.default.preactElemFromTemplate(a)},e.prototype.onItemClick=function(e,t,n,i){window.showNarrative(n,i,0,s.RECOMMENDED_NARRATIVES_LIST,{trackCode:this.config.trackCode,source:s.RECOMMENDED_NARRATIVES_SOURCE})},e.prototype.onEditMenuClick=function(e){var t=this.narratives.find((function(t){return t.id===e}));if(t){var n=this.prepareActionsMenu(t);this.actionsContextMenu=c.ContextMenu.open(n,"",{appendToBody:!0,withoutPopupCloning:!0,menuEl:n},n)}},e.prototype.loadData=function(){var e=this;return new Promise((function(t,n){window.ajax.post("narratives",{act:"recommended_narratives_list",track_code:e.config.trackCode},{onDone:function(e){t(e)},onFail:function(e){return n(e),!0}})}))},e.prototype.closePopup=function(){this.popup&&(Popup.close(this.popup),this.popup=null)},e}()},42512:function(e,t,n){"use strict";var i=n(70923),o=n(33705);window.RecommendedNarrativesBlock=new i.RecommendedNarrativesBlock,window.RecommendedNarrativesList=new o.RecommendedNarrativesList},2111:function(e,t,n){"use strict";n.d(t,{RECOMMENDED_NARRATIVES_LIST:function(){return i},RECOMMENDED_NARRATIVES_SOURCE:function(){return o},getTrackCode:function(){return r},getIgnoreUrl:function(){return s},getShareNarrativeMailHash:function(){return l},getMarkBlockSeenHash:function(){return c}});var i="recommended_narratives",o="narrative_recommendations",a=function(e,t){var n;return e?e.classList.contains("RecommendedNarrativesBlock")?e.getAttribute(t):(null===(n=e.closest(".RecommendedNarrativesBlock"))||void 0===n?void 0:n.getAttribute(t))||null:null},r=function(e){return a(e,"data-track-code")},s=function(e){return a(e,"data-ignore-url")},l=function(e){return a(e,"data-share-narrative-mail-hash")},c=function(e){return a(e,"data-mark-block-seen-hash")}},52934:function(e,t,n){"use strict";n.d(t,{ConnectionType:function(){return v}});var i=n(86900),o="4g",a="3g",r="2g",s="slow-2g",l="wifi",c="ethernet",u="cellular",d="bluetooth",_="none",f="mixed",p="wimax",m="mvk_connection_types",h="mvk_connection_types_timeout",v=function(){function e(){this.connection=window.navigator.connection||window.navigator.mozConnection||window.navigator.webkitConnection,this.connection?(this.badConnectionTimerCounter=0,this.currentConnection=this.updateConnection(this.connection),this.prevConnection=this.updateConnection(this.connection),this.connection.addEventListener("change",this.onConnectionChange.bind(this))):(0,i.statlogsValueEvent)(m,"not_supported")}return e.prototype.startBadConnectionTimer=function(){var e=this;this.badConnectionTimer||(this.badConnectionTimer=setInterval((function(){e.updateBadConnectionTimer()}),1e3))},e.prototype.stopBadConnectionTimer=function(){this.badConnectionTimer&&(clearInterval(this.badConnectionTimer),this.badConnectionTimer=0,this.badConnectionTimerCounter=0,this.badConnectionTimer10=!1,this.badConnectionTimer20=!1,this.badConnectionTimer30=!1)},e.prototype.updateBadConnectionTimer=function(){this.badConnectionTimerCounter++,this.badConnectionTimerCounter>=30&&!this.badConnectionTimer30?((0,i.statlogsValueEvent)(h,"supported",this.prevConnection.type,this.currentConnection.type,this.prevConnection.effectiveType,this.currentConnection.effectiveType,"30",window.cur.module),this.badConnectionTimer30=!0):this.badConnectionTimerCounter>=20&&!this.badConnectionTimer20?((0,i.statlogsValueEvent)(h,"supported",this.prevConnection.type,this.currentConnection.type,this.prevConnection.effectiveType,this.currentConnection.effectiveType,"20",window.cur.module),this.badConnectionTimer20=!0):this.badConnectionTimerCounter>=10&&!this.badConnectionTimer10&&((0,i.statlogsValueEvent)(h,"supported",this.prevConnection.type,this.currentConnection.type,this.prevConnection.effectiveType,this.currentConnection.effectiveType,"10",window.cur.module),this.badConnectionTimer10=!0)},e.prototype.updateConnection=function(e){return Object.assign({},{type:e.type,effectiveType:e.effectiveType})},e.prototype.onChangeToBadConnection=function(){this.startBadConnectionTimer(),(0,i.statlogsValueEvent)(m,"supported",this.prevConnection.type,this.currentConnection.type,this.prevConnection.effectiveType,this.currentConnection.effectiveType,"to_bad_connection",window.cur.module)},e.prototype.onChangeToGoodConnection=function(){this.stopBadConnectionTimer(),(0,i.statlogsValueEvent)(m,"supported",this.prevConnection.type,this.currentConnection.type,this.prevConnection.effectiveType,this.currentConnection.effectiveType,"to_good_connection",window.cur.module)},e.prototype.onChangeToNoConnection=function(){(0,i.statlogsValueEvent)(m,"supported",this.prevConnection.type,this.currentConnection.type,this.prevConnection.effectiveType,this.currentConnection.effectiveType,"to_no_connection",window.cur.module)},e.prototype.onChangeToUnknownConnection=function(){(0,i.statlogsValueEvent)(m,"supported",this.prevConnection.type,this.currentConnection.type,this.prevConnection.effectiveType,this.currentConnection.effectiveType,"to_unknown_connection",window.cur.module)},e.prototype.onConnectionChange=function(){this.currentConnection=this.updateConnection(this.connection),this.currentConnection.type===u||this.currentConnection.type===d?this.prevConnection.effectiveType===o&&(this.currentConnection.effectiveType===a||this.currentConnection.effectiveType===r||this.currentConnection.effectiveType===s)||this.prevConnection.effectiveType===a&&(this.currentConnection.effectiveType===r||this.currentConnection.effectiveType===s)||this.prevConnection.effectiveType===r&&this.currentConnection.effectiveType===s?this.onChangeToBadConnection():this.currentConnection.effectiveType!==o||this.prevConnection.effectiveType!==a&&this.prevConnection.effectiveType!==r&&this.prevConnection.effectiveType!==s||this.onChangeToGoodConnection():this.currentConnection.type===l||this.currentConnection.type===c||this.currentConnection.type===p||this.currentConnection.type===f?this.onChangeToGoodConnection():this.currentConnection.type===_?this.onChangeToNoConnection():this.onChangeToUnknownConnection(),this.prevConnection=this.updateConnection(this.currentConnection)},e}()},68627:function(e,t,n){"use strict";n.d(t,{VoiceRecordControlsManager:function(){return y}});var i=n(9046),o=n(43734),a=n.n(o),r=n(1730),s=n(45029),l=n(11393),c=n(24122),u=n(3226),d=n(86205),_=n(44571),f=n(2067),p=n(76065),m=n(32027),h=n(22770),v=n(89854),g=n(41707),A=40,y=function(){function e(e,t){var n=this;this.onSend=(0,u.default)(),this.onDestroy=(0,u.default)(),this.onPreviewProcessComplete=(0,u.default)(),this.audioMessagePreviewData=null,this.initialized=!1,this.lastDurationSend=0,this.state="moving",this.moving=!1,this.needLock=!1,this.floatPosition=[0,0],this.isSending=!1,this.isPreviewProcessing=!1,this.init=function(e,t,o){var a,s,u,d,_,f;n.state=t,n.recorder&&(n.recorder.duration=0),n.recordingID=o;var p=(0,c.VoiceRecordControls)({state:"moving"===n.state?"":n.state,audioMessagePreviewData:n.audioMessagePreviewData});if(n.elements.appendElement&&p&&(n.elements.controls=l.default.elem(p),n.elements.controls&&n.elements.appendElement.appendChild(n.elements.controls)),n.findPanelElements(),"preview"!==n.state&&(n.elements.float=(0,r.$)(".VoiceRecordControls__float",n.elements.controls),n.elements.lock=(0,r.$)(".VoiceRecordControls__lock",n.elements.controls),n.elements.lockChevron=(0,r.$)(".VoiceRecordControls__lockChevron",n.elements.controls),n.elements.lockIcon=(0,r.$)(".VoiceRecordControls__lockIcon",n.elements.controls),n.calculateTransitionData()),"moving"===n.state&&e){e.preventDefault(),e.stopPropagation();var m=e.touches[0];n.moveElements([m.pageX,m.pageY])}else"locked"===n.state&&n.lock();n.applyVolume(0),null===(a=n.elements.controls)||void 0===a||a.classList.add("VoiceRecordControls--show"),window.nav.onBeforeGo((function(){return n.cancel(!0)})),"moving"===n.state&&((0,i.addEvent)(n.elements.initialElement,"touchmove",n.onTouchMove,{passive:!0}),(0,i.addEvent)(n.elements.initialElement,"touchend touchcancel",n.onTouchEnd,{passive:!0}),(0,i.addEvent)(window,"resize",n.onResize),document.addEventListener("visibilitychange",n.onVisibilityChange,!1)),"preview"!==n.state&&((0,i.addEvent)(n.elements.float,"click",n.onFloatClick),(0,i.addEvent)(n.elements.lock,"click",(function(){"locked"===n.state&&(n.getDuration()>0?n.showPreview():n.cancel(!0))})),(0,i.addEvent)(window,"click",n.onGlobalClick,{capture:!0}),window.Speech&&(window.Speech.onRecordProgress(n.onProgress),window.Speech.onRecordStart(n.onRecordStart),window.Speech.onStop(n.onStop),window.Speech.onCancel(n.onCancel)),v.screenWakeLocker.lock()),n.initialized=!0,"preview"===n.state?(n.updatePanel(!0),window.requestAnimationFrame((function(){window.AudioMessagePlayer.redrawWaves()}))):("locked"===t?null===(s=n.recorder)||void 0===s||s.record():"moving"===t&&setTimeout((function(){var e;null===(e=n.recorder)||void 0===e||e.record()}),window.browser.iphone?250:0),"suspended"===(null===(u=n.recorder)||void 0===u?void 0:u._ctx.state)&&(null===(f=null===(d=n.recorder)||void 0===d?void 0:(_=d._ctx).resume)||void 0===f||f.call(_))),setTimeout((function(){(0,i.statlogsValueEvent)("mvk_audio_messages_event",null,"init",n.state)}),400)},this.setAudioMessagePreviewData=function(e){n.audioMessagePreviewData=e},this.getDuration=function(){return n.recorder?n.recorder.duration:n.audioMessagePreviewData?n.audioMessagePreviewData.duration:0},this.calculateTransitionData=function(){var e=(0,i.getSize)(n.elements.appendElement)[0],t=(0,i.getCh)(),o=t-160-40,a=0;n.elements.panel&&(a=parseInt(getComputedStyle(n.elements.panel).marginBottom,10)),n.elements.initialElement=document.body,n.transitionData={cancelPositionX:Math.max(e/2,e-240),cancelOpacityDecreaseStartX:e-320,minY:t-A-a,maxX:e-A,maxLockY:o+A,maxY:o}},this.findPanelElements=function(){n.elements.panel=(0,r.$)(".VoiceRecordControls__panel",n.elements.controls),n.elements.duration=(0,r.$)(".VoiceRecordControls__duration",n.elements.controls),n.elements.cancel=(0,r.$)(".VoiceRecordControls__cancel",n.elements.controls),n.elements.previewPlayer=(0,r.$)(".audio-msg-track",n.elements.controls)},this.onPreviewPanelShow=function(){n.findPanelElements(),n.elements.send=(0,r.$)(".VoiceRecordControls__send",n.elements.controls),(0,i.addEvent)(n.elements.send,"click",n.send),n.state="preview"},this.updatePanel=function(e){var t,o;void 0===e&&(e=!1),"preview"===n.state&&(e=!0);var a={state:n.needLock?"locked":""};if(!e&&n.recorder&&(a.duration=(0,s.formatDuration)(n.getDuration())),null===(t=n.elements.controls)||void 0===t||t.classList.toggle("VoiceRecordControls--locked","locked"===n.state),e){n.needLock=!0,n.previewBuffer=n.previewBuffer||(null===(o=n.recorder)||void 0===o?void 0:o.buffer);var r=URL.createObjectURL(n.previewBuffer);a.state="preview",a.url=r,window.Speech&&n.recorder&&n.audioMessagePreviewData&&window.Speech.saveRecordingBuffer(n.audioMessagePreviewData.bufferKey,n.previewBuffer).then((function(){window.clog("[VoiceRecorder] Voice record was cached")})),a.audioMessagePreviewData=n.audioMessagePreviewData,n.onPreviewProcessComplete(n.audioMessagePreviewData),(0,i.remove)(n.elements.float),(0,i.remove)(n.elements.lock),n.transitionData&&n.moveElements([n.transitionData.maxX,n.transitionData.minY])}var c=l.default.elem((0,p.VoiceRecordControlsPanel)(a));n.elements.panel&&c&&(n.elements.panel.outerHTML=c.outerHTML),n.findPanelElements(),e?n.onPreviewPanelShow():n.movePanelElements(),window.requestAnimationFrame((function(){window.AudioMessagePlayer.redrawWaves()}))},this.onFinish=function(){var e,t;n.isPreviewProcessing=!1,null===(e=n.elements.controls)||void 0===e||e.classList.remove("VoiceRecordControls--longProcessing"),(0,i.removeEvent)(window,"click",n.onGlobalClick,{capture:!0}),(0,i.removeEvent)(n.recorder,"finish",n.onFinish);var o=n.audioMessagePreviewData||{bufferKey:n.key,duration:n.getDuration(),waves:null===(t=n.recorder)||void 0===t?void 0:t._waveData};n.setAudioMessagePreviewData(o),n.isSending||n.updatePanel(!0)},this.showPreview=function(){var e;n.isPreviewProcessing||((0,i.statlogsValueEvent)("mvk_audio_messages_event",null,"show_preview"),n.isPreviewProcessing=!0,(0,i.addEvent)(n.recorder,"finish",n.onFinish),setTimeout((function(){var e;n.isPreviewProcessing&&(null===(e=n.elements.controls)||void 0===e||e.classList.add("VoiceRecordControls--longProcessing"))}),500),null===(e=n.recorder)||void 0===e||e.stop())},this.applyVolume=(0,s.throttle)((function(e){var t=(0,r.$)(".VoiceRecordControls__shadow");i.setStyle.transform(t,.7+Math.min(e,.2))}),50),this.setDuration=function(e){n.elements.duration&&((0,r.$)(".VoiceRecordControls__durationText",n.elements.duration).innerHTML=e)},this.isTouchCancel=function(e){var t;return!(null===(t=n.recorder)||void 0===t?void 0:t._aquireing)&&e.pageX<=n.transitionData.cancelPositionX},this.moveElements=function(e){void 0===e&&(e=[0,0]);var t=[Math.min(n.transitionData.maxX,e[0])-A,Math.max(Math.min(n.transitionData.minY,e[1])-A,n.transitionData.maxY)];n.floatPosition=t;var o="locked"===n.state?0:1-(n.transitionData.minY-t[1]-A)/(n.transitionData.minY-n.transitionData.maxLockY-A),r=[Math.max(0,Math.min(6,6*o)),Math.max(0,Math.min(10,10*o))],s=[t[0]+20,t[1]-80-r[0]-r[1]];a().mutate((function(){i.setStyle.transform(n.elements.float,{translate:t}),i.setStyle.transform(n.elements.lock,{translate:s}),(0,i.setStyle)(n.elements.lock,{"padding-top":r[0],"padding-bottom":r[1]}),i.setStyle.transform(n.elements.lockIcon,{translate:[0,Math.max(-10,Math.min(0,-10*(1-o)))]}),i.setStyle.transform(n.elements.lockChevron,{translate:[Math.max(-8,Math.min(0,-8*(1-o))),0],rotate:-90}),(0,i.setStyle)(n.elements.lockChevron,{opacity:o}),n.movePanelElements()}));var c=o<=0;if("locked"===n.state||n.needLock!==c){var u=void 0;"locked"===n.state?u=(0,m.getStop20Icon)():(n.needLock=c,u=n.needLock?(0,_.getLockOutline20Icon)():(0,f.getUnlockOutline20Icon)()),n.elements.lockIcon&&"locked"!==n.state&&(n.elements.lockIcon.innerHTML=l.default.html((0,d.default)({icon:u})))}},this.movePanelElements=function(){var e=[n.floatPosition[0]-160,0];i.setStyle.transform(n.elements.duration,{translate:e}),n.transitionData&&(0,i.setStyle)(n.elements.cancel,{opacity:e[0]/n.transitionData.cancelOpacityDecreaseStartX})},this.lock=function(){var e,t;if("locked"!==n.state){(0,i.statlogsValueEvent)("mvk_audio_messages_event",null,"lock"),n.needLock=!0,n.state="locked",null===(e=n.elements.controls)||void 0===e||e.classList.add("VoiceRecordControls--lock"),null===(t=n.elements.controls)||void 0===t||t.classList.add("VoiceRecordControls--locked"),n.initialized&&(i.setStyle.animate(n.elements.lock,"transform",{duration:150,func:"ease"}),i.setStyle.animate(n.elements.duration,"transform",{duration:150,func:"ease"}));var o=function(){if(n.updatePanel(),n.elements.lockIcon&&(n.elements.lockIcon.innerHTML=l.default.html((0,d.default)({icon:(0,m.getStop20Icon)()}))),n.elements.lock&&(n.elements.lock.setAttribute("tabindex","0"),n.elements.lock.setAttribute("role","button")),n.elements.float&&(n.elements.float.setAttribute("tabindex","0"),n.elements.float.setAttribute("role","button"),n.elements.float.focus()),n.elements.controls){var e=(0,h.setFocusTrap)(n.elements.controls);e&&(n.cancelFocusTrap=e,n.cancelFocusTrap.exitIntent=function(){return n.cancel(!0)})}};n.initialized?i.setStyle.animate(n.elements.float,"transform",{duration:200,func:"ease"},(function(){o()})):o(),n.moveElements([n.transitionData.maxX,n.transitionData.minY])}else n.moveElements([n.transitionData.maxX,n.transitionData.minY])},this.onGlobalClick=function(e){if("preview"!==n.state)return n.moving?(e.preventDefault(),e.stopPropagation(),void(n.getDuration()?n.cancel(!0):n.lock())):void(!e.target||e.target.closest(".VoiceRecordControls")||e.target.closest(".uMailWrite__buttonSend")||e.target.classList.contains("uMailWrite__buttonSend")||(e.preventDefault(),e.stopPropagation(),n.getDuration()<=0?n.cancel(!0):n.showPreview()))},this.onTouchMove=function(e){var t,i,o,a,r,s;if("suspended"===(null===(t=n.recorder)||void 0===t?void 0:t._ctx.state)&&(null===(a=null===(i=n.recorder)||void 0===i?void 0:(o=i._ctx).resume)||void 0===a||a.call(o)),"moving"===n.state){n.moving=!0;var l=e.touches[0];null===(r=n.elements.controls)||void 0===r||r.classList.toggle("VoiceRecordControls--cancel",n.isTouchCancel(l)),n.moveElements([l.pageX,l.pageY]),null===(s=n.elements.controls)||void 0===s||s.classList.toggle("VoiceRecordControls--lock",n.needLock)}},this.onTouchEnd=function(e){var t;if("moving"===n.state){n.moving=!1;var i=n.isTouchCancel(e.changedTouches[0]);(null===(t=n.recorder)||void 0===t?void 0:t._aquireing)||n.needLock&&!i?n.lock():i||n.getDuration()<=0?n.cancel():n.send()}},this.onFloatClick=function(){"locked"===n.state&&n.send()},this.onResize=function(){n.calculateTransitionData(),n.lock()},this.onCancel=function(){n.cancel(!0)},this.onStop=function(){n.getDuration()>0?n.showPreview():n.cancel(!0)},this.onProgress=function(){if(n.recorder&&n.recorder._waveData){var e=n.recorder._waveData[n.recorder._waveData.length-1];n.applyVolume(e/.5)}n.setDuration((0,s.formatDuration)(n.getDuration())||"0:00")},this.onRecordStart=function(){n.elements.controls&&n.elements.controls.classList.add("VoiceRecordControls--recording")},this.onVisibilityChange=function(){document.hidden&&"moving"===n.state&&n.lock()},this.stopRecording=function(){n.recorder&&n.recorder.isRecording&&n.recorder._stream&&n.recorder.stop()},this.detachEvents=function(){(0,i.removeEvent)(n.elements.initialElement,"touchmove",n.onTouchMove),(0,i.removeEvent)(n.elements.initialElement,"touchend",n.onTouchEnd),(0,i.removeEvent)(window,"click",n.onGlobalClick,{capture:!0}),(0,i.removeEvent)(window,"resize",n.onResize),document.removeEventListener("visibilitychange",n.onVisibilityChange,!1),window.Speech&&(window.Speech.onRecordProgress.off(n.onProgress),window.Speech.onRecordStart.off(n.onRecordStart),window.Speech.onCancel.off(n.onCancel),window.Speech.onStop.off(n.onStop))},this.send=function(){if(!(n.isSending||n.getDuration()<=0)){n.isSending=!0;var e=function(){if(n.onFinish(),(0,i.removeEvent)(n.recorder,"finish",e),n.audioMessagePreviewData&&n.previewBuffer){var t=(0,g.getFormData)(n.audioMessagePreviewData.waves,n.previewBuffer,n.previewBuffer.type);n.onSend(t,n.recordingID)}else{t=n.recorder.getFormData();n.onSend(t,n.recordingID)}};window.Speech&&n.audioMessagePreviewData&&window.Speech.saveRecordingBuffer(n.audioMessagePreviewData.bufferKey,null),(0,i.statlogsValueEvent)("mvk_audio_messages_event",null,"send"),!n.audioMessagePreviewData&&n.recorder.isRecording?((0,i.addEvent)(n.recorder,"finish",e),n.stopRecording(),n.destroy()):(e(),n.destroy(!0))}},this.cancel=function(e){void 0===e&&(e=!1),(0,i.statlogsValueEvent)("mvk_audio_messages_event",null,"cancel"),window.clog("[VoiceRecorder] Voice send cancelled"),n.stopRecording(),n.destroy(e)},this.destroy=function(e){var t;void 0===e&&(e=!1),n.audioMessagePreviewData=void 0,n.previewBuffer=void 0,null===(t=n.elements.controls)||void 0===t||t.classList.add("VoiceRecordControls--destroying"),n.detachEvents(),v.screenWakeLocker.unlock();var o=function(){n.cancelFocusTrap&&n.cancelFocusTrap(),(0,i.remove)(n.elements.controls),n.elements.previewPlayer&&window.AudioMessagePlayer.togglePlay(n.elements.previewPlayer,null,!1),n.onDestroy()};e?o():setTimeout(o,250)},this.key=e,this.elements={},this.elements.appendElement=t}return e.prototype.clearCache=function(){window.Speech&&window.Speech.saveRecordingBuffer(this.key,null)},e}()},11878:function(e,t,n){"use strict";var i=n(3226),o=function(){this.onNarrativeChangedFromStoryView=(0,i.default)(),this.onNarrativeRemovedFromStoryView=(0,i.default)()};window.Narratives=new o},15e3:function(e,t,n){"use strict";var i=n(87625),o=n(40469);Object.assign(i.default,{onToggle:function(e){var t,n=null===(t=e.target)||void 0===t?void 0:t.closest(".NarrativesBlock");if(!n)return n;n.classList.toggle("NarrativesBlock--collapsed")},onCreateNarrativeClick:function(e,t,n){return(0,o.sendNarrativeAnalytic)(o.NarrativeAnalyticEventType.createNarrative,{ownerId:e},e>0?o.NarrativeAnalyticNavScreen.profile:o.NarrativeAnalyticNavScreen.club),window.nav.go(t,n)},onHeaderClick:function(e,t,n){return(0,o.sendNarrativeAnalytic)(o.NarrativeAnalyticEventType.openNarrativeList,{ownerId:e},e>0?o.NarrativeAnalyticNavScreen.profile:o.NarrativeAnalyticNavScreen.club),window.nav.go(t,n)},onShowMoreClick:function(e,t,n){return(0,o.sendNarrativeAnalytic)(o.NarrativeAnalyticEventType.seeMore,{ownerId:e},e>0?o.NarrativeAnalyticNavScreen.profile:o.NarrativeAnalyticNavScreen.club),window.nav.go(t,n)}})},91402:function(e,t,n){"use strict";n.d(t,{IPadBanner0:function(){return o}});var i=n(86658),o={close:function(e,t,n){e.preventDefault();var o=t.closest(".IPadBanner");o&&(o.remove(),i.default.post("/promo",{act:"ipad_close",hash:n,_ajax:1}))},open:function(e){i.default.post("/promo",{act:"ipad_open",hash:e,_ajax:1})}}},18249:function(e,t,n){"use strict";n.d(t,{manageStoryInNarratives:function(){return b}});var i,o,a,r,s=n(97316),l=n(61124),c=n(49050),u=n(11393),d=n(92505),_=n(46950),f=n(59219),p=n(49751),m=n(81755),h=n(92424),v=n(1730),g=n(9046),A=n(53502),y=n(40469),w=!1;function S(e){var t,n=this;this.pauseStory(),this._hideTooltips();var i=function(){p.default.setLoading((0,v.$)("#AddToNarrativeFromStoryViewSaveBtn"),!1),w=!1,l.default.close(o),n.hideMenu(),n.playStory()},a=(0,f.BtnStack)({inner:[(0,p.default)({children:(0,_.getLang)("mobile_narratives_create_popup_save_button_text"),disabled:!0,attrs:{id:"AddToNarrativeFromStoryViewSaveBtn"},onClick:function(){w||(p.default.setLoading((0,v.$)("#AddToNarrativeFromStoryViewSaveBtn"),!0),w=!0,window.ajax.post("narratives",{act:"publish",owner_id:e.ownerId,hash:e.publishNarrativeHash,cover_story_id:e.storyId,story_ids:e.storyId,title:t},{onDone:function(e){h.init({type:h.SNACKBAR_TYPE_SUCCESS,avatar:e.coverUrl,text:(0,_.getLangReplace)((0,_.getLang)("mobile_narratives_success_added_to_narrative"),{narrative_title:e.title})}),(0,y.sendNarrativeAnalytic)(y.NarrativeAnalyticEventType.publishNarrative,e,y.NarrativeAnalyticNavScreen.storyViewer),i()},onFail:function(e){return h.init({text:e||(0,_.getLang)("global_error"),type:h.SNACKBAR_TYPE_ERROR}),i(),!0}}))}}),(0,p.default)({theme:"secondary",children:(0,_.getLang)("mobile_narratives_create_popup_cancel_button_text"),onClick:function(){return i()}})]}),r=u.default.preactElem(l.default,{on_overlay_click_native:function(){return i()},scrollable:!0,header:{title:(0,_.getLang)("mobile_narratives_create_popup_title")},footer:a,inner:[{inner:(0,_.getLang)("mobile_narratives_create_popup_description"),style:"margin-bottom: 10px"},(0,m.default)({placeholder:(0,_.getLang)("mobile_narratives_create_popup_title"),maxlength:e.narrativeTitleMaxLength,on_change:function(e){t=e.currentTarget.value.trim(),p.default.setDisabled((0,v.$)("#AddToNarrativeFromStoryViewSaveBtn"),!t.length)}})]});o=l.default.open(r,!0,{withoutCloning:!0})}function b(){var e,t=this;this.pauseStory(),this._hideTooltips();var o=function(){p.default.setLoading((0,v.$)(".NarrativesListActions__action--save"),!1),w=!1,l.default.close(i),t.hideMenu(),t.playStory()},f=[],m=this.getCurrentStory(),b=(0,s.__read)(null===(e=null==m?void 0:m.raw_id)||void 0===e?void 0:e.split("_").map(Number),2),k=b[0],C=b[1],E=function(){var e=null,n=u.default.preactElem(d.default,{contentId:"StoriesArchiveNarrativeSelector",title:(0,_.getLang)("mobile_narratives_selector_page_title"),onLeftActionClick:function(){return o()}});u.default.mountPreactComponent(r,{ownerId:k,selectedStoryId:C,isCreateBtnVisible:!0,disablePreview:!0,forceActionsVisible:!0,customOnScrollForAutoScroller:function(t){return e=t},onNarrativeCheckChanged:function(e,t){var n,i=null===(n=e.stories)||void 0===n?void 0:n.some((function(e){return e.id===C}));f=f.filter((function(t){return t.narrative_id!==e.id})),t?i||f.push({op:c.BatchOperationType.Add,story_id:C,narrative_id:e.id,narrative_title:e.title,narrative_cover_url:e.coverUrl}):i&&f.push({op:c.BatchOperationType.Delete,story_id:C,narrative_id:e.id,narrative_title:e.title,narrative_cover_url:e.coverUrl}),p.default.setDisabled((0,v.$)(".NarrativesListActions__action--save"),Boolean(!f.length))},onCreateBtnClick:function(){return l.default.close(i),(0,y.sendNarrativeAnalytic)(y.NarrativeAnalyticEventType.createNarrative,{ownerId:k},y.NarrativeAnalyticNavScreen.storyViewer),S.call(t,{storyId:C,ownerId:k,publishNarrativeHash:a.publishNarrativeHash,narrativeTitleMaxLength:a.narrativeTitleMaxLength})},isSelectActionAvailable:!0,isSaveActionAvailable:!0,forceFirstLoading:!0,onSaveClick:function(){if(!w){p.default.setLoading((0,v.$)(".NarrativesListActions__action--save"),!0),w=!1;var e=f.map((function(e){return{op:e.op,story_id:e.story_id,narrative_id:e.narrative_id}}));window.ajax.post("narratives.php",{act:"batch_edit",owner_id:k,operations:JSON.stringify(e),hash:a.editNarrativeHash},{onDone:function(){var e=[],t=[];f.forEach((function(n){switch(n.op){case c.BatchOperationType.Add:e.push(n);break;case c.BatchOperationType.Delete:t.push(n)}}));var n=e.length,i=t.length,a="",r=null;if(n)if(1===n){var s=e[0];r=s.narrative_cover_url,a=(0,_.getLangReplace)((0,_.getLang)("mobile_narratives_success_added_to_narrative"),{narrative_title:s.narrative_title})}else a=(0,_.getLangNumeric)(n,(0,_.getLang)("mobile_narratives_story_added_to_narratives","raw"));else i&&(a=(0,_.getLangNumeric)(i,(0,_.getLang)("mobile_narratives_story_removed_from_narratives","raw")));a&&h.init({type:h.SNACKBAR_TYPE_SUCCESS,avatar:r,text:a}),(0,y.sendNarrativeAnalytic)(y.NarrativeAnalyticEventType.addStoryToNarrative,{ownerId:k},y.NarrativeAnalyticNavScreen.storyViewer),o()},onFail:function(e){return h.init({text:e||(0,_.getLang)("global_error"),type:h.SNACKBAR_TYPE_ERROR}),o(),!0}})}}},(0,v.$)("#StoriesArchiveNarrativeSelector",n)),i=l.default.open(n,!0,{withoutCloning:!0});var s=(0,v.$)(".ModalPage__content",n);null==s||s.addEventListener("scroll",(function(t){null==e||e((0,g.getY)(t.currentTarget)+t.currentTarget.scrollTop)}))};(function(e){return new Promise((function(t,n){a?t(a):window.ajax.post("narratives.php",{act:"choose_box_data",owner_id:e},{onDone:function(e){t(a=e)},onFail:function(e){return n(e),!0}})}))})(k).then((function(e){return Promise.all([Promise.all([n.e(4736),n.e(3079),n.e(4617)]).then(n.bind(n,41272)).catch((function(e){return(0,g.statlogsValueEvent)("mvk_narratives_event",null,"chunk_error",e.name)})),(0,A.addStatic)([e.narrativesCssPath])]).then((function(e){var t=(0,s.__read)(e,1)[0];r=t&&(null==t?void 0:t.NarrativesList),E()}))})).catch(console.error)}},42016:function(e,t,n){"use strict";var i=n(97316),o=n(11393),a=n(3226),r=n(82470),s=n(62691),l=n(1730),c=n(65287),u=n(36162),d=n(21965),_=n(77858),f=n(34256),p=n(69756),m=n(61124),h=n(49751),v=n(86205),g=n(92424),A=n(9046),y=n(78869),w=n(46950),S=n(86353),b=n(14561),k=n(11386),C=n(72018),E=n(28859),I=n(18249),T=n(38383),M=n(84347),P=n(70675),L=n(40469),N=n(55667),R=n(12813),x=n(97398),B="StoryAuthor_current",D="Stories_paused",O="Stories_inited",U="Stories_touchMove",H="vk__story_open",F="Stories_menuOpened",V="Stories_commentOpened",j="Stories_questionOpened",$="Story__commentSend_active",q="Stories__flash_show",W=1.5,G=function(){function e(){var e=this;this.opened=!1,this.onRender=(0,a.default)(),this.init=function(t,n){void 0===n&&(n={}),e.params=Object.assign({replace:!1,reply:!1,replyTo:!1,restore:!1,forceAuthorIndex:!0},n);var o=(0,i.__read)(e._parseList(t).split("/"),3),a=o[0],r=o[1],s=o[2],l=(0,i.__read)(a.split("_"),1)[0];(null==n?void 0:n.id)?l=n.id:(null==n?void 0:n.narrativeRawId)&&(l=n.narrativeRawId),e.initTrackCode=e.params.trackCode,e.initRaw=t,e.storyOwner=l,e.storyRaw=a,e.storyExtra=s,e.storyList=r,e.storyExtraObj=e.parseExtra(e.storyExtra),e.needAudioRestore=window.audio.playing(),e.Views={},e.popoutOpen=!1,e.slideTimer=null,e.createLayer(),e._initStore(),e.isMuted=!1,e.detectAutoplay().then((function(){e.isRestored?e._init():e.isPreloadedListExists()?(e.initList(e.storyList,window.store.storiesLists[e.storyList]),e._init()):e._requestList().then((function(t){var n=t.items,i=t.list;n&&(e.initList(i,n),e._init())}),(function(){}))})).catch(console.error)},this.hideFlashPopup=function(t){var n;void 0===t&&(t=!1),t&&e.playStory(),clearTimeout(e.flashTimer),clearTimeout(e.flashHideTimer);var i=null===(n=e.layer)||void 0===n?void 0:n.querySelector(".Stories__flash");(0,A.removeClass)(i,q)},this.onTouchMove=function(t){var n,i=0,o=0;"touchmove"===t.type&&(i=e.tapStartX-t.changedTouches[0].clientX,o=e.tapStartY-t.changedTouches[0].clientY),null===e.isYmove&&(e.isYmove=Math.abs(i)<Math.abs(o),e.isYmove&&(null===(n=e.layer)||void 0===n||n.classList.add(U))),e.isYmove?e.onVerticalSwipe(-o/W):e.onVerticalSwipe(0)},this.onTouchEnd=function(t,n){var i;void 0===n&&(n=!1),clearTimeout(e.isTapTimer);var o=e.getCurrentAuthor();if(o){var a=o.story;e.isTap||e.sendAnalyticsEvent("resume_release");var r,s;"touchend"===t.type?(r=t.changedTouches[0].clientX,s=t.changedTouches[0].clientY):(r=t.clientX,s=t.clientY),(Math.abs(e.tapStartX-r)>20||Math.abs(e.tapStartY-s)>20)&&(e.isTap=!1),(0,A.removeClass)(e.layer,U),(0,A.setStyle)(e.sliderEl,"opacity",1),A.setStyle.transform(e.sliderEl,1,[0,0]),A.setStyle.transform(document.querySelector(".Story__moreLink"),1,[0,0]);var l=null===(i=t.target)||void 0===i?void 0:i.classList.contains("Story__sticker"),u=(0,A.domData)(t.target,"id"),d=Number((0,A.domData)(t.target,"type"));if(l&&e.sendAnalyticsEvent("click_on_clickable_sticker",{clickable_sticker:{id:u,type:c.StickerTypeLabel[d]}}),e.needGoToLink){var _=e.getCurrentAuthor().story;if(e.needGoToLink=!1,_&&_.hasLink())return void e.openCustomButton(t)}if(e.needClose)return e.sendAnalyticsEvent("close_swipe_down"),void e.close();if(e.tooltip)e._hideTooltips();else{if(e.isTap){var f=e.getCurrentAuthor();if(!f)return;var p=f.getCurrentStory();if(l){var m=(0,A.domData)(t.target,"app-id"),h=(0,A.domData)(t.target,"pollId"),v=(0,A.domData)(t.target,"pollOwnerId"),g=(0,A.domData)(t.target,"situational-app-id"),y=(0,A.domData)(t.target,"situational-theme-id");if((0,A.removeClass)(e.layer,D),(0,A.domData)(t.target,"question"))e.askQuestionBox(t);else if(m)e.clickToApp();else if(h&&v)e.openPoll(v,h,a.raw_id);else if(g&&y)e.openSituationalApp(g,y);else{var w=a._createStickerLink(t.target,{id:u,type:d});e.tooltip?e._hideTooltips():e._showTooltip(t,w)}return}if(n){if(null==p?void 0:p.isOneTime)return;e.sendAnalyticsEvent("go_to_previous_story"),e.prevStory()}else{if(e.sendAnalyticsEvent("go_to_next_story_tap"),null==p?void 0:p.isOneTime)return e.close(),void(0,A.cancelEvent)(t);e.nextStory()}}e._hideTooltips(!0),e.hideMenu()}}},this.markSeenStory=function(t){void 0===t&&(t=!1);var n=e.getCurrentAuthor();if(n){var i=e._getSource(),o=n.getCountDown(),a=n.getCurrentStory(),r=0;!o||e.store.readedStories[null==a?void 0:a.raw_id]&&!t||((null==a?void 0:a.isOneTime)&&(r=(null==a?void 0:a.progress)?a.progress:Math.max(Math.round(a.getProgressPercentByLeftTime(o.left)),1)),window.ajax.post("stories.php",{_ajax:1,act:"read_stories",hash:e.store.authors[0].read_hash,story_id:null==a?void 0:a.raw_id,track_code:(null==a?void 0:a.track_code)?a.track_code:"",source:i,progress:r,navigation_stats:(0,f.serializeNavigationStats)(),loading_stats:(0,f.serializeLoadingStats)(),connection_type:(0,f.getConnectionType)()}),t?e.setAllAuthorStoriesReaded(e.getCurrentAuthorIndex()):(e.store.authors[e.getCurrentAuthorIndex()].items[e.getCurrentStoryIndex()].unread=!1,e.store.readedStories[null==a?void 0:a.raw_id]=!0),e.updateOwnerAvatarsWithStories())}},this._requestUpdateFeedBlock=function(){var t=e.store,n=Object.keys(t.readedStories),i=e._getSource();(n.length||e._needFeedUpdate)&&"feed"===i&&(e._needFeedUpdate=!1,setTimeout((function(){e._requestFeedBlock()})))},this._requestFeedBlock=function(){var t=window.nav.getQuery();window.store.storiesLayers.length||window.ajax.post("stories.php",{_ajax:1,act:"feed_block",q:t.q},{onDone:function(t,n){var i=document.getElementById("StoriesFeedBlock");i&&(0,A.replace)((0,A.ceFromString)(t),i),e.pushPreloadedList(n)}})},this._sendMessage=function(t,n,i,o){var a=window.ajax.post("mail.php",{_ajax:1,act:"send",entrypoint:"stories_comment",hash:t,media:n,message:i,to:o},{onDone:function(){e.showFlashPopup(window.lang.mobile_stories_comment_success),e.sendAnalyticsEvent("comment_send")}});e._saveRequest(a)},this.share=function(t,n){void 0===n&&(n=!1);var i=e.getCurrentAuthor(),o=e.getCurrentNarrative();if(i){var a=null==o?void 0:o.isOwnerClosedGroup,r=null==o?void 0:o.isGroupEditor;e.stopStory(),e.getFrom();var s=n?"narrative":"story";e.stopStory(),window.Share(t,{mail_hash:e.getCurrentStory().share_hash,object:s+t,is_bookmarked:null==o?void 0:o.isBookmarked,bookmark_hash:null==o?void 0:o.bookmarkHash,bookmark_type:31,can_bookmark:n,can_to_own:n&&!a,can_to_club:n&&(!a||r)}),window.cur.share.onClose((function(){e.playStory()}))}},this.clickClose=function(){requestAnimationFrame((function(){e.sendAnalyticsEvent("close_tap"),e.close()}))},this.destroy=function(){var t;if(e.restoreAudio(),e.store){e.slider=null,e.hideMenu(!1),e.markSeenStoryIfNeeded(),e._abortRequests(),(0,A.removeClass)(e.layer,O);var n=e.getCurrentAuthorIndex(),i=e.getCurrentAuthor(),o=i&&i.getCurrentStory();if(o&&o.isOneTime&&e._removeList(),void 0!==n&&e.Authors)e.Authors[n].destroy();e.onRender.off(),(0,A.remove)(e.layer),e._requestUpdateFeedBlock(),Object.keys(e).forEach((function(t){"store"!==t&&"supportAutoplay"!==t&&"function"!=typeof e[t]&&(e[t]=null,delete e[t])})),window.zlayer.close(),null===(t=document.getElementById("StoriesFeedBlock"))||void 0===t||t.classList.add("StoriesFeedBlock_been-open"),(0,A.removeClass)(document.body,H),e.opened=!1;var a=document.querySelector(".Question__popup .Popup__overlay");a&&p.default.close(a)}},this.sendAnalyticsEvent=function(t,n){void 0===n&&(n={});var o=e.getCurrentStory();if(o){var a=e.getCurrentNarrative(),r=e.getCurrentAuthor(),s=e.getCurrentStoryIndex(),l=e._getSource(),c=o.is_groups_meta_story||o.is_apps_meta_story,u=(0,i.__read)(o.raw_id.split("_"),2),d=u[0],_=u[1],f=0;c&&(d="0",_="0"),"groups"!==e.storyList&&"apps"!==e.storyList||(f=1);var p={event_type:t,story_owner_id:Number(d),story_id:Number(_),time:window.vk.ts+Math.floor(((new Date).getTime()-window.vk.started)/1e3),view_entry_point:l,nav_screen:window.cur.module,story_type:c?"group_feed":"",is_grouped:f,track_code:o.track_code,narrative_id:"view_story"===t&&a?a.id:void 0};if(r){var m=r.feedItem,h=r.getCountDown();h&&m&&Object.assign(p,{stories_author_before:s,stories_author_after:m.items.length-s,view_event_timeline_position:h.initialTime-h.left})}Object.assign(p,n),(0,S.partConfigEnabled)("web_stats_transport_story_view")?(0,b.saveStoryViewStats)(p):(0,A.statlogsValueEvent)("story_product_analytics",p)}},this.askQuestionBox=function(t){var n;(0,A.cancelEvent)(t);var i=e.getCurrentStory().can_ask;if(e.hideFlashPopup(!1),e._hideTooltips(),!i)return e.showFlashPopup(window.lang.mobile_stories_ask_question_forbidden),!1;e.stopStory(),null===(n=e.layer)||void 0===n||n.classList.add(j);var o=e.authors[e.store.authorIndex],a=null==o?void 0:o.querySelector(".Story__questionTextarea");requestAnimationFrame((function(){null==a||a.focus()}))},this.changeQuestionMode=function(e,t){var n=document.querySelector(".Story__questionSelect");switch(t){case N.QUESTION_SELECT_MODE.PUBLIC:(0,A.val)(n,window.lang.mobile_stories_ask_question_public),(0,A.domData)(n,"selected",N.QUESTION_SELECT_MODE.PUBLIC);break;case N.QUESTION_SELECT_MODE.AUTHOR_ONLY:(0,A.val)(n,window.lang.mobile_stories_ask_question_author_only),(0,A.domData)(n,"selected",N.QUESTION_SELECT_MODE.AUTHOR_ONLY);break;case N.QUESTION_SELECT_MODE.ANONYMOUS:(0,A.val)(n,window.lang.mobile_stories_ask_question_anonymous),(0,A.domData)(n,"selected",N.QUESTION_SELECT_MODE.ANONYMOUS)}p.default.close(e)},this.hideAskQuestion=function(t){void 0===t&&(t=!0),e.store.showMenu=!1,(0,A.removeClass)(e.layer,j),t&&e.playStory()},this.sendQuestion=function(){var t=e.getCurrentAuthorEl();if(t){var n=null==t?void 0:t.querySelector(".Story__questionTextarea"),o=null==t?void 0:t.querySelector(".Story__questionSend"),a=e.getCurrentStory(),r=a.raw_id,s=a.askQuestionHash,l=(0,i.__read)(r.split("_"),2),c=l[0],u=l[1],d=(0,A.trim)((0,A.val)(n)),_=document.querySelector(".Story__questionSelect"),f=+(0,A.domData)(_,"selected"),p=!1,m=!1;f===N.QUESTION_SELECT_MODE.PUBLIC?p=!0:f===N.QUESTION_SELECT_MODE.ANONYMOUS&&(m=!0),(0,A.val)(n,""),o&&(o.disabled=!0);var h=window.ajax.post("stories.php",{_ajax:1,act:"ask_question",story_owner_id:c,story_id:u,question_text:d,is_anonymous:+m,with_mention:+p,hash:s},{onDone:function(t){if(!t)return e.showFlashPopup(window.lang.mobile_stories_question_error),!1;var n=e.getCurrentAuthor().feedItem.author;switch(e.showFlashPopup(window.lang.mobile_stories_question_sent.replace("{name}",n.first_name_ins)),f){case N.QUESTION_SELECT_MODE.PUBLIC:e.sendAnalyticsEvent("question_reply_publish");break;case N.QUESTION_SELECT_MODE.AUTHOR_ONLY:e.sendAnalyticsEvent("question_reply");break;case N.QUESTION_SELECT_MODE.ANONYMOUS:e.sendAnalyticsEvent("question_reply_anonymous")}}});e._saveRequest(h),e.hideAskQuestion()}},this.removeQuestion=function(t,n){var i=e.getQuestionById(n),o=i.storyOwnerId,a=i.storyId,r=i.id,s=i.removeHash;window.ajax.post("stories.php",{_ajax:1,act:"remove_question",story_owner_id:o,story_id:a,question_id:r,remove_hash:s},{onDone:function(i){var s=o+"_"+a;if(p.default.close(t),!i)return requestAnimationFrame((function(){return e.showFlashPopup(window.lang.mobile_stories_question_error)})),!1;(0,l.$$)('.Question[data-id="'+n+'"]').forEach((function(e){return(0,A.re)(e)})),e.store.questions[s]=e.store.questions[s].filter((function(e){return e.id!==n})),(0,l.$$)(".Question").length<1&&(0,A.re)(document.querySelector(".Views__questions")),e.sendAnalyticsEvent("question_delete",{questionId:r})}})},this.replyQuestionBox=function(t,n){var i,a=e.getCurrentStory(),r=e.getQuestionById(n),s=r.author,l=r.text,c=window.lang.mobile_stories_question_reply_title.replace("{name}",s.nameGen),u=o.default.elem({className:"QuestionReplyPopup",inner:[{className:"QuestionReplyPopup__inner",inner:[{className:"QuestionReplyPopup__header",inner:[{class:"QuestionReplyPopup__preview",style:"background-image: url("+a.small_preview+")"},{className:"QuestionReplyPopup__top",inner:[{className:"QuestionReplyPopup__title",inner:c},{className:"QuestionReplyPopup__question",inner:l}]}]},{className:"QuestionReplyPopup__content",inner:[{class:"QuestionReplyPopup__textarea",tag:"textarea",placeholder:window.lang.mobile_stories_comment_textarea,oninput:"Stories.onInputReplyQuestion(this);"}]},{className:"QuestionReplyPopup__footer",inner:[(0,h.default)({className:"QuestionReplyPopup__send",theme:"regular",children:window.lang.mobile_stories_question_reply_to_message,on_click:["Stories.sendReplyQuestion",n],disabled:!0}),(0,h.default)({className:"QuestionReplyPopup__cancel",theme:"link",children:window.lang.mobile_stories_comment_cancel,on_click:["Stories.hideReplyQuestion"]})]}]}]});null===(i=e.popout)||void 0===i||i.appendChild(u),p.default.close(t)},this.hideReplyQuestion=function(){var t;(0,A.re)(null===(t=e.popout)||void 0===t?void 0:t.querySelector(".QuestionReplyPopup"))},this.onInputReplyQuestion=function(e){(0,l.$)(".QuestionReplyPopup__send").disabled=!(0,A.trim)((0,A.val)(e))},this.sendReplyQuestion=function(t){var n=(0,A.trim)((0,A.val)(document.querySelector(".QuestionReplyPopup__textarea"))),i=e.getQuestionById(t),o=i.id,a=i.ownerId,r=i.storyOwnerId,s=i.storyId,l=i.sendHash,c="story"+r+"_"+s,u=n+"\n\n🗣 "+i.text,d=window.ajax.post("mail.php",{_ajax:1,act:"send",hash:l,media:c,message:u,to:a},{onDone:function(t){var n=t&&t.error?t.message:window.lang.mobile_stories_comment_success;e.showFlashPopup(n,!1),e.sendAnalyticsEvent("question_send_message",{questionId:o})}});e._saveRequest(d),e.hideReplyQuestion()},this.showQuestions=function(t){var n,i=new d.default(t).render();null===(n=e.popout)||void 0===n||n.appendChild(i),e.sendAnalyticsEvent("question_show_all")},this.banQuestion=function(t,n){var i=e.getQuestionById(n),o=i.storyOwnerId,a=i.storyId,r=i.banHash,s=i.isOwnerBlocked;window.ajax.post("stories.php",{_ajax:1,act:"ban_question",story_raw:o+"_"+a,question_id:n,ban_hash:r,is_blocked:+s},{onDone:function(o){if(!o)return p.default.close(t),void e.showFlashPopup(window.lang.mobile_stories_question_error,!1);if(!s){var a="question_ban_author";i.isAnonymous&&(a="question_ban_anonymous_author"),e.sendAnalyticsEvent(a,{questionId:n})}p.default.close(t),i.isOwnerBlocked=!s,e.showFlashPopup(s?window.lang.mobile_stories_question_author_unblocked:window.lang.mobile_stories_question_author_blocked,!1)}})},this.reportQuestion=function(t,n){var i=e.getQuestionById(n),o=e.getFrom();p.default.close(t),window.nav.go((0,R.getStoryQuestionReportUrl)({storyOwnerId:i.storyOwnerId,questionId:i.id,refrom:o}))},this.addMusic=function(t,n,i){window.audioplayer.add(n),p.default.close(t),e._hideTooltips(!0),e.showFlashPopup(i?window.lang.mobile_stories_music_deleted:window.lang.mobile_stories_music_added)},this.nextMusic=function(t,n){var i=window.audio,o=window.audioplayer,a=(0,y.asObject)(n);if(i.getCurrentId()){var r=i.playlist().map((function(e){return e.id})).indexOf(i.getCurrentId())+1;i.addToPlaylist([a],r)}else o.playPause(!1,a.fullId,!0),i.pause();p.default.close(t),e._hideTooltips()},this.toggleLikeForCurrentStory=function(t){var n=e.getCurrentStory(),i=e.getCurrentAuthor().story,a=n.raw_id,r=n.isLiked,s=n.likeHash,l={act:r?"delete_like":"like",hash:s,story_raw_id:a};i.isLiked=!r,n.isLiked=!r,t.innerHTML=r?o.default.html((0,v.default)((0,E.getLikeOutlineShadow48Icon)())):o.default.html((0,v.default)((0,C.getLikeShadow48Icon)())),(0,A.toggleClass)("Story__like--set",t,n.isLiked),window.ajax.post("stories.php",l,{onDone:function(a){a?(i.isLiked=r,n.isLiked=r,t.innerHTML=r?o.default.html((0,v.default)((0,C.getLikeShadow48Icon)())):o.default.html((0,v.default)((0,E.getLikeOutlineShadow48Icon)())),(0,A.toggleClass)("Story__like--set",t,n.isLiked)):e.sendAnalyticsEvent(r?"click_to_unlike":"click_to_like")}})},this.clickToApp=function(){var t=e.getCurrentStory(),n=t.raw_id,o=void 0===n?"":n,a=t.clickable_stickers,r=a&&a.stickers.find((function(e){return e.type===c.StickerTypes.app}));if(r&&r.appId){var s=(0,i.__read)(o.split("_"),2),l=s[0],u=s[1];r.hasNewInteractions&&window.ajax.post("stories.php",{act:"mark_app_notifications_seen",owner_id:l,story_id:u,sticker_id:r.id,hash:r.hash},{onDone:function(){var e;r.hasNewInteractions=!1,null===(e=document.querySelector(".Story__app"))||void 0===e||e.classList.remove("has_new")}}),e.pauseStory(),e.showLoading(),window.nav.go("/app"+r.appId+"?ref="+r.appRef+"&hash="+r.appHash)}},this.openPoll=function(t,n,i){var o="/poll"+t+"_"+n+"?from=story"+i+"&story_raw="+i;window.nav.go(o),e.showLoading()},this.openSituationalApp=function(t,n){e.pauseStory(),e.showLoading(),window.location.href="/app"+t+"#"+n}}return e.prototype.parseExtra=function(e){var t={},n=String(e).split(";");return n.forEach((function(e,o){if(n.hasOwnProperty(o)){var a=(0,i.__read)(n[o].split(":"),2),r=a[0],s=a[1];r&&s&&(t[r]=s)}})),t},e.prototype.isPreloadedListExists=function(){var e,t;return Boolean(null===(t=null===(e=window.store)||void 0===e?void 0:e.storiesLists)||void 0===t?void 0:t[this.storyList])},e.prototype.initList=function(e,t){t&&(this.store.authors=t,this.store.listLoaded=!0,this.store.list=e,this.store.inited=!0)},e.prototype.pushPreloadedList=function(e){var t=(0,A.parseJSON)(e);window.store||(window.store={}),window.store.storiesLists||(window.store.storiesLists={}),Object.assign(window.store.storiesLists,t),window.store.stories||(window.store.stories={}),Object.keys(t).forEach((function(e){window.store&&window.store.storiesLayers&&window.store.storiesLayers.includes(e)||delete window.store.stories[e]}))},e.prototype._init=function(){var e,t=this;this.createAuthors();var n=this.getFirstStoryIndex();this.setCurrentStory(n);var i=this.getCurrentStory();this.params.restore||this.setHistory(i.raw_id,{nav_init:!0,replace:Boolean(this.params.replace),no_open:!1}),this.sliderEl=document.getElementById("StoriesSlider"),this.slider=(0,r.default)(this.sliderEl,{speed:300,startSlide:this.getCurrentAuthorIndex(),onSlideChange:function(e){if(t.slider){e=t.slider&&(0,A.intval)(t.slider.getCurrentPos());var n=t.getCurrentAuthorIndex(),i=t.getCurrentAuthor().feedItem;clearTimeout(t.slideTimer),void 0!==e&&e!==n&&(t.markSeenAllOwners(),!1===t.isTap&&(e>n?t.sendAnalyticsEvent("go_to_next_author"):t.sendAnalyticsEvent("go_to_previous_author"),i.is_groups||i.is_apps||t.markSeenStory(!0)),t.setCurrentAuthor(e),t.slideTimer=setTimeout((function(){t.renderStory()}),300)),delete t.isTap}},onSetup:function(){var e;null===(e=t.layer)||void 0===e||e.classList.add(O),t.renderStory()}}),this.Authors&&1===this.Authors.length&&(null===(e=this.layer)||void 0===e||e.classList.add(O),this.renderStory()),this.store.showViews&&this.showViews(i.raw_id,!0),this._initViewerSource(),this._sendOpeningEvents()},e.prototype._initStore=function(){window.store||(window.store={stories:{},storiesLayers:[]}),window.store.stories||(window.store.stories={}),window.store.storiesLayers||(window.store.storiesLayers=[]),window.store.stories[this.storyList]&&window.store.stories[this.storyList].inited?(this.store=window.store.stories[this.storyList],this.isRestored=!0):(this.store={authors:[],listLoaded:!1,readedStories:{},_requests:[],viewers:{},questions:{},viewersState:{},extendedStats:{},replies:{},polls:{},showMenu:!1,storyList:this.storyList,initRaw:this.initRaw,storyIndex:0,authorIndex:0,isReply:Boolean(this.params.reply),replyTo:String(this.params.replyTo),inited:!1},window.store.stories[this.storyList]=this.store,this.isRestored=!1),this.params.restore||window.store.storiesLayers.push(this.store.storyList)},e.prototype._initViewerSource=function(){var e=this._getSource();switch(e){case"reply":this.viewerSource="replies_list";break;case"feed":this.viewerSource=window.cur.module;break;default:this.viewerSource=e}},e.prototype._sendOpeningEvents=function(){var e=this._getSource();if(e){var t;switch(e){case"narrative_story":t="narrative_open_stories";break;case"narrative_snippet":case"narrative_link":t="narrative_open";break;case"narrative_recommendations":t="narrative_other"}if(t&&this._sendNavigationStatEvents(t),"narrative_fave"===e){var n=this.getCurrentNarrative();if(!(null==n?void 0:n.ownerId)||!(null==n?void 0:n.id))return;(0,A.statlogsValueEvent)("bookmarks_product_analytics",{item_type:"narrative",item_owner_id:(0,A.intval)(null==n?void 0:n.ownerId),item_id:(0,A.intval)(null==n?void 0:n.id),time:window.vk.ts+Math.floor(((new Date).getTime()-window.vk.started)/1e3)})}}},e.prototype._abortRequests=function(){var e;(0,w.isArray)(this.store._requests)&&(null===(e=this.store._requests)||void 0===e||e.forEach((function(e){e.abort()}))),this.store._requests=[]},e.prototype._saveRequest=function(e){this.store._requests.push(e)},e.prototype.getStore=function(){return this.store},e.prototype.setAllAuthorStoriesReaded=function(e){var t=this,n=[];this.store.authors[e].items.forEach((function(e){if(e.unread){e.unread=!1;var i=e.raw_id;e.track_code&&(i+="_"+e.track_code),t.store.readedStories[i]=!0,n.push(e.raw_id)}})),n.length&&this.markSkippedStories(n)},e.prototype.markSeenAllOwners=function(){var e=this.getCurrentAuthor().feedItem;if(e.is_groups||e.is_apps){var t=window.store.stories[e.is_groups?"groups":"apps"];if(t){var n=[];t.authors.forEach((function(e){return e.items.forEach((function(e){n.push(e.raw_id),e.unread=!1}))})),this.markSkippedStories(n),this._needFeedUpdate=!0}}},e.prototype.markSkippedStories=function(e){window.ajax.post("stories.php",{_ajax:1,act:"mark_skipped",hash:this.store.authors[0].read_hash,stories:e.join(",")})},e.prototype.createAuthors=function(){var e,t,n,i,o=this,a="";this.Authors=[];var r=this.getCurrentAuthorIndex();this.isRestored&&!this.params.forceAuthorIndex||(r=this.getFirstAuthorIndex());var s=this.store.authors[r],l=!(null===(e=this.params)||void 0===e?void 0:e.narrativeRawId)&&s.items[s.items.length-1].unread;if(this.storyExtraObj)switch(this.storyExtraObj.context){case"new":l=!0;break;case"all":l=!1}null===(t=this.store.authors)||void 0===t||t.forEach((function(e,t){var n=e.items;if(!t||!l||n[n.length-1].unread){var i=new c.StoryAuthor(t,e);o.Authors.push(i),a+=i.renderEmpty()}})),(0,A.val)(null===(n=this.layer)||void 0===n?void 0:n.querySelector(".Stories__authors"),a),this.authors=Array.from(this.layer.getElementsByClassName("StoryAuthor")),null===(i=this.Authors)||void 0===i||i.forEach((function(e){e.updateHeader()})),this.setCurrentAuthor(r)},e.prototype.getFirstStoryIndex=function(){var e=this,t=this.store.authors[this.getCurrentAuthorIndex()];if(this._hasContext("all"))return 0;if(!this._hasContext("new")){var n=t.items.findIndex((function(t){return t.raw_id===e.storyRaw}));if(-1!==n)return n;var i=t.items.findIndex((function(e){return e.unread}));return-1!==i?i:0}return this.getCurrentStoryIndex()},e.prototype.getFirstAuthorIndex=function(){var e=this,t=this.store.authors.findIndex((function(t){var n=t.author.id;return t.id&&e.params.id&&(n=t.id),t.narrative&&(n=t.narrative.rawId),String(n)===String(e.storyOwner)}));return-1!==t?t:0},e.prototype.getCurrentAuthorIndex=function(){return this.store.authorIndex},e.prototype.getCurrentStoryIndex=function(){return this.store.authors[this.getCurrentAuthorIndex()].index||0},e.prototype.getCurrentStory=function(){var e;return null===(e=this.store.authors[this.getCurrentAuthorIndex()])||void 0===e?void 0:e.items[this.getCurrentStoryIndex()]},e.prototype.getCurrentNarrative=function(){return this.store.authors[this.getCurrentAuthorIndex()].narrative},e.prototype.setCurrentNarrative=function(e){var t=this.store.authors;if(t){var n=t[this.getCurrentAuthorIndex()];n&&(n.narrative=e)}},e.prototype.setCurrentAuthor=function(e){this.store.authorPrevIndex=this.store.authorIndex,this.store.authorIndex=e,this.updateCurrentAuthor()},e.prototype.setCurrentStory=function(e){this.store.authors[this.getCurrentAuthorIndex()].index=e},e.prototype.drawSiblingPreview=function(){for(var e=this.getCurrentAuthorIndex(),t=-2;t<=2;t++){var n=e+t;this.authors[n]&&n!==e&&this.drawPreview(this.authors[n])}},e.prototype.drawPreview=function(e){(0,A.setStyle)(e,"background-image","url("+e.getAttribute("data-src")+")")},e.prototype.updateCurrentAuthor=function(){var e,t=this.authors[this.store.authorIndex];null===(e=this.authors)||void 0===e||e.forEach((function(e){(0,A.removeClass)(e,B)})),null==t||t.classList.add(B)},e.prototype.getSizes=function(){var e,t,n,i=window.innerHeight,o=window.innerWidth;return o<540?(t=o,n=i,window.zlayer.open(),window.zlayer.onResize=this.onResize.bind(this)):(t=Math.floor(Math.min(540,Math.max(320,.563*i))),n=Math.floor(1.78*t),null===(e=document.body)||void 0===e||e.classList.add(H)),[t,n]},e.prototype.createLayer=function(){var e,t,n,a,r;window.innerWidth<540?(window.zlayer.open(),window.zlayer.onResize=this.onResize.bind(this)):null===(e=document.body)||void 0===e||e.classList.add(H),this.opened=!0;var s=(0,i.__read)(this.getSizes(),2),l=s[0],c=s[1];this.storyW=l;var u=o.default.html({id:"StoriesView",className:"Stories__layer _preventMenuOpen",style:"max-width: "+l+"px; max-height: "+c+"px",inner:[{className:"Stories__loading",inner:{class:"Stories__loadingInner"}},{id:"StoriesSlider",className:"Stories__authors peppermint peppermint-inactive",ontouchmove:"Stories.onTouchMove(event);",inner:""},{className:"Stories__layerClose",inner:{class:"Story__icon Story__icon_close"},onclick:"return Stories.clickClose();"},{class:"Stories__popout"},{className:"Stories__flash",onclick:"Stories.hideFlashPopup()",inner:{class:"Stories__flashText"}},{class:"Stories__swipeText Stories__swipeText_top"}]});this.layer=(0,A.append)((0,A.ce)("div",{className:"Stories",innerHTML:u}),document.body),null===(t=this.layer)||void 0===t||t.setAttribute("ontouchmove","event.preventDefault();"),this.loader=null===(n=this.layer)||void 0===n?void 0:n.querySelector(".Stories__loading"),this.popout=null===(a=this.layer)||void 0===a?void 0:a.querySelector(".Stories__popout"),this.swipeTextTop=null===(r=this.layer)||void 0===r?void 0:r.querySelector(".Stories__swipeText_top")},e.prototype.onResize=function(){var e=document.getElementById("StoriesView"),t=(0,i.__read)(this.getSizes(),2),n=t[0],o=t[1];null==e||e.setAttribute("style","max-width: "+n+"px; max-height: "+o+"px"),this.storyW=n,this.authors.forEach((function(e){(0,A.setStyle)(e,"width",n+"px")})),this.Authors&&this.Authors.length>1&&this.slider&&this.slider.recalcWidth()},e.prototype.getWidth=function(){return this.storyW},e.prototype.renderStory=function(){var e=Number(this.store.authorPrevIndex),t=this.getCurrentAuthorIndex(),n=this.authors[t],i=this.Authors[t];if(i.update(),!isNaN(e)&&e!==t){var o=this.Authors[e],a=this.authors[e];o.update();var r=o.renderEmpty(),s=(0,A.ceFromString)(r);(0,A.replace)(s,a)}var l=(0,A.ceFromString)(i.render());(0,A.replace)(l,n),this.authors=Array.from(this.layer.getElementsByClassName("StoryAuthor")),this.updateCurrentAuthor(),i.updateHeader(),this.onRender(),this.drawSiblingPreview(),"open"===this.storyExtraObj.replies&&this.showViews(this.getCurrentStory().raw_id)},e.prototype.getCurrentAuthor=function(){var e=this.getCurrentAuthorIndex();return(this.Authors||[])[e]},e.prototype.getCurrentAuthorEl=function(){return this.getCurrentAuthor().authorElem},e.prototype.getAuthorElems=function(){return this.authors},e.prototype.prevStory=function(){var e=this;this.stopStory(),this.store.isStopped=!1,requestAnimationFrame((function(){var t=e.getCurrentStoryIndex(),n=e.getCurrentAuthorIndex();if(t-1<0)if(n-1<0)e.setCurrentStory(0),e.renderStory();else{e.slider.slideTo(n-1);var i=e.store.authors[n-1].items.length-1;e.setCurrentStory(i)}else e.setCurrentStory(t-1),e.renderStory()}))},e.prototype.nextStory=function(e){var t=this;void 0===e&&(e=!1),this.stopStory(),this.markSeenAllOwners(),this.store.isStopped=!1,this.markSeenStoryIfNeeded(),requestAnimationFrame((function(){var n=t.store.authors[t.getCurrentAuthorIndex()],i=t.getCurrentStoryIndex(),o=t.getCurrentAuthorIndex(),a=n.items.length;if(t.Authors){var r=t.Authors.length;a-1<=i?r-1<=o?requestAnimationFrame((function(){e&&t.sendAnalyticsEvent("close_auto_by_time"),t.close()})):(e&&t.sendAnalyticsEvent("go_to_next_story_auto_by_time"),t.slider.slideTo(o+1),t.setCurrentStory(0)):(e&&t.sendAnalyticsEvent("go_to_next_story_auto_by_time"),t.setCurrentStory(i+1),t.renderStory())}}))},e.prototype.stopStory=function(){this.store.isStopped=!0,this.pauseStory()},e.prototype.pauseStory=function(e){var t;void 0===e&&(e=!1);var n=this.getCurrentAuthor();if(n){var i=n.getCountDown();e&&(null===(t=this.layer)||void 0===t||t.classList.add(D)),i&&i.pause()}},e.prototype.playStory=function(){this.store.isStopped=!1;var e=this.getCurrentAuthor();if(e){var t=e.getCountDown();(0,A.removeClass)(this.layer,D),t&&t.start()}},e.prototype.pauseAudio=function(){var e=window.audio;this.getCurrentStory().noSound||e&&e.pause()},e.prototype.restoreAudio=function(){var e=window.audio;this.needAudioRestore&&e&&e.play()},e.prototype.showMenu=function(){var e;this.store.showMenu=!0,this._hideTooltips(),this.stopStory(),null===(e=this.layer)||void 0===e||e.classList.add(F)},e.prototype.hideMenu=function(e){void 0===e&&(e=!0),this.store.showMenu=!1,(0,A.removeClass)(this.layer,F),e&&this.playStory()},e.prototype.showLoading=function(){var e=this;this.loader&&(clearTimeout(this.loaderTimer),this.loaderTimer=setTimeout((function(){(0,A.show)(e.loader)}),100))},e.prototype.hideLoading=function(){this.loader&&(clearTimeout(this.loaderTimer),(0,A.hide)(this.loader))},e.prototype.onRepliesScroll=function(e,t){this.Views[t]&&(this.store.viewersState[t].repliesScrollLeft=e.target.scrollLeft)},e.prototype.goToSettingsFromPrivacyHint=function(e,t,n){var i=this.store.viewersState[e]||[];return this.sendAnalyticsEvent("go_to_settings",{nav_screen:i.count?"feedback":"feedback_without_viewers"}),window.nav.go(t,n)},e.prototype.showEmptyStats=function(e){this.sendAnalyticsEvent("open_empty_feedback"),this.showViews(e)},e.prototype.showViews=function(e,t){var n,i=this;if(void 0===t&&(t=!1),this.hideMenu(),this.store.showViews=!0,this.stopStory(),this._hideTooltips(),this.Views[e]){var o=this.Views[e].render();this.popoutOpen=!0,(0,A.val)(this.popout,o);var a=null===(n=this.popout)||void 0===n?void 0:n.querySelector(".Views__repliesBody");a&&(a.scrollLeft=0),t||this.sendAnalyticsEvent("open_replies_list")}else{var r=this.store.viewersState[e],s=this.store.viewers[e];if(r&&s)return void this.createViews(e,t);this.showLoading(),this._requestFeedback(e).then((function(){i.markQuestionsAsViewed(),i.createViews(e,t),i.hideLoading()})).catch(console.error)}},e.prototype.showExtendedStats=function(e){var t,n=new _.default(e).render();n&&(null===(t=this.popout)||void 0===t||t.appendChild(n)),this.sendAnalyticsEvent("open_advanced_statistic")},e.prototype.hideExtendedStats=function(){var e;(0,A.re)(null===(e=this.popout)||void 0===e?void 0:e.querySelector(".StoryExtendedStats"))},e.prototype.markQuestionsAsViewed=function(){(this.getCurrentStory()||{}).isNewQuestions=!1,(0,A.removeClass)(document.querySelector(".Story__stats"),"Story__stats_new_questions")},e.prototype.createViews=function(e,t){var n;void 0===t&&(t=!1);var i=this.store.viewersState[e],o=new u.default(e),a=o.render();this.popoutOpen=!0,(0,A.val)(this.popout,a),this.Views[e]=o;var r=null===(n=this.popout)||void 0===n?void 0:n.querySelector(".Views__repliesBody");r&&(r.scrollLeft=i.repliesScrollLeft),t||this.sendAnalyticsEvent("open_replies_list")},e.prototype.hideViews=function(e){void 0===e&&(e=!0),e&&this.playStory(),this.store.showViews=!1,this.popoutOpen=!1,(0,A.val)(this.popout,"")},e.prototype.loadViews=function(e){var t=this,n=this.store.viewersState[e],i=n.loading,o=n.nextFrom;!i&&o&&(n.loading=!0,this.showLoading(),this._requestFeedback(e,o).then((function(){var i,o,a,r=new u.default(e),s=r.render();t.popoutOpen=!0;var l=null===(o=null===(i=t.layer)||void 0===i?void 0:i.querySelector(".Views__body"))||void 0===o?void 0:o.scrollTop;(0,A.val)(t.popout,s);var c=null===(a=t.layer)||void 0===a?void 0:a.querySelector(".Views__body");c&&l&&(c.scrollTop=l),t.Views[e]=r,t.hideLoading(),n.loading=!1})).catch(console.error))},e.prototype.showComment=function(){var e,t=this,n=this.authors[this.store.authorIndex],i=null==n?void 0:n.querySelector(".Story__commentTextarea");this.store.showComment=!0,this.stopStory(),null===(e=this.layer)||void 0===e||e.classList.add(V),this._hideTooltips(),requestAnimationFrame((function(){t.sendAnalyticsEvent("comment_tap"),null==i||i.focus()}))},e.prototype.hideComment=function(e){void 0===e&&(e=!0),this.store.showMenu=!1,(0,A.removeClass)(this.layer,V),e&&this.playStory()},e.prototype.onInputComment=function(e){var t=this.authors[this.store.authorIndex],n=null==t?void 0:t.querySelector(".Story__commentSend"),i=String((0,A.val)(e)).trim();(0,A.toggleClass)($,n,!!i)},e.prototype.sendComment=function(){var e=this.authors[this.store.authorIndex],t=null==e?void 0:e.querySelector(".Story__commentTextarea"),n=null==e?void 0:e.querySelector(".Story__commentSend"),i=(0,A.val)(t);if((0,A.hasClass)($,n)){(0,A.val)(t,""),(0,A.removeClass)(n,$);var o=this.getCurrentAuthorIndex(),a=this.getCurrentNarrative(),r=this.getCurrentStory().raw_id,s=this.store.authors[o],l=s.send_hash,c=s.author.id,u=void 0;u=a?"narrative"+a.ownerId+"_"+a.id:"story"+r,this._sendMessage(l,u,i,c),this.hideComment()}},e.prototype.manageStoryInNarratives=function(e){void 0===e&&(e=!1);var t=this.getCurrentNarrative();return window.helpHints.canShow(x.AvailableHelpHints.ACCOUNT_HINT_NARRATIVES_ADD_TOOLTIP)&&this.hideStoriesNarrativesFeatureHint(),(0,L.sendNarrativeAnalytic)(e?L.NarrativeAnalyticEventType.addToNarrativeFromActionSheet:L.NarrativeAnalyticEventType.clickToAddToNarrative,t,L.NarrativeAnalyticNavScreen.storyViewer),I.manageStoryInNarratives.call(this)},e.prototype.hideStoriesNarrativesFeatureHint=function(){(0,T.setHelpHintShown)(x.AvailableHelpHints.ACCOUNT_HINT_NARRATIVES_ADD_TOOLTIP)},e.prototype.showFlashPopup=function(e,t){var n,i=this;void 0===t&&(t=!0);this.stopStory();var o=null===(n=this.layer)||void 0===n?void 0:n.querySelector(".Stories__flash");(0,A.val)(null==o?void 0:o.querySelector(".Stories__flashText"),e),setTimeout((function(){null==o||o.classList.add(q)})),clearTimeout(this.flashTimer),clearTimeout(this.flashHideTimer),this.flashTimer=setTimeout((function(){(0,A.removeClass)(o,q),i.flashHideTimer=setTimeout((function(){i.hideFlashPopup(t)}),1500)}),1500)},e.prototype.removeCurrentStory=function(){var e=this,t=this.getCurrentAuthor(),n=this.getCurrentNarrative();if(t){var i=t.getCurrentStory(),o=(null==i?void 0:i.isNarrative)?(0,w.getLang)("mobile_stories_delete_narrative"):(0,w.getLang)("mobile_stories_delete_story"),a=null,r=function(){a&&m.default.close(a),e.hideMenu(),e.playStory()};a=(0,P.Confirm)(o.replace(/(<([^>]+)>)/gi,"\n"),(function(){h.default.setLoading((0,l.$)(".Popup__buttons .Popup__button:first-child",a),!0),h.default.setDisabled((0,l.$)(".Popup__buttons .Popup__button:last-child",a),!0);var o=t.feedItem.remove_hash,s=i.can_remove,c=i.raw_id;if(s){e.pauseStory();var u=function(){e._requestFeedBlock(),0===e.getCurrentStoryIndex()?(e.close({closeAll:!1}),location.reload()):(e.store.authors[e.getCurrentAuthorIndex()].items.splice(e.getCurrentStoryIndex(),1),e.hideMenu(),e.prevStory())};n?e._requestRemoveNarrative(n.rawId,o).then((function(){var e,t;r(),u(),null===(t=null===(e=window.Narratives)||void 0===e?void 0:e.onNarrativeRemovedFromStoryView)||void 0===t||t.call(e,n.id)})).catch(console.error):e._requestRemoveStory(c,o).then((function(){r(),e.sendAnalyticsEvent("delete"),u()})).catch(console.error)}else r()}),r,{yes_label:(0,w.getLang)("mobile_stories_delete_submit_label")})}},e.prototype.removeCurrentStoryFromNarrative=function(){return M.removeCurrentStoryFromNarrative.call(this)},e.prototype.editCurrentNarrative=function(e){var t=this.getCurrentNarrative(),n=(0,w.makeUrl)("narratives",{act:"edit",owner_id:null==t?void 0:t.ownerId,narrative_id:null==t?void 0:t.id,from:window.nav.cur});return(0,L.sendNarrativeAnalytic)(L.NarrativeAnalyticEventType.clickToEditNarrative,t,L.NarrativeAnalyticNavScreen.storyViewer),window.nav.go(n,e,{replace:!0})},e.prototype.onScrollViews=function(e,t){var n=this.store.viewersState[t],i=n.loading,o=n.nextFrom;if(!i&&o){e.scrollHeight-e.offsetHeight-400<=e.scrollTop&&this.loadViews(t)}},e.prototype.unMute=function(e){var t=this.getCurrentAuthor().story;(0,A.cancelEvent)(e),t&&t.unMute(),this.isMuted=!1},e.prototype.mute=function(e){var t=this.getCurrentAuthor().story;(0,A.cancelEvent)(e),t&&t.mute(),this.isMuted=!0},e.prototype.onTouchStart=function(e){var t=this,n=this.getCurrentAuthor().story;if(n&&"video"===n.getType()){var i=n.getVideo();if(i&&i.paused)return void(this.preventedTap=!0)}this.isTap=!0,clearTimeout(this.isTapTimer),n.isOneTime||(this.pauseStory(!0),"touchstart"===e.type?(this.tapStartX=e.changedTouches[0].clientX,this.tapStartY=e.changedTouches[0].clientY):(this.tapStartX=e.clientX,this.tapStartY=e.clientY),this.isYmove=null,(0,A.removeClass)(this.layer,U),this.isTapTimer=setTimeout((function(){t.isTap=!1,t.sendAnalyticsEvent("pause_long_tap")}),200))},e.prototype.openCustomButton=function(e){e.preventDefault(),e.stopPropagation();var t=this.getCurrentAuthor().story,n=t.getLinkUrl(),i=n.match(/\/narrative(-?\d+)_(\d+)/);if(i){var o={ownerId:i[1],narrativeId:i[2]},a=o.ownerId,r=o.narrativeId;if(!a||!r)return!1;this.openNarrative(a+"/narrative"+a+"_"+r,{source:"narrative_story"})}else if(this.stopStory(),this.showLoading(),this.sendAnalyticsEvent("link_click"),t.stats&&t.stats.url_view){var s=t.stats.url_view,l=s.event_type,c=s.rhash;this._requestClickStat(t.raw_id,l,c,t.track_code,(function(){window.nav.go(n)}))}else window.nav.go(n);return!1},e.prototype.onVerticalSwipe=function(e){var t;if(this.needClose=!1,this.needGoToLink=!1,e){var n=e>0,i=Number(null===(t=this.sliderEl)||void 0===t?void 0:t.offsetHeight),o=i/3.5,a=Math.abs(e)>o;if(n){var r=a?window.lang.mobile_zphoto_release_to_close:window.lang.mobile_zphoto_move_to_close,s=a?"":n?"zpv_close_move_down":"zpv_close_move_up",l=Math.max(1-.75*e/i,.6);(0,A.val)(this.swipeTextTop,'<div class="zpv_close_msg '+s+'">'+r+"</div>"),(0,A.setStyle)(this.sliderEl,"opacity",l),A.setStyle.transform(this.sliderEl,1,[0,e/W]),(0,A.setStyle)(this.swipeTextTop,"opacity",Math.abs(l-1-.6)),A.setStyle.transform(this.swipeTextTop,1,[0,e/W*.85]),this.needClose=a}else{var c=Math.min(1-.5*e/i,1.1);(0,A.setStyle)(this.sliderEl,"opacity",1),A.setStyle.transform(this.sliderEl,1,[0,0]),A.setStyle.transform(document.querySelector(".Story__moreLink"),c,[0,Math.max(e/(1.6*W),-90)]),this.needGoToLink=a}}else(0,A.setStyle)(this.sliderEl,"opacity",1),A.setStyle.transform(this.sliderEl,1,[0,0]),A.setStyle.transform(document.querySelector(".Story__moreLink"),1,[0,0]),this.needClose=!1,this.needGoToLink=!1},e.prototype.preventScroll=function(){return this.popoutOpen},e.prototype._requestRemoveStory=function(e,t){return new Promise((function(n,i){window.ajax.post("stories.php",{_ajax:1,act:"remove_story",hash:t,story_raw:e},{onDone:function(){n()},onFail:function(){return i(),!0}})}))},e.prototype._requestRemoveNarrative=function(e,t){return new Promise((function(n,i){window.ajax.post("stories.php",{_ajax:1,act:"remove_narrative",hash:t,narrative_raw:e},{onDone:function(){n()},onFail:function(){return i(),!0}})}))},e.prototype._requestList=function(){var e=this;return new Promise((function(t,n){var i={list:e.storyList,storyRaw:e.storyRaw,extra:e.storyExtra,items:null};if(!e.storyRaw)return n();var o=window.ajax.post("stories.php",{_ajax:1,act:"get_list",list:i.list,story_raw:i.storyRaw,extra:i.extra,track_code:e.initTrackCode},{onDone:function(e){i.items=e,t(i)},onFail:function(){return n(),!0}});e._saveRequest(o)}))},e.prototype._removeList=function(){window.store&&window.store.storiesLists&&window.store.storiesLists[this.storyList]&&delete window.store.storiesLists[this.storyList],window.store&&window.store.stories[this.storyList]&&delete window.store.stories[this.storyList]},e.prototype._forceSetStore=function(e,t,n){return{authors:n,listLoaded:!0,list:t,readedStories:{},_requests:[],questions:{},viewers:{},viewersState:{},extendedStats:{},replies:{},polls:{},showMenu:!1,storyList:t,initRaw:e,storyIndex:0,authorIndex:0,isReply:!1,replyTo:"",inited:!0}},e.prototype._requestFeedback=function(e,t){var n=this;void 0===t&&(t=0);var o=this.store;return new Promise((function(a,r){var s=window.ajax.post("stories.php",{_ajax:1,act:"feedback",offset:t,story_raw:e},{onDone:function(t,n,r,s,l,c,u,d,_,f,p){s&&s.length&&(o.replies[e]=s),o.viewers[e]=(0,i.__spreadArray)((0,i.__spreadArray)([],(0,i.__read)(o.viewers[e]||[])),(0,i.__read)(t)).filter((function(e,t,n){return t===n.findIndex((function(t){return t.viewerId===e.viewerId}))})),o.viewersState[e]?Object.assign(o.viewersState[e],{count:n,nextFrom:r}):o.viewersState[e]={count:n,nextFrom:r,repliesCountText:l,authorCountText:c,repliesScrollLeft:0,hiddenReason:d},u.length&&(o.questions[e]=u),l&&(o.viewersState[e].repliesCountText=l),c&&(o.viewersState[e].authorCountText=c),_&&(o.polls[e]=_),f&&(o.extendedStats[e]=f),o.viewersState[e].privacyHint=p,a({viewers:t,count:n,nextFrom:r,repliesCountText:l,authorCountText:c,questions:u})},onFail:function(){return r(),!0}});n._saveRequest(s)}))},e.prototype.markSeenStoryIfNeeded=function(){var e=this.getCurrentAuthor();if(e){var t=e.getCurrentStory();(null==t?void 0:t.isOneTime)||this.markSeenStory()}},e.prototype.updateOwnerAvatarsWithStories=function(){var e,t,n=[],o=this.getCurrentAuthor().feedItem;if(o.is_groups||o.is_apps){var a=window.store.stories[o.is_groups?"groups":"apps"];a&&a.authors.forEach((function(e){var t,o;try{for(var a=(0,i.__values)(e.items),r=a.next();!r.done;r=a.next()){if(r.value.unread)return}}catch(e){t={error:e}}finally{try{r&&!r.done&&(o=a.return)&&o.call(a)}finally{if(t)throw t.error}}n.push(e.author.id)}))}else{var r=!0,s=this.store.authors[this.getCurrentAuthorIndex()];try{for(var l=(0,i.__values)(s.items),c=l.next();!c.done;c=l.next()){if(c.value.unread){r=!1;break}}}catch(t){e={error:t}}finally{try{c&&!c.done&&(t=l.return)&&t.call(l)}finally{if(e)throw e.error}}r&&n.push(s.author.id)}n.length&&n.forEach((function(e){window.qsearch.removeFromCache(/\/friends/,e),Array.from(document.querySelectorAll('[data-avatar-with-stories-owner-id="'+e+'"]')).forEach((function(e){e.removeAttribute("onclick");var t=e.classList.contains("Avatar--withStories")?e:e.querySelector(".Avatar--withStories");null==t||t.classList.remove("Avatar--withStories")}))}))},e.prototype._getSource=function(){if(this.params&&this.params.source)return this.params.source;var e=this.store&&this.store.list||"",t="";return e.includes("feed")?t="feed":e.includes("replies")&&(t="reply"),t},e.prototype._sendNavigationStatEvents=function(e){var t=this.getCurrentStory(),n=t&&t.raw_id;if(n){var i=this._getSource();(0,f.saveNavigationStatEvent)({storyRawId:n,source:i,action:e})}},e.prototype._sendViewerStartTime=function(e,t){var n=this.viewerSource;(0,f.saveViewerStartTime)({storyRawId:e,source:n,time:t})},e.prototype._requestClickStat=function(e,t,n,i,o){window.ajax.post("stories.php",{_ajax:1,act:"stat",source_story:e,event_type:t,rhash:n,track_code:i},{onDone:function(){o&&o()}})},e.prototype._requestFave=function(e,t,n,i){window.ajax.post("bookmarks.php",{_ajax:1,act:e,item_type:31,item_oid:t,item_id:n,hash:i,ref:window.cur.module},{onDone:function(){"bookmark_add"===e&&(0,L.sendNarrativeAnalytic)(L.NarrativeAnalyticEventType.addToBookmarks,{ownerId:t,id:n},L.NarrativeAnalyticNavScreen.storyViewer)}})},e.prototype._parseList=function(e){var t=(e=decodeURIComponent(e)).match(/^story(-?\d+)_(\d+)(\/([a-z0-9\_\-]+))?(\/([a-z0-9\_\:\;\-]+))?$/i);if(t){var n=(0,i.__read)(t,7),o=n[1],a=n[2],r=n[4],s=n[6],l=o+"_"+a;return e.match(/from_feed\=1/)?r="feed":e.match(/profile\=1/)?r="profile":r||(r=l),l+"/"+r+"/"+s}return e},e.prototype.setHistory=function(e,t){void 0===t&&(t={nav_init:!1,replace:!0,no_open:!1});var n=this.getHistoryURL(e),o=window.nav.getQuery(),a=n.match(/narrative(s)?(-?\d+)(?:_(\d+))?(?:_(\d+))?/);if(a){var r=Boolean(a[1]),s=this.getCurrentStory().raw_id,l=this.getCurrentNarrative(),c=(0,i.__read)(s.split("_"),2)[1];n="narrative"+(r?"s":"")+(null==l?void 0:l.rawId)+"_"+c}o.z=n;var u=window.nav.path+(0,A.obj2qs)(o)+window.nav.hash,d={push_only:!0,replace:t.replace,nav_init:!t.no_open,nav_incr:!0};window.nav.go(u,null,d)},e.prototype.getFrom=function(e){void 0===e&&(e=!0);var t=this.store.list,n=window.nav.getQuery(),i="z="+n.z,o="";return"/write"===window.nav.path.substr(0,6)?o="write"+window.nav.path.substr(0,6)+"?"+i:"/mail"===window.nav.path?o="write"+n.peer+"?"+i:"/feed"===window.nav.path?o=n.section&&"notifications"===n.section?"feed?section=notifications&"+i:"feed?"+i:(null==t?void 0:t.startsWith("archive"))?o=window.nav.path+"?act=stories":n.from&&(o=n.from),e?encodeURIComponent(o):o},e.prototype.getHistoryURL=function(e){var t=this.store.list;return"story"+e+(t?"/"+t:"")},e.prototype.getParams=function(){return this.params||{}},e.prototype.toggleBookmark=function(e,t){void 0===t&&(t=!1);var n=this.getCurrentAuthor(),i=this.getCurrentNarrative();if(i){var o=n.getCurrentStory(),a=Boolean(null==i?void 0:i.isBookmarked),r=null==i?void 0:i.bookmarkHash;Object.keys(window.store.stories).forEach((function(e){var t,n=window.store.stories[e];n.authors&&(n.authors.forEach((function(e){t||(t=e.items.find((function(e){return i.bookmarkHash===r&&e.raw_id===(null==o?void 0:o.raw_id)})))})),i.isBookmarked=!a)})),(0,A.val)(e,a?window.lang.mobile_stories_menu_bookmark_title:window.lang.mobile_stories_menu_bookmarked_title);var s=a?"bookmark_remove":"bookmark_add",l=i.ownerId,c=i.rawId,u=i.id;t||this._requestFave(s,l,u,r),window.Share.setBookmarkState(c,!a)}},e.prototype._requestMarkNotInterested=function(e,t){var n=this;void 0===t&&(t=null),window.ajax.post("stories.php",{act:"mark_not_interested",story_raw_id:e.raw_id,track_code:e.track_code,hash:e.canMarkNotInterestedHash},{onDone:function(){n.sendAnalyticsEvent("mark_not_interested"),"function"==typeof t&&t()}})},e.prototype.markCurrentStoryNotInterested=function(e){var t=this.getCurrentStory();t?e&&(0,S.partConfigEnabled)("ads_new_reports_mvk_histories")?this._requestMarkNotInterested(t,(function(){return window.nav.go(e)})):(g.init({text:(0,w.getLang)("mobile_stories_thanks_feedback"),type:g.SNACKBAR_TYPE_SUCCESS}),this.hideMenu(),this._requestMarkNotInterested(t)):(0,k.logError)(new Error("Fail: markNotInterested"),{environment:"mobile_stories"})},e.prototype.openReplies=function(e,t){this.playStory(),t||this.sendAnalyticsEvent("open_parent_story"),this.destroy();var n=(0,i.__read)(this._parseList(e).split("/"),3),o=n[0],a=n[1],r=n[2],s=this.parseExtra(r);if(s.context="owner",r=Object.keys(s).map((function(e){return e+":"+s[e]})).join(";"),a)if(~window.store.storiesLayers.indexOf(a)){var l=String(this.store.list),c=String(a);this.restore(l,c)}else this.init(o+"/"+a+(r?"/"+r:""),{reply:!0,replyTo:t});else this.close()},e.prototype.hidePrivacyHint=function(e){var t=this.store.viewersState[e];if(t&&t.privacyHint){var n=t.privacyHint.privacyHintHash;t.privacyHint=null,n&&window.ajax.post("stories.php",{act:"hide_privacy_hint",privacy_hint_hash:n})}var i=(0,l.$)(".ViewsPrivacyHint");i&&i.remove(),this.sendAnalyticsEvent("hide_privacy_block")},e.prototype.openNarrative=function(e,t){void 0===t&&(t={}),this.playStory(),this.destroy();var n=(0,i.__read)(e.split("/"),2)[1];if(n)if(~window.store.storiesLayers.indexOf(n)){var o=String(this.store.list);this.restore(o,n)}else this.init(e,t);else this.close()},e.prototype.close=function(e){var t;if(void 0===e&&(e={}),Object.assign({isPopState:!1,storyRaw:!1,closeAll:!1},e),this.store&&this.store.list&&this._getSource().includes("narrative")&&this._sendNavigationStatEvents("narrative_close"),!e.isPopState){var n=window.nav,o=n.getQuery();if(window.store.storiesLayers[window.store.storiesLayers.length-1-1]){var a=window.store.storiesLayers[window.store.storiesLayers.length-1-1],r=window.store.stories[a],s=r.authorIndex,l=r.authors[s].index,c=r.authors[s].items[l];o.z=this.getHistoryURL(c.raw_id)}else delete o.z;var u=n.path+(0,A.obj2qs)(o)+(n.hash||"");window.nav.go(u,null,{push_only:!0,replace:null===(t=this.params)||void 0===t?void 0:t.isReplaceNavAfterClose})}if(this.destroy(),e.isPopState&&e.storyRaw){var d=(0,i.__read)(this._parseList(e.storyRaw).split("/"),2)[1];this.store?this.restore(this.store.storyList,d,e.storyRaw,e):this.init(e.storyRaw,{replace:!0})}else this.store&&this.store.storyList&&this.restore(this.store.storyList,"","",e)},e.prototype.hideAllViews=function(){window.store&&(window.store.storiesLayers=[],window.store.stories&&Object.keys(window.store.stories).forEach((function(e){window.store.stories[e].showViews=!1,window.store.stories[e].isStopped=!1})))},e.prototype.restore=function(e,t,n,o){if(void 0===t&&(t=""),void 0===n&&(n=""),void 0===o&&(o={}),window.store.storiesLayers){var a=window.store.storiesLayers.indexOf(e);window.store.storiesLayers.splice(a,1)}if(window.store.storiesLayers.length||t||n){t=t||window.store.storiesLayers[window.store.storiesLayers.length-1];var r=window.store.stories[e],s=window.store.stories[t];if(r&&s){var l=Object.keys(r.readedStories);null==l||l.forEach((function(e){var t=(0,i.__read)(e.split("_"),1)[0],n=s.replies[r.replyTo];if(n){var o=(0,i.__read)(n.filter((function(e){return String(e.owner_id)===t})),1)[0];o&&(o.has_new=!1)}})),this.init(s.initRaw,{restore:!0,forceAuthorIndex:!1,reply:!0})}else n&&this.init(n,{restore:!0,forceAuthorIndex:!1,reply:!0})}else this.hideAllViews();o.closeAll&&window.store.storiesLayers.length&&this.close(o)},e.prototype.clearStore=function(){this._initStore()},e.prototype.isAutoplaySupport=function(){return this.supportAutoplay},e.prototype.detectAutoplay=function(){var e=this;return new Promise((function(t,n){if(e.supportAutoplay)t();else{e.supportAutoplay=!1;var i=(0,A.ce)("video"),o=(0,A.ce)("source");o.src="data:video/mp4;base64,AAAAFGZ0eXBNU05WAAACAE1TTlYAAAOUbW9vdgAAAGxtdmhkAAAAAM9ghv7PYIb+AAACWAAACu8AAQAAAQAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAgAAAnh0cmFrAAAAXHRraGQAAAAHz2CG/s9ghv4AAAABAAAAAAAACu8AAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAABAAAAAAFAAAAA4AAAAAAHgbWRpYQAAACBtZGhkAAAAAM9ghv7PYIb+AAALuAAANq8AAAAAAAAAIWhkbHIAAAAAbWhscnZpZGVBVlMgAAAAAAABAB4AAAABl21pbmYAAAAUdm1oZAAAAAAAAAAAAAAAAAAAACRkaW5mAAAAHGRyZWYAAAAAAAAAAQAAAAx1cmwgAAAAAQAAAVdzdGJsAAAAp3N0c2QAAAAAAAAAAQAAAJdhdmMxAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAFAAOABIAAAASAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAGP//AAAAEmNvbHJuY2xjAAEAAQABAAAAL2F2Y0MBTUAz/+EAGGdNQDOadCk/LgIgAAADACAAAAMA0eMGVAEABGjuPIAAAAAYc3R0cwAAAAAAAAABAAAADgAAA+gAAAAUc3RzcwAAAAAAAAABAAAAAQAAABxzdHNjAAAAAAAAAAEAAAABAAAADgAAAAEAAABMc3RzegAAAAAAAAAAAAAADgAAAE8AAAAOAAAADQAAAA0AAAANAAAADQAAAA0AAAANAAAADQAAAA0AAAANAAAADQAAAA4AAAAOAAAAFHN0Y28AAAAAAAAAAQAAA7AAAAA0dXVpZFVTTVQh0k/Ou4hpXPrJx0AAAAAcTVREVAABABIAAAAKVcQAAAAAAAEAAAAAAAAAqHV1aWRVU01UIdJPzruIaVz6ycdAAAAAkE1URFQABAAMAAAAC1XEAAACHAAeAAAABBXHAAEAQQBWAFMAIABNAGUAZABpAGEAAAAqAAAAASoOAAEAZABlAHQAZQBjAHQAXwBhAHUAdABvAHAAbABhAHkAAAAyAAAAA1XEAAEAMgAwADAANQBtAGUALwAwADcALwAwADYAMAA2ACAAMwA6ADUAOgAwAAABA21kYXQAAAAYZ01AM5p0KT8uAiAAAAMAIAAAAwDR4wZUAAAABGjuPIAAAAAnZYiAIAAR//eBLT+oL1eA2Nlb/edvwWZflzEVLlhlXtJvSAEGRA3ZAAAACkGaAQCyJ/8AFBAAAAAJQZoCATP/AOmBAAAACUGaAwGz/wDpgAAAAAlBmgQCM/8A6YEAAAAJQZoFArP/AOmBAAAACUGaBgMz/wDpgQAAAAlBmgcDs/8A6YEAAAAJQZoIBDP/AOmAAAAACUGaCQSz/wDpgAAAAAlBmgoFM/8A6YEAAAAJQZoLBbP/AOmAAAAACkGaDAYyJ/8AFBAAAAAKQZoNBrIv/4cMeQ==";var a=(0,A.ce)("source");a.src="data:video/webm;base64,GkXfo49CgoR3ZWJtQoeBAUKFgQEYU4BnAQAAAAAAF60RTZt0vE27jFOrhBVJqWZTrIIQA027jFOrhBZUrmtTrIIQbE27jFOrhBFNm3RTrIIXmU27jFOrhBxTu2tTrIIWs+xPvwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFUmpZuQq17GDD0JATYCjbGliZWJtbCB2MC43LjcgKyBsaWJtYXRyb3NrYSB2MC44LjFXQY9BVlNNYXRyb3NrYUZpbGVEiYRFnEAARGGIBc2Lz1QNtgBzpJCy3XZ0KNuKNZS4+fDpFxzUFlSua9iu1teBAXPFhL4G+bmDgQG5gQGIgQFVqoEAnIEAbeeBASMxT4Q/gAAAVe6BAIaFVl9WUDiqgQEj44OEE95DVSK1nIN1bmTgkbCBULqBPJqBAFSwgVBUuoE87EQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB9DtnVB4eeBAKC4obaBAAAAkAMAnQEqUAA8AABHCIWFiIWEiAICAAamYnoOC6cfJa8f5Zvda4D+/7YOf//nNefQYACgnKGWgQFNANEBAAEQEAAYABhYL/QACIhgAPuC/rOgnKGWgQKbANEBAAEQEAAYABhYL/QACIhgAPuC/rKgnKGWgQPoANEBAAEQEAAYABhYL/QACIhgAPuC/rOgnKGWgQU1ANEBAAEQEAAYABhYL/QACIhgAPuC/rOgnKGWgQaDANEBAAEQEAAYABhYL/QACIhgAPuC/rKgnKGWgQfQANEBAAEQEAAYABhYL/QACIhgAPuC/rOgnKGWgQkdANEBAAEQEBRgAGFgv9AAIiGAAPuC/rOgnKGWgQprANEBAAEQEAAYABhYL/QACIhgAPuC/rKgnKGWgQu4ANEBAAEQEAAYABhYL/QACIhgAPuC/rOgnKGWgQ0FANEBAAEQEAAYABhYL/QACIhgAPuC/rOgnKGWgQ5TANEBAAEQEAAYABhYL/QACIhgAPuC/rKgnKGWgQ+gANEBAAEQEAAYABhYL/QACIhgAPuC/rOgnKGWgRDtANEBAAEQEAAYABhYL/QACIhgAPuC/rOgnKGWgRI7ANEBAAEQEAAYABhYL/QACIhgAPuC/rIcU7trQOC7jLOBALeH94EB8YIUzLuNs4IBTbeH94EB8YIUzLuNs4ICm7eH94EB8YIUzLuNs4ID6LeH94EB8YIUzLuNs4IFNbeH94EB8YIUzLuNs4IGg7eH94EB8YIUzLuNs4IH0LeH94EB8YIUzLuNs4IJHbeH94EB8YIUzLuNs4IKa7eH94EB8YIUzLuNs4ILuLeH94EB8YIUzLuNs4INBbeH94EB8YIUzLuNs4IOU7eH94EB8YIUzLuNs4IPoLeH94EB8YIUzLuNs4IQ7beH94EB8YIUzLuNs4ISO7eH94EB8YIUzBFNm3SPTbuMU6uEH0O2dVOsghTM",(0,A.append)(a,i),(0,A.append)(o,i),i.style.position="fixed",i.style.left="5000px",i.setAttribute("id","base64testvideo"),i.setAttribute("playsinline","playsinline"),i.setAttribute("webkit-playsinline","webkit-playsinline"),i.setAttribute("muted","muted"),i.muted=!0,i.setAttribute("autoplay","autoplay"),i.setAttribute("loop","loop"),(0,A.append)(i,document.body);var r=document.querySelector("#base64testvideo");if(s.default.android&&s.default.chrome)return e.supportAutoplay=!0,(0,A.remove)(i),t(),void clearTimeout(e.autoDetectTimeout);if(s.default.mobile&&s.default.ios&&s.default.ios<10)return e.supportAutoplay=!1,(0,A.remove)(i),t(),void clearTimeout(e.autoDetectTimeout);if(!s.default.safari_mobile||s.default.safari_mobile&&parseInt(s.default.version,10)>=10){var l=i.play();void 0!==l&&l.then((function(){e.supportAutoplay=!0,(0,A.remove)(i),t(),clearTimeout(e.autoDetectTimeout)})).catch(console.error)}r?(r.onplay=function(){e.supportAutoplay=!0,(0,A.remove)(i),t(),clearTimeout(e.autoDetectTimeout)},e.autoDetectTimeout=setTimeout((function(){(null==r?void 0:r.paused)||(e.supportAutoplay=!0),(0,A.remove)(i),t()}),250)):n()}}))},e.prototype.narrativeReply=function(){this.setCurrentStory(0),this.renderStory(),this._sendNavigationStatEvents("narrative_replay")},e.prototype.narrativeGoToStories=function(){this.nextStory(),this._sendNavigationStatEvents("narrative_go_to_stories")},e.prototype._showTooltip=function(e,t){if(this.hideMenu(!1),this.hideFlashPopup(!1),e&&t)if(this.tooltip)this._hideTooltips();else{var n,o,a=this.getCurrentAuthorEl();this.tooltip=(0,A.ce)("div",{className:"StoriesTooltip"},{top:0,left:0}),this.tooltipArrow=(0,A.ce)("span",{className:"StoriesTooltip__arrow"}),this.tooltip.appendChild(t),this.tooltip.appendChild(this.tooltipArrow),a.appendChild(this.tooltip),"touchend"===e.type?(n=e.changedTouches[0].clientX,o=e.changedTouches[0].clientY):(n=e.clientX,o=e.clientY);var r=a.getBoundingClientRect(),s=r.top,l=r.left,c=r.width,u=(0,i.__read)((0,A.getSize)(this.tooltip),2),d=u[0],_=o-(s+u[1]+10),f=n-(l+d/2);(0,A.setStyle)(this.tooltip,{top:Math.max(_,2),left:Math.min(Math.max(f,2),c-d-2)}),(0,A.setStyle)(this.tooltipArrow,{left:Math.max(Math.min(n-l-Math.min(Math.max(f,0),c-d),d-15),15)}),this.pauseStory()}else this.playStory()},e.prototype._hideTooltips=function(e){void 0===e&&(e=!1),this.tooltip&&(e||this.playStory(),(0,A.remove)(this.tooltip),delete this.tooltip)},e.prototype._hasContext=function(e){return!(!this.storyExtraObj||!this.storyExtraObj.context||this.storyExtraObj.context!==e)},e.prototype.clickAuthor=function(){this.sendAnalyticsEvent("go_to_author")},e.prototype.changeAskAnonymous=function(e){e.preventDefault();var t=document.querySelector(".Story__questionSelect");if(t){var n=+(0,A.domData)(t,"selected"),i=this.getCurrentStory();if(i){var a=[(0,p.ModalMenuBtn)({inner:window.lang.mobile_stories_ask_question_author_only,onclick:["Stories.changeQuestionMode","this",N.QUESTION_SELECT_MODE.AUTHOR_ONLY],class:n===N.QUESTION_SELECT_MODE.AUTHOR_ONLY?"selected":""}),(0,p.ModalMenuBtn)({inner:window.lang.mobile_stories_ask_question_public,onclick:["Stories.changeQuestionMode","this",N.QUESTION_SELECT_MODE.PUBLIC],class:n===N.QUESTION_SELECT_MODE.PUBLIC?"selected":""})];i.can_ask_anonymous&&a.splice(1,0,(0,p.ModalMenuBtn)({inner:window.lang.mobile_stories_ask_question_anonymous,onclick:["Stories.changeQuestionMode","this",N.QUESTION_SELECT_MODE.ANONYMOUS],className:n===N.QUESTION_SELECT_MODE.ANONYMOUS?"selected":""}));var r=(0,p.default)({class:"Story__questionSelectModal",close:!0,closeText:window.lang.mobile_stories_ask_question_cancel,items:a});m.default.open(o.default.elem(r),!0)}}},e.prototype.onInputQuestion=function(e){var t=document.querySelector(".Story__questionSend");t&&(t.disabled=!(0,A.trim)((0,A.val)(e)))},e.prototype.getQuestionById=function(e){var t=this.getCurrentStory();return this.store.questions[t.raw_id].find((function(t){return t.id===e}))},e.prototype.openQuestionActions=function(e){var t=this.getQuestionById(e);if(t){var n=t.canAnswer,i=t.isOwnerBlocked,a=t.canBlocked,r=[(0,p.ModalMenuBtn)({inner:window.lang.mobile_stories_question_delete,onclick:["Stories.removeQuestion","this",t.id]})];a&&(r.push((0,p.ModalMenuBtn)({inner:i?window.lang.mobile_stories_question_unban:window.lang.mobile_stories_question_ban,onclick:["Stories.banQuestion","this",t.id]})),r.push((0,p.ModalMenuBtn)({inner:window.lang.mobile_stories_question_report,onclick:["Stories.reportQuestion","this",t.id]}))),n&&r.unshift((0,p.ModalMenuBtn)({inner:window.lang.mobile_stories_question_reply,onclick:["Stories.replyQuestionBox","this",t.id]}));var s=(0,p.default)({class:"Question__popup",items:r});m.default.open(o.default.elem(s),!0)}},e.prototype.hideQuestions=function(){var e;(0,A.re)(null===(e=this.popout)||void 0===e?void 0:e.querySelector(".Questions"))},e.prototype.toggleQuestionTooltip=function(e,t){void 0===t&&(t=!1);var n=this.getCurrentAuthor().getCurrentStory(),i=(0,l.$)(".QuestionSupport"),o=(0,l.$)(".Story__questionSelect"),a=+(0,A.domData)(o,"selected");if((0,A.cancelEvent)(e),i){var r=null==n?void 0:n.firstName;(null==n?void 0:n.authorId)<0&&(r=window.lang.mobile_stories_ask_question_group_owner);var s="";switch(a){case N.QUESTION_SELECT_MODE.PUBLIC:s=window.lang.mobile_stories_ask_question_public_tooltip;break;case N.QUESTION_SELECT_MODE.AUTHOR_ONLY:s=window.lang.mobile_stories_ask_question_author_only_tooltip;break;case N.QUESTION_SELECT_MODE.ANONYMOUS:s=window.lang.mobile_stories_ask_question_anonymous_tooltip}(0,l.$)(".QuestionSupport__tooltip").innerText=s.replace("{name}",r),t?(0,A.removeClass)(i,"QuestionSupport--active"):(0,A.toggleClass)(i,"QuestionSupport--active")}},e.prototype.openMusicStickerActions=function(e,t){var n=document.getElementById("audio"+e),i=(0,A.hasClass)("ai_added",n),a=(0,p.default)({close:!0,items:[(0,p.ModalMenuBtn)({className:"ai_add",inner:i?window.lang.global_delete_audio:window.lang.global_add_to_audio,onclick:'Stories.addMusic(this, "'+e+'", '+i+");"}),(0,p.ModalMenuBtn)({className:"ai_add",inner:window.lang.mobile_stories_music_next,onclick:"Stories.nextMusic(this, "+t+");"})]}),r=o.default.elem(a);r.setAttribute("id","ai_menu_"+e),m.default.open(r,!0)},e}();window.page&&window.page.onChange((function(){window.store.storiesLayers=[],window.store.stories={}})),window.Stories=window.Stories||new G,window.showNarrative=function(e,t,n,i,o){void 0===n&&(n=0),void 0===i&&(i=""),void 0===o&&(o={});var a=""+e+(n?"_"+n:"")+"/"+(i=i||"narrative"+e+"_"+t);Object.assign(o,{narrativeRawId:e+"_"+t}),window.Stories.init(a,o)}},84347:function(e,t,n){"use strict";n.d(t,{removeCurrentStoryFromNarrative:function(){return u}});var i=n(92424),o=n(46950),a=n(70675),r=n(61124),s=n(49751),l=n(1730),c=!1;function u(){var e,t=this,n=this.getCurrentAuthorIndex(),u=this.getCurrentStoryIndex(),d=(null===(e=this.store.authors[n])||void 0===e?void 0:e.items)||[],_=this.getCurrentStory().id,f=this.getCurrentNarrative(),p=null;if(f&&!c){this.pauseStory();var m=function(e){void 0===e&&(e=!0),p&&r.default.close(p),t.hideMenu(),e&&t.playStory(),c=!1};p=(0,a.Confirm)((0,o.getLang)("mobile_stories_remove_only_from_narrative_warning"),(function(){var e,n,a,r,h,v;if(!c){s.default.setLoading((0,l.$)(".Popup__buttons .Popup__button:first-child",p),!0),s.default.setDisabled((0,l.$)(".Popup__buttons .Popup__button:last-child",p),!0),c=!0;var g=null===(e=f.stories)||void 0===e?void 0:e.filter((function(e){return e.id!==_})),A=null==g?void 0:g.map((function(e){return e.id})),y=f.customCover?null:A.includes(f.coverStoryId)?f.coverStoryId:A[0]||_;window.ajax.post("narratives",{act:"update",owner_id:f.ownerId,hash:f.editHash,cover_story_id:y,custom_cover_photo_id:null===(n=f.customCover)||void 0===n?void 0:n.photoId,story_ids:A.join(","),title:f.title,narrative_raw_id:f.rawId,crop_x:null===(a=f.coverCrop)||void 0===a?void 0:a.x,crop_y:null===(r=f.coverCrop)||void 0===r?void 0:r.y,crop_width:null===(h=f.coverCrop)||void 0===h?void 0:h.width,crop_height:null===(v=f.coverCrop)||void 0===v?void 0:v.height},{onDone:function(e){var n,a;window.Stories.sendAnalyticsEvent("delete_from_narrative"),i.init({type:i.SNACKBAR_TYPE_SUCCESS,avatar:e.coverUrl,text:(0,o.getLangReplace)((0,o.getLang)("mobile_narratives_success_updated"),{narrative_title:e.title})}),null===(a=null===(n=window.Narratives)||void 0===n?void 0:n.onNarrativeChangedFromStoryView)||void 0===a||a.call(n,e),m(!1),d.splice(u,1),window.Stories.setCurrentNarrative(e),d.length?(t.setCurrentStory(u-1),t.nextStory()):(t.close(),location.reload())},onFail:function(){return m(),!0}})}}),m,{yes_label:(0,o.getLang)("mobile_stories_remove_only_from_narrative_submit_label")})}}},55667:function(e,t,n){"use strict";var i;n.d(t,{QUESTION_SELECT_MODE:function(){return i}}),function(e){e[e.PUBLIC=0]="PUBLIC",e[e.AUTHOR_ONLY=1]="AUTHOR_ONLY",e[e.ANONYMOUS=3]="ANONYMOUS"}(i||(i={}))},87844:function(e,t,n){"use strict";var i=n(40469),o=n(86353),a=n(14561),r=n(38383),s=n(97398),l=function(){function e(){}return e.prototype.sendStoryAnalytic=function(e){var t={event_type:String(e),time:window.vk.ts+Math.floor(((new Date).getTime()-window.vk.started)/1e3),nav_screen:i.NarrativeAnalyticNavScreen.storyArchive};(0,o.partConfigEnabled)("narratives_web_analytic_debug")&&console.log("-- story analytic",t),(0,a.saveStoryViewBaseStats)(t)},e.prototype.onSelectManyClick=function(e,t){return this.sendStoryAnalytic("select_some_story"),window.nav.go(e,t)},e.prototype.onActionsClick=function(e,t){return t.preventDefault(),window.helpHints.canShow(s.AvailableHelpHints.ACCOUNT_HINT_MVK_STORIES_ARCHIVE_ACTIONS_HINT)&&(0,r.setHelpHintShown)(s.AvailableHelpHints.ACCOUNT_HINT_MVK_STORIES_ARCHIVE_ACTIONS_HINT),window.ContextMenu.open(e,".header__gear",{appendToBody:!0}),!1},e}();window.StoriesArchive=new l},65287:function(e,t,n){"use strict";n.d(t,{ERROR_CLASS:function(){return m},StickerTypes:function(){return h},StickerTypeLabel:function(){return v},StoryAuthor:function(){return g}});var i=n(11393),o=n(1730),a=n(62691),r=n(11056),s=n(85601),l=n(9046),c=n(35909),u=n(46950),d="StoryAuthor__progressItem_filled",_="StoryAuthor_paused",f="StoryAuthor_videoHold",p="StoryAuthor_videoMuted",m="StoryAuthor--error",h={hashtag:1,mention:2,question:3,place:4,music:5,storyReply:6,owner:7,link:8,marketItem:9,post:10,poll:11,sticker:12,app:13,situationalTheme:14},v=Object.entries(h).reduce((function(e,t){return e[t[1]]=t[0],e}),{}),g=function(){function e(e,t){var n=this;this.store=window.Stories.getStore(),this.feedItem=t,this.state={authorIndex:e};var o=this.getCurrentStoryIndex();this.setCurrentStoryIndex(o),this.story=new r.Story(this.feedItem,e,o),this.authorStoriesHTML=i.default.html(this.story.render()),this.progressItemElems=null,window.Stories.onRender((function(){n.updateStory()}))}return e.prototype.getCurrentStory=function(){if(this.story)return this.story},e.prototype.destroy=function(){this.story&&this.story.destroy()},e.prototype.update=function(){var e=this.feedItem.index;this.destroy(),this.story=new r.Story(this.feedItem,this.state.authorIndex,e),this.authorStoriesHTML=i.default.html(this.story.render())},e.prototype.updateHeader=function(){this.authorElems=window.Stories.getAuthorElems(),this.authorElem=this.authorElems[this.state.authorIndex],this.authorElem&&(this.progressItemElems=Array.from(this.authorElem.getElementsByClassName("StoryAuthor__progressItem"))),this.drawFilledProgressItems()},e.prototype.updateStory=function(){var e,t=this;this.authorElems=window.Stories.getAuthorElems(),this.authorElem=this.authorElems[this.state.authorIndex];var n=null===(e=this.authorElem)||void 0===e?void 0:e.querySelector(".Story__body");this.story.update(n),this.story.onVideoData((function(){var e=t.story.getDuration(),i=t.story.getType(),a=t.store.isStopped,r=t.story.getStartTime(),c=t.story.getProgressPercentByLeftTime(e-r);if(t.drawCurrentProgress(c),(0,l.removeClass)("StoryAuthor__progress--hide",(0,o.$)(".StoryAuthor__progress",t.authorElem)),t.countdown=new s.default(e-r,{tick:13,onTick:function(e){t.drawCurrentProgress(t.story.getProgressPercentByLeftTime(e))},onEnd:function(){"video"!==i&&(t.drawCurrentProgress(100),window.Stories.nextStory(!0),(0,l.removeClass)(t.authorElem,_))},onPause:function(){var e;t.story.pause(),null===(e=t.authorElem)||void 0===e||e.classList.add(_)},onStart:function(){t.story.play().catch(console.error),(0,l.removeClass)(t.authorElem,f),(0,l.removeClass)(t.authorElem,_)}}),"photo"!==i&&"broken"!==i||a){if("video"===i){var u=t.story.getVideoState(),d=t.story.getVideo();null==n||n.classList.add("Story__body_video"),4!==u||a||d.paused||t.countdown.start()}}else t.countdown.start()})),this.story.onVideoEndedEvent((function(){t.drawCurrentProgress(100),t.story.progress=100,window.Stories.nextStory(!0)})),this.story.onVideoPauseEvent((function(){t.countdown&&t.countdown.pause()})),this.story.onVideoBuffering((function(){t.countdown&&t.countdown.pause()})),this.story.onVideoPlayEvent((function(){t.countdown&&!t.store.isStopped&&t.countdown.start()})),this.story.onAutoPlay((function(){var e,n,i=window.lang;window.Stories.pauseAudio();var o=null===(e=t.authorElem)||void 0===e?void 0:e.querySelector(".Story__body");t.story.play().then((function(){t.story.canPause=!0})).catch((function(){t.story.canPause=!0})),t.story.isPaused()&&!window.Stories.supportAutoplay?t.story.renderError(t.authorElem,o,i.mobile_stories_inline_video_error):!t.countdown||t.store.isStopped||t.story.isPaused()||t.story.buffering?window.Stories.supportAutoplay&&t.story.isPaused()&&(null===(n=t.authorElem)||void 0===n||n.classList.add(f)):t.countdown.start()})),this.story.onMute((function(e){var n,i;e?null===(n=t.authorElem)||void 0===n||n.classList.remove(p):null===(i=t.authorElem)||void 0===i||i.classList.add(p)})),this.story.onUnMute((function(){(0,l.removeClass)(t.authorElem,p)})),this.story.onDestroy((function(){t.countdown&&(t.countdown.stop(),t.countdown=null)}))},e.prototype.getCountDown=function(){if(this.countdown)return this.countdown},e.prototype.getFirstUnreadStoryIndex=function(){if(window.Stories._hasContext("all"))return 0;var e=this.feedItem.items.findIndex((function(e){return!0===e.unread}));return-1!==e?e:0},e.prototype.getCurrentStoryIndex=function(){if(!this.feedItem.index){var e=this.getFirstUnreadStoryIndex();this.setCurrentStoryIndex(e)}return this.feedItem.index},e.prototype.drawCurrentProgress=function(e){if(this.progressItemElems){var t=this.progressItemElems[this.feedItem.index],n=null==t?void 0:t.querySelector(".StoryAuthor__progressItemCurrent"),i=null==t?void 0:t.querySelector(".StoryAuthor__wick"),o=e/100*((null==t?void 0:t.clientWidth)||0);l.setStyle.transform(n,void 0,[o,0]),this.story.isOneTime&&l.setStyle.transform(i,void 0,[o,0])}},e.prototype.drawFilledProgressItems=function(){var e,t,n=this.feedItem.index;if(this.progressItemElems)for(null===(e=this.progressItemElems)||void 0===e||e.forEach((function(e){(0,l.removeClass)(e,d)}));n>=0;)null===(t=this.progressItemElems[--n])||void 0===t||t.classList.add(d)},e.prototype.setCurrentStoryIndex=function(e){this.feedItem.index=e,this.drawFilledProgressItems()},e.prototype.renderEmpty=function(){var e=this.story.getPreview(),t=window.Stories.getWidth();return i.default.html({class:"StoryAuthor StoryAuthor_empty",style:"width: "+t+"px;",attrs:{"data-src":e}})},e.prototype.render=function(){var e,t,n,o,r=this,s=window.lang,l=window.Stories.getWidth(),d=a.isTouch?"ontouchstart":"onmousedown",_=a.isTouch?"ontouchend":"onmouseup",f=this.story.getType(),p=window.Stories.isMuted,m=(0,u.classNames)("StoryAuthor","StoryAuthor_inited",{StoryAuthor_videoMuted:"video"===f&&p});return i.default.html({className:m,style:"width: "+l+"px;",inner:[{className:"StoryAuthor__header",inner:{className:"StoryAuthor__progress"+(this.story.isOneTime?" StoryAuthor__progress--isOneTime StoryAuthor__progress--hide":""),inner:this.feedItem.items.map((function(){return{className:"StoryAuthor__progressItem",inner:[{className:"StoryAuthor__progressItemBar",inner:{class:"StoryAuthor__progressItemCurrent"}},r.story.isOneTime?{class:"StoryAuthor__wick"}:null]}}))}},"video"===f?(e={className:"StoryAuthorMuteButton StoryAuthorMuteButton--unmute"},e[d]="Stories.unMute(event);",e.inner=[{className:"StoryAuthorMuteButton__icon",inner:(0,c.Icon24Mute)()},{className:"StoryAuthorMuteButton__text",inner:s.mobile_stories_unmute}],e):null,"video"===f?(t={className:"StoryAuthorMuteButton StoryAuthorMuteButton--mute"},t[d]="Stories.mute(event);",t.inner=[{className:"StoryAuthorMuteButton__icon",inner:(0,c.Icon24Volume)()},{className:"StoryAuthorMuteButton__text",inner:s.mobile_stories_mute}],t):null,(n={class:"StoryAuthor__next"},n[d]="Stories.onTouchStart(event);",n[_]="Stories.onTouchEnd(event);",n.ontouchcancel="Stories.onTouchEnd(event);",n),(o={class:"StoryAuthor__prev"},o[d]="Stories.onTouchStart(event);",o[_]="Stories.onTouchEnd(event, true);",o.ontouchcancel="Stories.onTouchEnd(event, true);",o),{className:"StoryAuthor__body",inner:this.authorStoriesHTML}]})},e}()},1934:function(e,t,n){"use strict";var i=n(61124),o=n(36557),a=n(28600),r=n(11393),s=n(9046),l=n(49751),c=n(92424),u=n(46950),d=n(83718),_=n(29629),f=n(27109),p=n(15797);Object.assign(a.default,{init:function(e,t,n){var s=this;void 0===t&&(t=o.noop),void 0===n&&(n=o.noop),this.successHandler=this.successHandler.bind(this),this.errorHandler=this.errorHandler.bind(this),e.artboardHeight=e.artboardHeight||(window.innerHeight<357?window.innerHeight-100:357),e.artboardWidth=e.artboardWidth||e.artboardHeight/1.78,this.props=e,this.props.src=e.src||e.url||e.blob,this.onClickSave=t,this.cb=n,this.popup=i.default.open(r.default.elem((0,a.default)(this.props)),!0);var l=function(){return(0,f.hide)(document.querySelector(".StoryPublisher__spinner"))};switch(this.props.background_type){case d.StoryPublisherBackgroundType.IMAGE:(0,o.loadImage)(this.props.src).then((function(e){l(),s.drawImage(e)})).catch((function(){return s.errorHandler(new Error("Can't upload image"))}));break;case d.StoryPublisherBackgroundType.VIDEO:this.validateVideo(this.props).then(l).catch(this.errorHandler)}return this},drawImage:function(e){if(this.canvas=document.querySelector(".StoryPublisher__canvasLayer"),!this.canvas)return this.errorHandler();var t=this.canvas.getContext("2d");if(!t)return this.errorHandler();var n,i,a=+(e.height/e.width).toFixed(2);if(a>1.77?(i=this.canvas.height,n=this.canvas.height/a):(n=this.canvas.width,i=this.canvas.width*a),t.save(),t.clearRect(0,0,this.canvas.width,this.canvas.height),t.filter="blur(135px)",t.drawImage(e,0,0,this.canvas.width,this.canvas.height),t.restore(),"none"!==t.filter){var r=(0,o.getAverageRGB)(t);t.fillStyle="rgb("+r.r+", "+r.g+", "+r.b+")",t.fillRect(0,0,this.canvas.width,this.canvas.height)}t.drawImage(e,this.canvas.width/2-n/2,this.canvas.height/2-i/2,n,i)},closePopup:function(e){void 0===e&&(e=!0),e&&this.cb(),i.default.close(this.popup),this.popup=null},successHandler:function(e){this.cb(!0,e),this.isLoading=!1,this.closePopup(!1)},errorHandler:function(e){void 0===e&&(e={}),this.props.closeAfterError&&this.closePopup(!1),this.cb(!1,{error:e}),this.isLoading=!1,l.default.setLoading(this.shareButton,!1),c.init({type:c.SNACKBAR_TYPE_ERROR,text:e.message||(0,u.getLang)("mobile_apps_story_publisher_unexpected_error")})},save:function(e){var t=this;if(!this.isLoading){this.onClickSave(),l.default.setLoading(e,!0),this.shareButton=e,this.isLoading=!0;var n=this.props,i=n.background_type,o=n.miniAppId,a=n.entrypoint,r=n.storyUploadUrlHash,s=n.storySaveHash,c=n.attachment;this.getBlob().then((function(e){return(0,_.getStoryUploadUrl)({mini_app_id:o,story_type:i===d.StoryPublisherBackgroundType.IMAGE?p.StoryType.PHOTO:p.StoryType.VIDEO,hash:r,entry_point:a,ref:window.cur.module,file_size:e.size,attachment:c?JSON.stringify(c):void 0}).then((function(n){return t.uploadStoryBlobToServer(e,n)})).then((function(e){var t=e.response;return(0,_.saveStoryOnServer)(t&&t.upload_result,s)})).then(t.successHandler).catch(t.errorHandler)})).catch(this.errorHandler)}},uploadStoryBlobToServer:function(e,t){return new Promise((function(n,i){var a=(0,o.getBlobType)(e),r=9e5*Math.random(),l=new FormData,c=encodeURIComponent("story_"+r+"."+a);l.append("file0",e,c);var u=(0,s.uploadFile)(t,l,{onComplete:function(){var e=(0,s.parseJSON)(u.response);e&&e.response&&e.response.upload_result||i(),n(e)},onError:i})}))},getBlob:function(){var e=this;return this.props.background_type===d.StoryPublisherBackgroundType.IMAGE?new Promise((function(t,n){try{e.canvas.toBlob(t,"image/jpeg")}catch(e){n()}})):(0,o.getMediaBlob)(this.props.src)},validateVideo:function(e){return new Promise((function(t,n){(0,o.getVideoDuration)(e.src).then((function(i){if(e.maxVideoDuration&&i>e.maxVideoDuration)return n(new Error("The duration of the video file must not exceed 15 seconds"));t(i)})).catch((function(){return n(new Error("Can't upload video"))}))}))}})},83718:function(e,t,n){"use strict";var i;n.d(t,{StoryPublisherBackgroundType:function(){return i}}),function(e){e.IMAGE="image",e.VIDEO="video"}(i||(i={}))},85261:function(e,t,n){"use strict";n.d(t,{fakeInfo:function(){return a}});var i=n(11393),o=n(85100),a=new(function(){function e(){}return e.prototype.openFakeInfoModal=function(e){var t=(0,o.FakeInfoModal)(e);window.ModalMenu.open(i.default.elem(t),!0),window.ajax.post("wall.php",{act:"track_fake_news_caption_clicked"})},e}())},92509:function(e,t,n){"use strict";n.d(t,{PostPrivacyBanner:function(){return r}});var i=n(5987),o=n(97398),a=n(9046),r=function(){function e(){var e=this;this.onBestFriendsChange=function(t,n){var o,a;null===(o=window.PostPrivacy)||void 0===o||o.changePostPrivacySelectConfig(n),null===(a=window.PostPrivacySelect)||void 0===a||a.changePrivacy(i.PostPrivacySelectValue.BEST_FRIENDS_ONLY),e.close(t)}}return e.prototype.close=function(e){(0,a.remove)(null==e?void 0:e.closest(".PostPrivacyBanner")),this.hideBanner()},e.prototype.onEditBestFriendsClick=function(e){var t;null===(t=window.BestFriendsEditBox)||void 0===t||t.open({onSubmit:["PostPrivacyBanner.onBestFriendsChange",e]})},e.prototype.hideBanner=function(){window.helpHints.hide(o.AvailableHelpHints.ACCOUNT_HINT_FRIENDS_BEST_FRIENDS_POSTING)},e}()},18696:function(e,t,n){"use strict";n.d(t,{PostPrivacyModal:function(){return s}});var i=n(11393),o=n(18744),a=n(50344),r=n(80444),s=function(){function e(){var e=this;this.postPrivacyModalMenu=null,this.onBestFriendsListChanged=function(){var t,n,i;if(!(null===(t=e.config)||void 0===t?void 0:t.isOwner)&&(null===(n=e.config)||void 0===n?void 0:n.isOnlyForBestFriends)&&0===(null===(i=e.config)||void 0===i?void 0:i.viewerBestFriendsCount)){var o=(0,r.makeUrl)("wall",{act:"add",post_privacy:"best_friends_only"});window.nav.go(o)}e.close()},this.getConfig=function(e){return e?JSON.parse(e.getAttribute("data-post-privacy-modal-config")||"null"):null}}return e.prototype.open=function(e){var t,n,r=this.getConfig(e);r&&(this.config=r,r.isOnlyForBestFriends?(0,a.sendBestFriendsAnalytic)(a.BestFriendsEventType.clickToLockBestFriends):r.isOnlyForFriends&&(0,a.sendBestFriendsAnalytic)(a.BestFriendsEventType.clickToLockFriends),(null===(t=window.BestFriends)||void 0===t?void 0:t.isCountWasChanged)&&(r.bestFriendsCount=null===(n=window.BestFriends)||void 0===n?void 0:n.getCount()),this.postPrivacyModalMenu=window.ModalMenu.open(i.default.elem((0,o.PostPrivacyModal)(r)),!0))},e.prototype.close=function(){this.config=null,this.postPrivacyModalMenu&&(window.ModalMenu.close(this.postPrivacyModalMenu),this.postPrivacyModalMenu=null)},e.prototype.onCreatePostClick=function(e){var t,n;window.ModalMenu.close(e),(null===(t=this.config)||void 0===t?void 0:t.isOnlyForBestFriends)?(0,a.sendBestFriendsAnalytic)(a.BestFriendsEventType.createPostFromPopupBest):(null===(n=this.config)||void 0===n?void 0:n.isOnlyForFriends)&&(0,a.sendBestFriendsAnalytic)(a.BestFriendsEventType.createPostFromPopupFriends)},e.prototype.onChooseBestFriendsClick=function(){var e;(0,a.sendBestFriendsAnalytic)(a.BestFriendsEventType.editBestFriendsFromPopup),null===(e=window.BestFriendsEditBox)||void 0===e||e.open({showSuccessSnackbar:!0,onSubmit:"PostPrivacyModal.onBestFriendsListChanged"})},e}()},5987:function(e,t,n){"use strict";n.d(t,{PostPrivacySelectValue:function(){return i},PostPrivacySelect:function(){return s}});var i,o=n(52738),a=n(46950),r=n(50344);!function(e){e.PUBLIC="public",e.FRIENDS_ONLY="friends_only",e.BEST_FRIENDS_ONLY="best_friends_only"}(i||(i={}));var s=function(){function e(){var e=this;this.onBestFriendsChange=function(t){var n;null===(n=window.PostPrivacy)||void 0===n||n.changePostPrivacySelectConfig(t),e.changePrivacy(t.bestFriendsCount>0?i.BEST_FRIENDS_ONLY:i.PUBLIC)},this.onPrivacyChange=function(t){void 0===t&&(t={}),(0,r.sendBestFriendsAnalytic)(r.BestFriendsEventType.selectBestFriends),e.changePrivacy(t.value)}}return e.prototype.onEditBestFriendsClick=function(){var e;(0,r.sendBestFriendsAnalytic)(r.BestFriendsEventType.editBestFriends),null===(e=window.BestFriendsEditBox)||void 0===e||e.open({onSubmit:["PostPrivacySelect.onBestFriendsChange"]})},e.prototype.changePrivacy=function(e){var t,n,r=(0,o.getPostPrivacyFormControls)(),s=r.selectPrivacy,l=r.selectPrivacyLabel,c=r.selectPrivacyCreatePostSelect,u=r.bestFriendsOnlyCheckbox,d=r.friendsOnlyCheckbox;if(s&&l&&c){switch(s.classList.remove("PostSelect--bestFriends"),u&&(u.checked=!1),d&&(d.checked=!1),e){case i.PUBLIC:l.innerText=(0,a.getLang)("mobile_profile_new_post_privacy_public");break;case i.FRIENDS_ONLY:l.innerText=(0,a.getLang)("mobile_profile_new_post_privacy_friends_only"),d&&(d.checked=!0);break;case i.BEST_FRIENDS_ONLY:s.classList.add("PostSelect--bestFriends"),l.innerText=(0,a.getLang)("mobile_profile_new_post_privacy_best_friends_only"),u&&(u.checked=!0)}null===(t=window.PostPrivacy)||void 0===t||t.closePostPrivacySelect();var _=(0,o.getSavePostDraftHash)();_&&(null===(n=window.post)||void 0===n||n.saveDraft(null,_))}},e}()},96398:function(e,t,n){"use strict";n.d(t,{PostPrivacy:function(){return c}});var i=n(97316),o=n(11393),a=n(16336),r=n(5987),s=n(52738),l=n(50344),c=function(){function e(){}return e.prototype.openPostPrivacySelect=function(){var e=(0,s.getPostPrivacySelectConfig)();if(e){var t=(0,a.PostPrivacySelect)((0,i.__assign)((0,i.__assign)({},e),{selectedValue:this.getCurrentSelectedPrivacyValue()}));this.postPrivacySelectModalMenu=window.ModalMenu.open(o.default.elem(t),!0)}},e.prototype.changePostPrivacySelectConfig=function(e){var t=(0,s.getPostPrivacyFormControls)().selectPrivacy;t&&t.setAttribute("data-post-privacy-select-config",JSON.stringify(e))},e.prototype.closePostPrivacySelect=function(){this.postPrivacySelectModalMenu&&(window.ModalMenu.close(this.postPrivacySelectModalMenu),this.postPrivacySelectModalMenu=null)},e.prototype.onPostMenuEditBestFriendsClick=function(){(0,l.sendBestFriendsAnalytic)(l.BestFriendsEventType.editBestFriends),setTimeout((function(){var e;null===(e=window.BestFriendsEditBox)||void 0===e||e.open({showSuccessSnackbar:!0})}),0)},e.prototype.getCurrentSelectedPrivacyValue=function(){var e=(0,s.getPostPrivacyFormControls)(),t=e.bestFriendsOnlyCheckbox,n=e.friendsOnlyCheckbox;return(null==t?void 0:t.checked)?r.PostPrivacySelectValue.BEST_FRIENDS_ONLY:(null==n?void 0:n.checked)?r.PostPrivacySelectValue.FRIENDS_ONLY:r.PostPrivacySelectValue.PUBLIC},e}()},52738:function(e,t,n){"use strict";n.d(t,{getPostPrivacyFormControls:function(){return i},getSavePostDraftHash:function(){return o},getPostPrivacySelectConfig:function(){return a}});var i=function(){var e=document.querySelector("#select-privacy"),t=e.querySelector(".PostSelect__label");if(!e||!t)return{selectPrivacy:null,selectPrivacyLabel:null,selectPrivacyCreatePostSelect:null,bestFriendsOnlyCheckbox:null,friendsOnlyCheckbox:null};var n=e.closest(".create_post__select");if(!n)return{selectPrivacy:e,selectPrivacyLabel:t,selectPrivacyCreatePostSelect:null,bestFriendsOnlyCheckbox:null,friendsOnlyCheckbox:null};var i=n.querySelector('input[name="best_friends_only"]'),o=n.querySelector('input[name="friends_only"]');return{selectPrivacy:e,selectPrivacyLabel:t,selectPrivacyCreatePostSelect:n,bestFriendsOnlyCheckbox:i,friendsOnlyCheckbox:o}},o=function(){var e=i().selectPrivacy;return e&&e.getAttribute("data-save-post-draft-hash")||null},a=function(){var e=i().selectPrivacy;return e?JSON.parse(e.getAttribute("data-post-privacy-select-config")||"null"):null}},1539:function(e,t,n){"use strict";n.d(t,{RedirectScreen:function(){return c}});var i=n(86658),o=n(27813),a=n(9046),r=n(1730);function s(){var e=(0,r.$)(".RedirectScreen__mainButton");return e?e.getAttribute("href").replace(/^vk:\/\//,""):""}function l(e){var t=e.action,n=e.onDone,o=e.onError,r=function(e){var t=e.split("?");return(0,a.qs2obj)(t[1]).entry||""}(s());i.default.post("/webview",{act:"redirect_screen_"+t,entry:r,_ajax:1}).promise.then((function(){return n&&n()})).catch((function(){return o&&o()}))}var c={onInit:function(){var e=(0,r.$)(".RedirectScreen__mainButton"),t=window.location.hash;e.setAttribute("href",e.getAttribute("href").replace(encodeURIComponent("#{url_fragment}"),t?encodeURIComponent(t):""));var n=s();(0,a.openApp)(n)},onOpenClick:function(){window.event&&window.event.preventDefault();var e=s();l({action:"open",onDone:function(){return(0,a.openApp)(e,!0)}})},onContinueClick:function(){l({action:"continue",onDone:function(){(0,o.setCookie)("remixredirect_screen_opened","true",1/1440*5),window.location.reload()}})},onDownloadClick:function(e,t){e.preventDefault(),l({action:"download",onDone:function(){return window.location.href=t.href}})}}},74521:function(e,t,n){"use strict";var i=n(97316),o=n(51988),a=n(27813),r=n(86658),s=n(46950),l=n(3226),c=n(1730),u=n(33713),d=n(9046),_=function(){function e(){}return e.saveStickerPanel=function(e,t){o.default.set("sticker_panel",e),t&&(0,a.setCookie)("remixstickers_hash",t),window.cur.sticker_panel=e},e.getStickerPanel=function(e){void 0===e&&(e=""),e||(e=(0,s.getState)("target")||"");var t=o.default.get("sticker_panel")||window.cur.sticker_panel;return t?e?t.replace(/mail0/g,e):t:""},e.saveStickers=function(t){e.stickers=t,o.default.set("stickers",t)},e.setStickerTab=function(e,t){return void 0===t&&(t=[]),this.getStickers(),this.stickers[e]?this.stickers[e].stickers=t:this.stickers[e]={stickers:t},this.saveStickers(this.stickers),this.stickers[e]},e.getStickers=function(){if(this.stickers)return this.stickers;var t=o.default.get("stickers");return t&&Object.values(t).find((function(e){return!e.hasOwnProperty("stickers")}))&&(clog("[StickerCache] Stickers cache format is outdated"),t=null),!t&&cur.stickers&&(t=cur.stickers,this.saveStickers(t)),e.stickers||(e.stickers=t),e.stickers},e.setNewStickersCount=function(t,n){var i=n||e.getStickerPanel();if(!(0,u.isNumber)(t))return n;var o=ce("div");o.innerHTML=i;var a=(0,c.$)(".sp_badge",o),r=window.devicePixelRatio>=1.5?"_2x":"";return(0,d.setStyle)(a,{"background-image":t>0?"url(/images/mobile/badge"+t+r+".png)":""}),o.innerHTML},e.checkStickers=function(t){var n=this;if(void 0===t&&(t={}),!window.vk)return setTimeout((function(){var t;return(t=n.checkStickers).call.apply(t,(0,i.__spreadArray)([e],(0,i.__read)(arguments)))}),1e3);if(window.vk.id){if(this.getStickers()&&this.getStickerPanel()&&(0,a.getCookie)("remixstickers_hash")){if(!t.force&&Date.now()-o.default.get("stickers_last_load")<3e5)return clog("[StickerCache] Stickers check was fired in less than 5 minutes. Prevent loading"),!1}else clog("[StickerCache] Stickers cache isn't loaded or broken"),(0,a.setCookie)("remixstickers_hash","");t.ignore_hash&&(0,a.setCookie)("remixstickers_hash",""),o.default.set("stickers_last_load",Date.now()),r.default.post("/?act=load_stickers",{},{onDone:function(t){if(o.default.set("stickers_last_load",Date.now()),t){if(t.part_load){clog("[StickerCache] Force loaded some categories");var n=t.stickers_data,i=t.new_items;if((0,u.isNumber)(i)){var a=e.setNewStickersCount(i);e.saveStickerPanel(a)}var r=extend(e.getStickers()||{},n);e.saveStickers(r)}else{clog("[StickerCache] New version of stickers async loaded");a=t.sticker_panel,n=t.stickers_data;e.saveStickerPanel(a,t.hash),e.saveStickers(JSON.parse(n))}e.onStickerPanelUpdate()}else clog("[StickerCache] Stickers already exists.")}})}else clog("[StickerCache] User unauthorized.")},e.stickers=null,e.onStickerPanelUpdate=(0,l.default)(),e}();t.default=_},48366:function(e,t,n){"use strict";n.d(t,{VK_MVK_APP_ID:function(){return l},makeAuthAndApiGlobal:function(){return g}});var i=n(97316),o=n(98374),a=n(53369),r=n(86353),s=6287487,l=7879029,c=!1,u=!1,d=!1,_=!1,f="QbYic1K3lEV5kTGiqlq2",p=function(e){u||((0,o.setLoginConfig)((0,i.__assign)({appId:s},e)),u=!0)},m=function(e,t,n,a){return u?(0,o.login)(e,t,n,a).then((function(e){return _=Boolean(e.access_token),e})).catch((function(e){if(console.error("[VKJS][AUTH]:",e),"unauthorized"===e.error&&"login_error"===e.type){var t=(0,r.partConfigEnabled)("loginvk_unauthorized_force_logout");if(console.error("[VKJS][AUTH]: logout "+(t?"enabled":"disabled")+" because ","loginvk_unauthorized_force_logout = ",t),t){(0,o.removeLoginCache)();var n=window.location.origin;return window.location.href=window.vk.loginDomain+"?act=logout&hash="+window.vk.ip_h+"&reason=tn&_origin="+n,new Promise((function(e,t){setTimeout((function(){return t("[VKJS][API]: forced logout")}),200)}))}}return(0,i.__assign)({access_token:"",error:!0},e)})):Promise.reject("[VKJS][LOGIN]: login didn't init. Use setLoginConfig function")},h=function(e){c?(0,a.setApiConfig)((0,i.__assign)({},e)):((0,a.setApiConfig)((0,i.__assign)({appId:s,version:"5.133",onTokenExpired:function(){return m("web_token",{},{},!0).then((function(e){return e.access_token||""}))}},e)),c=!0)},v=function(e,t,n,o){if(void 0===o&&(o={}),!c)return Promise.reject("[VKJS][API]: api didn't init. Use setApiConfig function");if(!d)return m("web_token").then((function(r){d=!0,h({accessToken:r.access_token});var s=_?t:(0,i.__assign)({client_secret:f},t);return(0,a.api)(e,s,n,o)}));var r=_?t:(0,i.__assign)({client_secret:f},t);return(0,a.api)(e,r,n,o)},g=function(){window.vkApi||(window.vkApi={api:v,login:m,setLoginConfig:p,setApiConfig:h,removeLoginCache:o.removeLoginCache})}},62643:function(e,t,n){"use strict";n.d(t,{setLoginConfig:function(){return i},setApiConfig:function(){return o},api:function(){return a},login:function(){return r}});var i=function(e){return window.vkApi?window.vkApi.setLoginConfig(e):console.error("[VKJS]: setLoginConfig didn't allowed. Use makeAuthAndApiGlobal function")},o=function(e){return window.vkApi?window.vkApi.setApiConfig(e):console.error("[VKJS]: setApiConfig didn't allowed. Use makeAuthAndApiGlobal function")},a=function(e,t,n,i){return void 0===i&&(i={}),window.vkApi?window.vkApi.api(e,t,n,i):Promise.reject("[VKJS][API]: api didn't allowed. Use makeAuthAndApiGlobal function")},r=function(e,t,n,i){return window.vkApi?window.vkApi.login(e,t,n,i):Promise.reject("[VKJS]: login didn't allowed. Use makeAuthAndApiGlobal function")}},34220:function(e,t,n){"use strict";n.d(t,{AudioHlsNode:function(){return u}});var i=n(97316),o=n(76663),a=n(82312),r=n(80781),s=n(63705),l=n(22124),c=n(51988),u=function(){function e(e,t){var n=this;this.fullyLoaded=!1,this.url="",this.audioElement=new Audio,this.audioElement.crossOrigin="anonymous",this.audioElement.preload="auto",this.volume=e.volume,this.addEventListeners(e),t&&this.setUrl(t).then((function(){n.audioElement.load()}));var i=new r.NetworkStatCollector;this.audioNetworkStatCollector=new r.AudioNetworkStatCollector(i)}return Object.defineProperty(e.prototype,"isFullyLoaded",{get:function(){return this.fullyLoaded},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"error",{get:function(){return this.audioElement.error||null},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"played",{get:function(){return this.audioElement.played},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"src",{get:function(){return this.url},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"hls",{get:function(){return this.hlsInstance||null},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"duration",{get:function(){return isFinite(this.audioElement.duration)?this.audioElement.duration:0},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"readyState",{get:function(){return this.audioElement.readyState},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"currentTime",{get:function(){return this.audioElement.currentTime},set:function(e){this.audioElement.currentTime=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"volume",{get:function(){return this.audioElement.volume},set:function(e){this.audioElement.volume=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"playbackRate",{set:function(e){this.audioElement.playbackRate=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"currentProgress",{get:function(){return isNaN(this.audioElement.duration)?0:Math.max(0,Math.min(1,this.audioElement.currentTime/this.audioElement.duration))},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"currentBuffered",{get:function(){return this.audioElement.buffered.length?Math.min(1,this.audioElement.buffered.end(0)/this.audioElement.duration):0},enumerable:!1,configurable:!0}),e.prototype.play=function(){return(0,l.wrapAudioPlay)(this.audioElement).catch((function(e){switch(e.code){case e.NOT_SUPPORTED_ERR:case e.ABORT_ERR:break;default:throw e}}))},e.prototype.pause=function(){this.audioElement.pause()},e.prototype.addEventListeners=function(e){var t=this;this.audioElement.addEventListener("pause",(function(){return e.onPause()})),this.audioElement.addEventListener("play",(function(){return e.onPlay()})),this.audioElement.addEventListener("progress",(function(){if(e.onBufferUpdate(),!t.hlsInstance){var n=t.audioElement.buffered;n.length&&Math.abs(n.end(n.length-1)-t.audioElement.duration)<1&&(t.fullyLoaded=!0)}})),this.audioElement.addEventListener("timeupdate",(function(){e.onProgressUpdate&&e.onProgressUpdate()})),this.audioElement.addEventListener("ended",(function(){e.onEnd&&e.onEnd()})),this.onFail=e.onFail||function(){},this.audioElement.addEventListener("error",(function(){t.onFail()})),this.audioElement.addEventListener("canplay",(function(){e.onCanPlay&&e.onCanPlay()})),this.audioElement.addEventListener("durationchange",(function(){e.onDurationChange&&e.onDurationChange()}))},e.isHlsUrl=function(e){return(0,o.audioUnmaskSource)(e).includes(".m3u8")},e.prototype.setUrl=function(t){var n=this,i=(0,o.audioUnmaskSource)(t);return this.url=i,e.isHlsUrl(i)&&!e.shouldUseNativeHls()&&"function"==typeof window.MediaSource?this.initHls(i).catch((function(){return n.onFail()})):(this.hlsInstance&&this.hlsInstance.destroy(),this.audioElement.src=i,this.audioElement.load(),Promise.resolve())},e.shouldUseNativeHls=function(){var e=(0,i.__read)(window.browser.version.split("."),1)[0],t=parseInt(e);return window.browser.safari||window.browser.msie_edge&&t>11&&t<78},e.prototype.initHls=function(t){var n=this;return e.loadHls().then((function(e){var o=e.default;return new Promise((function(e){var l=!1,u=!!c.default.get("_audio_hls_debug");n.hlsInstance&&n.hlsInstance.destroy();var d=new o({debug:u,maxBufferHole:3,nudgeOffset:.5,nudgeMaxRetry:5,maxFragLookUpTolerance:.2});d.on(o.Events.BUFFER_EOS,(function(){return n.fullyLoaded=!0})),d.on(o.Events.ERROR,(function(e,t){t.details===o.ErrorDetails.BUFFER_STALLED_ERROR&&(l=!0),(u||t.fatal)&&console.log("audio hls error",e,t),t.details===o.ErrorDetails.BUFFER_STALLED_ERROR&&(d.stopLoad(),d.startLoad()),t.fatal&&n.onFail({type:t.type,details:t.details,url:t.frag&&t.frag.url||t.context&&t.context.url,code:t.networkDetails?t.networkDetails.status:0})})),d.on(o.Events.FRAG_BUFFERED,(function(e,t){var o=(0,a.getCurrentAudio)(),c={owner_id:o.ownerId,audio_id:o.id,fragment_id:t.frag.sn.toString(),fragment_duration:Math.ceil(1e3*t.frag.duration).toString(),time_to_first_byte:Math.ceil(t.stats.tfirst-t.stats.trequest).toString(),time_to_first_frame:Math.ceil(t.stats.tload-t.stats.trequest).toString(),buffering_time:Math.ceil(t.stats.tbuffered-t.stats.trequest).toString()};l&&n.audioNetworkStatCollector.logEvent((0,i.__assign)((0,i.__assign)({},c),{event_type:r.AudioNetworkType.FRAGMENT_STALLED}),s.default.getConnectionType(),s.default.getConnectionEffectiveType()),l=!1,n.audioNetworkStatCollector.logEvent((0,i.__assign)((0,i.__assign)({},c),{event_type:r.AudioNetworkType.FRAGMENT_LOADED}),s.default.getConnectionType(),s.default.getConnectionEffectiveType())})),d.loadSource(t),d.attachMedia(n.audioElement),n.hlsInstance=d,e()}))}))},e.loadHls=function(){return n.e(6052).then(n.t.bind(n,79763,23))},e}()},3793:function(e,t,n){"use strict";n.d(t,{TaskName:function(){return i},AudioTaskManager:function(){return a}});var i,o=n(67334);!function(e){e.URL="url",e.PLAYBACK_RATE="playback_rate",e.DELAY="delay",e.SEEK="seek",e.PAUSE="pause",e.PLAY="play",e.VOL_SET="vol_set",e.VOL_UP="vol_up",e.VOL_DOWN="vol_down"}(i||(i={}));var a=function(){function e(e){this.impl=e,this.taskIDCounter=1,this.tasks=[],this.taskInProgress=null,this.taskAbort=null}return e.prototype.newTask=function(e,t){var n,i,o=new Promise((function(e,t){n=e,i=t}));return this.tasks.push({name:e,fn:function(){return t().then(n).catch(i)},id:e+"_"+this.taskIDCounter++}),this.doTasks(),o},e.prototype.clearAllTasks=function(){this.taskAbort=this.taskInProgress,this.taskInProgress=null,this.tasks=[]},e.prototype.clearTask=function(e){this.tasks=this.tasks||[],this.tasks=this.tasks.filter((function(t){return t.name!==e}))},e.prototype.doTasks=function(){var e=this;if(!this.taskInProgress){var t=this.tasks.shift();t&&(this.taskInProgress=t.id,this.ensureImplReady().then((function(){return t.fn()})).then((function(){e.taskAbort!==t.id?(e.taskInProgress=null,e.doTasks()):e.taskAbort=null})))}},e.prototype.ensureImplReady=function(){var e=this;return new Promise((function(t){return e.impl.onReady(t)}))},e.prototype.delay=function(e){return this.newTask(i.DELAY,(function(){return new Promise((function(t){return(0,o.setWorkerTimeout)(t,e)}))}))},e.prototype.setUrl=function(e){var t=this;return this.newTask(i.URL,(function(){return new Promise((function(n){return t.impl.setUrl(e,n)}))}))},e.prototype.seekImmediate=function(e){this.impl.seek(e)},e.prototype.seek=function(e){var t=this;return this.clearTask(i.SEEK),this.newTask(i.SEEK,(function(){return new Promise((function(n){t.seekImmediate(e),n()}))}))},e.prototype.pause=function(){var e=this;return this.newTask(i.PAUSE,(function(){return new Promise((function(t){e.impl.pause(),t()}))}))},e.prototype.play=function(){var e=this;return window.browser.safari&&this.impl.play(),this.newTask(i.PLAY,(function(){return new Promise((function(t,n){e.impl.play().then(t).catch(n)}))}))},e.prototype.setVolume=function(e,t,n){var o=this;if(void 0===n&&(n=null),t){var a=e?i.VOL_UP:i.VOL_DOWN;return this.newTask(a,(function(){return new Promise((function(t){return o.impl.fadeVolume(e,n,(function(){return t()}))}))}))}return this.newTask(i.VOL_SET,(function(){return new Promise((function(t){o.impl.setVolume(e),t()}))}))},e.prototype.updatePlaybackRate=function(e){var t=this;return this.newTask(i.PLAYBACK_RATE,(function(){return new Promise((function(n){t.impl.setPlaybackRate(e),n()}))}))},e}()},51242:function(e,t,n){"use strict";n.d(t,{EventBus:function(){return o}});var i=n(97316),o=function(){function e(){this.subscriptions={}}return e.prototype.subscribe=function(e,t){var n=this;return Array.isArray(e)&&e.forEach((function(e){return n.subscribe(e,t)})),this.subscriptions[e]||(this.subscriptions[e]=[]),this.subscriptions[e].push(t),{unsubscribe:function(){return n.unsubscribe(e,t)}}},e.prototype.unsubscribe=function(e,t){if(this.subscriptions[e]){var n=this.subscriptions[e].indexOf(t);n>=0&&this.subscriptions[e].splice(n,1)}},e.prototype.emit=function(e){for(var t=this,n=[],o=1;o<arguments.length;o++)n[o-1]=arguments[o];this.precheck&&!this.precheck.apply(this,(0,i.__spreadArray)([e],(0,i.__read)(n)))||(this.onAnyCallBack&&setTimeout((function(){return t.onAnyCallBack.apply(t,(0,i.__spreadArray)([e],(0,i.__read)(n)))})),this.subscriptions[e]&&this.subscriptions[e].forEach((function(e){return setTimeout((function(){return e.apply(void 0,(0,i.__spreadArray)([],(0,i.__read)(n)))}))})))},e}()},68887:function(e,t,n){"use strict";n.d(t,{CatalogBannerStatCollector:function(){return r}});var i=n(97316),o=n(36471),a=n(76238),r=function(){function e(e,t){var n=this;this.blockId=t;this.observed_items=[],this.observer=new IntersectionObserver((function(e){return n.onView(e)}),{root:null,rootMargin:"0px",threshold:.5}),this.productCollector=new a.ProductionStatCollector,this.viewCollector=new a.ViewStatCollector(this.productCollector),this.clickCollector=new a.ClickStatCollector(this.productCollector),this.elements=e,this.addHandlers()}return e.prototype.destroy=function(){var e=this;this.observer.disconnect(),this.observed_items.forEach((function(t,n){return e.sendViewStat(n)})),this.elements.forEach((function(t){return t.removeEventListener("mousedown",e.clickHandler)}))},e.prototype.addHandlers=function(){var e=this;this.clickHandler=this.onClick.bind(this),this.elements.forEach((function(t){return t.addEventListener("mousedown",e.clickHandler)})),this.elements.forEach((function(t){return e.observer.observe(t)}))},e.prototype.onClick=function(e){if(e.currentTarget&&e.currentTarget instanceof HTMLElement&&e.currentTarget.parentElement&&e.currentTarget.dataset.id){var t=parseInt(e.currentTarget.dataset.id),n={type:o.ClickProductionStatEventTypes.TYPE_CATALOG_BANNER_ITEM,position:(0,i.__spreadArray)([],(0,i.__read)(e.currentTarget.parentElement.children)).indexOf(e.currentTarget)+1},a={type:o.EventItemType.CATALOG_BANNER,id:t,track_code:this.blockId};this.clickCollector.logEvent(n,a)}},e.prototype.sendViewStat=function(e){if(void 0!==this.observed_items[e]){var t=(0,i.__assign)((0,i.__assign)({},this.observed_items[e]),{end_view:this.productCollector.getCurrentTime()}),n={type:o.EventItemType.CATALOG_BANNER,id:e,track_code:this.blockId};this.viewCollector.logEvent(t,n),delete this.observed_items[e]}},e.prototype.onView=function(e){var t=this;e.forEach((function(e){var n=e.target;if(n instanceof HTMLElement&&n.parentElement&&n.dataset.id){var a=parseInt(n.dataset.id);e.isIntersecting?void 0===t.observed_items[a]&&(t.observed_items[a]={type:o.ViewProductionStatEventTypes.TYPE_CATALOG_BANNER_ITEM,start_view:t.productCollector.getCurrentTime(),end_view:"0",position:(0,i.__spreadArray)([],(0,i.__read)(n.parentElement.children)).indexOf(n)+1}):t.sendViewStat(a)}}))},e}()},90128:function(e,t,n){"use strict";n.d(t,{ConsumeReason:function(){return i},BannersController:function(){return a}});var i,o=n(68887);!function(e){e.Click="click",e.Close="close"}(i||(i={}));var a=function(){function e(e,t){this.blockContent=e,this.blockId=t;var n=this.getBanners();this.bannerStatCollector=new o.CatalogBannerStatCollector(n,t)}return e.prototype.getBanners=function(){return Array.from(this.blockContent.querySelectorAll(".BannerItem"))},e.prototype.setBannersEvents=function(){var e=this;this.getBanners().forEach((function(t){if(t.dataset.id){var n=parseInt(t.dataset.id);e.addConsumableClick(t,n),e.addConsumableCloseClick(t,n)}}))},e.prototype.checkItems=function(){this.getBanners().length||this.blockContent&&this.blockContent.remove()},e.prototype.destroy=function(){this.bannerStatCollector.destroy()},e}()},40852:function(e,t,n){"use strict";n.d(t,{QueueListener:function(){return i}});var i=function(e){this.queueHandler=e}},40975:function(e,t,n){"use strict";function i(e){var t={};return e&&e.length&&e.filter((function(e){return!!e})).map((function(e){return e.queues&&e.queues[0]})).forEach((function(e){return t[e.type]=e})),t}n.d(t,{unpackQueues:function(){return i}})},53859:function(e,t,n){"use strict";n.d(t,{POST_PARAM_DONUT_DURATION:function(){return i}});var i="donut_duration"},75951:function(e,t,n){"use strict";n.d(t,{logDonutEvent:function(){return r}});var i=n(80400),o=n(36471),a=n(20453);function r(e,t){var n=(0,a.parseJSON)(e),r=n.type,s=n.type_property,l=n.params;s===o.ActionProductionStatEventTypes.TYPE_DONUT_PAYMENT_ITEM?i.donutStats.logEventAction({event_type:l.event_type,source:l.source,owner_id:l.owner_id}):t&&r===o.ProductionStatEventTypes.TYPE_NAVGO&&function(e,t){var n=t.params;if(t.typeProperty===o.NavigationProductionStatEventTypes.TYPE_DONUT_DESCRIPTION_NAV_ITEM){var a=n.owner_id,r=n.track_code;if(!n||"number"!=typeof a||"string"!=typeof r)return;i.donutStats.logEventDescriptionClick({ownerId:a,trackCode:r})}}(0,{typeProperty:s,params:l})}},80400:function(e,t,n){"use strict";n.d(t,{donutStats:function(){return s}});var i=n(97316),o=n(76238),a=n(36471),r=n(22402),s=new(function(){function e(){this.productionStatCollector=new o.ProductionStatCollector,this.actionStatCollector=new o.ActionStatCollector(this.productionStatCollector),this.navStatCollector=new o.NavigationStatCollector(this.productionStatCollector)}return e.prototype.logEventAction=function(t){return this.actionStatCollector.logEvent(e.createDonutActionStatEvent(t))},e.prototype.logEventActionView=function(e){return this.logEventAction((0,i.__assign)((0,i.__assign)({},e),{event_type:r.DonutActionEventType.PAYMENT_FORM}))},e.prototype.logEventDescriptionClick=function(t){this.navStatCollector.logEvent((0,i.__assign)((0,i.__assign)({},e.createNavStatEventBase()),e.createDescriptionClickStatEvent(t)))},e.createDonutActionStatEvent=function(e){var t;return(t={type:a.ActionProductionStatEventTypes.TYPE_DONUT_PAYMENT_ITEM})[a.ActionProductionStatEventTypes.TYPE_DONUT_PAYMENT_ITEM]=e,t},e.createNavStatEventBase=function(){return{screen:"wall",subtype:a.NavigationProductionStatEventTypes.GO}},e.createDescriptionClickStatEvent=function(t){var n;return(n={item:e.processClickParamsToEventItem(t),type:a.NavigationProductionStatEventTypes.TYPE_DONUT_DESCRIPTION_NAV_ITEM})[a.NavigationProductionStatEventTypes.TYPE_DONUT_DESCRIPTION_NAV_ITEM]={},n},e.processClickParamsToEventItem=function(e){return{type:a.EventItemType.BROWSER,owner_id:e.ownerId,track_code:e.trackCode}},e}())},21943:function(e,t,n){"use strict";n.d(t,{RecommendedGroupsEventLog:function(){return a}});var i=n(97316),o=n(51988),a=function(){function e(e,t){this.sendLogsTimeout=null,this.sendLogsProcess=!1,this.localStorageKey="recommended_groups",this.logsDataDelimiter="|",this.location=e,this.act=t}return e.prototype.sendLogs=function(){this.sendLogsTimeout&&clearTimeout(this.sendLogsTimeout),this.sendLogsTimeout=setTimeout(this.sendLogsAccept.bind(this),1e4)},e.prototype.sendLogsAccept=function(){var e=this;if(!this.sendLogsProcess){var t=this.getLogs(!0);t.length&&(this.sendLogsProcess=!0,this.clearLogs(),window.ajax.post(this.location,{act:this.act,logs:t},{onDone:function(){e.sendLogsProcess=!1},onFail:function(){return e.restoreLogs(t),e.sendLogsProcess=!1,!0}}))}},e.prototype.restoreLogs=function(e){var t=this,n=this.getLogs(),a=e.map((function(e){return e.split(t.logsDataDelimiter)})),r=(0,i.__spreadArray)((0,i.__spreadArray)([],(0,i.__read)(a)),(0,i.__read)(n));o.default.set(this.localStorageKey,r)},e.prototype.getLogs=function(e){var t=this,n=o.default.get(this.localStorageKey)||[];return e&&(n=n.map((function(e){return e.join(t.logsDataDelimiter)}))),n},e.prototype.addLog=function(e){var t=this.getLogs(),n=e.eventType,i=e.trackCode,a=e.groupId,r=a?[n,i,a]:[n,i];t.push(r),o.default.set(this.localStorageKey,t),this.sendLogs()},e.prototype.clearLogs=function(){o.default.remove(this.localStorageKey)},e}()},14116:function(e,t,n){"use strict";n.d(t,{EntityType:function(){return i},EventQueue:function(){return a}});var i,o=n(97316);!function(e){e.Online="online"}(i||(i={}));var a=function(e){var t=this,n=e.getQueue,i=e.registerQueue;this.QUEUE_KEY_TTL=3e3,this.MAX_RETRIES=5,this.listeners=[],this.retriesLeft=this.MAX_RETRIES,this.restart=function(){t.intervalId&&clearInterval(t.intervalId),0!==t.retriesLeft&&(t.retriesLeft--,t.getQueue().then((function(e){t.retriesLeft=t.MAX_RETRIES;var n=(0,o.__assign)({},e);t.intervalId=window.setInterval((function(){t.registerQueue(n,(function(e,i){var a,r,s,l;if(function(e){return void 0!==e.err}(i))t.restart();else{n.ts=i.ts;try{for(var c=(0,o.__values)(i.events),u=c.next();!u.done;u=c.next()){var d=u.value;try{for(var _=(s=void 0,(0,o.__values)(t.listeners)),f=_.next();!f.done;f=_.next())(0,f.value)(d)}catch(e){s={error:e}}finally{try{f&&!f.done&&(l=_.return)&&l.call(_)}finally{if(s)throw s.error}}}}catch(e){a={error:e}}finally{try{u&&!u.done&&(r=c.return)&&r.call(c)}finally{if(a)throw a.error}}}}))}),t.QUEUE_KEY_TTL)})).catch((function(e){console.error(e),setTimeout(t.restart,t.QUEUE_KEY_TTL)})))},this.subscribe=function(e){return t.listeners.push(e),1===t.listeners.length&&t.restart(),function(){t.listeners=t.listeners.filter((function(t){return t!==e})),0===t.listeners.length&&(t.retriesLeft=t.MAX_RETRIES,t.intervalId&&clearInterval(t.intervalId))}},this.registerQueue=i,this.getQueue=n}},85515:function(e,t,n){"use strict";n.d(t,{getMessageFromTuple:function(){return r}});var i=n(97316),o=n(54048),a=n(71372),r=function(e){var t=(0,i.__read)(e,10),n=t[0],r=t[1],s=t[2],l=t[3],c=t[4],u=t[5],d=t[6],_=t[7],f=t[8],p=t[9],m=Object.assign({},u||{},d||{});return Array.isArray(m.marked_users)&&(m.marked_users=m.marked_users.filter((function(e){return Object.values(o.MARKED_TYPE).includes(e[0])}))),{messageId:n,flags:r,peerId:s,date:l,attaches:(0,a.convertKludgesToAttaches)(m,n),subject:m.title||"",text:c,kludges:m,randomId:_,userId:(0,a.isChatPeer)(s)?Number(m.from)||0:s,update_time:p,chat_local_id:f}}},76829:function(e,t,n){"use strict";n.d(t,{createLongpollConnect:function(){return d}});var i=n(97316),o=n(27192),a=n(68660),r=n(72989);function s(e,t){e.waitAbortFns.push(t)}function l(e){if(e.isStoppedFn())return Promise.resolve({ts:0,updates:[]});var t=(0,a.plaingetCancelable)(e.url,{act:"a_check",key:e.key,version:e.version,ts:e.ts,wait:25,mode:e.mode}),n=t.request,r=t.cancel;return e.stopFn=r,window.lpDebug={startedAt:Date.now(),finishedAt:null,error:!1,request:n,cancel:r},n.then((function(t){var n=(0,i.__read)(t,2),o=n[0],a=n[1];return window.lpDebug&&(window.lpDebug=(0,i.__assign)((0,i.__assign)({},window.lpDebug),{finishedAt:Date.now(),request:null,cancel:null})),e.onData(e,a),e.waitTimeout=2,JSON.parse(o)})).catch((function(t){var n=(0,i.__read)(t,2)[1];return window.lpDebug&&(window.lpDebug=(0,i.__assign)((0,i.__assign)({},window.lpDebug),{finishedAt:Date.now(),error:!0,request:null,cancel:null})),e.onData(e,n),Promise.reject(new Error(""))})).then((function(t){return function(e,t){var n=t.failed?(0,o.abortablePause)(4,null):{abort:function(){},pause:function(){return Promise.resolve()}},a=n.abort,r=n.pause;switch(t.failed){case 1:return s(e,a),e.onHistoryLost(e,t).then((function(){return e.onResult({ts:t.ts,updates:[[-1]]})})).then(r).then((function(){return l(e)}));case 2:return s(e,a),e.onKeyExpired(e,t).then((function(t){var n=(0,i.__read)(t,4),o=n[0],a=n[1],r=n[2],s=n[3];return e.onResult({ts:+s,updates:[[-2,o,a+"/"+r],[-1]]})})).then(r).then((function(){return l(e)}));case 3:return e.onLpBroken(e,t);default:return t.updates.some((function(e){switch(e[0]){case 4:return 4===e.length;case 5:case 18:return 3===e.length;default:return!1}}))?e.onHistoryLost(e,t).then((function(){return e.onResult({ts:t.ts,updates:[[-1]]})})).then(r).then((function(){return l(e)})):Promise.resolve(t)}}(e,t)}))}function c(e){e.isStoppedFn()||l(e).then(e.onResult.bind(e)).then((function(){return e.isReconnecting&&u(e,-5)})).catch((function(t){return function(e,t){if(e.isStoppedFn())return;e.onRequestError(t),e.waitTimeout=Math.min(60,2*e.waitTimeout),u(e,-3);var n=(0,o.abortablePause)(e.waitTimeout,null),i=n.abort,a=n.pause;return s(e,i),a().then((function(){return u(e,-4)}))}(e,t)})).then((function(){return c(e)}))}function u(e,t){e.isReconnecting=-4===t,e.onResult({ts:e.ts,updates:[[t,e.waitTimeout]]})}function d(e,t){var n=!!e.stopped,i={id:e.id,key:e.key,ts:e.ts,url:e.url,lpstat:e.lpstat||0,version:e.version||14,mode:1226,waitTimeout:2,waitAbortFns:[],isReconnecting:!1,isStoppedFn:function(){return n},onResult:function(e){e.ts&&a(i.ts,e.ts,e.updates.map(r.constructEvent))},onData:_(t.onData),onRequestError:_(t.onRequestError),onHistoryLost:f(t.onHistoryLost),onKeyExpired:f(t.onKeyExpired),onLpBroken:f(t.onHistoryLost)},o=t.onEvents;function a(e,t,n){i.ts=t;for(var a=0;a<n.length;++a)n[a].type===r.REFRESH_LP_KEY&&(i.key=n[a].key||"",i.url=n[a].url||"");o(e,t,n)}var s={options:i,isStopped:function(){return n},stopConnection:function(){n=!0,i.stopFn&&i.stopFn(),i.stopFn=void 0,document.removeEventListener("resume",l),this.abortWaiting()},reinitConnection:function(){this.stopConnection(),document.addEventListener("resume",l),u(i,-4),n=!1,c(i)},abortWaiting:function(){i.waitAbortFns.forEach((function(e){return e()})),i.waitAbortFns=[],i.waitTimeout=2},onLp:a};function l(){s.abortWaiting()}return document.addEventListener("resume",l),c(i),s}function _(e){return e||function(){}}function f(e){return e?function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];return Promise.resolve(e.apply(void 0,(0,i.__spreadArray)([],(0,i.__read)(t))))}:function(){return Promise.reject()}}},72989:function(e,t,n){"use strict";n.d(t,{constructEvent:function(){return a},SET_FLAGS:function(){return s},REPLACE_FLAGS:function(){return l},RESET_FLAGS:function(){return c},ADD_MESSAGE:function(){return u},READ_INBOUND:function(){return d},READ_OUTBOUND:function(){return _},CONVERSATION_UPDATED:function(){return p},TYPING:function(){return m},RECORDING_AUDIO:function(){return h},VIDEO_CALL:function(){return v},UNREAD_COUNT:function(){return g},NOTIFY_SETTINGS_CHANGED:function(){return A},KEYBOARD_CALLBACK_RECEIVED:function(){return y},RESET_DIRECTORIES:function(){return S},REPLACE_DIRECTORIES:function(){return b},SET_DIRECTORIES:function(){return k},RESYNC:function(){return C},REFRESH_LP_KEY:function(){return E},DELETE_DIALOG:function(){return I},EDIT_MESSAGE:function(){return T},REPLACE_MESSAGE:function(){return M},INCOMING_CALL:function(){return B},CONVO_MAJOR_ID_CHANGED:function(){return D},CONVO_MINOR_ID_CHANGED:function(){return O},FLAG_OUTBOUND:function(){return F},FLAG_IMPORTANT:function(){return V},FLAG_SPAM:function(){return j},FLAG_DELETED:function(){return $},FLAG_STEALTH:function(){return q},FLAG_HAS_REPLY:function(){return W},FLAG_AUDIO_MESSAGE_LISTENED:function(){return G},FOLDER_IMPORTANT:function(){return Y},FOLDER_AD_TAG:function(){return K},FOLDER_MARKED_UNREAD:function(){return Q},MAIL_CHAT_UPDATE_TYPE_CALL_IN_PROGRESS_CHANGED:function(){return z},MAIL_CHAT_UPDATE_TYPE_IS_NEW_CHANGED:function(){return X}});var i=n(97316),o=n(85515);n(17999);function a(e){switch(e[0]){case 0:return t=e,n=(0,i.__read)(t,2)[1],{type:r,localId:n};case 1:return function(e){var t=(0,i.__read)(e,4),n=t[1],o=t[2],a=t[3];return{type:l,messageId:n,mask:o,peerId:a}}(e);case 2:return function(e){var t=(0,i.__read)(e,4),n=t[1],o=t[2],a=t[3];return{type:s,messageId:n,flags:o,peerId:a}}(e);case 3:return function(e){var t=(0,i.__read)(e,4),n=t[1],o=t[2],a=t[3];return{type:c,messageId:n,flags:o,peerId:a}}(e);case 4:return function(e){var t=(0,i.__read)(e,12),n=t[1],a=t[2],r=t[3],s=t[4],l=t[5],c=t[6],d=t[7],_=t[8],f=t[9],p=t[10],m=t[11];return(0,i.__assign)((0,i.__assign)({type:u},(0,o.getMessageFromTuple)([Number(n),Number(a),Number(s),Number(l),c,d,_,f,p,m])),{minorSortId:r})}(e);case 5:return J(e);case 6:return function(e){var t=(0,i.__read)(e,4),n=t[1],o=t[2],a=t[3];return{type:d,peerId:n,upToId:o,unread:a}}(e);case 7:return function(e){var t=(0,i.__read)(e,4),n=t[1],o=t[2],a=t[3];return{type:_,peerId:n,upToId:o,unread:a}}(e);case 10:return function(e){var t=(0,i.__read)(e,4),n=t[1],o=t[2],a=t[3];return{type:S,peerId:n,mask:o,local:void 0!==a&&a}}(e);case 11:return function(e){var t=(0,i.__read)(e,3),n=t[1],o=t[2];return{type:b,peerId:n,mask:o}}(e);case 12:return function(e){var t=(0,i.__read)(e,4),n=t[1],o=t[2],a=t[3];return{type:k,peerId:n,mask:o,local:void 0!==a&&a}}(e);case 13:return function(e){var t=(0,i.__read)(e,3),n=t[1],o=t[2];return{type:I,peerId:n,localId:o}}(e);case 18:return function(e){var t=(0,i.__read)(e,11),n=t[1],a=t[2],r=t[3],s=t[4],l=t[5],c=t[6],u=t[7],d=t[8],_=t[9],f=t[10];return(0,i.__assign)({type:M},(0,o.getMessageFromTuple)([Number(n),Number(a),Number(r),Number(s),l,c,u,d,_,f]))}(e);case 19:return function(e){var t=(0,i.__read)(e,2)[1];return{type:P,messageId:t}}(e);case 20:return function(e){var t=(0,i.__read)(e,3),n=t[1],o=t[2];return{type:D,peerId:n,majorId:o}}(e);case 21:return function(e){var t=(0,i.__read)(e,3),n=t[1],o=t[2];return{type:O,peerId:n,minorId:o}}(e);case 23:return function(e){var t=(0,i.__read)(e,3),n=t[1],o=t[2];return{type:U,peerId:n,peerTagsMask:o}}(e);case 51:return function(e){var t=(0,i.__read)(e,3),n=t[1],o=t[2];return{type:f,chatId:n,self:o}}(e);case 52:return function(e){var t=(0,i.__read)(e,4),n=t[1],o=t[2],a=t[3];return{type:p,peerId:o,updateType:n,updateArg:a}}(e);case 63:return function(e){var t=(0,i.__read)(e,5),n=t[1],o=t[2],a=t[3],r=t[4];return{type:m,peerId:n,userIds:o,totalCount:a,ts:r}}(e);case 64:return function(e){var t=(0,i.__read)(e,5),n=t[1],o=t[2],a=t[3],r=t[4];return{type:h,peerId:n,userIds:o,totalCount:a,ts:r}}(e);case 70:return function(e){var t=(0,i.__read)(e,3),n=t[1],o=t[2];return{type:v,userId:n,callId:o}}(e);case 80:return function(e){var t=(0,i.__read)(e,10),n=t[1],o=t[2],a=t[3],r=t[4],s=t[5],l=t[6],c=t[7],u=t[8],d=t[9];return{type:g,count:n,countNotMuted:o,showOnlyNotMuted:a,businessNotifyUnread:r,headerTotalUnread:s,headerNotMutedUnread:l,archiveUnreadCount:c,archiveUnreadUnmutedCount:u,archiveMentionsCount:d}}(e);case 114:return function(e){var t=(0,i.__read)(e,2)[1]||{},n=t.peer_id,o=t.sound,a=t.disabled_until;return{type:A,peerId:n,sound:o,disabledUntil:a}}(e);case 115:return function(e){var t=(0,i.__read)(e,2)[1];return{type:B,payload:t}}(e);case 116:return function(e){var t=(0,i.__read)(e,2)[1]||{},n=t.id,o=t.flags,a=t.peer_id,r=t.date,s=t.message,l=t.kludges,c=t.random_id,u=t.chat_local_id,d=t.update_time,_=t.title;return J([5,n,o,a,r,s,Object.assign({},l||{},{title:_||""}),{},c,u,d])}(e);case 117:return function(e){var t=(0,i.__read)(e,2)[1]||{},n=t.uuid,o=t.device_name;return{type:L,uuid:n,deviceName:void 0===o?"":o}}(e);case 119:return function(e){var t=(0,i.__read)(e,2)[1],n=t.event_id,o=t.owner_id,a=t.peer_id,r=t.action;return{type:y,event_id:n,owner_id:o,peer_id:a,action:r}}(e);case 120:return{type:H};case-1:return{type:C};case-2:return function(e){var t=(0,i.__read)(e,3),n=t[1],o=t[2];return{type:E,key:n,url:o}}(e);case-3:return function(e){var t=(0,i.__read)(e,2)[1];return{type:N,timeout:t}}(e);case-4:return{type:R};case-5:return{type:x};default:return function(e){return{type:w,params:e}}(e)}var t,n}var r="event_delete",s="event_set_flags",l="event_replace_flags",c="event_reset_flags",u="event_add_message",d="event_read_inbound",_="event_read_outbound",f="event_chat_changed",p="event_chat_updated",m="event_typing",h="event_recoding_audio",v="event_video_call",g="event_unread_count",A="event_notify_settings_changed",y="event_keyboard_callback_received",w="event_empty",S="event_reset_directories",b="event_replace_directories",k="event_set_directories",C="event_resync",E="event_refresh_lp_key",I="event_delete_dialog",T="event_edit_message",M="event_replace_message",P="event_invalidate_event",L="event_audio_start",N="event_waiting_for_reconnect",R="event_reconnecting",x="event_reconnected",B="incoming_call",D="event_convo_major_id_changed",O="event_convo_minor_id_changed",U="peer_tags_changed",H="peer_profile_tags_changed",F=2,V=8,j=64,$=128,q=65536,W=1<<21,G=4096,Y=1,K=32768,Q=1<<20,z=19,X=22;function J(e){var t=(0,i.__read)(e,11),n=t[1],a=t[2],r=t[3],s=t[4],l=t[5],c=t[6],u=t[7],d=t[8],_=t[9],f=t[10];return(0,i.__assign)({type:T},(0,o.getMessageFromTuple)([Number(n),Number(a),Number(r),Number(s),l,c,u,d,_,f]))}},4819:function(e,t,n){"use strict";n.d(t,{createLongpollEventsQueue:function(){return o}});var i=n(97316);function o(e,t,n){var o=0,a=e,r=[],s=!1;function l(){!r.length||o>0||s||(t(r),r=[])}return{pause:function(){o++},resume:function(){o>0&&(o--,l())},onLp:function(e,t,o){s||(a>=e?(a=t,r.push.apply(r,(0,i.__spreadArray)([],(0,i.__read)(o))),l()):n&&(s=!0,n(a).then((function(e){var t=(0,i.__read)(e,3),n=t[1],o=t[2];a=n,s=!1,r.push.apply(r,(0,i.__spreadArray)([],(0,i.__read)(o))),l()}))))}}}},68660:function(e,t,n){"use strict";n.d(t,{post:function(){return a},plaingetCancelable:function(){return r}});var i=n(97316),o=n(82408);function a(e,t,n){return t&&(t.im_v=3),new Promise((function(o,a){window.ajax.post(e,t,{timeout:n,onDone:function(){o.apply(null,[(0,i.__spreadArray)([],(0,i.__read)(arguments))])},onFail:function(){return a.apply(null,(0,i.__spreadArray)([],(0,i.__read)(arguments))),!0}})}))}function r(e,t,n){void 0===n&&(n={});var i=new XMLHttpRequest;return{request:new Promise((function(a,r){var s,l=Date.now(),c=n.timeout||60,u=(0,o.toQueryString)(t);i.onreadystatechange=function(){4==i.readyState&&(window.clearInterval(s),i.status>=200&&i.status<300?a([i.responseText,i]):r([i.responseText,i]))};try{i.open("GET",e+"?"+u,!0)}catch(e){return r([e,i])}i.send(),s=window.setInterval((function(){Date.now()-l>1e3*c&&(window.browser.safari&&i.abort(),r(["",{}]),window.clearInterval(s))}),1e3)})),cancel:function(){i.abort()}}}},54048:function(e,t,n){"use strict";var i;n.d(t,{MARKED_TYPE:function(){return i}}),function(e){e[e.MENTIONS=1]="MENTIONS",e[e.CASPER=2]="CASPER"}(i||(i={}))},50344:function(e,t,n){"use strict";n.d(t,{BestFriendsEventType:function(){return i},sendBestFriendsAnalytic:function(){return r}});var i,o=n(86900),a=n(86353);function r(e,t){var n={event_type:e,nav_screen:t||window.cur.module};(0,a.partConfigEnabled)("best_friends_analytics_log")&&console.log(n),(0,o.statlogsValueEvent)("best_friends_product_analytic",n)}!function(e){e.addFriendsFromChat="add_friends_from_chat",e.clear="clear",e.moreChats="more_chats",e.selectFriendFromSearch="select_friend_from_search",e.selectChatFromSearch="select_chat_from_search",e.saveBestFriendsList="save_best_friends_list",e.updatePopupSave="update_popup_save",e.updatePopupCancel="update_popup_cancel",e.createPostFromPopupBest="create_post_from_popup_best",e.createPostFromPopupFriends="create_post_from_popup_friends",e.clickToLockFriends="click_to_lock_friends",e.clickToLockBestFriends="click_to_lock_best_friends",e.editBestFriendsFromPopup="edit_best_friends_from_popup",e.editBestFriends="edit_best_friends",e.selectBestFriends="select_best_friends",e.clickToBestFriendsEntrypoint="click_to_best_friends_entrypoint"}(i||(i={}))},49050:function(e,t,n){"use strict";var i;n.d(t,{BatchOperationType:function(){return i}}),function(e){e.Add="add",e.Delete="delete"}(i||(i={}))},20453:function(e,t,n){"use strict";n.d(t,{parseJSON:function(){return a}});var i=n(11386),o=n(85124);function a(e){try{return JSON.parse(e)}catch(n){var t={environment:"parseJsonError",breadcrumb:{message:"Uncaught json parse error",data:{json:e},category:o.customBreadcrumbCategory}};return(0,i.logError)(n,t),{}}}},29629:function(e,t,n){"use strict";n.d(t,{MAX_STORY_VIDEO_DURATION:function(){return a},getStoryUploadUrl:function(){return r},saveStoryOnServer:function(){return s}});var i=n(97316),o=(n(17999),n(36557)),a=16;function r(e){return new Promise((function(t,n){window.ajax.post((0,o.isMvk)()?"stories.php":"al_stories.php",(0,i.__assign)({act:"get_upload_url"},e),{onDone:t,onError:n,onFail:n})}))}function s(e,t){return new Promise((function(n,i){window.ajax.post((0,o.isMvk)()?"stories.php":"al_stories.php",{act:"save",upload_result:e,hash:t},{onDone:n,onError:i,onFail:i})}))}},15797:function(e,t,n){"use strict";var i,o,a,r,s;n.d(t,{StoryType:function(){return i},StoryEntryPoint:function(){return o},StorySource:function(){return a}}),function(e){e.PHOTO="photo",e.VIDEO="video",e.LIVE="live"}(i||(i={})),function(e){e.SWIPE="swipe",e.NAVIGATION_BUTTON="navigation_button",e.SIT_POSTING="sit_posting",e.LINK="link",e.STORY_REPLY="story_reply",e.STORY_REPOST="story_repost",e.CATALOG_ADD="catalog_add",e.DIALOG="dialog",e.STORY_LIVE_FINISHED="story_live_finished",e.DIALOG_VKME="dialog_vkme",e.STORY_VIEWER_FINISHED="story_viewer_finished",e.PUSH_TRY_MASK="push_try_mask",e.STORY_VIEWER_TRY_MASK="story_viewer_try_mask",e.LINK_MASK="link_mask",e.POSTING="posting",e.NEW_STORY_AVATAR="new_story_avatar",e.STORY_REPLIES_LIST="story_replies_list",e.STORIES_FEED="stories_feed",e.STORIES_SEARCH_NEWS="stories_search_news",e.QUESTION_STICKER="question_sticker",e.LIST_MIDDLE="list_middle",e.ARCHIVE_EMPTY_BUTTON="archive_empty_button",e.ARCHIVE_MENU_BUTTON="archive_menu_button",e.IM="im",e.PROFILE_BUTTON="profile_button",e.SHARE="share",e.MINI_APP="mini_app",e.SYSTEM_SHARING="system_sharing",e.SHORTCUT="shortcut",e.ARCHIVE_SHARING="archive_sharing",e.STORY_VIEWER_CAMERA_BUTTON="story_viewer_camera_button",e.STORY_VIEWER_MUSIC="story_viewer_music",e.STORY_VIEWER_MUSIC_SHEET="story_viewer_music_sheet",e.REPOST_TO_STORY_ACTIVITY="repost_to_story_activity",e.CHANGE_AVATAR="change_avatar"}(o||(o={})),function(e){e.FEED="feed",e.FEED_MIDDLE="feed_middle",e.LINK="link",e.PROFILE="profile",e.IM_DIALOGS="im_dialogs",e.IM_DIALOG_HEADER="im_dialog_header",e.SNIPPET="snippet",e.REPLY="reply",e.REPLIES_LIST="replies_list",e.REPLY_STORY="reply_story",e.DISCOVER="discover",e.STORIES_MANAGE="stories_manage",e.USER_PERSONAL_CARD="user_personal_card",e.GROUP_PERSONAL_CARD="group_personal_card",e.NARRATIVE_SNIPPET="narrative_snippet",e.NARRATIVE_STORY="narrative_story",e.NARRATIVE_LINK="narrative_link",e.NARRATIVE_RECOMMENDATIONS="narrative_recommendations",e.NARRATIVE_SECTION="narrative_section",e.FAVE="fave",e.SPAMFEED="sf",e.ADS_PREVIEW="ads_preview",e.LIST_MIDDLE="list_middle",e.PLACE_STORY_LIST="place_story_list",e.SEARCH_STORY_LIST="search_story_list",e.STORY_ARCHIVE="story_archive",e.IM_MSG_LIST="im_msg_list",e.NOSPAM="nospam",e.PROFILE_SNACKBAR="profile_snackbar"}(a||(a={})),function(e){e.stories="stories",e.communityGroupedStories="community_grouped_stories",e.appGroupedStories="app_grouped_stories",e.discover="discover"}(r||(r={})),function(e){e.feed="feed",e.groups="groups",e.apps="apps",e.discover="discover"}(s||(s={}))},80876:function(e,t,n){"use strict";n.d(t,{MarketAnalyticsManager:function(){return o}});var i={screens:[],hash:"",replacedScreen:"",isEnabled:!1},o={setHash:function(e){i.hash=e},getHash:function(){return i.hash},getScreens:function(){var e=[];return i.screens.forEach((function(t){e.push(t)})),e},replaceScreen:function(e){i.replacedScreen=e},setScreen:function(e){i.screens.push(e),i.screens.length>5&&i.screens.shift()},getScreen:function(){return""!==i.replacedScreen?i.replacedScreen:i.screens.length>0?i.screens[i.screens.length-1]:""},getPrevScreen:function(){return i.screens.length>1?i.screens[i.screens.length-2]:""},popScreen:function(){return i.screens.length>0?String(i.screens.pop()):""},setEnabled:function(e){i.isEnabled=e},isEnabled:function(){return i.isEnabled}}},20266:function(e,t,n){"use strict";n.d(t,{clickStat:function(){return a}});var i=n(76238),o=new i.ProductionStatCollector,a=new i.ClickStatCollector(o)},61209:function(e,t,n){"use strict";var i,o;n.d(t,{MODULE_THROTTLE_MS:function(){return s},IGNORED_MODULES:function(){return l},MODULE_SKIP_RATIO:function(){return c},PoorValueOf:function(){return u}});var a="mvk"===(null===(o=null===(i=window.vk)||void 0===i?void 0:i.statsMeta)||void 0===o?void 0:o.platform),r=36e5,s={feed:8*r,im:6*r,profile:6*r,audio:6*r,apps:6*r,group:4*r,groups:4*r,public:4*r,video:8*r,wall:8*r,board:4*r,photos:4*r,activation:6*r,"i-oauth":6*r,mail:6*r},l=["unknown","app","docs","invite","wall_donut","wall_archive","support","helpdesk","abuse","noSpam","sf"],c=a?{group:.05,index:.05,profile:.05,video:.1,feed:.05,mail:.1,wall:.2,login:.2,"i-oauth":.05,notifications:.3,recommended:.3,search:.4,menu:.4,join:.5}:{feed:.025,im:.05,profile:.075,public:.1,groups:.2,groups_list:.3,audio:.3,photos:.3,friends:.4,board:.5,video:.5,wall:.5},u={FID:300,LCP:4e3,CLS:.25,TTFB:600,FCP:3e3}},33127:function(e,t,n){"use strict";n.d(t,{NavigationProductionStatEventTypes:function(){return i.NavigationProductionStatEventTypes},navigationStat:function(){return a}});var i=n(76238),o=new i.ProductionStatCollector,a=new i.NavigationStatCollector(o)},38225:function(e,t,n){"use strict";n.d(t,{AudioNetworkStatCollector:function(){return o}});var i=n(39912),o=function(){function e(e){this.networkStatCollector=e}return e.prototype.logEvent=function(e,t,n){var o,a=((o={network_type:t,network_effective_type:n,type:i.NetworkStatEventTypes.TYPE_NETWORK_AUDIO_ITEM})[i.NetworkStatEventTypes.TYPE_NETWORK_AUDIO_ITEM]=e,o);this.networkStatCollector.logEvent(a)},e}()},80781:function(e,t,n){"use strict";n.d(t,{NetworkStatCollector:function(){return i.NetworkStatCollector},NetworkStatCollectorInstance:function(){return i.NetworkStatCollectorInstance},AudioNetworkStatCollector:function(){return o.AudioNetworkStatCollector},AudioNetworkType:function(){return a.AudioNetworkType}});var i=n(80024),o=n(38225),a=n(39912)},66239:function(e,t,n){"use strict";n.d(t,{ModuleNavigationStatCollector:function(){return d}});var i=n(97316),o=n(39912),a=n(63705),r=n(33127),s=n(86353),l=n(61209),c=n(36557),u=n(24801),d=function(){function e(t,n){this.moduleNavigationStatCollector=t,this.storage=n,this.storage.setItem(e.LS_LOCK_NAME,JSON.stringify(this.getActualNavDurationTimestamps()))}return e.prototype.getActualNavDurationTimestamps=function(){return Object.entries(this.getNavDurationTimestamps()).reduce((function(e,t){var n,o=(0,i.__read)(t,2),a=o[0],r=o[1],s=r+u.MODULE_THROTTLE_MS[a];return s&&s>Date.now()?(0,i.__assign)((0,i.__assign)({},e),((n={})[a]=r,n)):e}),{})},e.prototype.getNavDurationTimestamps=function(){var t={};try{t=JSON.parse(this.storage.getItem(e.LS_LOCK_NAME)||"{}")}catch(e){}return t},e.clearPerformanceMeasures=function(e){var t=u.ModuleNavigationStatMarks[e],n=t.PERF_MARK,i=t.PERF_MEASURE;"performance"in window&&(window.performance.clearMeasures(i),window.performance.clearMarks(n))},e.measurementMustBeSkipped=function(e){return l.IGNORED_MODULES.includes(e)||(0,s.randEnabled)(1-(l.MODULE_SKIP_RATIO[e]||1))},e.prototype.logEvent=function(){var t,n,s,l,c,d,_,f="mvk"===(null===(l=null===(s=window.vk)||void 0===s?void 0:s.statsMeta)||void 0===l?void 0:l.platform)?"mvk":"web2",p=a.default.getConnectionEffectiveType(),m=r.navigationStat.getModule();try{var h=u.ModuleNavigationStatMarks[f],v=h.PERF_MARK,g=h.PERF_MEASURE;window.performance.measure(g,v),d=null===(c=window.performance.getEntriesByType("measure").find((function(e){return e.name===g})))||void 0===c?void 0:c.duration}catch(e){}if(e.clearPerformanceMeasures(f),d&&!e.measurementMustBeSkipped(m)){if(Object.keys(u.MODULE_THROTTLE_MS).includes(m)){var A=Date.now(),y=this.getNavDurationTimestamps();if(void 0===(_=y[m])&&(_=0),_+u.MODULE_THROTTLE_MS[m]>=A)return;this.storage.setItem(e.LS_LOCK_NAME,JSON.stringify((0,i.__assign)((0,i.__assign)({},y),((t={})[m]=A,t))))}this.moduleNavigationStatCollector.logEvent(((n={network_type:"UNKNOWN",network_effective_type:p,type:o.NetworkStatEventTypes.TYPE_MODULE_NAVIGATION_STATS_ITEM})[o.NetworkStatEventTypes.TYPE_MODULE_NAVIGATION_STATS_ITEM]={module:m,value:Math.round(d).toString()},n))}},e.LS_LOCK_NAME="NAV_DURATION_TIMESTAMPS_"+((0,c.isMvk)()?"MVK":"WEB"),e}()},80024:function(e,t,n){"use strict";n.d(t,{NetworkStatCollector:function(){return a},NetworkStatCollectorInstance:function(){return r}});var i=n(11386),o=n(24961),a=function(){function e(){}return e.prototype.logEvent=function(e){e.type&&e[e.type]?(0,o.saveNetworkStats)(e):(0,i.logError)(new Error("NetworkStatCollector: invalid event."))},e}(),r=new a},39912:function(e,t,n){"use strict";var i,o;n.d(t,{NetworkStatEventTypes:function(){return i},AudioNetworkType:function(){return o}}),function(e){e.TYPE_NETWORK_AUDIO_ITEM="type_network_audio_item",e.TYPE_MODULE_NAVIGATION_STATS_ITEM="type_module_navigation_stats_item"}(i||(i={})),function(e){e.FRAGMENT_LOADED="fragment_loaded",e.FRAGMENT_STALLED="fragment_stalled"}(o||(o={}))},62372:function(e,t,n){"use strict";n.d(t,{customMetricsCollector:function(){return a}});var i=n(36471),o=n(76238),a=new(function(){function e(){this.productionStatCollector=new o.ProductionStatCollector,this.actionStatCollector=new o.ActionStatCollector(this.productionStatCollector)}return e.prototype.logEvent=function(e){var t;return this.actionStatCollector.logEvent(((t={type:i.ActionProductionStatEventTypes.TYPE_CUSTOM_METRICS_ITEM})[i.ActionProductionStatEventTypes.TYPE_CUSTOM_METRICS_ITEM]=e,t))},e}())},49771:function(e,t,n){"use strict";n.d(t,{messagingActionItemStatCollector:function(){return a}});var i=n(36471),o=n(76238),a=new(function(){function e(){this.productStatCollector=new o.ProductionStatCollector,this.actionStatCollector=new o.ActionStatCollector(this.productStatCollector)}return e.prototype.logEvent=function(e,t){var n,o={peer_id:e,action_type:t},a=((n={type:i.ActionProductionStatEventTypes.TYPE_MESSAGING_ACTION_ITEM})[i.ActionProductionStatEventTypes.TYPE_MESSAGING_ACTION_ITEM]=o,n);this.actionStatCollector.logEvent(a)},e}())},22402:function(e,t,n){"use strict";var i,o;n.d(t,{DonutActionEventType:function(){return i},DonutActionEventScreen:function(){return o}}),function(e){e.PAYMENT_FORM="payment_form",e.PAYMENT_FORM_CLICK_OFFER="payment_form_click_offer",e.PAYMENT_FORM_CLICK_PAY="payment_form_click_pay",e.PAYMENT_FORM_CLICK_CLOSE="payment_form_click_close",e.PAYMENT_FORM_CHANGE_CLICK_CHANGE="payment_form_change_click_change",e.CLICK_SHOW_MORE="click_show_more",e.WIDGET_VIEW="widget_view",e.DESCRIPTION_VIEW="description_view"}(i||(i={})),function(e){e.PAYMENT_START="payment_start",e.DATA_ACCESS="data_access",e.RESULT_PAYMENT_SUCCESS_OK="result_payment_success_ok",e.RESULT_PAYMENT_SUCCESS_WAITING="result_payment_success_waiting",e.RESULT_PAYMENT_SUCCESS_WAITING_TIMEOUT="result_payment_success_waiting_timeout",e.RESULT_RESUB_SUCCESS_WAITING="result_resub_success_waiting",e.RESULT_RESUB_SUCCESS_WAITING_OK="result_resub_success_waiting_ok",e.RESULT_PAYMENT_UNAVAILABLE="result_payment_unavailable",e.RESULT_PAYMENT_CANCEL="result_payment_cancel",e.RESULT_ERROR="result_error",e.CHANGE_START="change_start",e.RESULT_CHANGE_ERROR="result_change_error",e.RESULT_CHANGE_SUCCESS_OK="result_change_success_ok",e.RESULT_CHANGE_SUCCESS_WAITING="result_change_success_waiting",e.RESULT_CHANGE_SUCCESS_WAITING_TIMEOUT="result_change_success_waiting_timeout",e.RESULT_CHANGE_UNAVAILABLE="result_change_unavailable",e.UNKNOWN="donut_payment_screen_unknown"}(o||(o={}))},69041:function(e,t,n){"use strict";n.d(t,{ContactRecommendationCollector:function(){return a}});var i=n(36471),o=n(76238),a=new(function(){function e(){this.productionStatCollector=new o.ProductionStatCollector,this.clickStatCollector=new o.ClickStatCollector(this.productionStatCollector),this.actionStatCollector=new o.ActionStatCollector(this.productionStatCollector)}return e.prototype.logEvent=function(e){var t,n;switch(e.event_type){case"click":var o=((t={type:i.ClickProductionStatEventTypes.TYPE_MESSAGING_CONTACT_RECOMMENDATIONS_ITEM,position:e.position})[i.ClickProductionStatEventTypes.TYPE_MESSAGING_CONTACT_RECOMMENDATIONS_ITEM]=e,t),a={type:i.EventItemType.TYPE_MESSAGING_CONTACT_RECOMMENDATIONS_ITEM};return this.clickStatCollector.logEvent(o,a);case"show":case"hide":o=((n={type:i.ActionProductionStatEventTypes.TYPE_MESSAGING_CONTACT_RECOMMENDATIONS_ITEM})[i.ActionProductionStatEventTypes.TYPE_MESSAGING_CONTACT_RECOMMENDATIONS_ITEM]=e,n);return this.actionStatCollector.logEvent(o)}},e}())},41707:function(e,t,n){"use strict";function i(e,t,n){var i=new FormData,o=e.map((function(e){return 31*e}));return i.append("waveform",JSON.stringify(o)),i.append("file",t,"voice_message."+function(e){var t=e.match(/.*\/(\w*).*/);if(!t)return"";switch(t[1]){case"mpeg":return"mp3";case"ogg":case"webm":case"wav":return t[1]}return""}(n)),i}n.d(t,{getFormData:function(){return i}})},80576:function(e,t,n){"use strict";n.d(t,{UnauthorizedSourceType:function(){return i}});var i={PHOTO:"photo",VIDEO:"video",AUDIO:"audio",COMMENTS:"comments"}},43520:function(e,t,n){"use strict";n.d(t,{WorkiSnippetStats:function(){return s}});var i=n(20266),o=n(4360),a=n(18448),r=new o.WorkiClickStatCollector(i.clickStat),s=new a.WorkiSnippetItemStatCollector(r)},80479:function(e,t,n){"use strict";var i;n.d(t,{WorkiSnippetEventNames:function(){return i}}),function(e){e.CLICK_CTA="click_cta",e.CLICK_CALL="click_call"}(i||(i={}))},4360:function(e,t,n){"use strict";n.d(t,{WorkiClickStatCollector:function(){return o}});var i=n(36471),o=function(){function e(e){this.clickStatCollector=e}return e.prototype.logEvent=function(e,t){var n,o=((n={type:i.ClickProductionStatEventTypes.TYPE_WORKI_CLICK})[i.ClickProductionStatEventTypes.TYPE_WORKI_CLICK]=e,n);this.clickStatCollector.logEvent(o,t)},e}()},18448:function(e,t,n){"use strict";n.d(t,{WorkiSnippetItemStatCollector:function(){return o}});var i=n(36471),o=function(){function e(e){this.workiClickStatCollector=e}return e.prototype.logEvent=function(e){var t,n=((t={type:i.WorkiEventTypes.TYPE_WORKI_SNIPPET_ITEM})[i.WorkiEventTypes.TYPE_WORKI_SNIPPET_ITEM]=e,t.screen=window.cur.module,t),o={type:i.EventItemType.WORKI_SNIPPET};this.workiClickStatCollector.logEvent(n,o)},e}()}},function(e){"use strict";e.O(0,[4736,4578,6855,5456,6199,4839,3674,9955,5273,9030,7125,1014,6444,4144],(function(){return t=21922,e(e.s=t);var t}));e.O()}]);